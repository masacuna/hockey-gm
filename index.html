<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hockey GM Simulator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #1e293b 0%, #1e3a8a 50%, #1e293b 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 3rem 1.5rem;
        }
        h1 {
            font-size: 3rem;
            font-weight: 900;
            text-align: center;
            margin-bottom: 2rem;
            background: linear-gradient(to right, #60a5fa, #22d3ee);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .subtitle {
            font-size: 1.25rem;
            text-align: center;
            color: #93c5fd;
            margin-bottom: 3rem;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            max-width: 72rem;
            margin: 0 auto;
        }
        .team-button {
            padding: 1rem;
            background: rgba(30, 58, 138, 0.3);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 0.5rem;
            color: white;
            font-size: 1.125rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }
        .team-button:hover {
            background: rgba(30, 64, 175, 0.5);
            transform: scale(1.02);
        }
        .header {
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(59, 130, 246, 0.3);
            padding: 1rem 1.5rem;
        }
        .header h1 {
            font-size: 1.875rem;
            margin-bottom: 0.25rem;
            text-align: left;
            background: none;
            -webkit-text-fill-color: white;
        }
        .header-info {
            color: #93c5fd;
            font-size: 0.875rem;
        }
        .nav {
            background: rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(59, 130, 246, 0.2);
            position: relative;
            z-index: 100;
        }
        .nav-content {
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 1.5rem;
            display: flex;
            gap: 0.25rem;
            flex-wrap: wrap;
            align-items: center;
            position: relative;
        }
        .nav-group {
            position: relative;
            display: inline-block;
            z-index: 101;
        }
        .nav-button {
            padding: 0.75rem 1.5rem;
            font-weight: bold;
            font-size: 0.875rem;
            text-transform: uppercase;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            background: transparent;
            color: #93c5fd;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            position: relative;
            z-index: 102;
        }
        .nav-button:hover {
            background: rgba(30, 58, 138, 0.3);
        }
        .nav-button.active {
            background: #2563eb;
            color: white;
        }
        .nav-button.has-dropdown::after {
            content: 'â–¼';
            font-size: 0.7rem;
            opacity: 0.7;
        }
        .nav-dropdown {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            background: rgba(15, 23, 42, 0.98);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 0 0 0.5rem 0.5rem;
            min-width: 200px;
            z-index: 200;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.5);
            margin-top: 0;
        }
        .nav-group:hover .nav-dropdown {
            display: block;
        }
        .nav-dropdown-item {
            display: block;
            padding: 0.75rem 1.5rem;
            color: #93c5fd;
            text-decoration: none;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            background: transparent;
            width: 100%;
            text-align: left;
            position: relative;
            z-index: 201;
        }
        .nav-dropdown-item:hover:not(.disabled) {
            background: rgba(30, 58, 138, 0.5);
            color: white;
        }
        .nav-dropdown-item.active {
            background: rgba(37, 99, 235, 0.3);
            color: #22d3ee;
            border-left: 3px solid #22d3ee;
        }
        .nav-dropdown-item.disabled {
            color: #64748b;
            cursor: not-allowed;
            opacity: 0.5;
        }
        .nav-dropdown-item.disabled::after {
            content: 'ðŸ”’';
            margin-left: 0.5rem;
            font-size: 0.8rem;
        }
        .action-button {
            padding: 0.75rem 1.5rem;
            background: #16a34a;
            color: white;
            font-weight: bold;
            font-size: 0.875rem;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s;
            margin-left: 0.5rem;
        }
        .action-button:hover {
            background: #15803d;
        }
        .action-button.secondary {
            background: #2563eb;
            margin-left: 0.5rem;
        }
        .action-button.secondary:hover {
            background: #1d4ed8;
        }
        .content {
            max-width: 1280px;
            margin: 0 auto;
            padding: 2rem 1.5rem;
            position: relative;
            z-index: 1;
        }
        .card {
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .card h2 {
            font-size: 1.5rem;
            font-weight: bold;
            color: #22d3ee;
            margin-bottom: 1rem;
        }
        .card h3 {
            font-size: 1.2rem;
            color: #22d3ee;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
        }
        .standings-nav {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }
        .standings-nav button {
            padding: 0.5rem 1rem;
            background: rgba(30, 58, 138, 0.3);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 0.375rem;
            color: #93c5fd;
            font-weight: bold;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        .standings-nav button:hover {
            background: rgba(30, 64, 175, 0.5);
        }
        .standings-nav button.active {
            background: #2563eb;
            color: white;
            border-color: #2563eb;
        }
        .standings-table, .stats-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 0.5rem;
        }
        .standings-table thead, .stats-table thead {
            background: rgba(30, 58, 138, 0.4);
        }
        .standings-table th, .stats-table th {
            padding: 0.75rem 0.5rem;
            text-align: left;
            font-weight: bold;
            font-size: 0.75rem;
            text-transform: uppercase;
            color: #93c5fd;
            border-bottom: 2px solid rgba(59, 130, 246, 0.5);
        }
        .standings-table th.text-right,
        .standings-table td.text-right,
        .stats-table th.text-right,
        .stats-table td.text-right {
            text-align: right;
        }
        .standings-table th.text-center,
        .standings-table td.text-center,
        .stats-table th.text-center,
        .stats-table td.text-center {
            text-align: center;
        }
        .standings-table tbody tr, .stats-table tbody tr {
            background: rgba(30, 58, 138, 0.2);
            border-bottom: 1px solid rgba(59, 130, 246, 0.2);
            transition: background 0.2s;
        }
        .standings-table tbody tr:hover, .stats-table tbody tr:hover {
            background: rgba(30, 64, 175, 0.3);
        }
        .standings-table tbody tr.highlight, .stats-table tbody tr.highlight {
            background: rgba(59, 130, 246, 0.3);
            border: 1px solid rgba(59, 130, 246, 0.5);
        }
        .standings-table tbody tr.playoff {
            border-left: 3px solid #16a34a;
        }
        .standings-table tbody tr.wildcard {
            border-left: 3px solid #ca8a04;
        }
        .standings-table td, .stats-table td {
            padding: 0.75rem 0.5rem;
            font-size: 0.875rem;
        }
        .standings-table .rank, .stats-table .rank {
            width: 40px;
            font-weight: bold;
            color: #22d3ee;
        }
        .standings-table .team-name, .stats-table .player-name {
            font-weight: bold;
        }
        .list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            background: rgba(30, 58, 138, 0.2);
            border-radius: 0.375rem;
            margin-bottom: 0.5rem;
        }
        .list-item.highlight {
            background: rgba(59, 130, 246, 0.3);
            border: 1px solid rgba(59, 130, 246, 0.5);
        }
        .list-item span {
            font-weight: bold;
        }
        .player-pos {
            color: #93c5fd;
            margin-left: 0.5rem;
            font-size: 0.85em;
        }
        .clickable-player {
            cursor: pointer;
            transition: all 0.2s;
        }
        .clickable-player:hover {
            color: #60a5fa;
            text-decoration: underline;
        }
        .badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: bold;
            margin-left: 0.5rem;
        }
        .badge-green {
            background: #16a34a;
        }
        .badge-yellow {
            background: #ca8a04;
        }
        .select {
            width: 100%;
            padding: 0.75rem;
            background: rgba(30, 58, 138, 0.3);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 0.375rem;
            color: white;
            margin-bottom: 1rem;
            font-size: 1rem;
        }
        .select option {
            background: #1e293b;
            color: white;
        }
        .button {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0.375rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.875rem;
        }
        .button-primary {
            background: #16a34a;
            color: white;
        }
        .button-primary:hover {
            background: #15803d;
        }
        @media (max-width: 768px) {
            .grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .standings-table, .stats-table {
                font-size: 0.75rem;
            }
            .standings-table th,
            .standings-table td,
            .stats-table th,
            .stats-table td {
                padding: 0.5rem 0.25rem;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script type="text/babel">
        const { useState, useMemo, useCallback } = React;

        const TEAMS = [
            { id: 1, city: 'Anaheim', name: 'Waves', abbreviation: 'ANA', conference: 'West', division: 'Pacific' },
            { id: 2, city: 'Arizona', name: 'Scorpions', abbreviation: 'ARI', conference: 'West', division: 'Pacific' },
            { id: 3, city: 'Boston', name: 'Blades', abbreviation: 'BOS', conference: 'East', division: 'Atlantic' },
            { id: 4, city: 'Buffalo', name: 'Storm', abbreviation: 'BUF', conference: 'East', division: 'Atlantic' },
            { id: 5, city: 'Calgary', name: 'Inferno', abbreviation: 'CGY', conference: 'West', division: 'Pacific' },
            { id: 6, city: 'Carolina', name: 'Tempest', abbreviation: 'CAR', conference: 'East', division: 'Metropolitan' },
            { id: 7, city: 'Chicago', name: 'Cyclones', abbreviation: 'CHI', conference: 'West', division: 'Central' },
            { id: 8, city: 'Colorado', name: 'Summit', abbreviation: 'COL', conference: 'West', division: 'Central' },
            { id: 9, city: 'Columbus', name: 'Commanders', abbreviation: 'CBJ', conference: 'East', division: 'Metropolitan' },
            { id: 10, city: 'Dallas', name: 'Outlaws', abbreviation: 'DAL', conference: 'West', division: 'Central' },
            { id: 11, city: 'Detroit', name: 'Motors', abbreviation: 'DET', conference: 'East', division: 'Atlantic' },
            { id: 12, city: 'Edmonton', name: 'Express', abbreviation: 'EDM', conference: 'West', division: 'Pacific' },
            { id: 13, city: 'Florida', name: 'Surge', abbreviation: 'FLA', conference: 'East', division: 'Atlantic' },
            { id: 14, city: 'Los Angeles', name: 'Knights', abbreviation: 'LAK', conference: 'West', division: 'Pacific' },
            { id: 15, city: 'Minnesota', name: 'Timberwolves', abbreviation: 'MIN', conference: 'West', division: 'Central' },
            { id: 16, city: 'Montreal', name: 'Metros', abbreviation: 'MTL', conference: 'East', division: 'Atlantic' },
            { id: 17, city: 'Nashville', name: 'Strikers', abbreviation: 'NSH', conference: 'West', division: 'Central' },
            { id: 18, city: 'New Jersey', name: 'Vipers', abbreviation: 'NJD', conference: 'East', division: 'Metropolitan' },
            { id: 19, city: 'New York', name: 'Mariners', abbreviation: 'NYI', conference: 'East', division: 'Metropolitan' },
            { id: 20, city: 'New York', name: 'Rockets', abbreviation: 'NYR', conference: 'East', division: 'Metropolitan' },
            { id: 21, city: 'Ottawa', name: 'Capitals', abbreviation: 'OTT', conference: 'East', division: 'Atlantic' },
            { id: 22, city: 'Philadelphia', name: 'Phoenix', abbreviation: 'PHI', conference: 'East', division: 'Metropolitan' },
            { id: 23, city: 'Pittsburgh', name: 'Steel', abbreviation: 'PIT', conference: 'East', division: 'Metropolitan' },
            { id: 24, city: 'San Jose', name: 'Barracudas', abbreviation: 'SJS', conference: 'West', division: 'Pacific' },
            { id: 25, city: 'Seattle', name: 'Storm', abbreviation: 'SEA', conference: 'West', division: 'Pacific' },
            { id: 26, city: 'St. Louis', name: 'Archers', abbreviation: 'STL', conference: 'West', division: 'Central' },
            { id: 27, city: 'Tampa Bay', name: 'Thunder', abbreviation: 'TBL', conference: 'East', division: 'Atlantic' },
            { id: 28, city: 'Toronto', name: 'Titans', abbreviation: 'TOR', conference: 'East', division: 'Atlantic' },
            { id: 29, city: 'Vancouver', name: 'Orcas', abbreviation: 'VAN', conference: 'West', division: 'Pacific' },
            { id: 30, city: 'Vegas', name: 'Vipers', abbreviation: 'VGK', conference: 'West', division: 'Pacific' },
            { id: 31, city: 'Washington', name: 'Sentinels', abbreviation: 'WSH', conference: 'East', division: 'Metropolitan' },
            { id: 32, city: 'Winnipeg', name: 'Blizzard', abbreviation: 'WPG', conference: 'West', division: 'Central' },
        ];
        
        // IMPORTANT: Number of NHL teams - update this if adding expansion teams!
        const NUM_TEAMS = TEAMS.length; // Currently 32
        
        // ==================== LEAGUE CONFIGURATION CONSTANTS ====================
        // Update these values to customize league rules and season structure
        
        // SEASON STRUCTURE
        const GAMES_PER_SEASON = 82;           // Regular season games per team (82 days)
        
        // ROSTER SIZES
        const NHL_ROSTER_SIZE = 23;            // Active NHL roster
        const FORWARDS_COUNT = 13;             // Forwards per team
        const DEFENSE_COUNT = 7;               // Defensemen per team
        const GOALIES_COUNT = 3;               // Goalies per team
        const FORWARD_LINES = 4;               // Number of forward lines (1-4)
        const DEFENSE_PAIRS = 3;               // Number of defense pairs (1-3)
        
        // PLAYOFFS
        const PLAYOFF_TEAMS = 16;              // Teams that make playoffs
        const PLAYOFF_TEAMS_PER_CONFERENCE = 8; // Per conference
        
        // PLAYER LIMITS
        const MAX_PLAYER_AGE = 42;             // Maximum age before retirement
        const YOUNG_PLAYER_AGE = 25;           // Age threshold for development tracking
        
        // GAME SIMULATION
        const AVG_GOALS_PER_GAME = 6;          // League average total goals per game
        const INJURY_RATE_PER_TEAM = 12.5;     // Injuries per team per season (~400/32)
        
        // STREAKS & BONUSES
        const STREAK_BONUS_TIER_1 = 5;         // Games for +2 OVR bonus
        const STREAK_BONUS_TIER_2 = 10;        // Games for +3 OVR bonus
        const STREAK_BONUS_TIER_3 = 15;        // Games for +4 OVR bonus (cap)
        const SCORELESS_PENALTY_GAMES = 10;    // Games scoreless for -2 OVR penalty
        const TEAM_STREAK_TIER_1 = 5;          // Wins for +3% team bonus
        const TEAM_STREAK_TIER_2 = 10;         // Wins for +5% team bonus (cap)
        
        // MID-SEASON
        const MID_SEASON_GAME = 41;            // Game for mid-season report (All-Star Break)
        const PLAYOFF_RACE_START_GAME = 62;    // When playoff race tags start (last 20 games)
        
        // ========================================================================
        
        // Farm teams (AHL-equivalent) - affiliated with NHL teams
        const FARM_TEAMS = [
            { id: 101, nhlAffiliation: 1, city: 'San Diego', name: 'Gulls', abbreviation: 'SDG' },
            { id: 102, nhlAffiliation: 2, city: 'Tucson', name: 'Roadrunners', abbreviation: 'TUC' },
            { id: 103, nhlAffiliation: 3, city: 'Providence', name: 'Bruins', abbreviation: 'PRO' },
            { id: 104, nhlAffiliation: 4, city: 'Rochester', name: 'Americans', abbreviation: 'ROC' },
            { id: 105, nhlAffiliation: 5, city: 'Abbotsford', name: 'Heat', abbreviation: 'ABB' },
            { id: 106, nhlAffiliation: 6, city: 'Springfield', name: 'Thunderbirds', abbreviation: 'SPR' },
            { id: 107, nhlAffiliation: 7, city: 'Rockford', name: 'IceHogs', abbreviation: 'RFD' },
            { id: 108, nhlAffiliation: 8, city: 'Loveland', name: 'Eagles', abbreviation: 'LOV' },
            { id: 109, nhlAffiliation: 9, city: 'Cleveland', name: 'Monsters', abbreviation: 'CLE' },
            { id: 110, nhlAffiliation: 10, city: 'Cedar Park', name: 'Stars', abbreviation: 'TEX' },
            { id: 111, nhlAffiliation: 11, city: 'Grand Rapids', name: 'Griffins', abbreviation: 'GRG' },
            { id: 112, nhlAffiliation: 12, city: 'Bakersfield', name: 'Condors', abbreviation: 'BAK' },
            { id: 113, nhlAffiliation: 13, city: 'Charlotte', name: 'Checkers', abbreviation: 'CHR' },
            { id: 114, nhlAffiliation: 14, city: 'Ontario', name: 'Reign', abbreviation: 'ONT' },
            { id: 115, nhlAffiliation: 15, city: 'Iowa', name: 'Wild', abbreviation: 'IOW' },
            { id: 116, nhlAffiliation: 16, city: 'Laval', name: 'Rocket', abbreviation: 'LAV' },
            { id: 117, nhlAffiliation: 17, city: 'Milwaukee', name: 'Admirals', abbreviation: 'MIL' },
            { id: 118, nhlAffiliation: 18, city: 'Utica', name: 'Comets', abbreviation: 'UTI' },
            { id: 119, nhlAffiliation: 19, city: 'Bridgeport', name: 'Islanders', abbreviation: 'BRI' },
            { id: 120, nhlAffiliation: 20, city: 'Hartford', name: 'Wolf Pack', abbreviation: 'HAR' },
            { id: 121, nhlAffiliation: 21, city: 'Belleville', name: 'Senators', abbreviation: 'BEL' },
            { id: 122, nhlAffiliation: 22, city: 'Lehigh Valley', name: 'Phantoms', abbreviation: 'LHV' },
            { id: 123, nhlAffiliation: 23, city: 'Wilkes-Barre', name: 'Penguins', abbreviation: 'WBS' },
            { id: 124, nhlAffiliation: 24, city: 'San Jose', name: 'Barracuda', abbreviation: 'SJB' },
            { id: 125, nhlAffiliation: 25, city: 'Coachella Valley', name: 'Firebirds', abbreviation: 'CV' },
            { id: 126, nhlAffiliation: 26, city: 'Springfield', name: 'Thunderbirds', abbreviation: 'SPT' },
            { id: 127, nhlAffiliation: 27, city: 'Syracuse', name: 'Crunch', abbreviation: 'SYR' },
            { id: 128, nhlAffiliation: 28, city: 'Toronto', name: 'Marlies', abbreviation: 'TML' },
            { id: 129, nhlAffiliation: 29, city: 'Abbotsford', name: 'Canucks', abbreviation: 'ABB' },
            { id: 130, nhlAffiliation: 30, city: 'Henderson', name: 'Silver Knights', abbreviation: 'HEN' },
            { id: 131, nhlAffiliation: 31, city: 'Hershey', name: 'Bears', abbreviation: 'HER' },
            { id: 132, nhlAffiliation: 32, city: 'Manitoba', name: 'Moose', abbreviation: 'MAN' },
        ];

        const FIRST_NAMES = ['Connor', 'Nathan', 'Alex', 'Ryan', 'Tyler', 'Jake', 'Marcus', 'Dylan', 
            'Ethan', 'Jack', 'Owen', 'Liam', 'Noah', 'Mason', 'Logan', 'Lucas', 'Elijah', 'Oliver',
            'James', 'William', 'Benjamin', 'Henry', 'Samuel', 'David', 'Joseph', 'Carter', 'Wyatt',
            'John', 'Sebastian', 'Matthew'];
        const LAST_NAMES = ['Smith', 'Johnson', 'Williams', 'Brown', 'Jones', 'Miller', 'Davis', 'Wilson',
            'Anderson', 'Taylor', 'Thomas', 'Moore', 'Jackson', 'Martin', 'Lee', 'Thompson', 'White',
            'Harris', 'Clark', 'Lewis', 'Robinson', 'Walker', 'Young', 'Hall', 'Allen', 'King', 'Wright',
            'Lopez', 'Hill', 'Scott'];

        const generatePlayer = (position, teamId, lineNumber = 1, isFarm = false) => {
            // Farm players have lower base ratings
            const baseRating = isFarm ? 
                (45 + Math.random() * 25) : // Farm: 45-70 OVR
                (60 + Math.random() * 30);  // NHL: 60-90 OVR
            const potential = baseRating + Math.random() * 20 - 5;
            
            const baseStats = {
                gamesPlayed: 0, 
                goals: 0, 
                assists: 0, 
                points: 0,
                plusMinus: 0,
                pim: 0,
                shots: 0,
                timeOnIce: 0,
                // NEW: Power Play stats
                ppGoals: 0,
                ppAssists: 0,
                ppPoints: 0,
                // NEW: Shorthanded stats
                shGoals: 0,
                shAssists: 0,
                shPoints: 0
            };
            
            // Add goalie-specific stats
            if (position === 'G') {
                baseStats.wins = 0;
                baseStats.losses = 0;
                baseStats.shutouts = 0;
                baseStats.shotsAgainst = 0;
                baseStats.saves = 0;
                baseStats.goalsAgainst = 0;
                baseStats.savePercentage = 0;
                baseStats.gaa = 0;
            }
            
            // Create separate playoff stats (starts at 0 when playoffs begin)
            const playoffStats = JSON.parse(JSON.stringify(baseStats)); // Deep copy
            
            // Determine preferred position
            let preferredPosition = position;
            if (position === 'F') {
                const positions = ['C', 'LW', 'RW'];
                preferredPosition = positions[Math.floor(Math.random() * positions.length)];
            } else if (position === 'D') {
                preferredPosition = Math.random() > 0.5 ? 'LD' : 'RD';
            }
            
            return {
                id: `${teamId}-${position}-${Math.random()}`,
                firstName: FIRST_NAMES[Math.floor(Math.random() * FIRST_NAMES.length)],
                lastName: LAST_NAMES[Math.floor(Math.random() * LAST_NAMES.length)],
                position,
                preferredPosition, // C, LW, RW for forwards; LD, RD for defense
                age: 20 + Math.floor(Math.random() * 15),
                teamId,
                nhlAffiliation: teamId <= NUM_TEAMS ? teamId : FARM_TEAMS.find(t => t.id === teamId)?.nhlAffiliation, // NHL team they belong to
                roster: teamId <= NUM_TEAMS ? 'nhl' : 'farm', // 'nhl' or 'farm'
                lineNumber,
                linePosition: null, // Specific slot: 'C', 'LW', 'RW', 'LD', 'RD'
                ppUnit: 0, // 0 = none, 1 = PP1, 2 = PP2
                pkUnit: 0, // 0 = none, 1 = PK1, 2 = PK2
                ppPosition: null, // Position on PP unit
                pkPosition: null, // Position on PK unit
                dressed: position === 'G' ? (lineNumber <= 2) : true, // Goalies: only 2 dress
                // Track original position before injury call-up
                originalLineNumber: null,
                originalLinePosition: null,
                originalDressed: null,
                isInjuryReplacement: false, // True if called up to replace injured player
                ratings: { 
                    overall: Math.round(baseRating),
                    potential: Math.round(potential)
                },
                stats: { ...baseStats },
                playoffStats: { ...playoffStats }, // Separate playoff stats
                milestones: [], // Track career achievements
                achievements: [], // Track awards, all-stars, league leaders
                // NEW: Streak tracking
                currentStreak: {
                    type: null, // 'point' or 'scoreless'
                    games: 0,
                    bonus: 0 // OVR bonus from streak
                },
                injury: {
                    injured: false,
                    type: null,
                    severity: null,
                    gamesOut: 0,
                    daysUntilReturn: 0,
                    isCareerEnding: false
                },
                careerStats: [],
                currentSeasonStats: {
                    season: 1,
                    ...baseStats
                }
            };
        };

        const generateRoster = (teamId) => {
            const roster = [];
            
            // Forwards: 13 total (12 active + 1 scratch)
            // Generate 13 forwards, we'll auto-assign best 12 to lines
            const forwardPositions = ['C', 'LW', 'RW'];
            for (let i = 0; i < 13; i++) {
                const player = generatePlayer('F', teamId, 0); // Start all at line 0 (unassigned)
                roster.push(player);
            }
            
            // Defense: 7 total (6 active + 1 scratch)
            // Generate 7 defensemen, we'll auto-assign best 6 to pairs
            for (let i = 0; i < 7; i++) {
                const player = generatePlayer('D', teamId, 0); // Start all at line 0 (unassigned)
                roster.push(player);
            }
            
            // Goalies: 3 total (2 dress + 1 scratch)
            const goaliesList = [];
            for (let i = 0; i < 3; i++) {
                const goalie = generatePlayer('G', teamId, 0); // Start with lineNumber 0
                goaliesList.push(goalie);
            }
            // Sort goalies by overall and assign lineNumbers
            goaliesList.sort((a, b) => b.ratings.overall - a.ratings.overall);
            goaliesList.forEach((g, idx) => {
                g.lineNumber = idx + 1; // 1 = Starter, 2 = Backup, 3 = Third
                g.dressed = idx < 2; // Only top 2 dress
                roster.push(g);
            });
            
            // Sort by overall rating within position (best first)
            roster.sort((a, b) => {
                if (a.position !== b.position) {
                    const order = { 'F': 1, 'D': 2, 'G': 3 };
                    return order[a.position] - order[b.position];
                }
                return b.ratings.overall - a.ratings.overall;
            });
            
            // Auto-assign best lineup
            autoSetLineup(roster);
            
            return roster;
        };
        
        // Auto-assign best players to lines based on OVR and position preference
        const autoSetLineup = (roster) => {
            // Forwards: Assign best 12 to lines
            const forwards = roster.filter(p => p.position === 'F' && !p.injury.injured).sort((a, b) => b.ratings.overall - a.ratings.overall);
            const forwardPositions = ['C', 'LW', 'RW'];
            
            // Try to match preferred positions first, then fill gaps
            const assigned = new Set();
            const lineAssignments = Array(4).fill(null).map(() => ({ C: null, LW: null, RW: null }));
            
            // First pass: Assign players to their preferred positions (best players first)
            for (let line = 0; line < FORWARD_LINES; line++) {
                for (let pos of forwardPositions) {
                    const candidate = forwards.find(p => 
                        !assigned.has(p.id) && 
                        p.preferredPosition === pos
                    );
                    if (candidate) {
                        lineAssignments[line][pos] = candidate;
                        candidate.lineNumber = line + 1;
                        candidate.linePosition = pos;
                        assigned.add(candidate.id);
                    }
                }
            }
            
            // Second pass: Fill remaining slots with best available players
            for (let line = 0; line < FORWARD_LINES; line++) {
                for (let pos of forwardPositions) {
                    if (!lineAssignments[line][pos]) {
                        const candidate = forwards.find(p => !assigned.has(p.id));
                        if (candidate) {
                            lineAssignments[line][pos] = candidate;
                            candidate.lineNumber = line + 1;
                            candidate.linePosition = pos;
                            assigned.add(candidate.id);
                        }
                    }
                }
            }
            
            // 13th forward becomes healthy scratch (lineNumber = 0)
            forwards.forEach(f => {
                if (!assigned.has(f.id)) {
                    f.lineNumber = 0;
                    f.linePosition = null;
                }
            });
            
            // Defense: Assign best 6 to pairs
            const defensemen = roster.filter(p => p.position === 'D' && !p.injury.injured).sort((a, b) => b.ratings.overall - a.ratings.overall);
            const defensePositions = ['LD', 'RD'];
            const dAssigned = new Set();
            const pairAssignments = Array(3).fill(null).map(() => ({ LD: null, RD: null }));
            
            // First pass: Assign to preferred sides
            for (let pair = 0; pair < 3; pair++) {
                for (let pos of defensePositions) {
                    const candidate = defensemen.find(p => 
                        !dAssigned.has(p.id) && 
                        p.preferredPosition === pos
                    );
                    if (candidate) {
                        pairAssignments[pair][pos] = candidate;
                        candidate.lineNumber = pair + 1;
                        candidate.linePosition = pos;
                        dAssigned.add(candidate.id);
                    }
                }
            }
            
            // Second pass: Fill remaining slots
            for (let pair = 0; pair < 3; pair++) {
                for (let pos of defensePositions) {
                    if (!pairAssignments[pair][pos]) {
                        const candidate = defensemen.find(p => !dAssigned.has(p.id));
                        if (candidate) {
                            pairAssignments[pair][pos] = candidate;
                            candidate.lineNumber = pair + 1;
                            candidate.linePosition = pos;
                            dAssigned.add(candidate.id);
                        }
                    }
                }
            }
            
            // 7th defenseman becomes healthy scratch
            defensemen.forEach(d => {
                if (!dAssigned.has(d.id)) {
                    d.lineNumber = 0;
                    d.linePosition = null;
                }
            });
            
            // Goalies: Dress best 2 goalies
            const goalies = roster.filter(p => p.position === 'G' && !p.injury.injured).sort((a, b) => b.ratings.overall - a.ratings.overall);
            goalies.forEach((g, idx) => {
                g.dressed = idx < 2; // Top 2 goalies dressed, rest undressed
                g.lineNumber = idx + 1; // 1 = Starter, 2 = Backup, 3 = Third
            });
            
            // Power Play Units: Assign top skaters (PP1 = top 5, PP2 = next 5)
            const activeSkaters = [...forwards.filter((p, idx) => idx < 12), ...defensemen.filter((p, idx) => idx < 6)]
                .sort((a, b) => b.ratings.overall - a.ratings.overall);
            
            activeSkaters.forEach((p, idx) => {
                if (idx < 5) {
                    p.ppUnit = 1;
                    if (idx < 4) {
                        p.ppPosition = `PP1-F${idx + 1}`;
                    } else {
                        p.ppPosition = 'PP1-D1';
                    }
                } else if (idx < 10) {
                    p.ppUnit = 2;
                    if (idx < 9) {
                        p.ppPosition = `PP2-F${idx - 4}`;
                    } else {
                        p.ppPosition = 'PP2-D1';
                    }
                } else {
                    p.ppUnit = null;
                    p.ppPosition = null;
                }
            });
            
            // Penalty Kill Units: Prioritize defensemen and defensive forwards (PK1 = top 4, PK2 = next 4)
            const pkCandidates = [...forwards.filter((p, idx) => idx < 12), ...defensemen.filter((p, idx) => idx < 6)]
                .sort((a, b) => {
                    // Defensemen get priority for PK
                    if (a.position === 'D' && b.position === 'F') return -1;
                    if (a.position === 'F' && b.position === 'D') return 1;
                    return b.ratings.overall - a.ratings.overall;
                });
            
            pkCandidates.forEach((p, idx) => {
                if (idx < 4) {
                    p.pkUnit = 1;
                    if (idx < 2) {
                        p.pkPosition = `PK1-F${idx + 1}`;
                    } else {
                        p.pkPosition = `PK1-D${idx - 1}`;
                    }
                } else if (idx < 8) {
                    p.pkUnit = 2;
                    if (idx < 6) {
                        p.pkPosition = `PK2-F${idx - 3}`;
                    } else {
                        p.pkPosition = `PK2-D${idx - 5}`;
                    }
                } else {
                    p.pkUnit = null;
                    p.pkPosition = null;
                }
            });
        };

        const generateSchedule = () => {
            // Generate 82 days where ALL 32 teams play each day (16 matchups per day)
            // Each team plays exactly 82 games (41 home, 41 away)
            
            const schedule = [];
            const teamGamesPlayed = {}; // Track how many games each team has played
            const teamHomeGames = {}; // Track home game count
            const teamAwayGames = {}; // Track away game count
            const matchupCount = {}; // Track how many times teams have played each other
            
            // Initialize tracking
            TEAMS.forEach(t => {
                teamGamesPlayed[t.id] = 0;
                teamHomeGames[t.id] = 0;
                teamAwayGames[t.id] = 0;
                matchupCount[t.id] = {};
                TEAMS.forEach(opp => {
                    if (opp.id !== t.id) matchupCount[t.id][opp.id] = 0;
                });
            });
            
            // Build day-by-day schedule - ensure ALL 32 teams play each day
            for (let day = 1; day <= 82; day++) {
                const dayMatchups = [];
                const usedTeams = new Set();
                const availableTeams = TEAMS.filter(t => !usedTeams.has(t.id));
                
                // Pair up all 32 teams (16 matchups per day)
                while (availableTeams.length >= 2) {
                    const team1 = availableTeams[0];
                    
                    // Find best opponent for team1
                    let bestOpponent = null;
                    let bestScore = -999999;
                    
                    for (let i = 1; i < availableTeams.length; i++) {
                        const team2 = availableTeams[i];
                        if (usedTeams.has(team2.id)) continue;
                        
                        // Score this matchup
                        let score = 0;
                        
                        // Prefer teams in same division (more realistic)
                        if (team1.division === team2.division) score += 50;
                        else if (team1.conference === team2.conference) score += 20;
                        
                        // Prefer teams that haven't played each other much
                        const timesPlayed = matchupCount[team1.id][team2.id];
                        score -= timesPlayed * 30;
                        
                        // Randomness for variety
                        score += Math.random() * 10;
                        
                        if (score > bestScore) {
                            bestScore = score;
                            bestOpponent = team2;
                        }
                    }
                    
                    if (!bestOpponent) break;
                    
                    // Determine home/away
                    let homeTeam, awayTeam;
                    if (teamHomeGames[team1.id] < teamAwayGames[team1.id]) {
                        // team1 needs more home games
                        homeTeam = team1.id;
                        awayTeam = bestOpponent.id;
                    } else if (teamAwayGames[team1.id] < teamHomeGames[team1.id]) {
                        // team1 needs more away games
                        homeTeam = bestOpponent.id;
                        awayTeam = team1.id;
                    } else {
                        // Equal, check opponent's needs
                        if (teamHomeGames[bestOpponent.id] < teamAwayGames[bestOpponent.id]) {
                            homeTeam = bestOpponent.id;
                            awayTeam = team1.id;
                        } else {
                            homeTeam = team1.id;
                            awayTeam = bestOpponent.id;
                        }
                    }
                    
                    dayMatchups.push({
                        homeTeam,
                        awayTeam,
                        played: false,
                        homeScore: 0,
                        awayScore: 0,
                        homeStats: null,
                        awayStats: null,
                        periodScoring: null
                    });
                    
                    // Update tracking
                    usedTeams.add(team1.id);
                    usedTeams.add(bestOpponent.id);
                    teamGamesPlayed[team1.id]++;
                    teamGamesPlayed[bestOpponent.id]++;
                    matchupCount[team1.id][bestOpponent.id]++;
                    matchupCount[bestOpponent.id][team1.id]++;
                    
                    if (homeTeam === team1.id) {
                        teamHomeGames[team1.id]++;
                        teamAwayGames[bestOpponent.id]++;
                    } else {
                        teamHomeGames[bestOpponent.id]++;
                        teamAwayGames[team1.id]++;
                    }
                    
                    // Remove used teams from available list
                    availableTeams.splice(availableTeams.indexOf(team1), 1);
                    availableTeams.splice(availableTeams.indexOf(bestOpponent), 1);
                }
                
                schedule.push({
                    day,
                    matchups: dayMatchups
                });
                
                // Debug: Check if all teams played
                if (dayMatchups.length !== 16) {
                    console.warn(`âš ï¸ Day ${day}: Only ${dayMatchups.length} matchups (should be 16)`);
                }
                
                // Debug: Log first day's schedule
                if (day === 1) {
                    console.log(`Day 1 Schedule (${dayMatchups.length} matchups):`);
                    dayMatchups.forEach(m => {
                        const home = TEAMS.find(t => t.id === m.homeTeam);
                        const away = TEAMS.find(t => t.id === m.awayTeam);
                        console.log(`  ${home.city} vs ${away.city}`);
                    });
                }
            }
            
            console.log('=== 82-Day Schedule Generated ===');
            console.log(`Total days: ${schedule.length}`);
            console.log(`Average matchups per day: ${schedule.reduce((sum, d) => sum + d.matchups.length, 0) / schedule.length}`);
            TEAMS.forEach(t => {
                const total = teamGamesPlayed[t.id];
                const homeGames = teamHomeGames[t.id];
                const awayGames = teamAwayGames[t.id];
                if (total !== 82) {
                    console.warn(`âŒ ${t.city}: ${total} games (${homeGames}H / ${awayGames}A) - SHOULD BE 82!`);
                } else {
                    console.log(`âœ“ ${t.city}: ${total} games (${homeGames}H / ${awayGames}A)`);
                }
            });
            
            return schedule;
        };

        const getIceTime = (player) => {
            if (player.position === 'G') return 60;
            
            if (player.position === 'D') {
                if (player.lineNumber === 1) return 24 + Math.random() * 2; // 24-26 min
                if (player.lineNumber === 2) return 20 + Math.random() * 2; // 20-22 min
                return 16 + Math.random() * 2; // 16-18 min
            }
            
            // Forwards
            if (player.lineNumber === 1) return 19 + Math.random() * 3; // 19-22 min
            if (player.lineNumber === 2) return 16 + Math.random() * 2; // 16-18 min
            if (player.lineNumber === 3) return 13 + Math.random() * 2; // 13-15 min
            return 10 + Math.random() * 2; // 10-12 min
        };

        // NHL Penalty System
        // Based on NHL data: ~6-8 penalties per game total, ~12-16 PIM per team per game
        const PENALTY_TYPES = {
            // Minor penalties (2 minutes) - 85% of all penalties
            'Tripping': { minutes: 2, weight: 20, description: 'Tripping' },
            'Hooking': { minutes: 2, weight: 18, description: 'Hooking' },
            'Slashing': { minutes: 2, weight: 15, description: 'Slashing' },
            'Interference': { minutes: 2, weight: 12, description: 'Interference' },
            'High-Sticking': { minutes: 2, weight: 10, description: 'High-Sticking' },
            'Holding': { minutes: 2, weight: 8, description: 'Holding' },
            'Roughing': { minutes: 2, weight: 7, description: 'Roughing' },
            'Delay of Game': { minutes: 2, weight: 5, description: 'Delay of Game' },
            
            // Double minors (4 minutes) - 8% of penalties
            'High-Stick (Blood)': { minutes: 4, weight: 5, description: 'High-Sticking (double minor)' },
            'Roughing (Double)': { minutes: 4, weight: 3, description: 'Roughing (double minor)' },
            
            // Major penalties (5 minutes) - 5% of penalties
            'Fighting': { minutes: 5, weight: 3, description: 'Fighting' },
            'Boarding': { minutes: 5, weight: 1, description: 'Boarding (major)' },
            'Charging': { minutes: 5, weight: 0.5, description: 'Charging (major)' },
            
            // Misconduct (10 minutes, doesn't create PP) - 1.5% of penalties
            'Misconduct': { minutes: 10, weight: 1, description: 'Misconduct', noAdvantage: true },
            
            // Game Misconduct (ejection + 10 min) - 0.5% of penalties
            'Game Misconduct': { minutes: 10, weight: 0.3, description: 'Game Misconduct', ejection: true, noAdvantage: true }
        };

        const assignPenalties = (players) => {
            // NHL average: 3-4 penalties per team per game
            const numPenalties = Math.random() < 0.3 ? 2 : Math.random() < 0.7 ? 3 : 4;
            
            const penalties = [];
            
            for (let i = 0; i < numPenalties; i++) {
                // Select penalty type by weight
                const totalWeight = Object.values(PENALTY_TYPES).reduce((sum, p) => sum + p.weight, 0);
                let rand = Math.random() * totalWeight;
                let selectedPenalty = null;
                
                for (const [name, data] of Object.entries(PENALTY_TYPES)) {
                    rand -= data.weight;
                    if (rand <= 0) {
                        selectedPenalty = { name, ...data };
                        break;
                    }
                }
                
                if (!selectedPenalty) selectedPenalty = { name: 'Tripping', ...PENALTY_TYPES['Tripping'] };
                
                // Assign to a random player (weighted by position and rating)
                // Forwards get more penalties, lower rated players slightly more
                const eligiblePlayers = players.filter(p => p.position !== 'G');
                const weights = eligiblePlayers.map(p => {
                    const positionFactor = p.position === 'F' ? 1.2 : 1.0; // Forwards 20% more likely
                    const ratingFactor = 1.1 - (p.ratings.overall / 100) * 0.3; // Lower OVR = slightly more penalties
                    const toiFactor = getIceTime(p) / 15; // More TOI = more penalty chances
                    return positionFactor * ratingFactor * toiFactor;
                });
                
                const totalPlayerWeight = weights.reduce((sum, w) => sum + w, 0);
                rand = Math.random() * totalPlayerWeight;
                let culprit = eligiblePlayers[0];
                let cumulative = 0;
                
                for (let j = 0; j < eligiblePlayers.length; j++) {
                    cumulative += weights[j];
                    if (rand <= cumulative) {
                        culprit = eligiblePlayers[j];
                        break;
                    }
                }
                
                penalties.push({
                    player: culprit,
                    penalty: selectedPenalty
                });
            }
            
            return penalties;
        };
        // Based on NHL data: ~400 injuries per season across 32 teams = ~12.5 per team per season
        // ~0.15 injuries per game (1 injury every ~7 games)
        const INJURY_TYPES = {
            'Lower Body': { weight: 35, avgDays: 14 }, // Leg, knee, ankle, groin
            'Upper Body': { weight: 30, avgDays: 10 }, // Shoulder, arm, hand, wrist
            'Concussion': { weight: 15, avgDays: 21 }, // Head injuries
            'Core': { weight: 10, avgDays: 12 }, // Back, abdomen
            'Illness': { weight: 8, avgDays: 3 }, // Flu, COVID, etc.
            'Facial': { weight: 2, avgDays: 7 } // Broken nose, jaw, dental
        };

        const checkForInjury = (player, toi) => {
            // Base injury chance: ~3% per game (realistic NHL rates)
            // Expected: ~50-75 injuries per team per 82-game season
            // NHL average: 400-500 man-games lost per team = 5-6 players missing significant time
            const baseChance = 0.03; // 3% per game base
            
            // Position multiplier
            const positionMultiplier = player.position === 'G' ? 0.4 : player.position === 'F' ? 1.2 : 1.0;
            
            // TOI multiplier - scales with ice time (more ice time = more injury risk)
            const toiMultiplier = toi / 15;
            
            // Age factor - older players more injury-prone
            const ageFactor = player.age < 24 ? 0.8 : player.age > 32 ? 1.4 : 1.0;
            
            const injuryChance = baseChance * positionMultiplier * toiMultiplier * ageFactor;
            
            const roll = Math.random();
            if (roll < injuryChance) {
                // Injury occurred
                return generateInjury();
            }
            
            return null;
        };

        const generateInjury = () => {
            // Select injury type weighted by frequency
            const totalWeight = Object.values(INJURY_TYPES).reduce((sum, t) => sum + t.weight, 0);
            let rand = Math.random() * totalWeight;
            let injuryType = 'Lower Body';
            
            for (const [type, data] of Object.entries(INJURY_TYPES)) {
                rand -= data.weight;
                if (rand <= 0) {
                    injuryType = type;
                    break;
                }
            }
            
            const baseAvgDays = INJURY_TYPES[injuryType].avgDays;
            
            // Severity distribution: 60% DTD/Week, 25% Month, 10% Season, 4.9% rare, 0.1% career-ending
            const severityRoll = Math.random();
            
            let severity, daysOut;
            
            if (severityRoll < 0.60) {
                severity = Math.random() < 0.5 ? 'Day-to-Day' : 'Week-to-Week';
                daysOut = Math.floor(1 + Math.random() * 14);
            } else if (severityRoll < 0.85) {
                severity = 'Month-to-Month';
                daysOut = Math.floor(15 + Math.random() * 46);
            } else if (severityRoll < 0.999) {
                severity = 'Season-Ending';
                daysOut = 999;
            } else {
                severity = 'Career-Ending';
                daysOut = 9999;
            }
            
            return {
                injured: true,
                type: injuryType,
                severity: severity,
                gamesOut: 0,
                daysUntilReturn: daysOut,
                isCareerEnding: severity === 'Career-Ending'
            };
        };

        const updateInjuries = (players) => {
            players.forEach(player => {
                if (player.injury.injured && !player.injury.isCareerEnding) {
                    player.injury.daysUntilReturn--;
                    
                    if (player.injury.daysUntilReturn <= 0) {
                        // Player has healed - clear injury
                        player.injury = {
                            injured: false,
                            type: null,
                            severity: null,
                            gamesOut: 0,
                            daysUntilReturn: 0,
                            isCareerEnding: false
                        };
                        
                        // Return player to their original position
                        if (player.originalLineNumber !== null) {
                            // Find who's currently in their spot
                            const currentOccupant = players.find(p =>
                                p.nhlAffiliation === player.nhlAffiliation &&
                                p.roster === 'nhl' &&
                                p.position === player.position &&
                                p.lineNumber === player.originalLineNumber &&
                                p.linePosition === player.originalLinePosition &&
                                p.id !== player.id
                            );
                            
                            // Return healed player to original spot
                            if (player.position === 'G') {
                                player.dressed = player.originalDressed;
                            } else {
                                player.lineNumber = player.originalLineNumber;
                                player.linePosition = player.originalLinePosition;
                            }
                            
                            // If occupant was injury replacement from farm, send them back
                            if (currentOccupant && currentOccupant.isInjuryReplacement && currentOccupant.originalRoster === 'farm') {
                                const farmTeam = FARM_TEAMS.find(t => t.nhlAffiliation === currentOccupant.nhlAffiliation);
                                if (farmTeam) {
                                    currentOccupant.roster = 'farm';
                                    currentOccupant.teamId = farmTeam.id;
                                    currentOccupant.lineNumber = 0;
                                    currentOccupant.linePosition = null;
                                    currentOccupant.dressed = false;
                                    currentOccupant.isInjuryReplacement = false;
                                    currentOccupant.originalRoster = null;
                                }
                            } else if (currentOccupant) {
                                // If NHL player, just scratch them
                                if (currentOccupant.position === 'G') {
                                    currentOccupant.dressed = false;
                                } else {
                                    currentOccupant.lineNumber = 0;
                                    currentOccupant.linePosition = null;
                                }
                            }
                            
                            // Clear original position tracking
                            player.originalLineNumber = null;
                            player.originalLinePosition = null;
                            player.originalDressed = null;
                        }
                    }
                }
            });
        };

        const getPlayerStatus = (player) => {
            if (!player.injury.injured) return 'Active';
            if (player.injury.isCareerEnding) return 'Retired';
            if (player.injury.severity === 'Season-Ending') return 'Out';
            if (player.injury.severity === 'Month-to-Month') return 'IR';
            if (player.injury.severity === 'Week-to-Week') return 'Out';
            return 'DTD';
        };
        
        // Call up player from farm to NHL
        const callUpPlayer = (playerId) => {
            if (!gameState) return;
            
            const newPlayers = [...gameState.players];
            const player = newPlayers.find(p => p.id === playerId);
            
            if (player && player.roster === 'farm') {
                const nhlTeam = player.nhlAffiliation;
                player.roster = 'nhl';
                player.teamId = nhlTeam;
                player.lineNumber = 0; // Scratched until assigned
                player.linePosition = null;
                if (player.position === 'G') player.dressed = false;
                setGameState({ ...gameState, players: newPlayers });
            }
        };
        
        // Send down player from NHL to farm
        const sendDownPlayer = (playerId) => {
            if (!gameState) return;
            
            const newPlayers = [...gameState.players];
            const player = newPlayers.find(p => p.id === playerId);
            
            if (player && player.roster === 'nhl' && !player.injury.injured) {
                const farmTeam = FARM_TEAMS.find(t => t.nhlAffiliation === player.nhlAffiliation);
                if (farmTeam) {
                    player.roster = 'farm';
                    player.teamId = farmTeam.id;
                    player.lineNumber = 0;
                    player.linePosition = null;
                    if (player.position === 'G') player.dressed = false;
                    setGameState({ ...gameState, players: newPlayers });
                }
            }
        };
        
        // Auto-call-up replacement when player gets injured
        const autoCallUpReplacement = (allPlayers, injuredPlayer) => {
            const nhlTeamId = injuredPlayer.nhlAffiliation || injuredPlayer.teamId;
            const position = injuredPlayer.position;
            
            // Store injured player's original position
            if (!injuredPlayer.originalLineNumber) {
                injuredPlayer.originalLineNumber = injuredPlayer.lineNumber;
                injuredPlayer.originalLinePosition = injuredPlayer.linePosition;
                injuredPlayer.originalDressed = injuredPlayer.dressed;
            }
            
            // First: Try to find scratched NHL player
            let replacement = allPlayers
                .filter(p => 
                    p.nhlAffiliation === nhlTeamId &&
                    p.roster === 'nhl' &&
                    p.position === position && 
                    !p.injury.injured &&
                    (position === 'G' ? !p.dressed : p.lineNumber === 0)
                )
                .sort((a, b) => b.ratings.overall - a.ratings.overall)[0];
            
            // Second: If no NHL scratches, call up from farm
            if (!replacement) {
                replacement = allPlayers
                    .filter(p => 
                        p.nhlAffiliation === nhlTeamId &&
                        p.roster === 'farm' &&
                        p.position === position &&
                        !p.injury.injured
                    )
                    .sort((a, b) => b.ratings.overall - a.ratings.overall)[0];
                
                // If calling from farm, move them to NHL roster
                if (replacement) {
                    replacement.roster = 'nhl';
                    replacement.teamId = nhlTeamId;
                    replacement.isInjuryReplacement = true;
                    // Store their original farm status
                    replacement.originalLineNumber = 0; // Will return to farm
                    replacement.originalRoster = 'farm';
                }
            }
            
            if (replacement) {
                // Take injured player's spot in lineup
                if (position === 'G') {
                    replacement.dressed = true;
                } else {
                    replacement.lineNumber = injuredPlayer.lineNumber;
                    replacement.linePosition = injuredPlayer.linePosition;
                }
                
                // DON'T scratch injured player - leave them in roster but marked injured
                // They keep their line assignment so we know where to put them back
            }
        };

        const simulateGameResult = (homePlayers, awayPlayers, homeTeamData = null, awayTeamData = null, standings = null) => {
            // Filter out injured players - they can't play
            const homeInjured = homePlayers.filter(p => p.injury.injured);
            const awayInjured = awayPlayers.filter(p => p.injury.injured);
            
            let homeAvailable = homePlayers.filter(p => !p.injury.injured);
            let awayAvailable = awayPlayers.filter(p => !p.injury.injured);
            
            // Load Management / Healthy Scratches
            const homeScratched = [];
            const awayScratched = [];
            
            homeAvailable = homeAvailable.filter(p => {
                if (p.position === 'G') return true; // Goalies use different system
                
                let scratchChance = 0.01;
                if (p.age > 35) scratchChance += 0.05;
                else if (p.age > 32) scratchChance += 0.02;
                if (p.ratings.overall >= 85) scratchChance *= 0.3;
                
                const scratched = Math.random() <= scratchChance;
                if (scratched) homeScratched.push(p);
                return !scratched;
            });
            
            awayAvailable = awayAvailable.filter(p => {
                if (p.position === 'G') return true;
                let scratchChance = 0.01;
                if (p.age > 35) scratchChance += 0.05;
                else if (p.age > 32) scratchChance += 0.02;
                if (p.ratings.overall >= 85) scratchChance *= 0.3;
                
                const scratched = Math.random() <= scratchChance;
                if (scratched) awayScratched.push(p);
                return !scratched;
            });
            
            const homeForwards = homeAvailable.filter(p => p.position === 'F').sort((a, b) => b.ratings.overall - a.ratings.overall);
            const homeDefense = homeAvailable.filter(p => p.position === 'D').sort((a, b) => b.ratings.overall - a.ratings.overall);
            const homeGoalies = homeAvailable.filter(p => p.position === 'G').sort((a, b) => b.ratings.overall - a.ratings.overall);
            const awayForwards = awayAvailable.filter(p => p.position === 'F').sort((a, b) => b.ratings.overall - a.ratings.overall);
            const awayDefense = awayAvailable.filter(p => p.position === 'D').sort((a, b) => b.ratings.overall - a.ratings.overall);
            const awayGoalies = awayAvailable.filter(p => p.position === 'G').sort((a, b) => b.ratings.overall - a.ratings.overall);
            
            // NEW: Get team streaks for bonuses (if standings data provided)
            let homeTeamStreakBonus = 1.0;
            let awayTeamStreakBonus = 1.0;
            
            if (standings && homeTeamData && awayTeamData) {
                const homeStanding = standings.find(s => s.teamId === homeTeamData.id);
                const awayStanding = standings.find(s => s.teamId === awayTeamData.id);
                
                // Team streak bonuses: 5+ = +3%, 10+ = +5% (caps at 5%)
                const getTeamStreakBonus = (standing) => {
                    if (!standing?.currentStreak) return 1.0;
                    if (standing.currentStreak.type === 'W') {
                        if (standing.currentStreak.count >= 10) return 1.05;
                        if (standing.currentStreak.count >= 5) return 1.03;
                    }
                    if (standing.currentStreak.type === 'L') {
                        if (standing.currentStreak.count >= 10) return 0.95;
                        if (standing.currentStreak.count >= 5) return 0.97;
                    }
                    return 1.0;
                };
                
                homeTeamStreakBonus = getTeamStreakBonus(homeStanding);
                awayTeamStreakBonus = getTeamStreakBonus(awayStanding);
            }
            
            // Players who dressed for this game - use ALL available players (already filtered by lineup)
            const homeDressed = [...homeForwards, ...homeDefense, ...homeGoalies];
            const awayDressed = [...awayForwards, ...awayDefense, ...awayGoalies];
            
            // NEW: Calculate team ratings with player streak bonuses applied
            const calcEffectiveRating = (players) => {
                return players.reduce((sum, p) => {
                    const baseOVR = p.ratings.overall;
                    const streakBonus = p.currentStreak?.bonus || 0;
                    return sum + (baseOVR + streakBonus);
                }, 0) / (players.length || 1);
            };
            
            // Calculate base team ratings with player streak bonuses
            const homeRating = calcEffectiveRating([...homeForwards, ...homeDefense]) * homeTeamStreakBonus;
            const awayRating = calcEffectiveRating([...awayForwards, ...awayDefense]) * awayTeamStreakBonus;
            
            const homeAdvantage = 3;
            const adjustedHomeRating = homeRating + homeAdvantage;
            
            // Determine total goals
            const scoringRoll = Math.random();
            let totalGoals;
            
            if (scoringRoll < 0.15) {
                totalGoals = Math.floor(Math.random() * 5);
            } else if (scoringRoll < 0.70) {
                totalGoals = 5 + Math.floor(Math.random() * 4);
            } else {
                totalGoals = 9 + Math.floor(Math.random() * 5);
            }
            
            totalGoals += Math.random() < 0.3 ? 1 : 0;
            
            // Distribute goals
            const homeChance = adjustedHomeRating / (adjustedHomeRating + awayRating);
            
            let homeGoals = 0;
            let awayGoals = 0;
            
            for (let i = 0; i < totalGoals; i++) {
                if (Math.random() < homeChance) {
                    homeGoals++;
                } else {
                    awayGoals++;
                }
            }
            
            if (homeGoals === awayGoals) {
                if (Math.random() < homeChance) {
                    homeGoals++;
                } else {
                    awayGoals++;
                }
            }
            
            const winner = homeGoals > awayGoals ? 'home' : 'away';
            
            // Initialize per-game stats for all dressed players
            const homePlayerStats = {};
            const awayPlayerStats = {};
            
            homeDressed.forEach(p => {
                homePlayerStats[p.id] = {
                    player: p,
                    goals: 0,
                    assists: 0,
                    points: 0,
                    plusMinus: 0,
                    pim: 0,
                    shots: 0,
                    toi: getIceTime(p),
                    // NEW: PP/PK stats
                    ppGoals: 0,
                    ppAssists: 0,
                    shGoals: 0,
                    shAssists: 0,
                    // Goalie specific
                    saves: 0,
                    goalsAgainst: 0,
                    shotsAgainst: 0
                };
            });
            
            awayDressed.forEach(p => {
                awayPlayerStats[p.id] = {
                    player: p,
                    goals: 0,
                    assists: 0,
                    points: 0,
                    plusMinus: 0,
                    pim: 0,
                    shots: 0,
                    toi: getIceTime(p),
                    // NEW: PP/PK stats
                    ppGoals: 0,
                    ppAssists: 0,
                    shGoals: 0,
                    shAssists: 0,
                    saves: 0,
                    goalsAgainst: 0,
                    shotsAgainst: 0
                };
            });
            
            // Assign goals and assists to HOME team and build scoring summary
            const homeSkaters = homeDressed.filter(p => p.position !== 'G');
            const homeGoalEvents = []; // Track each goal for period summary
            
            for (let i = 0; i < homeGoals; i++) {
                const goalWeights = homeSkaters.map(p => ({
                    player: p,
                    weight: Math.pow(p.ratings.overall / 100, 2.5) * 
                           (p.lineNumber === 1 ? 1.3 : p.lineNumber === 2 ? 0.95 : 0.7) *
                           (p.ratings.overall >= 90 ? 1.2 : 1.0) *
                           (p.position === 'D' ? 0.2 : 1.0)
                }));
                
                const totalWeight = goalWeights.reduce((sum, w) => sum + w.weight, 0);
                let rand = Math.random() * totalWeight;
                let scorer = goalWeights[0].player;
                
                for (const w of goalWeights) {
                    rand -= w.weight;
                    if (rand <= 0) {
                        scorer = w.player;
                        break;
                    }
                }
                
                homePlayerStats[scorer.id].goals++;
                homePlayerStats[scorer.id].shots += 1 + Math.floor(Math.random() * 2);
                
                // Assign assists
                const numAssists = Math.random() < 0.03 ? 0 : Math.random() < 0.15 ? 1 : 2;
                const eligibleAssisters = homeSkaters.filter(p => p.id !== scorer.id);
                const assisters = [];
                
                for (let a = 0; a < numAssists && assisters.length < 2; a++) {
                    const assistWeights = eligibleAssisters.filter(p => !assisters.includes(p)).map(p => ({
                        player: p,
                        weight: Math.pow(p.ratings.overall / 100, 2.5) *
                               (p.lineNumber === 1 ? 1.3 : p.lineNumber === 2 ? 0.95 : 0.7) *
                               (p.position === 'D' ? 1.1 : 1.0)
                    }));
                    
                    if (assistWeights.length > 0) {
                        const totalAssistWeight = assistWeights.reduce((sum, w) => sum + w.weight, 0);
                        let assistRand = Math.random() * totalAssistWeight;
                        
                        for (const w of assistWeights) {
                            assistRand -= w.weight;
                            if (assistRand <= 0) {
                                assisters.push(w.player);
                                homePlayerStats[w.player.id].assists++;
                                break;
                            }
                        }
                    }
                }
                
                // Store goal event for period summary
                homeGoalEvents.push({
                    scorer: scorer,
                    assisters: assisters,
                    goalNumber: i + 1
                });
            }
            
            // Assign goals and assists to AWAY team and build scoring summary
            const awaySkaters = awayDressed.filter(p => p.position !== 'G');
            const awayGoalEvents = []; // Track each goal for period summary
            
            for (let i = 0; i < awayGoals; i++) {
                const goalWeights = awaySkaters.map(p => ({
                    player: p,
                    weight: Math.pow(p.ratings.overall / 100, 2.5) * 
                           (p.lineNumber === 1 ? 1.3 : p.lineNumber === 2 ? 0.95 : 0.7) *
                           (p.ratings.overall >= 90 ? 1.2 : 1.0) *
                           (p.position === 'D' ? 0.2 : 1.0)
                }));
                
                const totalWeight = goalWeights.reduce((sum, w) => sum + w.weight, 0);
                let rand = Math.random() * totalWeight;
                let scorer = goalWeights[0].player;
                
                for (const w of goalWeights) {
                    rand -= w.weight;
                    if (rand <= 0) {
                        scorer = w.player;
                        break;
                    }
                }
                
                awayPlayerStats[scorer.id].goals++;
                awayPlayerStats[scorer.id].shots += 1 + Math.floor(Math.random() * 2);
                
                const numAssists = Math.random() < 0.03 ? 0 : Math.random() < 0.15 ? 1 : 2;
                const eligibleAssisters = awaySkaters.filter(p => p.id !== scorer.id);
                const assisters = [];
                
                for (let a = 0; a < numAssists && assisters.length < 2; a++) {
                    const assistWeights = eligibleAssisters.filter(p => !assisters.includes(p)).map(p => ({
                        player: p,
                        weight: Math.pow(p.ratings.overall / 100, 2.5) *
                               (p.lineNumber === 1 ? 1.3 : p.lineNumber === 2 ? 0.95 : 0.7) *
                               (p.position === 'D' ? 1.1 : 1.0)
                    }));
                    
                    if (assistWeights.length > 0) {
                        const totalAssistWeight = assistWeights.reduce((sum, w) => sum + w.weight, 0);
                        let assistRand = Math.random() * totalAssistWeight;
                        
                        for (const w of assistWeights) {
                            assistRand -= w.weight;
                            if (assistRand <= 0) {
                                assisters.push(w.player);
                                awayPlayerStats[w.player.id].assists++;
                                break;
                            }
                        }
                    }
                }
                
                // Store goal event for period summary
                awayGoalEvents.push({
                    scorer: scorer,
                    assisters: assisters,
                    goalNumber: i + 1
                });
            }
            
            // Calculate points and add random shots for skaters
            Object.values(homePlayerStats).forEach(stats => {
                if (stats.player.position !== 'G') {
                    stats.points = stats.goals + stats.assists;
                    stats.shots += Math.floor(Math.random() * 3);
                    stats.plusMinus = winner === 'home' ? (Math.random() < 0.3 ? 1 : 0) : (Math.random() < 0.3 ? -1 : 0);
                }
            });
            
            Object.values(awayPlayerStats).forEach(stats => {
                if (stats.player.position !== 'G') {
                    stats.points = stats.goals + stats.assists;
                    stats.shots += Math.floor(Math.random() * 3);
                    stats.plusMinus = winner === 'away' ? (Math.random() < 0.3 ? 1 : 0) : (Math.random() < 0.3 ? -1 : 0);
                }
            });
            
            // Goalie stats
            if (homeGoalies.length > 0) {
                const homeGoalie = homeGoalies[0];
                homePlayerStats[homeGoalie.id].goalsAgainst = awayGoals;
                homePlayerStats[homeGoalie.id].shotsAgainst = Math.floor(25 + Math.random() * 10);
                homePlayerStats[homeGoalie.id].saves = homePlayerStats[homeGoalie.id].shotsAgainst - awayGoals;
            }
            
            if (awayGoalies.length > 0) {
                const awayGoalie = awayGoalies[0];
                awayPlayerStats[awayGoalie.id].goalsAgainst = homeGoals;
                awayPlayerStats[awayGoalie.id].shotsAgainst = Math.floor(25 + Math.random() * 10);
                awayPlayerStats[awayGoalie.id].saves = awayPlayerStats[awayGoalie.id].shotsAgainst - homeGoals;
            }
            
            // Generate period-by-period scoring summary
            // Distribute goals across 3 periods realistically
            const allGoals = [];
            homeGoalEvents.forEach(g => allGoals.push({ ...g, team: 'home' }));
            awayGoalEvents.forEach(g => allGoals.push({ ...g, team: 'away' }));
            
            // Shuffle goals to randomize order
            for (let i = allGoals.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [allGoals[i], allGoals[j]] = [allGoals[j], allGoals[i]];
            }
            
            // Assign to periods (weighted: 33% per period, slight variance)
            const totalGoalsInGame = homeGoals + awayGoals;
            const periods = [
                { period: 1, goals: [] },
                { period: 2, goals: [] },
                { period: 3, goals: [] }
            ];
            
            allGoals.forEach((goal, idx) => {
                const periodRoll = Math.random();
                let period;
                if (periodRoll < 0.33) period = 0;
                else if (periodRoll < 0.66) period = 1;
                else period = 2;
                
                // Ensure last period has at least one goal if game has goals
                if (idx === allGoals.length - 1 && periods[2].goals.length === 0 && totalGoalsInGame > 1) {
                    period = 2;
                }
                
                periods[period].goals.push(goal);
            });
            
            // Generate scoring summary with running season totals
            // Note: We need to pass in pre-game stats to calculate running totals
            const scoringSummary = periods.map(p => ({
                period: p.period,
                goals: p.goals.map(g => ({
                    team: g.team,
                    scorer: {
                        id: g.scorer.id,
                        name: `${g.scorer.firstName} ${g.scorer.lastName}`,
                        // Season totals will be calculated when displaying
                    },
                    assists: g.assisters.map((a, idx) => ({
                        id: a.id,
                        name: `${a.firstName} ${a.lastName}`,
                        isPrimary: idx === 0
                    }))
                }))
            }));
            
            // Calculate team stats for this game
            const homeShots = Object.values(homePlayerStats).reduce((sum, p) => sum + (p.shots || 0), 0);
            const awayShots = Object.values(awayPlayerStats).reduce((sum, p) => sum + (p.shots || 0), 0);
            
            // ==================== PENALTY & POWER PLAY SIMULATION ====================
            
            // Generate realistic penalties throughout the game
            const generatePenalties = () => {
                const penalties = [];
                
                // Average 3.2 penalties per team per game (NHL 2023-24)
                const homePenaltyCount = 2 + Math.floor(Math.random() * 3); // 2-4
                const awayPenaltyCount = 2 + Math.floor(Math.random() * 3); // 2-4
                
                // Penalty type distribution
                const getPenaltyDuration = () => {
                    const roll = Math.random();
                    if (roll < 0.85) return 2;  // Minor (85%)
                    if (roll < 0.93) return 4;  // Double Minor (8%)
                    if (roll < 0.98) return 5;  // Major (5%)
                    return 10; // Misconduct (2%)
                };
                
                // Period distribution: 1st=30%, 2nd=35%, 3rd=35%
                const getPeriod = () => {
                    const roll = Math.random();
                    if (roll < 0.30) return 1;
                    if (roll < 0.65) return 2;
                    return 3;
                };
                
                // Generate home penalties
                for (let i = 0; i < homePenaltyCount; i++) {
                    const period = getPeriod();
                    const duration = getPenaltyDuration();
                    penalties.push({
                        team: 'home',
                        period: period,
                        time: Math.floor(Math.random() * 20), // Random time in period (0-19)
                        duration: duration,
                        player: null, // Will be assigned later
                        ended: false
                    });
                }
                
                // Generate away penalties
                for (let i = 0; i < awayPenaltyCount; i++) {
                    const period = getPeriod();
                    const duration = getPenaltyDuration();
                    penalties.push({
                        team: 'away',
                        period: period,
                        time: Math.floor(Math.random() * 20),
                        duration: duration,
                        player: null,
                        ended: false
                    });
                }
                
                // Sort penalties by game time
                penalties.sort((a, b) => {
                    const timeA = (a.period - 1) * 20 + a.time;
                    const timeB = (b.period - 1) * 20 + b.time;
                    return timeA - timeB;
                });
                
                return penalties;
            };
            
            // Assign penalty takers (weighted by PIM tendency)
            const assignPenaltyTakers = (penalties, homeSkaters, awaySkaters) => {
                penalties.forEach(pen => {
                    const skaters = pen.team === 'home' ? homeSkaters : awaySkaters;
                    
                    // Weight by position and aggression (simulate PIM tendency)
                    const weights = skaters.map(p => {
                        let weight = 1.0;
                        if (p.position === 'D') weight *= 1.2; // D-men take more penalties
                        if (p.ratings.overall < 75) weight *= 1.3; // Lower rated = more penalties
                        return { player: p, weight };
                    });
                    
                    const totalWeight = weights.reduce((sum, w) => sum + w.weight, 0);
                    let rand = Math.random() * totalWeight;
                    
                    for (const w of weights) {
                        rand -= w.weight;
                        if (rand <= 0) {
                            pen.player = w.player;
                            break;
                        }
                    }
                });
            };
            
            // Get PP/PK unit players
            const getPPUnit = (players, unitNumber) => {
                return players.filter(p => p.ppUnit === unitNumber);
            };
            
            const getPKUnit = (players, unitNumber, penaltyBoxPlayers = []) => {
                // Get PK unit, excluding players in penalty box
                const pkPlayers = players.filter(p => 
                    p.pkUnit === unitNumber && 
                    !penaltyBoxPlayers.includes(p.id)
                );
                
                // If a PK player is in the box, replace with best available
                if (pkPlayers.length < 4) {
                    const replacements = players
                        .filter(p => !p.pkUnit && !penaltyBoxPlayers.includes(p.id))
                        .sort((a, b) => b.ratings.overall - a.ratings.overall);
                    
                    while (pkPlayers.length < 4 && replacements.length > 0) {
                        pkPlayers.push(replacements.shift());
                    }
                }
                
                return pkPlayers;
            };
            
            // Calculate unit rating
            const getUnitRating = (players) => {
                if (players.length === 0) return 75;
                return players.reduce((sum, p) => sum + p.ratings.overall, 0) / players.length;
            };
            
            // Simulate power plays
            const penalties = generatePenalties();
            assignPenaltyTakers(penalties, [...homeForwards, ...homeDefense], [...awayForwards, ...awayDefense]);
            
            let homePPOpportunities = 0;
            let awayPPOpportunities = 0;
            let homePPGoals = 0;
            let awayPPGoals = 0;
            let homeSHGoals = 0; // Shorthanded goals
            let awaySHGoals = 0;
            
            const penaltyLog = []; // Track for game detail display
            
            penalties.forEach((pen, idx) => {
                // Check for concurrent penalties (5v3 situation)
                const checkForFiveOnThree = () => {
                    // Look for overlapping penalty within 2 minutes
                    const penaltyTime = (pen.period - 1) * 20 + pen.time;
                    return penalties.some((other, otherIdx) => {
                        if (otherIdx === idx || other.team !== pen.team || other.ended) return false;
                        const otherTime = (other.period - 1) * 20 + other.time;
                        const timeDiff = Math.abs(penaltyTime - otherTime);
                        return timeDiff < 2 && timeDiff > 0;
                    });
                };
                
                const isFiveOnThree = checkForFiveOnThree();
                
                // Determine which team gets PP
                if (pen.team === 'home') {
                    // Away gets power play
                    awayPPOpportunities++;
                    
                    // Get PP and PK units
                    const ppUnit = Math.random() < 0.7 ? 1 : 2; // PP1 70%, PP2 30%
                    const pkUnit = Math.random() < 0.7 ? 1 : 2;
                    
                    const awayPPPlayers = getPPUnit([...awayForwards, ...awayDefense], ppUnit);
                    const homePKPlayers = getPKUnit([...homeForwards, ...homeDefense], pkUnit, [pen.player?.id]);
                    
                    // Calculate success rate
                    const ppRating = getUnitRating(awayPPPlayers);
                    const pkRating = getUnitRating(homePKPlayers);
                    
                    // Base success rates: 5v4 = 20%, 5v3 = 40%
                    const baseSuccess = isFiveOnThree ? 0.40 : 0.20;
                    const successRate = baseSuccess * (ppRating / pkRating) * (ppRating / 80); // Normalize around 80 OVR
                    
                    // Simulate PP
                    if (Math.random() < successRate) {
                        awayPPGoals++;
                        
                        // Attribute goal to PP player (weighted by rating)
                        if (awayPPPlayers.length > 0) {
                            const weights = awayPPPlayers.map(p => ({
                                player: p,
                                weight: Math.pow(p.ratings.overall / 100, 2)
                            }));
                            const totalWeight = weights.reduce((sum, w) => sum + w.weight, 0);
                            let rand = Math.random() * totalWeight;
                            
                            for (const w of weights) {
                                rand -= w.weight;
                                if (rand <= 0 && homePlayerStats[w.player.id]) {
                                    homePlayerStats[w.player.id].ppGoals = (homePlayerStats[w.player.id].ppGoals || 0) + 1;
                                    break;
                                }
                            }
                        }
                        
                        // Minor penalties end on goal (unless 5v3)
                        if (pen.duration === 2 && !isFiveOnThree) {
                            pen.ended = true;
                        }
                    }
                    
                    // Small chance of shorthanded goal (~3%)
                    if (Math.random() < 0.03) {
                        homeSHGoals++;
                        
                        // Attribute to PK player
                        if (homePKPlayers.length > 0) {
                            const shScorer = homePKPlayers[Math.floor(Math.random() * homePKPlayers.length)];
                            if (homePlayerStats[shScorer.id]) {
                                homePlayerStats[shScorer.id].shGoals = (homePlayerStats[shScorer.id].shGoals || 0) + 1;
                            }
                        }
                    }
                    
                } else {
                    // Home gets power play (mirror logic)
                    homePPOpportunities++;
                    
                    const ppUnit = Math.random() < 0.7 ? 1 : 2;
                    const pkUnit = Math.random() < 0.7 ? 1 : 2;
                    
                    const homePPPlayers = getPPUnit([...homeForwards, ...homeDefense], ppUnit);
                    const awayPKPlayers = getPKUnit([...awayForwards, ...awayDefense], pkUnit, [pen.player?.id]);
                    
                    const ppRating = getUnitRating(homePPPlayers);
                    const pkRating = getUnitRating(awayPKPlayers);
                    
                    const baseSuccess = isFiveOnThree ? 0.40 : 0.20;
                    const successRate = baseSuccess * (ppRating / pkRating) * (ppRating / 80);
                    
                    if (Math.random() < successRate) {
                        homePPGoals++;
                        
                        if (homePPPlayers.length > 0) {
                            const weights = homePPPlayers.map(p => ({
                                player: p,
                                weight: Math.pow(p.ratings.overall / 100, 2)
                            }));
                            const totalWeight = weights.reduce((sum, w) => sum + w.weight, 0);
                            let rand = Math.random() * totalWeight;
                            
                            for (const w of weights) {
                                rand -= w.weight;
                                if (rand <= 0 && homePlayerStats[w.player.id]) {
                                    homePlayerStats[w.player.id].ppGoals = (homePlayerStats[w.player.id].ppGoals || 0) + 1;
                                    break;
                                }
                            }
                        }
                        
                        if (pen.duration === 2 && !isFiveOnThree) {
                            pen.ended = true;
                        }
                    }
                    
                    if (Math.random() < 0.03) {
                        awaySHGoals++;
                        
                        if (awayPKPlayers.length > 0) {
                            const shScorer = awayPKPlayers[Math.floor(Math.random() * awayPKPlayers.length)];
                            if (awayPlayerStats[shScorer.id]) {
                                awayPlayerStats[shScorer.id].shGoals = (awayPlayerStats[shScorer.id].shGoals || 0) + 1;
                            }
                        }
                    }
                }
                
                // Add to penalty log for game detail
                penaltyLog.push({
                    period: pen.period,
                    time: pen.time,
                    team: pen.team,
                    player: pen.player ? `${pen.player.firstName} ${pen.player.lastName}` : 'Unknown',
                    duration: pen.duration,
                    type: pen.duration === 2 ? 'Minor' : 
                          pen.duration === 4 ? 'Double Minor' :
                          pen.duration === 5 ? 'Major' : 'Misconduct'
                });
            });
            
            // ==================== END PENALTY SIMULATION ====================
            
            return { 
                winner, 
                homeGoals, 
                awayGoals,
                homePlayers: homeForwards.slice(0, 15),
                awayPlayers: awayForwards.slice(0, 15),
                homeDefense: homeDefense.slice(0, 6),
                awayDefense: awayDefense.slice(0, 6),
                // NEW: Per-game stats
                homePlayerStats: Object.values(homePlayerStats),
                awayPlayerStats: Object.values(awayPlayerStats),
                homeInjured,
                awayInjured,
                homeScratched,
                awayScratched,
                // NEW: Period-by-period scoring summary
                scoringSummary: scoringSummary,
                // NEW: Team stats for this game
                teamStats: {
                    homeShots,
                    awayShots,
                    homePPOpportunities,
                    awayPPOpportunities,
                    homePPGoals,
                    awayPPGoals,
                    homeSHGoals,
                    awaySHGoals
                },
                // NEW: Penalty log
                penaltyLog: penaltyLog
            };
        };

        const updatePlayerStats = (player, isWinner, goals) => {
            const toi = getIceTime(player);
            player.stats.timeOnIce += toi;
            player.stats.gamesPlayed++;
            
            if (player.position === 'G') return;
            
            // Target scoring rates for 82 game season:
            // Elite (90+ OVR, 1st line): ~1.4 pts/game = 115 pts/season (50G, 65A)
            // Star (85+ OVR, 1st line): ~1.0 pts/game = 82 pts/season (35G, 47A)
            // Good (80-84 OVR, 1st/2nd line): ~0.85 pts/game = 70 pts/season (28G, 42A)
            // Average (70-79 OVR, 2nd/3rd line): ~0.5 pts/game = 41 pts/season (15G, 26A)
            // Below avg (60-69 OVR, 3rd/4th line): ~0.25 pts/game = 20 pts/season (7G, 13A)
            
            const ratingFactor = Math.pow(player.ratings.overall / 100, 2.5);
            const toiFactor = toi / 18;
            const lineMultiplier = player.lineNumber === 1 ? 1.3 : player.lineNumber === 2 ? 0.95 : player.lineNumber === 3 ? 0.7 : 0.5;
            
            // Elite bonus for 90+ rated players
            const eliteBonus = player.ratings.overall >= 90 ? 1.2 : 1.0;
            
            // Defense have much lower scoring rates
            const positionMultiplier = player.position === 'D' ? 0.25 : 1.0;
            
            // MUCH higher goal and assist chances to match NHL scoring
            const baseGoalChance = ratingFactor * toiFactor * lineMultiplier * positionMultiplier * eliteBonus * 0.55;
            const baseAssistChance = ratingFactor * toiFactor * lineMultiplier * eliteBonus * 0.85;
            
            // Goals
            if (Math.random() < baseGoalChance) {
                player.stats.goals++;
            }
            
            // Assists (can get assist even if scored)
            if (Math.random() < baseAssistChance) {
                player.stats.assists++;
            }
            
            // Multi-point games for good players
            if (player.ratings.overall >= 85) {
                // Top players get multi-point games ~20% of the time
                if (Math.random() < 0.20) {
                    if (Math.random() < 0.4 && player.position === 'F') {
                        player.stats.goals++;
                    } else {
                        player.stats.assists++;
                    }
                }
            } else if (player.ratings.overall >= 75) {
                // Good players get multi-point games ~10% of the time
                if (Math.random() < 0.10) {
                    if (Math.random() < 0.4 && player.position === 'F') {
                        player.stats.goals++;
                    } else {
                        player.stats.assists++;
                    }
                }
            }
            
            // Points = Goals + Assists
            player.stats.points = player.stats.goals + player.stats.assists;
            
            // Shots on goal - 2-4 per game
            const shotChance = toiFactor * 0.25;
            const shotsThisGame = Math.floor(Math.random() * 3) + (Math.random() < shotChance ? 2 : 1);
            player.stats.shots += player.position === 'D' ? Math.floor(shotsThisGame * 0.7) : shotsThisGame;
            
            // Plus/minus
            const pmBase = isWinner ? 1 : -1;
            if (Math.random() < 0.3) {
                player.stats.plusMinus += pmBase;
            }
            
            // Penalty minutes
            if (Math.random() < 0.08) {
                player.stats.pim += 2;
            }
        };

        // Bracket View Component
        function BracketView({ playoffState, TEAMS }) {
            // Build history object that shows ALL rounds including current round's LIVE scores
            const history = {
                eastRound1: playoffState.history?.eastRound1 || (playoffState.round === 1 ? playoffState.eastMatchups : []),
                westRound1: playoffState.history?.westRound1 || (playoffState.round === 1 ? playoffState.westMatchups : []),
                eastRound2: playoffState.history?.eastRound2 || (playoffState.round === 2 ? playoffState.eastMatchups : []),
                westRound2: playoffState.history?.westRound2 || (playoffState.round === 2 ? playoffState.westMatchups : []),
                eastRound3: playoffState.history?.eastRound3 || (playoffState.round === 3 ? playoffState.eastMatchups : []),
                westRound3: playoffState.history?.westRound3 || (playoffState.round === 3 ? playoffState.westMatchups : []),
                final: playoffState.history?.final || (playoffState.round === 4 ? playoffState.finalMatchup : null)
            };
            
            // Override history with CURRENT round's live data to show real-time updates
            if (playoffState.round === 1) {
                history.eastRound1 = playoffState.eastMatchups;
                history.westRound1 = playoffState.westMatchups;
            } else if (playoffState.round === 2) {
                history.eastRound2 = playoffState.eastMatchups;
                history.westRound2 = playoffState.westMatchups;
            } else if (playoffState.round === 3) {
                history.eastRound3 = playoffState.eastMatchups;
                history.westRound3 = playoffState.westMatchups;
            } else if (playoffState.round === 4) {
                history.final = playoffState.finalMatchup;
            }
            
            const getWinner = (matchup) => {
                if (!matchup) return null;
                if (matchup.homeWins >= 4) return matchup.home;
                if (matchup.awayWins >= 4) return matchup.away;
                return null;
            };
            
            const renderMatchup = (matchup, isGrayedOut = false) => {
                if (!matchup) {
                    if (isGrayedOut) {
                        return (
                            <div style={{ 
                                padding: '0.75rem', 
                                background: 'rgba(30, 58, 138, 0.1)', 
                                borderRadius: '0.375rem',
                                border: '1px dashed rgba(100, 116, 139, 0.3)',
                                marginBottom: '0.5rem'
                            }}>
                                <div style={{ color: '#64748b', fontSize: '0.875rem', textAlign: 'center' }}>TBD</div>
                            </div>
                        );
                    }
                    return null;
                }
                
                const homeTeam = TEAMS.find(t => t.id === matchup.home);
                const awayTeam = TEAMS.find(t => t.id === matchup.away);
                const winner = getWinner(matchup);
                const isComplete = winner !== null;
                
                return (
                    <div style={{ 
                        padding: '0.75rem', 
                        background: isComplete ? 'rgba(34, 211, 238, 0.1)' : 'rgba(30, 58, 138, 0.2)', 
                        borderRadius: '0.375rem',
                        border: isComplete ? '2px solid #22c55e' : '1px solid rgba(59, 130, 246, 0.3)',
                        marginBottom: '0.5rem'
                    }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '0.25rem' }}>
                            <span style={{ 
                                fontSize: '0.875rem',
                                fontWeight: winner === matchup.home ? 'bold' : 'normal',
                                color: winner === matchup.home ? '#22c55e' : '#fff'
                            }}>
                                {homeTeam.city}
                            </span>
                            <span style={{ fontSize: '1rem', fontWeight: 'bold' }}>{matchup.homeWins}</span>
                        </div>
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                            <span style={{ 
                                fontSize: '0.875rem',
                                fontWeight: winner === matchup.away ? 'bold' : 'normal',
                                color: winner === matchup.away ? '#22c55e' : '#fff'
                            }}>
                                {awayTeam.city}
                            </span>
                            <span style={{ fontSize: '1rem', fontWeight: 'bold' }}>{matchup.awayWins}</span>
                        </div>
                    </div>
                );
            };
            
            return (
                <div style={{ overflowX: 'auto' }}>
                    <div style={{ minWidth: '1200px', padding: '1rem' }}>
                        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(7, 1fr)', gap: '1rem' }}>
                            {/* EASTERN CONFERENCE - Round 1 */}
                            <div>
                                <h4 style={{ color: '#3b82f6', textAlign: 'center', marginBottom: '0.75rem', fontSize: '0.9rem' }}>
                                    EAST R1
                                </h4>
                                {history.eastRound1.length > 0 ? history.eastRound1.map((m, i) => (
                                    <div key={i}>{renderMatchup(m)}</div>
                                )) : (
                                    <>
                                        {renderMatchup(null, true)}
                                        {renderMatchup(null, true)}
                                        {renderMatchup(null, true)}
                                        {renderMatchup(null, true)}
                                    </>
                                )}
                            </div>
                            
                            {/* EASTERN CONFERENCE - Round 2 */}
                            <div>
                                <h4 style={{ color: '#3b82f6', textAlign: 'center', marginBottom: '0.75rem', fontSize: '0.9rem' }}>
                                    EAST R2
                                </h4>
                                <div style={{ marginTop: '3rem' }}>
                                    {history.eastRound2.length > 0 ? history.eastRound2.map((m, i) => (
                                        <div key={i}>{renderMatchup(m)}</div>
                                    )) : (
                                        <>
                                            {renderMatchup(null, true)}
                                            {renderMatchup(null, true)}
                                        </>
                                    )}
                                </div>
                            </div>
                            
                            {/* EASTERN CONFERENCE - Conference Finals */}
                            <div>
                                <h4 style={{ color: '#3b82f6', textAlign: 'center', marginBottom: '0.75rem', fontSize: '0.9rem' }}>
                                    EAST FINAL
                                </h4>
                                <div style={{ marginTop: '6rem' }}>
                                    {history.eastRound3.length > 0 ? renderMatchup(history.eastRound3[0]) : renderMatchup(null, true)}
                                </div>
                            </div>
                            
                            {/* STANLEY CUP FINALS */}
                            <div>
                                <h4 style={{ color: '#fbbf24', textAlign: 'center', marginBottom: '0.75rem', fontSize: '1rem', fontWeight: 'bold' }}>
                                    ðŸ† CUP ðŸ†
                                </h4>
                                <div style={{ marginTop: '9rem' }}>
                                    {history.final ? (
                                        <div style={{
                                            padding: '1rem',
                                            background: 'rgba(251, 191, 36, 0.15)',
                                            borderRadius: '0.5rem',
                                            border: '3px solid #fbbf24'
                                        }}>
                                            <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '0.5rem' }}>
                                                <span style={{ 
                                                    fontWeight: history.final.homeWins >= 4 ? 'bold' : 'normal',
                                                    color: history.final.homeWins >= 4 ? '#fbbf24' : '#fff'
                                                }}>
                                                    {TEAMS.find(t => t.id === history.final.home)?.city}
                                                </span>
                                                <span style={{ fontSize: '1.2rem', fontWeight: 'bold' }}>{history.final.homeWins}</span>
                                            </div>
                                            <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                                                <span style={{ 
                                                    fontWeight: history.final.awayWins >= 4 ? 'bold' : 'normal',
                                                    color: history.final.awayWins >= 4 ? '#fbbf24' : '#fff'
                                                }}>
                                                    {TEAMS.find(t => t.id === history.final.away)?.city}
                                                </span>
                                                <span style={{ fontSize: '1.2rem', fontWeight: 'bold' }}>{history.final.awayWins}</span>
                                            </div>
                                            {(history.final.homeWins >= 4 || history.final.awayWins >= 4) && (
                                                <div style={{ 
                                                    marginTop: '0.75rem', 
                                                    padding: '0.5rem',
                                                    background: '#fbbf24',
                                                    borderRadius: '0.25rem',
                                                    textAlign: 'center',
                                                    color: '#0f172a',
                                                    fontWeight: 'bold'
                                                }}>
                                                    CHAMPION!
                                                </div>
                                            )}
                                        </div>
                                    ) : (
                                        renderMatchup(null, true)
                                    )}
                                </div>
                            </div>
                            
                            {/* WESTERN CONFERENCE - Conference Finals */}
                            <div>
                                <h4 style={{ color: '#ef4444', textAlign: 'center', marginBottom: '0.75rem', fontSize: '0.9rem' }}>
                                    WEST FINAL
                                </h4>
                                <div style={{ marginTop: '6rem' }}>
                                    {history.westRound3.length > 0 ? renderMatchup(history.westRound3[0]) : renderMatchup(null, true)}
                                </div>
                            </div>
                            
                            {/* WESTERN CONFERENCE - Round 2 */}
                            <div>
                                <h4 style={{ color: '#ef4444', textAlign: 'center', marginBottom: '0.75rem', fontSize: '0.9rem' }}>
                                    WEST R2
                                </h4>
                                <div style={{ marginTop: '3rem' }}>
                                    {history.westRound2.length > 0 ? history.westRound2.map((m, i) => (
                                        <div key={i}>{renderMatchup(m)}</div>
                                    )) : (
                                        <>
                                            {renderMatchup(null, true)}
                                            {renderMatchup(null, true)}
                                        </>
                                    )}
                                </div>
                            </div>
                            
                            {/* WESTERN CONFERENCE - Round 1 */}
                            <div>
                                <h4 style={{ color: '#ef4444', textAlign: 'center', marginBottom: '0.75rem', fontSize: '0.9rem' }}>
                                    WEST R1
                                </h4>
                                {history.westRound1.length > 0 ? history.westRound1.map((m, i) => (
                                    <div key={i}>{renderMatchup(m)}</div>
                                )) : (
                                    <>
                                        {renderMatchup(null, true)}
                                        {renderMatchup(null, true)}
                                        {renderMatchup(null, true)}
                                        {renderMatchup(null, true)}
                                    </>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        function HockeyGM() {
            const [gameState, setGameState] = useState(null);
            const [playoffState, setPlayoffState] = useState(null);
            const [seasonAwards, setSeasonAwards] = useState(null);
            const [playoffMVP, setPlayoffMVP] = useState(null);
            const [userTeamId, setUserTeamId] = useState(null);
            const [savedLineups, setSavedLineups] = useState([]); // Store saved line combinations
            const [currentView, setCurrentView] = useState('standings');
            const [selectedPlayoffGame, setSelectedPlayoffGame] = useState(null);
            const [seasonMode, setSeasonMode] = useState('regular'); // 'regular' or 'playoffs'
            const [playerStatMode, setPlayerStatMode] = useState('regular'); // For individual player profile
            const [standingsView, setStandingsView] = useState('division');
            const [selectedPlayer, setSelectedPlayer] = useState(null);
            const [selectedTeam, setSelectedTeam] = useState(null);
            const [viewStack, setViewStack] = useState([]);
            const [isAutoSimulatingPlayoffs, setIsAutoSimulatingPlayoffs] = useState(false);
            const [selectedPlayerProfile, setSelectedPlayerProfile] = useState(null);
            const [selectedTeamProfile, setSelectedTeamProfile] = useState(null);
            const [selectedGame, setSelectedGame] = useState(null);
            const [selectedDate, setSelectedDate] = useState(null);
            const [gameDetailTeamTab, setGameDetailTeamTab] = useState('away'); // 'away' or 'home'
            const [teamProfileSort, setTeamProfileSort] = useState({ key: 'stats.points', direction: 'desc' });
            const [sortConfig, setSortConfig] = useState({ key: 'stats.points', direction: 'desc' });
            const [standingsSortConfig, setStandingsSortConfig] = useState({ key: 'points', direction: 'desc' });
            const [leadersSortConfig, setLeadersSortConfig] = useState({ key: 'stats.points', direction: 'desc' });
            const [injuriesSortConfig, setInjuriesSortConfig] = useState({ key: 'injury.severity', direction: 'desc' });
            const [previewTeamId, setPreviewTeamId] = useState(null); // For team selection preview

            // Trade view state
            const [mySelectedPlayers, setMySelectedPlayers] = useState([]);
            const [theirSelectedPlayers, setTheirSelectedPlayers] = useState([]);
            const [tradePartnerTeamId, setTradePartnerTeamId] = useState(null);
            const [tradeSortConfig, setTradeSortConfig] = useState({ key: 'ratings.overall', direction: 'desc' });
            const [tradeMessage, setTradeMessage] = useState(null);

            // PERFORMANCE OPTIMIZATION: Create lookup maps for O(1) access
            const teamsMap = useMemo(() => {
                const map = new Map();
                TEAMS.forEach(team => map.set(team.id, team));
                return map;
            }, []); // TEAMS array never changes

            const farmTeamsMap = useMemo(() => {
                const map = new Map();
                FARM_TEAMS.forEach(team => map.set(team.id, team));
                return map;
            }, []); // FARM_TEAMS array never changes

            // PERFORMANCE OPTIMIZATION: Memoize filtered player lists
            const nhlPlayers = useMemo(() => {
                if (!gameState?.players) return [];
                return gameState.players.filter(p => p.roster === 'nhl');
            }, [gameState?.players]);

            const farmPlayers = useMemo(() => {
                if (!gameState?.players) return [];
                return gameState.players.filter(p => p.roster === 'farm');
            }, [gameState?.players]);

            const userRoster = useMemo(() => {
                if (!gameState?.players || !userTeamId) return [];
                return gameState.players.filter(p => p.teamId === userTeamId && p.roster === 'nhl');
            }, [gameState?.players, userTeamId]);

            const injuredPlayers = useMemo(() => {
                if (!gameState?.players) return [];
                return gameState.players.filter(p => p.injury.injured && p.roster === 'nhl');
            }, [gameState?.players]);

            // Helper function for fast team lookup
            const getTeam = useCallback((teamId) => {
                return teamsMap.get(teamId);
            }, [teamsMap]);

            const getFarmTeam = useCallback((teamId) => {
                return farmTeamsMap.get(teamId);
            }, [farmTeamsMap]);

            const handleSort = (key) => {
                const direction = sortConfig.key === key && sortConfig.direction === 'desc' ? 'asc' : 'desc';
                setSortConfig({ key, direction });
            };

            const sortData = (data, key, direction) => {
                return [...data].sort((a, b) => {
                    let aVal = a;
                    let bVal = b;
                    
                    // Handle nested properties like stats.points
                    const keys = key.split('.');
                    for (const k of keys) {
                        aVal = aVal?.[k];
                        bVal = bVal?.[k];
                    }
                    
                    if (typeof aVal === 'number' && typeof bVal === 'number') {
                        return direction === 'desc' ? bVal - aVal : aVal - bVal;
                    }
                    
                    if (typeof aVal === 'string' && typeof bVal === 'string') {
                        return direction === 'desc' ? bVal.localeCompare(aVal) : aVal.localeCompare(bVal);
                    }
                    
                    return 0;
                });
            };

            // Helper to create sortable header
            const SortableHeader = ({ label, sortKey, currentSort, onSort, className = "text-center" }) => {
                const isActive = currentSort.key === sortKey;
                return (
                    <th 
                        className={className}
                        style={{ cursor: 'pointer', userSelect: 'none' }}
                        onClick={() => {
                            const dir = isActive && currentSort.direction === 'desc' ? 'asc' : 'desc';
                            onSort({ key: sortKey, direction: dir });
                        }}
                    >
                        {label} {isActive && (currentSort.direction === 'desc' ? 'â–¼' : 'â–²')}
                    </th>
                );
            };

            const navigateTo = (view, data = null) => {
                setViewStack([...viewStack, { view: currentView, data: { selectedPlayerProfile, selectedTeamProfile, selectedGame } }]);
                setCurrentView(view);
                if (view === 'playerProfile') setSelectedPlayerProfile(data);
                if (view === 'teamProfile') setSelectedTeamProfile(data);
                if (view === 'gameDetail') setSelectedGame(data);
            };

            const goBack = () => {
                if (viewStack.length === 0) return;
                const previous = viewStack[viewStack.length - 1];
                setViewStack(viewStack.slice(0, -1));
                setCurrentView(previous.view);
                setSelectedPlayerProfile(previous.data.selectedPlayerProfile);
                setSelectedTeamProfile(previous.data.selectedTeamProfile);
                setSelectedGame(previous.data.selectedGame);
            };

            const initGame = (teamId) => {
                const allPlayers = [];
                // Generate NHL rosters
                TEAMS.forEach(team => {
                    allPlayers.push(...generateRoster(team.id));
                });
                
                // Generate farm team rosters (23 players each, lower ratings)
                FARM_TEAMS.forEach(farmTeam => {
                    const farmRoster = [];
                    // 13 Forwards
                    for (let i = 0; i < 13; i++) {
                        farmRoster.push(generatePlayer('F', farmTeam.id, 0, true)); // isFarm = true
                    }
                    // 7 Defense
                    for (let i = 0; i < 7; i++) {
                        farmRoster.push(generatePlayer('D', farmTeam.id, 0, true));
                    }
                    // 3 Goalies
                    for (let i = 0; i < 3; i++) {
                        const goalie = generatePlayer('G', farmTeam.id, i + 1, true);
                        goalie.dressed = false; // Farm goalies don't have "dressed" status
                        farmRoster.push(goalie);
                    }
                    allPlayers.push(...farmRoster);
                });

                const schedule = generateSchedule();
                
                // 82-day season system - each season is a calendar year
                const currentYear = new Date().getFullYear();

                const newGameState = {
                    players: allPlayers,
                    standings: TEAMS.map(t => ({ 
                        teamId: t.id, 
                        wins: 0, 
                        losses: 0, 
                        otLosses: 0,
                        points: 0,
                        goalsFor: 0,
                        goalsAgainst: 0,
                        home: { wins: 0, losses: 0 },
                        away: { wins: 0, losses: 0 },
                        // NEW: Streak tracking
                        currentStreak: { type: null, count: 0 }, // 'W', 'L', 'OTL'
                        // Team stats for analytics
                        teamStats: {
                            gamesPlayed: 0,
                            shots: 0,
                            shotsAgainst: 0,
                            ppOpportunities: 0,
                            ppGoals: 0,
                            pkOpportunities: 0, 
                            pkGoalsAgainst: 0
                        }
                    })),
                    // Head-to-head records: { "1vs2": { team1Wins: 0, team2Wins: 0, ties: 0 }, ... }
                    headToHead: {},
                    schedule: schedule,
                    currentDay: 1, // Current day (1-82)
                    season: 1,
                    year: currentYear, // Season 1 = 2025, Season 2 = 2026, etc.
                    lastGameDay: null,
                    lastGameTeams: [],
                    // NEW: Season goals
                    seasonGoal: null, // Will be set by user
                    // NEW: Power rankings history
                    powerRankings: null, // Updated weekly (every 7 days)
                    lastRankingUpdate: null,
                    // NEW: Player development tracking
                    playerDevelopment: {}, // { playerId: { startOVR, currentOVR, games, lastUpdate } }
                    // NEW: Mid-season report generated
                    midSeasonReport: null,
                    // NEW: Team history tracking
                    teamHistory: {
                        seasons: [], // Array of completed season records
                        achievements: {
                            championships: [], // Years won Stanley Cup
                            conferenceTitles: [], // Years won conference
                            divisionTitles: [], // Years won division
                            playoffAppearances: [], // Years made playoffs
                            bestRecord: null, // { season, year, wins, losses, otLosses, points }
                            bestGoalsFor: null, // { season, year, goalsFor }
                            bestGoalDiff: null // { season, year, diff }
                        }
                    }
                };
                
                // NEW: Initialize player development tracking for young players (age <= 25)
                newGameState.playerDevelopment = {};
                allPlayers.forEach(p => {
                    if (p.age <= 25) {
                        newGameState.playerDevelopment[p.id] = {
                            startOVR: p.ratings.overall,
                            currentOVR: p.ratings.overall,
                            startPotential: p.ratings.potential,
                            growth: 0,
                            games: 0,
                            seasonStart: 1,
                            lastChecked: 1 // Day 1 of season
                        };
                    }
                });
                
                // Backfill milestones for all players at game start
                backfillMilestones(newGameState);
                
                setGameState(newGameState);
                setUserTeamId(teamId);
                setPlayoffState(null);
                setSeasonMode('regular');
                
                // Auto-save to localStorage
                saveGameToLocalStorage(newGameState, teamId, null, 'regular');
            };
            
            // ==========================================
            // INDEXEDDB STORAGE (replaces localStorage)
            // ==========================================
            
            const DB_NAME = 'HockeyGMDatabase';
            const DB_VERSION = 1;
            const STORE_NAME = 'saves';
            
            // Initialize IndexedDB
            const initDB = () => {
                return new Promise((resolve, reject) => {
                    const request = indexedDB.open(DB_NAME, DB_VERSION);
                    
                    request.onerror = () => reject(request.error);
                    request.onsuccess = () => resolve(request.result);
                    
                    request.onupgradeneeded = (event) => {
                        const db = event.target.result;
                        if (!db.objectStoreNames.contains(STORE_NAME)) {
                            db.createObjectStore(STORE_NAME, { keyPath: 'id' });
                        }
                    };
                });
            };
            
            // Save game to IndexedDB
            const saveGameToLocalStorage = async (gameStateToSave, userTeam, playoffStateToSave, mode) => {
                try {
                    const db = await initDB();
                    
                    const saveData = {
                        id: 'currentSave', // Single save slot for now
                        gameState: gameStateToSave,
                        userTeamId: userTeam,
                        playoffState: playoffStateToSave,
                        seasonMode: mode,
                        savedAt: new Date().toISOString()
                    };
                    
                    const transaction = db.transaction([STORE_NAME], 'readwrite');
                    const store = transaction.objectStore(STORE_NAME);
                    store.put(saveData);
                    
                    await new Promise((resolve, reject) => {
                        transaction.oncomplete = () => {
                            console.log('Game saved to IndexedDB');
                            resolve();
                        };
                        transaction.onerror = () => reject(transaction.error);
                    });
                } catch (error) {
                    console.error('Failed to save game:', error);
                    alert('Save failed: ' + error.message);
                }
            };
            
            // Load game from IndexedDB
            const loadGameFromLocalStorage = async () => {
                try {
                    const db = await initDB();
                    const transaction = db.transaction([STORE_NAME], 'readonly');
                    const store = transaction.objectStore(STORE_NAME);
                    const request = store.get('currentSave');
                    
                    const saveData = await new Promise((resolve, reject) => {
                        request.onsuccess = () => resolve(request.result);
                        request.onerror = () => reject(request.error);
                    });
                    
                    if (!saveData) return false;
                    
                    // Restore game state
                    const restoredGameState = {
                        ...saveData.gameState,
                        currentDay: saveData.gameState.currentDay || 1
                    };
                    
                    // Restore missing player fields if needed
                    restoredGameState.players.forEach(p => {
                        if (!p.achievements) p.achievements = [];
                        if (!p.milestones) p.milestones = [];
                        if (!p.currentStreak) p.currentStreak = { games: 0, bonus: 0 };
                    });
                    
                    // MIGRATION: Fix goalie lineNumbers and dressed status for all teams
                    const teams = [...new Set(restoredGameState.players.filter(p => p.position === 'G' && p.roster === 'nhl').map(p => p.teamId))];
                    teams.forEach(teamId => {
                        const teamGoalies = restoredGameState.players.filter(p => p.position === 'G' && p.teamId === teamId && p.roster === 'nhl');
                        teamGoalies.sort((a, b) => b.ratings.overall - a.ratings.overall);
                        teamGoalies.forEach((g, idx) => {
                            g.lineNumber = idx + 1;
                            g.dressed = idx < 2;
                        });
                    });
                    
                    // MIGRATION: Add teamHistory if it doesn't exist
                    if (!restoredGameState.teamHistory) {
                        restoredGameState.teamHistory = {
                            seasons: [],
                            achievements: {
                                championships: [],
                                conferenceTitles: [],
                                divisionTitles: [],
                                playoffAppearances: [],
                                bestRecord: null,
                                bestGoalsFor: null,
                                bestGoalDiff: null
                            }
                        };
                    }
                    
                    // MIGRATION: Initialize special teams if missing
                    restoredGameState.players.forEach(player => {
                        if (!player.specialTeams) {
                            player.specialTeams = {
                                powerPlay: player.position !== 'G' && player.lineNumber <= 2,
                                penaltyKill: player.position !== 'G' && player.lineNumber <= 2
                            };
                        }
                    });
                    
                    // Backfill milestones for existing players
                    backfillMilestones(restoredGameState);
                    
                    setGameState(restoredGameState);
                    setUserTeamId(saveData.userTeamId);
                    setPlayoffState(saveData.playoffState);
                    setSeasonMode(saveData.seasonMode);
                    
                    // Save the updated game state with backfilled milestones
                    await saveGameToLocalStorage(restoredGameState, saveData.userTeamId, saveData.playoffState, saveData.seasonMode);
                    
                    console.log('Game loaded from IndexedDB');
                    return true;
                } catch (error) {
                    console.error('Failed to load game:', error);
                    return false;
                }
            };
            
            // Delete save from IndexedDB
            const deleteSave = async () => {
                if (confirm('Are you sure you want to delete your saved game? This cannot be undone.')) {
                    try {
                        const db = await initDB();
                        const transaction = db.transaction([STORE_NAME], 'readwrite');
                        const store = transaction.objectStore(STORE_NAME);
                        store.delete('currentSave');
                        
                        await new Promise((resolve, reject) => {
                            transaction.oncomplete = resolve;
                            transaction.onerror = () => reject(transaction.error);
                        });
                        
                        setGameState(null);
                        setUserTeamId(null);
                        setPlayoffState(null);
                        setSeasonMode('regular');
                        alert('Save deleted. Start a new game to continue.');
                    } catch (error) {
                        console.error('Failed to delete save:', error);
                        alert('Failed to delete save: ' + error.message);
                    }
                }
            };
            
            // Auto-load on component mount
            React.useEffect(() => {
                const loaded = loadGameFromLocalStorage();
                if (loaded) {
                    console.log('Previous game loaded automatically');
                }
            }, []);
            
            // Auto-save whenever game state changes
            React.useEffect(() => {
                if (gameState && userTeamId) {
                    saveGameToLocalStorage(gameState, userTeamId, playoffState, seasonMode);
                }
            }, [gameState, playoffState, seasonMode]);

            // Auto-simulate playoff rounds when flag is set
            React.useEffect(() => {
                if (isAutoSimulatingPlayoffs && playoffState && !playoffState.completed) {
                    // Simulate one round
                    simulatePlayoffSeries();
                } else if (isAutoSimulatingPlayoffs && (!playoffState || playoffState.completed)) {
                    // Playoffs are done, turn off auto-simulation
                    setIsAutoSimulatingPlayoffs(false);
                }
            }, [isAutoSimulatingPlayoffs, playoffState?.round, playoffState?.completed]);

            // Calculate team overall rating (weighted by ice time and role)
            const calculateTeamOverall = useCallback((teamId, players) => {
                if (!players) return 0;
                
                const teamPlayers = players.filter(p => 
                    p.teamId === teamId && 
                    p.roster === 'nhl' && 
                    !p.injury.injured
                );
                
                if (teamPlayers.length === 0) return 0;
                
                let totalWeight = 0;
                let weightedSum = 0;
                
                // Process forwards (weight by line)
                const forwards = teamPlayers.filter(p => p.position === 'F' && p.lineNumber > 0);
                forwards.forEach(p => {
                    let weight = 0;
                    if (p.lineNumber === 1) weight = 1.5;      // Top line: 1.5x
                    else if (p.lineNumber === 2) weight = 1.0; // 2nd line: 1.0x
                    else if (p.lineNumber === 3) weight = 0.7; // 3rd line: 0.7x
                    else if (p.lineNumber === FORWARD_LINES) weight = 0.4; // 4th line: 0.4x
                    
                    // Bonus for PP/PK specialists
                    if (p.ppUnit) weight += 0.15;  // PP adds 0.15x
                    if (p.pkUnit) weight += 0.10;  // PK adds 0.10x
                    
                    totalWeight += weight;
                    weightedSum += p.ratings.overall * weight;
                });
                
                // Process defensemen (weight by pair)
                const defense = teamPlayers.filter(p => p.position === 'D' && p.lineNumber > 0);
                defense.forEach(p => {
                    let weight = 0;
                    if (p.lineNumber === 1) weight = 1.4;      // Top pair: 1.4x
                    else if (p.lineNumber === 2) weight = 0.9; // 2nd pair: 0.9x
                    else if (p.lineNumber === 3) weight = 0.5; // 3rd pair: 0.5x
                    
                    // Bonus for PP/PK specialists
                    if (p.ppUnit) weight += 0.15;
                    if (p.pkUnit) weight += 0.10;
                    
                    totalWeight += weight;
                    weightedSum += p.ratings.overall * weight;
                });
                
                // Process goalies (dressed goalies only)
                const goalies = teamPlayers.filter(p => p.position === 'G' && p.dressed);
                goalies.forEach((p, idx) => {
                    const weight = idx === 0 ? 1.2 : 0.8; // Starter: 1.2x, Backup: 0.8x
                    totalWeight += weight;
                    weightedSum += p.ratings.overall * weight;
                });
                
                return totalWeight > 0 ? Math.round(weightedSum / totalWeight) : 0;
            }, []);

            // Calculate all team overalls and rankings (memoized for performance)
            const teamOveralls = useMemo(() => {
                if (!gameState?.players) return [];
                
                const overalls = TEAMS.map(team => ({
                    teamId: team.id,
                    overall: calculateTeamOverall(team.id, gameState.players)
                }));
                
                // Sort by overall (highest first) to determine rank
                const sorted = [...overalls].sort((a, b) => b.overall - a.overall);
                
                // Add rank to each team
                return overalls.map(team => {
                    const rank = sorted.findIndex(t => t.teamId === team.teamId) + 1;
                    return { ...team, rank };
                });
            }, [gameState?.players, calculateTeamOverall]);

            // Helper to get team overall and rank
            const getTeamOverall = useCallback((teamId) => {
                return teamOveralls.find(t => t.teamId === teamId);
            }, [teamOveralls]);

            // Save completed season to team history
            const saveSeasonToHistory = (gameState, playoffState, userTeamId) => {
                if (!gameState || !gameState.teamHistory || !playoffState || !playoffState.completed) return;
                
                const userTeam = TEAMS.find(t => t.id === userTeamId);
                if (!userTeam) return;
                
                const userStanding = gameState.standings.find(s => s.teamId === userTeamId);
                if (!userStanding) return;
                
                // Determine division finish
                const divisionStandings = gameState.standings
                    .filter(s => TEAMS.find(t => t.id === s.teamId)?.division === userTeam.division)
                    .sort((a, b) => b.points - a.points);
                const divisionFinish = divisionStandings.findIndex(s => s.teamId === userTeamId) + 1;
                const wonDivision = divisionFinish === 1;
                
                // Determine conference finish
                const conferenceStandings = gameState.standings
                    .filter(s => TEAMS.find(t => t.id === s.teamId)?.conference === userTeam.conference)
                    .sort((a, b) => b.points - a.points);
                const conferenceFinish = conferenceStandings.findIndex(s => s.teamId === userTeamId) + 1;
                
                // Determine playoff results
                let playoffResult = null;
                let wonConference = false;
                let wonChampionship = false;
                
                if (playoffState.champion === userTeamId) {
                    playoffResult = 'Won Stanley Cup';
                    wonChampionship = true;
                    wonConference = true;
                } else {
                    // Check rounds
                    if (playoffState.history?.final && (playoffState.history.final.home === userTeamId || playoffState.history.final.away === userTeamId)) {
                        playoffResult = 'Lost in Stanley Cup Finals';
                        wonConference = true;
                    } else {
                        // Simplified: check if team was in playoffs
                        playoffResult = 'Made Playoffs';
                    }
                }
                
                // Create season record
                const seasonRecord = {
                    season: gameState.season,
                    year: gameState.year,
                    wins: userStanding.wins,
                    losses: userStanding.losses,
                    otLosses: userStanding.otLosses,
                    points: userStanding.points,
                    goalsFor: userStanding.goalsFor,
                    goalsAgainst: userStanding.goalsAgainst,
                    goalDifferential: userStanding.goalsFor - userStanding.goalsAgainst,
                    divisionFinish: divisionFinish,
                    conferenceFinish: conferenceFinish,
                    playoffResult: playoffResult,
                    wonDivision: wonDivision,
                    wonConference: wonConference,
                    wonChampionship: wonChampionship
                };
                
                // Add to seasons array
                gameState.teamHistory.seasons.push(seasonRecord);
                
                // Update achievements
                if (wonChampionship) {
                    gameState.teamHistory.achievements.championships.push(gameState.year);
                }
                if (wonConference) {
                    gameState.teamHistory.achievements.conferenceTitles.push(gameState.year);
                }
                if (wonDivision) {
                    gameState.teamHistory.achievements.divisionTitles.push(gameState.year);
                }
                gameState.teamHistory.achievements.playoffAppearances.push(gameState.year);
                
                // Update best records
                if (!gameState.teamHistory.achievements.bestRecord || 
                    userStanding.points > gameState.teamHistory.achievements.bestRecord.points) {
                    gameState.teamHistory.achievements.bestRecord = {
                        season: gameState.season,
                        year: gameState.year,
                        wins: userStanding.wins,
                        losses: userStanding.losses,
                        otLosses: userStanding.otLosses,
                        points: userStanding.points
                    };
                }
                
                if (!gameState.teamHistory.achievements.bestGoalsFor || 
                    userStanding.goalsFor > gameState.teamHistory.achievements.bestGoalsFor.goalsFor) {
                    gameState.teamHistory.achievements.bestGoalsFor = {
                        season: gameState.season,
                        year: gameState.year,
                        goalsFor: userStanding.goalsFor
                    };
                }
                
                const goalDiff = userStanding.goalsFor - userStanding.goalsAgainst;
                if (!gameState.teamHistory.achievements.bestGoalDiff || 
                    goalDiff > gameState.teamHistory.achievements.bestGoalDiff.diff) {
                    gameState.teamHistory.achievements.bestGoalDiff = {
                        season: gameState.season,
                        year: gameState.year,
                        diff: goalDiff
                    };
                }
            };

            // Auto-assign all lines for a team
            const autoSetAllLines = (players, teamId) => {
                const teamPlayers = players.filter(p => p.teamId === teamId && p.roster === 'nhl' && !p.injury.injured);
                
                // Sort by overall
                const forwards = teamPlayers.filter(p => p.position === 'F').sort((a, b) => b.ratings.overall - a.ratings.overall);
                const defense = teamPlayers.filter(p => p.position === 'D').sort((a, b) => b.ratings.overall - a.ratings.overall);
                const goalies = teamPlayers.filter(p => p.position === 'G').sort((a, b) => b.ratings.overall - a.ratings.overall);
                
                // Assign forwards to lines (top 12)
                forwards.forEach((p, idx) => {
                    if (idx < 12) {
                        p.lineNumber = Math.floor(idx / 3) + 1; // Lines 1-4
                    } else {
                        p.lineNumber = 0; // Scratch
                    }
                    p.linePosition = null; // Reset specific position
                });
                
                // Assign defense to pairs (top 6)
                defense.forEach((p, idx) => {
                    if (idx < 6) {
                        p.lineNumber = Math.floor(idx / 2) + 1; // Pairs 1-3
                    } else {
                        p.lineNumber = 0; // Scratch
                    }
                    p.linePosition = null;
                });
                
                // Assign goalies (top 2 dressed)
                goalies.forEach((p, idx) => {
                    p.dressed = idx < 2;
                    p.lineNumber = idx + 1; // 1 = Starter, 2 = Backup, 3 = Third
                });
                
                // Assign Power Play Units (PP1: top 5, PP2: next 5)
                const activeSkaters = [...forwards.filter((p, idx) => idx < 12), ...defense.filter((p, idx) => idx < 6)]
                    .sort((a, b) => b.ratings.overall - a.ratings.overall);
                
                activeSkaters.forEach((p, idx) => {
                    if (idx < 5) {
                        p.ppUnit = 1;
                        p.ppPosition = `PP1-${idx + 1}`;
                    } else if (idx < 10) {
                        p.ppUnit = 2;
                        p.ppPosition = `PP2-${idx - 4}`;
                    } else {
                        p.ppUnit = null;
                        p.ppPosition = null;
                    }
                });
                
                // Assign Penalty Kill Units (PK1: top 4, PK2: next 4)
                // Prioritize defensive forwards and all defensemen for PK
                const pkCandidates = [...forwards.filter((p, idx) => idx < 12), ...defense.filter((p, idx) => idx < 6)]
                    .sort((a, b) => {
                        // Defensemen get priority for PK
                        if (a.position === 'D' && b.position === 'F') return -1;
                        if (a.position === 'F' && b.position === 'D') return 1;
                        return b.ratings.overall - a.ratings.overall;
                    });
                
                pkCandidates.forEach((p, idx) => {
                    if (idx < 4) {
                        p.pkUnit = 1;
                        p.pkPosition = `PK1-${idx + 1}`;
                    } else if (idx < 8) {
                        p.pkUnit = 2;
                        p.pkPosition = `PK2-${idx - 3}`;
                    } else {
                        p.pkUnit = null;
                        p.pkPosition = null;
                    }
                });
            };

            // Call up player from farm
            const callUpPlayer = (playerId) => {
                if (!gameState) return;
                
                const newPlayers = [...gameState.players];
                const player = newPlayers.find(p => p.id === playerId);
                
                if (player && player.roster === 'farm') {
                    // Find player's NHL team
                    const farmTeam = FARM_TEAMS.find(t => t.id === player.teamId);
                    if (farmTeam) {
                        player.teamId = farmTeam.nhlAffiliation;
                        player.roster = 'nhl';
                        player.lineNumber = 0; // Start as scratch
                        player.linePosition = null;
                        player.ppUnit = null;
                        player.pkUnit = null;
                        if (player.position === 'G') player.dressed = false;
                        
                        setGameState({ ...gameState, players: newPlayers });
                        saveGameToLocalStorage({ ...gameState, players: newPlayers }, userTeamId, playoffState, seasonMode);
                    }
                }
            };

            // Send down player to farm
            const sendDownPlayer = (playerId) => {
                if (!gameState) return;
                
                const newPlayers = [...gameState.players];
                const player = newPlayers.find(p => p.id === playerId);
                
                if (player && player.roster === 'nhl' && !player.injury.injured) {
                    // Find team's farm affiliate
                    const farmTeam = FARM_TEAMS.find(t => t.nhlAffiliation === player.teamId);
                    if (farmTeam) {
                        player.teamId = farmTeam.id;
                        player.roster = 'farm';
                        player.lineNumber = 0;
                        player.linePosition = null;
                        player.ppUnit = null;
                        player.pkUnit = null;
                        if (player.position === 'G') player.dressed = false;
                        
                        setGameState({ ...gameState, players: newPlayers });
                        saveGameToLocalStorage({ ...gameState, players: newPlayers }, userTeamId, playoffState, seasonMode);
                    }
                }
            };

            // Calculate end-of-season awards
            const calculateAwards = (players, standings) => {
                const awards = {
                    league: {},
                    divisions: {
                        Atlantic: {},
                        Metropolitan: {},
                        Central: {},
                        Pacific: {}
                    },
                    allStars: {
                        firstTeam: {},
                        secondTeam: {},
                        thirdTeam: {},
                        divisions: {
                            Atlantic: {},
                            Metropolitan: {},
                            Central: {},
                            Pacific: {}
                        }
                    }
                };

                // Filter skaters and goalies
                const skaters = players.filter(p => p.position !== 'G' && p.stats.gamesPlayed >= 20);
                const goalies = players.filter(p => p.position === 'G' && p.stats.gamesPlayed >= 15);
                const forwards = players.filter(p => p.position === 'F' && p.stats.gamesPlayed >= 20);
                const defensemen = players.filter(p => p.position === 'D' && p.stats.gamesPlayed >= 20);

                // LEAGUE AWARDS
                
                // League MVP (Best overall player - points, +/-, performance)
                const mvpCandidates = skaters.map(p => ({
                    player: p,
                    score: (p.stats.points * 2) + (p.stats.plusMinus * 0.5) + (p.stats.gamesPlayed * 0.1)
                })).sort((a, b) => b.score - a.score);
                awards.league.mvp = mvpCandidates[0]?.player;

                // Best Goaltender (Save %, GAA, Wins)
                const goalieCandidates = goalies.map(p => ({
                    player: p,
                    score: (p.stats.savePercentage * 100) + ((3.0 - p.stats.gaa) * 10) + (p.stats.wins * 0.5)
                })).sort((a, b) => b.score - a.score);
                awards.league.bestGoalie = goalieCandidates[0]?.player;

                // Best Defenseman (Points, +/-, TOI for defensemen)
                const defensemanCandidates = defensemen.map(p => ({
                    player: p,
                    score: (p.stats.points * 2) + (p.stats.plusMinus * 1) + ((p.stats.timeOnIce / p.stats.gamesPlayed) * 0.01)
                })).sort((a, b) => b.score - a.score);
                awards.league.bestDefenseman = defensemanCandidates[0]?.player;

                // Rookie of the Year (Best first-year player - age <= 22, high points)
                const rookies = skaters.filter(p => p.age <= 22);
                const rookieCandidates = rookies.map(p => ({
                    player: p,
                    score: (p.stats.points * 2) + (p.stats.plusMinus * 0.5)
                })).sort((a, b) => b.score - a.score);
                awards.league.rookieOfYear = rookieCandidates[0]?.player;

                // Top Goal Scorer (Most goals)
                const topScorer = skaters.sort((a, b) => b.stats.goals - a.stats.goals)[0];
                awards.league.topGoalScorer = topScorer;

                // Top Point Scorer (Most points)
                const topPoints = skaters.sort((a, b) => b.stats.points - a.stats.points)[0];
                awards.league.topPointScorer = topPoints;

                // Best Defensive Forward (Best +/-, low PIM for forwards)
                const defensiveForwardCandidates = forwards.map(p => ({
                    player: p,
                    score: (p.stats.plusMinus * 2) - (p.stats.pim * 0.1) + (p.stats.gamesPlayed * 0.1)
                })).sort((a, b) => b.score - a.score);
                awards.league.bestDefensiveForward = defensiveForwardCandidates[0]?.player;

                // Sportsmanship Award (High points, low PIM)
                const sportsmanshipCandidates = skaters.map(p => ({
                    player: p,
                    score: (p.stats.points * 1.5) - (p.stats.pim * 0.5)
                })).sort((a, b) => b.score - a.score);
                awards.league.sportsmanship = sportsmanshipCandidates[0]?.player;

                // DIVISION AWARDS
                ['Atlantic', 'Metropolitan', 'Central', 'Pacific'].forEach(division => {
                    const divPlayers = players.filter(p => {
                        const team = TEAMS.find(t => t.id === p.teamId);
                        return team?.division === division;
                    });
                    
                    const divSkaters = divPlayers.filter(p => p.position !== 'G' && p.stats.gamesPlayed >= 20);
                    const divGoalies = divPlayers.filter(p => p.position === 'G' && p.stats.gamesPlayed >= 15);
                    const divDefensemen = divPlayers.filter(p => p.position === 'D' && p.stats.gamesPlayed >= 20);
                    const divRookies = divSkaters.filter(p => p.age <= 22);

                    // Division MVP
                    const divMvp = divSkaters.map(p => ({
                        player: p,
                        score: (p.stats.points * 2) + (p.stats.plusMinus * 0.5)
                    })).sort((a, b) => b.score - a.score)[0];
                    awards.divisions[division].mvp = divMvp?.player;

                    // Division Best Goalie
                    const divGoalie = divGoalies.map(p => ({
                        player: p,
                        score: (p.stats.savePercentage * 100) + ((3.0 - p.stats.gaa) * 10)
                    })).sort((a, b) => b.score - a.score)[0];
                    awards.divisions[division].bestGoalie = divGoalie?.player;

                    // Division Best Defenseman
                    const divDef = divDefensemen.map(p => ({
                        player: p,
                        score: (p.stats.points * 2) + (p.stats.plusMinus * 1)
                    })).sort((a, b) => b.score - a.score)[0];
                    awards.divisions[division].bestDefenseman = divDef?.player;

                    // Division Rookie
                    const divRookie = divRookies.map(p => ({
                        player: p,
                        score: (p.stats.points * 2) + (p.stats.plusMinus * 0.5)
                    })).sort((a, b) => b.score - a.score)[0];
                    awards.divisions[division].rookieOfYear = divRookie?.player;

                    // Division Top Scorer
                    const divTopScorer = divSkaters.sort((a, b) => b.stats.points - a.stats.points)[0];
                    awards.divisions[division].topScorer = divTopScorer;
                });

                // ALL-STAR TEAMS (League)
                
                // Goalies (top 3)
                const topGoalies = goalies.sort((a, b) => {
                    const scoreA = (a.stats.savePercentage * 100) + ((3.0 - a.stats.gaa) * 10);
                    const scoreB = (b.stats.savePercentage * 100) + ((3.0 - b.stats.gaa) * 10);
                    return scoreB - scoreA;
                });
                awards.allStars.firstTeam.goalie = topGoalies[0];
                awards.allStars.secondTeam.goalie = topGoalies[1];
                awards.allStars.thirdTeam.goalie = topGoalies[2];

                // Defensemen (top 6 - 2 per team)
                const topDefensemen = defensemen.sort((a, b) => {
                    const scoreA = (a.stats.points * 2) + (a.stats.plusMinus * 1);
                    const scoreB = (b.stats.points * 2) + (b.stats.plusMinus * 1);
                    return scoreB - scoreA;
                });
                awards.allStars.firstTeam.leftDefense = topDefensemen[0];
                awards.allStars.firstTeam.rightDefense = topDefensemen[1];
                awards.allStars.secondTeam.leftDefense = topDefensemen[2];
                awards.allStars.secondTeam.rightDefense = topDefensemen[3];
                awards.allStars.thirdTeam.leftDefense = topDefensemen[4];
                awards.allStars.thirdTeam.rightDefense = topDefensemen[5];

                // Forwards (top 9 - C, LW, RW per team)
                const topForwards = forwards.sort((a, b) => b.stats.points - a.stats.points);
                awards.allStars.firstTeam.center = topForwards[0];
                awards.allStars.firstTeam.leftWing = topForwards[1];
                awards.allStars.firstTeam.rightWing = topForwards[2];
                awards.allStars.secondTeam.center = topForwards[3];
                awards.allStars.secondTeam.leftWing = topForwards[4];
                awards.allStars.secondTeam.rightWing = topForwards[5];
                awards.allStars.thirdTeam.center = topForwards[6];
                awards.allStars.thirdTeam.leftWing = topForwards[7];
                awards.allStars.thirdTeam.rightWing = topForwards[8];

                // DIVISION ALL-STARS (top 6 per division)
                ['Atlantic', 'Metropolitan', 'Central', 'Pacific'].forEach(division => {
                    const divPlayers = players.filter(p => {
                        const team = TEAMS.find(t => t.id === p.teamId);
                        return team?.division === division;
                    });
                    
                    const divSkaters = divPlayers.filter(p => p.position !== 'G' && p.stats.gamesPlayed >= 20);
                    const divGoalies = divPlayers.filter(p => p.position === 'G' && p.stats.gamesPlayed >= 15);
                    const divDefensemen = divPlayers.filter(p => p.position === 'D' && p.stats.gamesPlayed >= 20);
                    const divForwards = divPlayers.filter(p => p.position === 'F' && p.stats.gamesPlayed >= 20);

                    // Top goalie
                    const divTopGoalie = divGoalies.sort((a, b) => {
                        const scoreA = (a.stats.savePercentage * 100) + ((3.0 - a.stats.gaa) * 10);
                        const scoreB = (b.stats.savePercentage * 100) + ((3.0 - b.stats.gaa) * 10);
                        return scoreB - scoreA;
                    })[0];
                    awards.allStars.divisions[division].goalie = divTopGoalie;

                    // Top 2 defensemen
                    const divTopDef = divDefensemen.sort((a, b) => {
                        const scoreA = (a.stats.points * 2) + (a.stats.plusMinus * 1);
                        const scoreB = (b.stats.points * 2) + (b.stats.plusMinus * 1);
                        return scoreB - scoreA;
                    });
                    awards.allStars.divisions[division].leftDefense = divTopDef[0];
                    awards.allStars.divisions[division].rightDefense = divTopDef[1];

                    // Top 3 forwards
                    const divTopForwards = divForwards.sort((a, b) => b.stats.points - a.stats.points);
                    awards.allStars.divisions[division].center = divTopForwards[0];
                    awards.allStars.divisions[division].leftWing = divTopForwards[1];
                    awards.allStars.divisions[division].rightWing = divTopForwards[2];
                });

                // AWARD ACHIEVEMENTS TO PLAYERS
                const currentYear = gameState.year; // Use year from gameState
                
                // Award trophies
                if (awards.league.mvp && awards.league.mvp.achievements) {
                    awards.league.mvp.achievements.push({
                        type: 'award',
                        award: 'Hart Trophy',
                        year: currentYear,
                        icon: 'ðŸ†'
                    });
                }
                if (awards.league.bestGoalie && awards.league.bestGoalie.achievements) {
                    awards.league.bestGoalie.achievements.push({
                        type: 'award',
                        award: 'Vezina Trophy',
                        year: currentYear,
                        icon: 'ðŸ†'
                    });
                }
                if (awards.league.bestDefenseman && awards.league.bestDefenseman.achievements) {
                    awards.league.bestDefenseman.achievements.push({
                        type: 'award',
                        award: 'Norris Trophy',
                        year: currentYear,
                        icon: 'ðŸ†'
                    });
                }
                if (awards.league.rookieOfTheYear && awards.league.rookieOfTheYear.achievements) {
                    awards.league.rookieOfTheYear.achievements.push({
                        type: 'award',
                        award: 'Calder Trophy',
                        year: currentYear,
                        icon: 'ðŸ†'
                    });
                }
                if (awards.league.topScorer && awards.league.topScorer.achievements) {
                    awards.league.topScorer.achievements.push({
                        type: 'award',
                        award: 'Art Ross Trophy',
                        year: currentYear,
                        icon: 'ðŸ†'
                    });
                }
                if (awards.league.topGoalScorer && awards.league.topGoalScorer.achievements) {
                    awards.league.topGoalScorer.achievements.push({
                        type: 'award',
                        award: 'Maurice Richard Trophy',
                        year: currentYear,
                        icon: 'ðŸ†'
                    });
                }
                if (awards.league.bestDefensiveForward && awards.league.bestDefensiveForward.achievements) {
                    awards.league.bestDefensiveForward.achievements.push({
                        type: 'award',
                        award: 'Selke Trophy',
                        year: currentYear,
                        icon: 'ðŸ…'
                    });
                }
                if (awards.league.sportsmanship && awards.league.sportsmanship.achievements) {
                    awards.league.sportsmanship.achievements.push({
                        type: 'award',
                        award: 'Lady Byng Trophy',
                        year: currentYear,
                        icon: 'ðŸ¤'
                    });
                }
                if (awards.league.topPointScorer && awards.league.topPointScorer.achievements) {
                    awards.league.topPointScorer.achievements.push({
                        type: 'award',
                        award: 'Art Ross Trophy',
                        year: currentYear,
                        icon: 'ðŸ“Š'
                    });
                }
                
                // Award All-Star Team selections (1st, 2nd, 3rd teams)
                ['firstTeam', 'secondTeam', 'thirdTeam'].forEach((team, teamIdx) => {
                    const teamName = teamIdx === 0 ? '1st' : teamIdx === 1 ? '2nd' : '3rd';
                    const allStarTeam = awards.allStars[team];
                    
                    [allStarTeam.center, allStarTeam.leftWing, allStarTeam.rightWing,
                     allStarTeam.leftDefense, allStarTeam.rightDefense, allStarTeam.goalie].forEach(player => {
                        if (player && player.achievements) {
                            player.achievements.push({
                                type: 'allstar_team',
                                team: `${teamName} All-Star Team`,
                                year: currentYear,
                                icon: teamIdx === 0 ? 'ðŸ¥‡' : teamIdx === 1 ? 'ðŸ¥ˆ' : 'ðŸ¥‰'
                            });
                        }
                    });
                });
                
                // Award Division MVPs and Best Goalies
                ['Atlantic', 'Metropolitan', 'Central', 'Pacific'].forEach(division => {
                    const divAwards = awards.divisions[division];
                    
                    if (divAwards.mvp && divAwards.mvp.achievements) {
                        divAwards.mvp.achievements.push({
                            type: 'division_award',
                            award: `${division} Division MVP`,
                            year: currentYear,
                            icon: 'ðŸ†'
                        });
                    }
                    
                    if (divAwards.bestGoalie && divAwards.bestGoalie.achievements) {
                        divAwards.bestGoalie.achievements.push({
                            type: 'division_award',
                            award: `${division} Division Best Goalie`,
                            year: currentYear,
                            icon: 'ðŸ¥…'
                        });
                    }
                    
                    // Award Division All-Star Team selections
                    const divAllStars = awards.allStars.divisions[division];
                    [divAllStars.center, divAllStars.leftWing, divAllStars.rightWing,
                     divAllStars.leftDefense, divAllStars.rightDefense, divAllStars.goalie].forEach(player => {
                        if (player && player.achievements) {
                            player.achievements.push({
                                type: 'division_allstar',
                                team: `${division} Division All-Star Team`,
                                year: currentYear,
                                icon: 'â­'
                            });
                        }
                    });
                });
                
                // Award All-Star selections (NHL-style: 12F, 6D, 2G per conference)
                // Eastern Conference All-Stars
                const eastPlayers = players.filter(p => {
                    const team = TEAMS.find(t => t.id === p.teamId);
                    return team && team.conference === 'East' && p.roster === 'nhl';
                });
                const eastForwards = eastPlayers.filter(p => p.position === 'F' && p.stats.gamesPlayed >= 20)
                    .sort((a, b) => b.stats.points - a.stats.points).slice(0, 12);
                const eastDefense = eastPlayers.filter(p => p.position === 'D' && p.stats.gamesPlayed >= 20)
                    .sort((a, b) => b.stats.points - a.stats.points).slice(0, 6);
                const eastGoalies = eastPlayers.filter(p => p.position === 'G' && p.stats.gamesPlayed >= 20)
                    .sort((a, b) => (b.stats.savePercentage || 0) - (a.stats.savePercentage || 0)).slice(0, 2);
                
                [...eastForwards, ...eastDefense, ...eastGoalies].forEach(p => {
                    if (p.achievements) {
                        p.achievements.push({
                            type: 'allstar',
                            conference: 'Eastern',
                            year: currentYear,
                            icon: 'â­'
                        });
                    }
                });
                
                // Western Conference All-Stars
                const westPlayers = players.filter(p => {
                    const team = TEAMS.find(t => t.id === p.teamId);
                    return team && team.conference === 'West' && p.roster === 'nhl';
                });
                const westForwards = westPlayers.filter(p => p.position === 'F' && p.stats.gamesPlayed >= 20)
                    .sort((a, b) => b.stats.points - a.stats.points).slice(0, 12);
                const westDefense = westPlayers.filter(p => p.position === 'D' && p.stats.gamesPlayed >= 20)
                    .sort((a, b) => b.stats.points - a.stats.points).slice(0, 6);
                const westGoalies = westPlayers.filter(p => p.position === 'G' && p.stats.gamesPlayed >= 20)
                    .sort((a, b) => (b.stats.savePercentage || 0) - (a.stats.savePercentage || 0)).slice(0, 2);
                
                [...westForwards, ...westDefense, ...westGoalies].forEach(p => {
                    if (p.achievements) {
                        p.achievements.push({
                            type: 'allstar',
                            conference: 'Western',
                            year: currentYear,
                            icon: 'â­'
                        });
                    }
                });
                
                // Award League Leaders
                const nhlPlayers = players.filter(p => p.roster === 'nhl' && p.stats.gamesPlayed > 0);
                const nhlSkaters = nhlPlayers.filter(p => p.position !== 'G');
                const nhlGoalies = nhlPlayers.filter(p => p.position === 'G' && p.stats.gamesPlayed >= 27);
                
                // Points leader
                const pointsLeader = [...nhlSkaters].sort((a, b) => b.stats.points - a.stats.points)[0];
                if (pointsLeader && pointsLeader.achievements) {
                    pointsLeader.achievements.push({
                        type: 'leagueLeader',
                        stat: 'Points',
                        value: pointsLeader.stats.points,
                        year: currentYear,
                        icon: 'ðŸŽ¯'
                    });
                }
                
                // Goals leader
                const goalsLeader = [...nhlSkaters].sort((a, b) => b.stats.goals - a.stats.goals)[0];
                if (goalsLeader && goalsLeader.achievements) {
                    goalsLeader.achievements.push({
                        type: 'leagueLeader',
                        stat: 'Goals',
                        value: goalsLeader.stats.goals,
                        year: currentYear,
                        icon: 'ðŸŽ¯'
                    });
                }
                
                // Assists leader
                const assistsLeader = [...nhlSkaters].sort((a, b) => b.stats.assists - a.stats.assists)[0];
                if (assistsLeader && assistsLeader.achievements) {
                    assistsLeader.achievements.push({
                        type: 'leagueLeader',
                        stat: 'Assists',
                        value: assistsLeader.stats.assists,
                        year: currentYear,
                        icon: 'ðŸŽ¯'
                    });
                }
                
                // Plus/Minus leader
                const plusMinusLeader = [...nhlSkaters].sort((a, b) => b.stats.plusMinus - a.stats.plusMinus)[0];
                if (plusMinusLeader && plusMinusLeader.achievements && plusMinusLeader.stats.plusMinus > 0) {
                    plusMinusLeader.achievements.push({
                        type: 'leagueLeader',
                        stat: 'Plus/Minus',
                        value: plusMinusLeader.stats.plusMinus,
                        year: currentYear,
                        icon: 'ðŸŽ¯'
                    });
                }
                
                // PIM leader
                const pimLeader = [...nhlSkaters].sort((a, b) => b.stats.pim - a.stats.pim)[0];
                if (pimLeader && pimLeader.achievements && pimLeader.stats.pim > 0) {
                    pimLeader.achievements.push({
                        type: 'leagueLeader',
                        stat: 'Penalty Minutes',
                        value: pimLeader.stats.pim,
                        year: currentYear,
                        icon: 'ðŸŽ¯'
                    });
                }
                
                // Goalie: Wins leader
                const winsLeader = [...nhlGoalies].sort((a, b) => (b.stats.wins || 0) - (a.stats.wins || 0))[0];
                if (winsLeader && winsLeader.achievements) {
                    winsLeader.achievements.push({
                        type: 'leagueLeader',
                        stat: 'Wins',
                        value: winsLeader.stats.wins,
                        year: currentYear,
                        icon: 'ðŸŽ¯'
                    });
                }
                
                // Goalie: Save % leader
                const savePercentageLeader = [...nhlGoalies].sort((a, b) => (b.stats.savePercentage || 0) - (a.stats.savePercentage || 0))[0];
                if (savePercentageLeader && savePercentageLeader.achievements) {
                    savePercentageLeader.achievements.push({
                        type: 'leagueLeader',
                        stat: 'Save Percentage',
                        value: savePercentageLeader.stats.savePercentage.toFixed(3),
                        year: currentYear,
                        icon: 'ðŸŽ¯'
                    });
                }
                
                // Goalie: GAA leader (lowest)
                const gaaLeader = [...nhlGoalies].sort((a, b) => (a.stats.gaa || 99) - (b.stats.gaa || 99))[0];
                if (gaaLeader && gaaLeader.achievements) {
                    gaaLeader.achievements.push({
                        type: 'leagueLeader',
                        stat: 'Goals Against Average',
                        value: gaaLeader.stats.gaa.toFixed(2),
                        year: currentYear,
                        icon: 'ðŸŽ¯'
                    });
                }

                return awards;
            };

            // Calculate playoff MVP (Conn Smythe equivalent)
            const calculatePlayoffMVP = (players) => {
                if (!players || players.length === 0) return null;
                
                const playoffSkaters = players.filter(p => p.position !== 'G' && p.playoffStats.gamesPlayed >= 4);
                const playoffGoalies = players.filter(p => p.position === 'G' && p.playoffStats.gamesPlayed >= 4);
                
                const allCandidates = [];
                
                // Score skaters
                playoffSkaters.forEach(p => {
                    const score = (p.playoffStats.points * 3) + 
                                 (p.playoffStats.plusMinus * 1) + 
                                 (p.playoffStats.gamesPlayed * 0.5);
                    allCandidates.push({ player: p, score });
                });
                
                // Score goalies
                playoffGoalies.forEach(p => {
                    const score = (p.playoffStats.savePercentage * 150) + 
                                 ((3.0 - p.playoffStats.gaa) * 15) + 
                                 (p.playoffStats.wins * 2);
                    allCandidates.push({ player: p, score });
                });
                
                allCandidates.sort((a, b) => b.score - a.score);
                return allCandidates[0]?.player;
            };

            // Line Management Functions
            const saveCurrentLineup = (lineupName) => {
                if (!gameState || !userTeamId) return;
                
                const roster = gameState.players.filter(p => p.teamId === userTeamId);
                const lineupData = roster.map(p => ({
                    playerId: p.id,
                    lineNumber: p.lineNumber,
                    position: p.position
                }));
                
                const newLineup = {
                    id: Date.now(),
                    name: lineupName,
                    date: new Date(),
                    data: lineupData
                };
                
                setSavedLineups([...savedLineups, newLineup]);
                alert(`Lineup "${lineupName}" saved successfully!`);
            };
            
            const loadLineup = (lineup) => {
                if (!gameState || !userTeamId) return;
                
                const newPlayers = [...gameState.players];
                
                lineup.data.forEach(savedPlayer => {
                    const player = newPlayers.find(p => p.id === savedPlayer.playerId);
                    if (player) {
                        player.lineNumber = savedPlayer.lineNumber;
                    }
                });
                
                setGameState({ ...gameState, players: newPlayers });
                alert(`Lineup "${lineup.name}" loaded successfully!`);
            };
            
            const deleteLineup = (lineupId) => {
                if (confirm('Are you sure you want to delete this saved lineup?')) {
                    setSavedLineups(savedLineups.filter(l => l.id !== lineupId));
                }
            };
            
            const changePlayerLine = (playerId, newLine) => {
                if (!gameState) return;
                
                const newPlayers = [...gameState.players];
                const player = newPlayers.find(p => p.id === playerId);
                if (player) {
                    player.lineNumber = newLine;
                    setGameState({ ...gameState, players: newPlayers });
                }
            };
            
            const toggleHealthyScratch = (playerId) => {
                if (!gameState) return;
                
                const newPlayers = [...gameState.players];
                const player = newPlayers.find(p => p.id === playerId);
                if (player) {
                    // Toggle between line 0 (scratched) and line 4 (playing)
                    player.lineNumber = player.lineNumber === 0 ? 4 : 0;
                    setGameState({ ...gameState, players: newPlayers });
                }
            };
            
            // Assign player to specific line and position
            const assignPlayerToLine = (playerId, lineNum, position) => {
                if (!gameState) return;
                
                const newPlayers = [...gameState.players];
                const player = newPlayers.find(p => p.id === playerId);
                if (player) {
                    player.lineNumber = lineNum;
                    player.linePosition = position;
                    setGameState({ ...gameState, players: newPlayers });
                }
            };
            
            // Assign player to special teams
            const assignToSpecialTeams = (playerId, unit, unitNumber, position) => {
                if (!gameState) return;
                
                const newPlayers = [...gameState.players];
                const player = newPlayers.find(p => p.id === playerId);
                if (player) {
                    if (unit === 'pp') {
                        // Clear any existing PP assignment for this player
                        player.ppUnit = unitNumber;
                        player.ppPosition = position;
                    } else if (unit === 'pk') {
                        // Clear any existing PK assignment for this player
                        player.pkUnit = unitNumber;
                        player.pkPosition = position;
                    }
                    setGameState({ ...gameState, players: newPlayers });
                    saveGameToLocalStorage({ ...gameState, players: newPlayers }, userTeamId, playoffState, seasonMode);
                }
            };
            
            // Toggle goalie dressed status
            const toggleGoalieDressed = (playerId) => {
                if (!gameState) return;
                
                const newPlayers = [...gameState.players];
                const player = newPlayers.find(p => p.id === playerId);
                if (player && player.position === 'G') {
                    player.dressed = !player.dressed;
                    setGameState({ ...gameState, players: newPlayers });
                }
            };

            // Calculate effective overall rating (reduced if out of position)
            const getEffectiveOverall = (player) => {
                if (!player.linePosition || !player.preferredPosition) return player.ratings.overall;
                
                // Goalies always play their position
                if (player.position === 'G') return player.ratings.overall;
                
                // In preferred position = full rating
                if (player.linePosition === player.preferredPosition) return player.ratings.overall;
                
                // Out of position penalty
                if (player.position === 'F') {
                    // Forwards: -3 OVR when out of position
                    return Math.max(50, player.ratings.overall - 3);
                } else if (player.position === 'D') {
                    // Defense: -5 OVR when playing wrong side
                    return Math.max(50, player.ratings.overall - 5);
                }
                
                return player.ratings.overall;
            };

            // Check and award milestones
            const checkMilestones = (player, gameState) => {
                if (!player.milestones) player.milestones = [];
                
                const milestones = [];
                const stats = player.stats;
                const existingMilestones = player.milestones.map(m => m.type);
                
                // Calculate current season game number for the player's team
                const teamStanding = gameState.standings.find(s => s.teamId === player.teamId);
                const seasonGame = teamStanding ? (teamStanding.wins + teamStanding.losses + teamStanding.otLosses) : 0;
                
                // Career game is stored in stats
                const careerGame = stats.gamesPlayed || 0;
                
                // ========== EARLY CAREER MILESTONES ==========
                if (stats.goals >= 1 && !existingMilestones.includes('first_goal')) {
                    milestones.push({ 
                        type: 'first_goal', 
                        day: gameState.currentDay, 
                        season: gameState.season, 
                        year: gameState.year, 
                        seasonGame: seasonGame,
                        careerGame: careerGame,
                        description: 'First Career Goal' 
                    });
                }
                if (stats.points >= 1 && !existingMilestones.includes('first_point')) {
                    milestones.push({ 
                        type: 'first_point', 
                        day: gameState.currentDay, 
                        season: gameState.season, 
                        year: gameState.year, 
                        seasonGame: seasonGame,
                        careerGame: careerGame,
                        description: 'First Career Point' 
                    });
                }
                
                // ========== REALISTIC SINGLE-SEASON GOAL MILESTONES ==========
                if (stats.goals >= 10 && !existingMilestones.includes('10_goals')) {
                    milestones.push({ 
                        type: '10_goals', 
                        day: gameState.currentDay, 
                        season: gameState.season, 
                        year: gameState.year, 
                        seasonGame: seasonGame,
                        careerGame: careerGame,
                        description: '10 Career Goals' 
                    });
                }
                if (stats.goals >= 20 && !existingMilestones.includes('20_goals')) {
                    milestones.push({ 
                        type: '20_goals', 
                        day: gameState.currentDay, 
                        season: gameState.season, 
                        year: gameState.year, 
                        seasonGame: seasonGame,
                        careerGame: careerGame,
                        description: '20 Career Goals' 
                    });
                }
                if (stats.goals >= 30 && !existingMilestones.includes('30_goals')) {
                    milestones.push({ 
                        type: '30_goals', 
                        day: gameState.currentDay, 
                        season: gameState.season, 
                        year: gameState.year, 
                        seasonGame: seasonGame,
                        careerGame: careerGame,
                        description: '30 Career Goals' 
                    });
                }
                if (stats.goals >= 40 && !existingMilestones.includes('40_goals')) {
                    milestones.push({ 
                        type: '40_goals', 
                        day: gameState.currentDay, 
                        season: gameState.season, 
                        year: gameState.year, 
                        seasonGame: seasonGame,
                        careerGame: careerGame,
                        description: '40 Career Goals' 
                    });
                }
                if (stats.goals >= 50 && !existingMilestones.includes('50_goals')) {
                    milestones.push({ 
                        type: '50_goals', 
                        day: gameState.currentDay, 
                        season: gameState.season, 
                        year: gameState.year, 
                        seasonGame: seasonGame,
                        careerGame: careerGame,
                        description: '50 Career Goals (Elite!)' 
                    });
                }
                if (stats.goals >= 100 && !existingMilestones.includes('100_goals')) {
                    milestones.push({ 
                        type: '100_goals', 
                        day: gameState.currentDay, 
                        season: gameState.season, 
                        year: gameState.year, 
                        seasonGame: seasonGame,
                        careerGame: careerGame,
                        description: '100 Career Goals' 
                    });
                }
                if (stats.goals >= 200 && !existingMilestones.includes('200_goals')) {
                    milestones.push({ 
                        type: '200_goals', 
                        day: gameState.currentDay, 
                        season: gameState.season, 
                        year: gameState.year, 
                        seasonGame: seasonGame,
                        careerGame: careerGame,
                        description: '200 Career Goals' 
                    });
                }
                if (stats.goals >= 300 && !existingMilestones.includes('300_goals')) {
                    milestones.push({ 
                        type: '300_goals', 
                        day: gameState.currentDay, 
                        season: gameState.season, 
                        year: gameState.year, 
                        seasonGame: seasonGame,
                        careerGame: careerGame,
                        description: '300 Career Goals' 
                    });
                }
                if (stats.goals >= 400 && !existingMilestones.includes('400_goals')) {
                    milestones.push({ 
                        type: '400_goals', 
                        day: gameState.currentDay, 
                        season: gameState.season, 
                        year: gameState.year, 
                        seasonGame: seasonGame,
                        careerGame: careerGame,
                        description: '400 Career Goals' 
                    });
                }
                if (stats.goals >= 500 && !existingMilestones.includes('500_goals')) {
                    milestones.push({ 
                        type: '500_goals', 
                        day: gameState.currentDay, 
                        season: gameState.season, 
                        year: gameState.year, 
                        seasonGame: seasonGame,
                        careerGame: careerGame,
                        description: '500 Career Goals (Legendary!)' 
                    });
                }
                
                // ========== POINTS MILESTONES ==========
                if (stats.points >= 10 && !existingMilestones.includes('10_points')) {
                    milestones.push({ 
                        type: '10_points', 
                        day: gameState.currentDay, 
                        season: gameState.season, 
                        year: gameState.year, 
                        seasonGame: seasonGame,
                        careerGame: careerGame,
                        description: '10 Career Points' 
                    });
                }
                if (stats.points >= 25 && !existingMilestones.includes('25_points')) {
                    milestones.push({ 
                        type: '25_points', 
                        day: gameState.currentDay, 
                        season: gameState.season, 
                        year: gameState.year, 
                        seasonGame: seasonGame,
                        careerGame: careerGame,
                        description: '25 Career Points' 
                    });
                }
                if (stats.points >= 50 && !existingMilestones.includes('50_points')) {
                    milestones.push({ 
                        type: '50_points', 
                        day: gameState.currentDay, 
                        season: gameState.season, 
                        year: gameState.year, 
                        seasonGame: seasonGame,
                        careerGame: careerGame,
                        description: '50 Career Points' 
                    });
                }
                if (stats.points >= 100 && !existingMilestones.includes('100_points')) {
                    milestones.push({ 
                        type: '100_points', 
                        day: gameState.currentDay, 
                        season: gameState.season, 
                        year: gameState.year, 
                        seasonGame: seasonGame,
                        careerGame: careerGame,
                        description: '100 Career Points' 
                    });
                }
                if (stats.points >= 200 && !existingMilestones.includes('200_points')) {
                    milestones.push({ 
                        type: '200_points', 
                        day: gameState.currentDay, 
                        season: gameState.season, 
                        year: gameState.year, 
                        seasonGame: seasonGame,
                        careerGame: careerGame,
                        description: '200 Career Points' 
                    });
                }
                if (stats.points >= 500 && !existingMilestones.includes('500_points')) {
                    milestones.push({ 
                        type: '500_points', 
                        day: gameState.currentDay, 
                        season: gameState.season, 
                        year: gameState.year, 
                        seasonGame: seasonGame,
                        careerGame: careerGame,
                        description: '500 Career Points' 
                    });
                }
                if (stats.points >= 1000 && !existingMilestones.includes('1000_points')) {
                    milestones.push({ 
                        type: '1000_points', 
                        day: gameState.currentDay, 
                        season: gameState.season, 
                        year: gameState.year, 
                        seasonGame: seasonGame,
                        careerGame: careerGame,
                        description: '1000 Career Points (Hall of Fame!)' 
                    });
                }
                
                // ========== GAMES PLAYED MILESTONES ==========
                if (stats.gamesPlayed >= 10 && !existingMilestones.includes('10_games')) {
                    milestones.push({ 
                        type: '10_games', 
                        day: gameState.currentDay, 
                        season: gameState.season, 
                        year: gameState.year, 
                        seasonGame: seasonGame,
                        careerGame: careerGame,
                        description: '10 Games Played' 
                    });
                }
                if (stats.gamesPlayed >= 50 && !existingMilestones.includes('50_games')) {
                    milestones.push({ 
                        type: '50_games', 
                        day: gameState.currentDay, 
                        season: gameState.season, 
                        year: gameState.year, 
                        seasonGame: seasonGame,
                        careerGame: careerGame,
                        description: '50 Games Played' 
                    });
                }
                if (stats.gamesPlayed >= 100 && !existingMilestones.includes('100_games')) {
                    milestones.push({ 
                        type: '100_games', 
                        day: gameState.currentDay, 
                        season: gameState.season, 
                        year: gameState.year, 
                        seasonGame: seasonGame,
                        careerGame: careerGame,
                        description: '100 Games Played' 
                    });
                }
                if (stats.gamesPlayed >= 200 && !existingMilestones.includes('200_games')) {
                    milestones.push({ 
                        type: '200_games', 
                        day: gameState.currentDay, 
                        season: gameState.season, 
                        year: gameState.year, 
                        seasonGame: seasonGame,
                        careerGame: careerGame,
                        description: '200 Games Played' 
                    });
                }
                if (stats.gamesPlayed >= 500 && !existingMilestones.includes('500_games')) {
                    milestones.push({ 
                        type: '500_games', 
                        day: gameState.currentDay, 
                        season: gameState.season, 
                        year: gameState.year, 
                        seasonGame: seasonGame,
                        careerGame: careerGame,
                        description: '500 Games Played' 
                    });
                }
                if (stats.gamesPlayed >= 1000 && !existingMilestones.includes('1000_games')) {
                    milestones.push({ 
                        type: '1000_games', 
                        day: gameState.currentDay, 
                        season: gameState.season, 
                        year: gameState.year, 
                        seasonGame: seasonGame,
                        careerGame: careerGame,
                        description: '1000 Games Played (Iron Man!)' 
                    });
                }
                
                // ========== GOALIE-SPECIFIC MILESTONES ==========
                if (player.position === 'G') {
                    if (stats.wins >= 1 && !existingMilestones.includes('first_win')) {
                        milestones.push({ 
                            type: 'first_win', 
                            day: gameState.currentDay, 
                            season: gameState.season, 
                            year: gameState.year, 
                            seasonGame: seasonGame,
                            careerGame: careerGame,
                            description: 'First Career Win' 
                        });
                    }
                    if (stats.shutouts >= 1 && !existingMilestones.includes('first_shutout')) {
                        milestones.push({ 
                            type: 'first_shutout', 
                            day: gameState.currentDay, 
                            season: gameState.season, 
                            year: gameState.year, 
                            seasonGame: seasonGame,
                            careerGame: careerGame,
                            description: 'First Career Shutout' 
                        });
                    }
                    if (stats.wins >= 10 && !existingMilestones.includes('10_wins')) {
                        milestones.push({ 
                            type: '10_wins', 
                            day: gameState.currentDay, 
                            season: gameState.season, 
                            year: gameState.year, 
                            seasonGame: seasonGame,
                            careerGame: careerGame,
                            description: '10 Career Wins' 
                        });
                    }
                    if (stats.wins >= 20 && !existingMilestones.includes('20_wins')) {
                        milestones.push({ 
                            type: '20_wins', 
                            day: gameState.currentDay, 
                            season: gameState.season, 
                            year: gameState.year, 
                            seasonGame: seasonGame,
                            careerGame: careerGame,
                            description: '20 Career Wins' 
                        });
                    }
                    if (stats.wins >= 30 && !existingMilestones.includes('30_wins')) {
                        milestones.push({ 
                            type: '30_wins', 
                            day: gameState.currentDay, 
                            season: gameState.season, 
                            year: gameState.year, 
                            seasonGame: seasonGame,
                            careerGame: careerGame,
                            description: '30 Career Wins' 
                        });
                    }
                    if (stats.wins >= 50 && !existingMilestones.includes('50_wins')) {
                        milestones.push({ 
                            type: '50_wins', 
                            day: gameState.currentDay, 
                            season: gameState.season, 
                            year: gameState.year, 
                            seasonGame: seasonGame,
                            careerGame: careerGame,
                            description: '50 Career Wins' 
                        });
                    }
                    if (stats.wins >= 100 && !existingMilestones.includes('100_wins')) {
                        milestones.push({ 
                            type: '100_wins', 
                            day: gameState.currentDay, 
                            season: gameState.season, 
                            year: gameState.year, 
                            seasonGame: seasonGame,
                            careerGame: careerGame,
                            description: '100 Career Wins' 
                        });
                    }
                    if (stats.wins >= 200 && !existingMilestones.includes('200_wins')) {
                        milestones.push({ 
                            type: '200_wins', 
                            day: gameState.currentDay, 
                            season: gameState.season, 
                            year: gameState.year, 
                            seasonGame: seasonGame,
                            careerGame: careerGame,
                            description: '200 Career Wins' 
                        });
                    }
                    if (stats.wins >= 300 && !existingMilestones.includes('300_wins')) {
                        milestones.push({ 
                            type: '300_wins', 
                            day: gameState.currentDay, 
                            season: gameState.season, 
                            year: gameState.year, 
                            seasonGame: seasonGame,
                            careerGame: careerGame,
                            description: '300 Career Wins' 
                        });
                    }
                    if (stats.shutouts >= 5 && !existingMilestones.includes('5_shutouts')) {
                        milestones.push({ 
                            type: '5_shutouts', 
                            day: gameState.currentDay, 
                            season: gameState.season, 
                            year: gameState.year, 
                            seasonGame: seasonGame,
                            careerGame: careerGame,
                            description: '5 Career Shutouts' 
                        });
                    }
                    if (stats.shutouts >= 10 && !existingMilestones.includes('10_shutouts')) {
                        milestones.push({ 
                            type: '10_shutouts', 
                            day: gameState.currentDay, 
                            season: gameState.season, 
                            year: gameState.year, 
                            seasonGame: seasonGame,
                            careerGame: careerGame,
                            description: '10 Career Shutouts' 
                        });
                    }
                    if (stats.shutouts >= 25 && !existingMilestones.includes('25_shutouts')) {
                        milestones.push({ 
                            type: '25_shutouts', 
                            day: gameState.currentDay, 
                            season: gameState.season, 
                            year: gameState.year, 
                            seasonGame: seasonGame,
                            careerGame: careerGame,
                            description: '25 Career Shutouts' 
                        });
                    }
                    if (stats.shutouts >= 50 && !existingMilestones.includes('50_shutouts')) {
                        milestones.push({ 
                            type: '50_shutouts', 
                            day: gameState.currentDay, 
                            season: gameState.season, 
                            year: gameState.year, 
                            seasonGame: seasonGame,
                            careerGame: careerGame,
                            description: '50 Career Shutouts (Elite!)' 
                        });
                    }
                }
                
                // Add all new milestones
                player.milestones.push(...milestones);
                
                return milestones;
            };

            // Backfill milestones for existing players (run once when loading save)
            const backfillMilestones = (gameState) => {
                if (!gameState || !gameState.players) return gameState;
                
                let milestonesAdded = 0;
                let playersProcessed = 0;
                
                gameState.players.forEach(player => {
                    if (!player.milestones) player.milestones = [];
                    
                    const statsBefore = player.milestones.length;
                    
                    // Run checkMilestones to award any missing milestones
                    const newMilestones = checkMilestones(player, gameState);
                    
                    const statsAfter = player.milestones.length;
                    const added = statsAfter - statsBefore;
                    
                    if (added > 0) {
                        playersProcessed++;
                        milestonesAdded += added;
                        console.log(`[MILESTONES] ${player.firstName} ${player.lastName}: Added ${added} milestones (${player.stats.goals}G, ${player.stats.points}P, ${player.stats.gamesPlayed}GP)`);
                    }
                });
                
                if (milestonesAdded > 0) {
                    console.log(`[MILESTONES] âœ… Backfilled ${milestonesAdded} total milestones for ${playersProcessed} players`);
                } else {
                    console.log(`[MILESTONES] No new milestones to backfill`);
                }
                
                return gameState;
            };

            // ============================================================
            // COMPREHENSIVE AI-TO-AI TRADE SYSTEM
            // ============================================================
            
            const processAITrades = (currentGameState, gameNumber) => {
                // Initialize trade tracking
                if (!currentGameState.tradeHistory) {
                    currentGameState.tradeHistory = [];
                }
                if (!currentGameState.aiTradeLog) {
                    currentGameState.aiTradeLog = [];
                }
                if (!currentGameState.teamTradeCount) {
                    currentGameState.teamTradeCount = {};
                    TEAMS.forEach(t => currentGameState.teamTradeCount[t.id] = 0);
                }
                
                // Target: 25-35 trades per season (NHL average ~30)
                // Distributed across ~55 days before deadline
                const targetTradesPerSeason = 30;
                const daysBeforeDeadline = 55;
                
                const isTradeDeadline = gameNumber >= 50 && gameNumber <= 56; // 7-day deadline period
                const isPostDeadline = gameNumber > 56;
                
                // Calculate how many trades should happen per day
                let tradesAttempted = 0;
                let maxAttemptsPerDay;
                
                if (isPostDeadline) {
                    return currentGameState; // No trades after deadline
                } else if (isTradeDeadline) {
                    // 50% of season trades happen at deadline (~15 trades over 7 days)
                    maxAttemptsPerDay = 8; // Attempt 8 trades, expect ~2-3 to succeed
                } else if (gameNumber < 20) {
                    // Early season: more active (teams assess rosters)
                    maxAttemptsPerDay = 2;
                } else {
                    // Mid-season: steady
                    maxAttemptsPerDay = 1;
                }
                
                // Process multiple trade attempts this day
                for (let attempt = 0; attempt < maxAttemptsPerDay; attempt++) {
                    const trade = attemptAITrade(currentGameState, gameNumber, isTradeDeadline);
                    
                    if (trade) {
                        // Execute the trade
                        executeAITrade(currentGameState, trade);
                        tradesAttempted++;
                    }
                }
                
                return currentGameState;
            };
            
            // Analyze team needs based on roster composition and standings
            const analyzeTeamNeeds = (teamId, players, standings) => {
                const roster = players.filter(p => p.teamId === teamId && p.roster === 'nhl');
                const standing = standings.find(s => s.teamId === teamId);
                
                const gamesPlayed = standing.wins + standing.losses + standing.otLosses;
                const winPct = gamesPlayed > 0 ? standing.wins / gamesPlayed : 0.5;
                
                // Team status
                const isContender = winPct > 0.58;  // Top playoff teams
                const isPlayoffBubble = winPct >= 0.48 && winPct <= 0.58;
                const isRebuilding = winPct < 0.40;
                
                // Position counts and quality
                const forwards = roster.filter(p => p.position === 'F');
                const defense = roster.filter(p => p.position === 'D');
                const goalies = roster.filter(p => p.position === 'G');
                
                // Calculate position strength (average OVR)
                const forwardStrength = forwards.reduce((sum, p) => sum + p.ratings.overall, 0) / forwards.length;
                const defenseStrength = defense.reduce((sum, p) => sum + p.ratings.overall, 0) / defense.length;
                const goalieStrength = goalies.reduce((sum, p) => sum + p.ratings.overall, 0) / goalies.length;
                
                // Top players
                const topForward = forwards.sort((a, b) => b.ratings.overall - a.ratings.overall)[0];
                const topDefense = defense.sort((a, b) => b.ratings.overall - a.ratings.overall)[0];
                
                // Identify needs
                const needs = [];
                const surpluses = [];
                
                // Position-based needs
                if (goalies.length < 2 || goalieStrength < 78) needs.push('G');
                if (defense.length < 7 || defenseStrength < 79) needs.push('D');
                if (forwards.length < 13 || forwardStrength < 79) needs.push('F');
                
                // Star power needs
                const hasEliteForward = forwards.some(p => p.ratings.overall >= 88);
                const hasEliteDefense = defense.some(p => p.ratings.overall >= 86);
                
                if (!hasEliteForward && isContender) needs.push('ELITE_F');
                if (!hasEliteDefense && isContender) needs.push('ELITE_D');
                
                // Identify surpluses (players to move)
                if (forwards.length > 15) surpluses.push('F');
                if (defense.length > 9) surpluses.push('D');
                if (goalies.length > 3) surpluses.push('G');
                
                return {
                    status: isContender ? 'CONTENDER' : isRebuilding ? 'REBUILDING' : isPlayoffBubble ? 'BUBBLE' : 'MIDDLE',
                    winPct,
                    needs,
                    surpluses,
                    forwardStrength,
                    defenseStrength,
                    goalieStrength,
                    weakestPosition: forwardStrength < defenseStrength ? (forwardStrength < goalieStrength ? 'F' : 'G') : (defenseStrength < goalieStrength ? 'D' : 'G')
                };
            };
            
            // Find optimal trade partners based on complementary needs
            const findTradePartners = (teams, standings, players, gameNumber, isDeadline) => {
                const teamAnalyses = teams.map(t => ({
                    team: t,
                    analysis: analyzeTeamNeeds(t.id, players, standings),
                    tradeCount: 0 // Will be updated
                }));
                
                // Find complementary pairs
                const pairs = [];
                
                for (let i = 0; i < teamAnalyses.length; i++) {
                    for (let j = i + 1; j < teamAnalyses.length; j++) {
                        const t1 = teamAnalyses[i];
                        const t2 = teamAnalyses[j];
                        
                        // Skip same division trades (unless deadline)
                        if (t1.team.division === t2.team.division && !isDeadline && Math.random() > 0.3) {
                            continue;
                        }
                        
                        // Calculate trade compatibility score
                        let score = 0;
                        
                        // Contender + Rebuilder = ideal match
                        if (t1.analysis.status === 'CONTENDER' && t2.analysis.status === 'REBUILDING') score += 50;
                        if (t1.analysis.status === 'REBUILDING' && t2.analysis.status === 'CONTENDER') score += 50;
                        
                        // Bubble teams trade with anyone
                        if (t1.analysis.status === 'BUBBLE' || t2.analysis.status === 'BUBBLE') score += 20;
                        
                        // Position needs matching
                        const sharedNeeds = t1.analysis.needs.filter(n => t2.analysis.surpluses.includes(n)).length;
                        const reverseNeeds = t2.analysis.needs.filter(n => t1.analysis.surpluses.includes(n)).length;
                        score += (sharedNeeds + reverseNeeds) * 15;
                        
                        // Deadline urgency
                        if (isDeadline) {
                            if (t1.analysis.status === 'CONTENDER') score += 30;
                            if (t2.analysis.status === 'CONTENDER') score += 30;
                        }
                        
                        if (score > 30) {
                            pairs.push({ t1, t2, score });
                        }
                    }
                }
                
                // Sort by compatibility score
                pairs.sort((a, b) => b.score - a.score);
                
                return pairs;
            };
            
            // Attempt a single AI trade
            const attemptAITrade = (gameState, gameNumber, isDeadline) => {
                const eligibleTeams = TEAMS.filter(t => 
                    (gameState.teamTradeCount[t.id] || 0) < (isDeadline ? 5 : 3) // Higher limit at deadline
                );
                
                if (eligibleTeams.length < 2) return null;
                
                // Find best trade partners
                const pairs = findTradePartners(eligibleTeams, gameState.standings, gameState.players, gameNumber, isDeadline);
                
                if (pairs.length === 0) return null;
                
                // Try top pairs until a trade succeeds
                for (const pair of pairs.slice(0, 5)) { // Try top 5 matches
                    const trade = constructTrade(pair.t1, pair.t2, gameState, gameNumber, isDeadline);
                    
                    if (trade && evaluateAITrade(trade, pair.t1, pair.t2)) {
                        return trade;
                    }
                }
                
                return null;
            };
            
            // Construct a trade between two teams
            const constructTrade = (team1Data, team2Data, gameState, gameNumber, isDeadline) => {
                const team1 = team1Data.team;
                const team2 = team2Data.team;
                const t1Analysis = team1Data.analysis;
                const t2Analysis = team2Data.analysis;
                
                // Get eligible players
                const getEligiblePlayers = (teamId) => {
                    return gameState.players.filter(p => {
                        if (p.teamId !== teamId || p.roster !== 'nhl') return false;
                        if (p.injury.injured) return false;
                        
                        // Protect franchise players from being traded easily
                        if (p.ratings.overall >= 92 && Math.random() > 0.2) return false;
                        
                        return true;
                    });
                };
                
                const t1Players = getEligiblePlayers(team1.id);
                const t2Players = getEligiblePlayers(team2.id);
                
                if (t1Players.length < 3 || t2Players.length < 3) return null;
                
                // Determine trade type and size based on team needs
                let t1GivesCount = 1;
                let t2GivesCount = 1;
                
                // Bigger trades at deadline
                if (isDeadline && Math.random() > 0.6) {
                    t1GivesCount = Math.random() > 0.5 ? 2 : 1;
                    t2GivesCount = Math.random() > 0.5 ? 2 : 1;
                }
                
                // Select players based on strategy
                const selectPlayersToTrade = (players, count, analysis, receivingTeamAnalysis) => {
                    const selected = [];
                    const available = [...players];
                    
                    for (let i = 0; i < count && available.length > 0; i++) {
                        // Weight players based on what makes sense to trade
                        const weights = available.map(p => {
                            let weight = 1;
                            
                            // CONTENDER giving up players
                            if (analysis.status === 'CONTENDER') {
                                // Trade away: aging players, prospects, depth
                                if (p.age > 32) weight *= 4;
                                if (p.age < 24 && p.ratings.overall < 80) weight *= 3; // Prospects
                                if (p.ratings.overall < 78) weight *= 2; // Depth pieces
                            }
                            
                            // REBUILDER giving up players
                            else if (analysis.status === 'REBUILDING') {
                                // Trade away: veterans, expensive players
                                if (p.age > 27) weight *= 5;
                                if (p.ratings.overall > 82 && p.age > 26) weight *= 3; // Valuable vets
                            }
                            
                            // BUBBLE team
                            else if (analysis.status === 'BUBBLE') {
                                // Trade away: underperformers, aging depth
                                if (p.age > 30 && p.ratings.overall < 82) weight *= 3;
                            }
                            
                            // Target positions that receiving team needs
                            if (receivingTeamAnalysis.needs.includes(p.position)) {
                                weight *= 2.5;
                            }
                            
                            // Match elite needs
                            if (receivingTeamAnalysis.needs.includes('ELITE_F') && p.position === 'F' && p.ratings.overall >= 88) {
                                weight *= 4;
                            }
                            if (receivingTeamAnalysis.needs.includes('ELITE_D') && p.position === 'D' && p.ratings.overall >= 86) {
                                weight *= 4;
                            }
                            
                            return weight;
                        });
                        
                        // Weighted selection
                        const totalWeight = weights.reduce((sum, w) => sum + w, 0);
                        if (totalWeight === 0) break;
                        
                        let rand = Math.random() * totalWeight;
                        let selectedIdx = 0;
                        
                        for (let j = 0; j < weights.length; j++) {
                            rand -= weights[j];
                            if (rand <= 0) {
                                selectedIdx = j;
                                break;
                            }
                        }
                        
                        selected.push(available[selectedIdx]);
                        available.splice(selectedIdx, 1);
                    }
                    
                    return selected;
                };
                
                const t1Gives = selectPlayersToTrade(t1Players, t1GivesCount, t1Analysis, t2Analysis);
                const t2Gives = selectPlayersToTrade(t2Players, t2GivesCount, t2Analysis, t1Analysis);
                
                if (t1Gives.length === 0 || t2Gives.length === 0) return null;
                
                return {
                    team1: team1.id,
                    team2: team2.id,
                    team1Gives: t1Gives,
                    team2Gives: t2Gives,
                    gameNumber: gameNumber,
                    isDeadline: isDeadline
                };
            };
            
            // Evaluate if AI trade should go through (using similar logic to player trades)
            const evaluateAITrade = (trade, team1Data, team2Data) => {
                const t1Analysis = team1Data.analysis;
                const t2Analysis = team2Data.analysis;
                
                // Calculate trade values
                const calculateValue = (players) => {
                    return {
                        totalOVR: players.reduce((sum, p) => sum + p.ratings.overall, 0),
                        avgOVR: players.reduce((sum, p) => sum + p.ratings.overall, 0) / players.length,
                        avgAge: players.reduce((sum, p) => sum + p.age, 0) / players.length,
                        totalPOT: players.reduce((sum, p) => sum + p.ratings.potential, 0),
                        hasGoalie: players.some(p => p.position === 'G'),
                        starCount: players.filter(p => p.ratings.overall >= 90).length
                    };
                };
                
                const t1Value = calculateValue(trade.team1Gives);
                const t2Value = calculateValue(trade.team2Gives);
                
                // OVR difference check (stricter than 15% for AI)
                const ovrDiff = Math.abs(t1Value.totalOVR - t2Value.totalOVR);
                const ovrDiffPercent = (ovrDiff / Math.max(t1Value.totalOVR, t2Value.totalOVR)) * 100;
                
                if (ovrDiffPercent > 12) return false; // AI trades must be balanced
                
                // Check if trade makes sense for both teams
                let t1Score = 0;
                let t2Score = 0;
                
                // Team 1 perspective (receiving t2Gives)
                if (t1Analysis.status === 'CONTENDER') {
                    if (t2Value.avgAge > t1Value.avgAge && t2Value.avgOVR > t1Value.avgOVR) t1Score += 40; // Getting better vets
                    if (t2Value.starCount > t1Value.starCount) t1Score += 30;
                } else if (t1Analysis.status === 'REBUILDING') {
                    if (t2Value.avgAge < t1Value.avgAge) t1Score += 50; // Getting younger
                    if (t2Value.totalPOT > t1Value.totalPOT) t1Score += 30;
                }
                
                // Team 2 perspective (receiving t1Gives)
                if (t2Analysis.status === 'CONTENDER') {
                    if (t1Value.avgAge > t2Value.avgAge && t1Value.avgOVR > t2Value.avgOVR) t2Score += 40;
                    if (t1Value.starCount > t2Value.starCount) t2Score += 30;
                } else if (t2Analysis.status === 'REBUILDING') {
                    if (t1Value.avgAge < t2Value.avgAge) t2Score += 50;
                    if (t1Value.totalPOT > t2Value.totalPOT) t2Score += 30;
                }
                
                // Both teams must benefit
                return (t1Score >= 30 && t2Score >= 30);
            };
            
            // Execute the AI trade
            const executeAITrade = (gameState, trade) => {
                const team1 = TEAMS.find(t => t.id === trade.team1);
                const team2 = TEAMS.find(t => t.id === trade.team2);
                
                // Swap players
                trade.team1Gives.forEach(p => {
                    const player = gameState.players.find(gp => gp.id === p.id);
                    player.teamId = trade.team2;
                    player.lineNumber = 0;
                    player.linePosition = null;
                    player.ppUnit = null;
                    player.pkUnit = null;
                    if (player.position === 'G') player.dressed = false;
                    
                    if (!player.tradeHistory) player.tradeHistory = [];
                    player.tradeHistory.push({
                        day: gameState.currentDay,
                        season: gameState.season,
                        year: gameState.year,
                        from: trade.team1,
                        to: trade.team2,
                        tradedWith: trade.team1Gives.filter(tp => tp.id !== p.id).map(tp => ({
                            id: tp.id,
                            name: `${tp.firstName} ${tp.lastName}`,
                            position: tp.position
                        })),
                        tradedFor: trade.team2Gives.map(tp => ({
                            id: tp.id,
                            name: `${tp.firstName} ${tp.lastName}`,
                            position: tp.position
                        }))
                    });
                });
                
                trade.team2Gives.forEach(p => {
                    const player = gameState.players.find(gp => gp.id === p.id);
                    player.teamId = trade.team1;
                    player.lineNumber = 0;
                    player.linePosition = null;
                    player.ppUnit = null;
                    player.pkUnit = null;
                    if (player.position === 'G') player.dressed = false;
                    
                    if (!player.tradeHistory) player.tradeHistory = [];
                    player.tradeHistory.push({
                        day: gameState.currentDay,
                        season: gameState.season,
                        year: gameState.year,
                        from: trade.team2,
                        to: trade.team1,
                        tradedWith: trade.team2Gives.filter(tp => tp.id !== p.id).map(tp => ({
                            id: tp.id,
                            name: `${tp.firstName} ${tp.lastName}`,
                            position: tp.position
                        })),
                        tradedFor: trade.team1Gives.map(tp => ({
                            id: tp.id,
                            name: `${tp.firstName} ${tp.lastName}`,
                            position: tp.position
                        }))
                    });
                });
                
                // Update team trade counts
                gameState.teamTradeCount[trade.team1] = (gameState.teamTradeCount[trade.team1] || 0) + 1;
                gameState.teamTradeCount[trade.team2] = (gameState.teamTradeCount[trade.team2] || 0) + 1;
                
                // Add to AI trade log
                gameState.aiTradeLog.push({
                    day: gameState.currentDay,
                    gameNumber: trade.gameNumber,
                    isDeadline: trade.isDeadline,
                    team1: { id: trade.team1, name: `${team1.city} ${team1.name}` },
                    team2: { id: trade.team2, name: `${team2.city} ${team2.name}` },
                    team1Gives: trade.team1Gives.map(p => ({
                        id: p.id,
                        name: `${p.firstName} ${p.lastName}`,
                        position: p.position,
                        age: p.age,
                        ovr: p.ratings.overall,
                        pot: p.ratings.potential
                    })),
                    team2Gives: trade.team2Gives.map(p => ({
                        id: p.id,
                        name: `${p.firstName} ${p.lastName}`,
                        position: p.position,
                        age: p.age,
                        ovr: p.ratings.overall,
                        pot: p.ratings.potential
                    }))
                });
                
                // Auto-assign lines for both teams
                autoSetAllLines(gameState.players, trade.team1);
                autoSetAllLines(gameState.players, trade.team2);
            };

            // NEW: Generate mid-season report card at All-Star Break (Game 41)
            const generateMidSeasonReport = () => {
                if (!gameState || !userTeamId) return null;
                
                const standing = gameState.standings.find(s => s.teamId === userTeamId);
                const gamesPlayed = standing.wins + standing.losses + standing.otLosses;
                
                // Only generate at exactly game 41
                if (gamesPlayed !== 41) return null;
                
                const teamOvr = getTeamOverall(userTeamId)?.overall || 80;
                
                // Calculate expected performance based on OVR
                // 90+ OVR = expect ~30-11 (73% win rate)
                // 85-89 = expect ~28-13 (68%)
                // 80-84 = expect ~25-16 (61%)
                // 75-79 = expect ~22-19 (54%)
                // 70-74 = expect ~19-22 (46%)
                // <70 = expect ~16-25 (39%)
                let expectedWins;
                if (teamOvr >= 90) expectedWins = 30;
                else if (teamOvr >= 85) expectedWins = 28;
                else if (teamOvr >= 80) expectedWins = 25;
                else if (teamOvr >= 75) expectedWins = 22;
                else if (teamOvr >= 70) expectedWins = 19;
                else expectedWins = 16;
                
                const actualWins = standing.wins;
                const winDiff = actualWins - expectedWins;
                const performance = winDiff > 3 ? 'exceeding' : winDiff < -3 ? 'underperforming' : 'meeting';
                
                // Calculate stats
                const gpf = (standing.goalsFor / gamesPlayed).toFixed(2);
                const gaa = (standing.goalsAgainst / gamesPlayed).toFixed(2);
                const homeWinPct = standing.home.wins / (standing.home.wins + standing.home.losses);
                const awayWinPct = standing.away.wins / (standing.away.wins + standing.away.losses);
                
                // Identify strengths
                const strengths = [];
                if (parseFloat(gpf) > 3.2) strengths.push({ stat: 'Offense', value: `${gpf} goals/game`, rank: 'Top 10' });
                if (parseFloat(gaa) < 2.8) strengths.push({ stat: 'Defense', value: `${gaa} goals against/game`, rank: 'Top 10' });
                if (homeWinPct > 0.65) strengths.push({ stat: 'Home Record', value: `${standing.home.wins}-${standing.home.losses}`, rank: 'Elite' });
                if ((standing.goalsFor - standing.goalsAgainst) > 25) strengths.push({ stat: 'Goal Differential', value: `+${standing.goalsFor - standing.goalsAgainst}`, rank: 'Excellent' });
                
                // Identify concerns
                const concerns = [];
                if (parseFloat(gpf) < 2.5) concerns.push({ stat: 'Offense Struggling', value: `Only ${gpf} goals/game`, suggestion: 'Consider trading for scoring help' });
                if (parseFloat(gaa) > 3.5) concerns.push({ stat: 'Defensive Issues', value: `Allowing ${gaa} goals/game`, suggestion: 'Shore up defense at trade deadline' });
                if (awayWinPct < 0.40) concerns.push({ stat: 'Poor Road Record', value: `${standing.away.wins}-${standing.away.losses}`, suggestion: 'Work on road consistency' });
                if ((standing.goalsFor - standing.goalsAgainst) < -10) concerns.push({ stat: 'Negative Goal Differential', value: `${standing.goalsFor - standing.goalsAgainst}`, suggestion: 'Team needs improvement on both ends' });
                
                // Calculate playoff odds (simplified)
                const sorted = [...gameState.standings].sort((a,b) => b.points - a.points);
                const currentRank = sorted.findIndex(s => s.teamId === userTeamId) + 1;
                
                let playoffOdds;
                if (currentRank <= 8) playoffOdds = 95; // Very likely
                else if (currentRank <= 12) playoffOdds = 75; // Likely
                else if (currentRank <= 16) playoffOdds = 50; // Bubble
                else if (currentRank <= 20) playoffOdds = 25; // Unlikely
                else playoffOdds = 5; // Very unlikely
                
                // Project final standing
                const pointsPerGame = standing.points / gamesPlayed;
                const projectedPoints = Math.round(pointsPerGame * 82);
                
                return {
                    gamesPlayed,
                    record: `${standing.wins}-${standing.losses}-${standing.otLosses}`,
                    points: standing.points,
                    expected: `${expectedWins}-${41-expectedWins}-0`,
                    performance,
                    performanceText: winDiff > 3 ? `+${winDiff} wins above expectations!` : winDiff < -3 ? `${Math.abs(winDiff)} wins below expectations` : 'On pace with expectations',
                    strengths,
                    concerns,
                    playoffOdds,
                    currentRank,
                    projectedPoints,
                    goalsFor: standing.goalsFor,
                    goalsAgainst: standing.goalsAgainst,
                    goalDiff: standing.goalsFor - standing.goalsAgainst
                };
            };

            // ========================================
            // NEW 82-DAY SIMULATION SYSTEM
            // ========================================
            
            const startPlayoffs = () => {
                if (!gameState) return;
                
                // Sort standings by points
                const sorted = [...gameState.standings].sort((a, b) => b.points - a.points);
                
                // Get top 16 teams for playoffs (top 8 per conference)
                const eastTeams = sorted.filter(s => {
                    const team = TEAMS.find(t => t.id === s.teamId);
                    return team.conference === 'East';
                }).slice(0, 8);
                
                const westTeams = sorted.filter(s => {
                    const team = TEAMS.find(t => t.id === s.teamId);
                    return team.conference === 'West';
                }).slice(0, 8);
                
                // Create first round matchups (1v8, 2v7, 3v6, 4v5)
                const createMatchups = (teams) => {
                    return [
                        { home: teams[0].teamId, away: teams[7].teamId, homeWins: 0, awayWins: 0, games: [] },
                        { home: teams[1].teamId, away: teams[6].teamId, homeWins: 0, awayWins: 0, games: [] },
                        { home: teams[2].teamId, away: teams[5].teamId, homeWins: 0, awayWins: 0, games: [] },
                        { home: teams[3].teamId, away: teams[4].teamId, homeWins: 0, awayWins: 0, games: [] }
                    ];
                };
                
                setPlayoffState({
                    round: 1, // 1=First Round, 2=Conference Semis, 3=Conference Finals, 4=Stanley Cup
                    eastMatchups: createMatchups(eastTeams),
                    westMatchups: createMatchups(westTeams),
                    completed: false,
                    lastDaySummary: {
                        title: 'ðŸ† Stanley Cup Playoffs Begin! ðŸ†',
                        message: 'Round 1 (First Round) matchups are set. Click "Sim Playoff Day" to begin!',
                        conference: 'Playoffs Start'
                    },
                    history: {
                        eastRound1: createMatchups(eastTeams),
                        westRound1: createMatchups(westTeams),
                        eastRound2: [],
                        westRound2: [],
                        eastRound3: [],
                        westRound3: [],
                        final: null
                    }
                });
                
                setCurrentView('bracket');
            };
            
            const calculateThreeStars = (homeTeam, awayTeam, homePlayers, awayPlayers, homeGoals, awayGoals) => {
                // Calculate star points: G=3pts, A=2pts, W(goalie)=5pts
                const allPlayers = [];
                
                // Get stats for all players in this game
                homePlayers.concat(awayPlayers).forEach(player => {
                    let points = 0;
                    const team = homePlayers.includes(player) ? homeTeam : awayTeam;
                    const goals = player.playoffStats.goals || 0;
                    const assists = player.playoffStats.assists || 0;
                    
                    if (player.position === 'G') {
                        // Goalie: points for win and shutout
                        const isWinner = (team.id === homeTeam.id && homeGoals > awayGoals) || 
                                        (team.id === awayTeam.id && awayGoals > homeGoals);
                        const isShutout = (team.id === homeTeam.id && awayGoals === 0) || 
                                         (team.id === awayTeam.id && homeGoals === 0);
                        if (isWinner) points += 5;
                        if (isShutout) points += 3;
                    } else {
                        // Skaters: goals and assists
                        points = (goals * 3) + (assists * 2);
                    }
                    
                    if (points > 0) {
                        allPlayers.push({ player, team, points, goals, assists });
                    }
                });
                
                // Sort by points and return top 3
                return allPlayers.sort((a, b) => b.points - a.points).slice(0, 3);
            };

            const simulatePlayoffGame = (matchup, isHomeGame) => {
                // Only include active (non-scratched) and non-injured NHL players
                const homePlayers = gameState.players.filter(p => 
                    p.teamId === (isHomeGame ? matchup.home : matchup.away) &&
                    p.roster === 'nhl' &&
                    !p.injury.injured &&
                    (p.position === 'G' ? p.dressed : p.lineNumber > 0)
                );
                const awayPlayers = gameState.players.filter(p => 
                    p.teamId === (isHomeGame ? matchup.away : matchup.home) &&
                    p.roster === 'nhl' &&
                    !p.injury.injured &&
                    (p.position === 'G' ? p.dressed : p.lineNumber > 0)
                );
                
                const result = simulateGameResult(homePlayers, awayPlayers);
                
                // Store comprehensive game details including per-player stats
                const gameDetails = {
                    homeGoals: result.homeGoals,
                    awayGoals: result.awayGoals,
                    winner: result.winner,
                    homeTeam: isHomeGame ? matchup.home : matchup.away,
                    awayTeam: isHomeGame ? matchup.away : matchup.home,
                    homePlayerStats: result.homePlayerStats,
                    awayPlayerStats: result.awayPlayerStats,
                    homeScratched: result.homeScratched.map(p => ({ id: p.id, name: `${p.firstName} ${p.lastName}`, reason: 'Healthy Scratch' })),
                    awayScratched: result.awayScratched.map(p => ({ id: p.id, name: `${p.firstName} ${p.lastName}`, reason: 'Healthy Scratch' })),
                    homeNewInjuries: [],
                    awayNewInjuries: [],
                    scoringSummary: result.scoringSummary
                };
                
                // Update PLAYOFF stats from per-game stats
                result.homePlayerStats.forEach(playerGameStats => {
                    const player = gameState.players.find(p => p.id === playerGameStats.player.id);
                    if (player) {
                        if (player.position === 'G') {
                            if (playerGameStats.shotsAgainst > 0) {
                                player.playoffStats.gamesPlayed++;
                                player.playoffStats.timeOnIce += playerGameStats.toi;
                                player.playoffStats.saves = (player.playoffStats.saves || 0) + playerGameStats.saves;
                                player.playoffStats.goalsAgainst = (player.playoffStats.goalsAgainst || 0) + playerGameStats.goalsAgainst;
                                player.playoffStats.shotsAgainst = (player.playoffStats.shotsAgainst || 0) + playerGameStats.shotsAgainst;
                                
                                if (result.winner === 'home') {
                                    player.playoffStats.wins = (player.playoffStats.wins || 0) + 1;
                                } else {
                                    player.playoffStats.losses = (player.playoffStats.losses || 0) + 1;
                                }
                                
                                if (playerGameStats.goalsAgainst === 0) {
                                    player.playoffStats.shutouts = (player.playoffStats.shutouts || 0) + 1;
                                }
                                
                                player.playoffStats.savePercentage = player.playoffStats.saves / (player.playoffStats.shotsAgainst || 1);
                                player.playoffStats.gaa = (player.playoffStats.goalsAgainst / (player.playoffStats.gamesPlayed || 1)) * 1.0;
                            }
                        } else {
                            player.playoffStats.gamesPlayed++;
                            player.playoffStats.goals += playerGameStats.goals;
                            player.playoffStats.assists += playerGameStats.assists;
                            player.playoffStats.points += playerGameStats.points;
                            player.playoffStats.plusMinus += playerGameStats.plusMinus;
                            player.playoffStats.pim += playerGameStats.pim;
                            player.playoffStats.shots += playerGameStats.shots;
                            player.playoffStats.timeOnIce += playerGameStats.toi;
                        }
                        
                        // NEW: Update player streaks (playoffs count toward streaks too!)
                        if (player.position !== 'G') {
                            if (!player.currentStreak) player.currentStreak = { type: null, games: 0, bonus: 0 };
                            
                            const hadPoints = playerGameStats.goals + playerGameStats.assists > 0;
                            
                            if (hadPoints) {
                                if (player.currentStreak.type === 'point') {
                                    player.currentStreak.games++;
                                } else {
                                    player.currentStreak = { type: 'point', games: 1, bonus: 0 };
                                }
                                
                                if (player.currentStreak.games >= 15) {
                                    player.currentStreak.bonus = 4;
                                } else if (player.currentStreak.games >= 10) {
                                    player.currentStreak.bonus = 3;
                                } else if (player.currentStreak.games >= 5) {
                                    player.currentStreak.bonus = 2;
                                } else {
                                    player.currentStreak.bonus = 0;
                                }
                            } else {
                                if (player.currentStreak.type === 'scoreless') {
                                    player.currentStreak.games++;
                                } else {
                                    player.currentStreak = { type: 'scoreless', games: 1, bonus: 0 };
                                }
                                
                                if (player.currentStreak.games >= 10) {
                                    player.currentStreak.bonus = -2;
                                } else {
                                    player.currentStreak.bonus = 0;
                                }
                            }
                        }
                        
                        // NEW: Update player development (playoffs count!)
                        if (gameState.playerDevelopment && gameState.playerDevelopment[player.id]) {
                            const dev = gameState.playerDevelopment[player.id];
                            dev.currentOVR = player.ratings.overall;
                            dev.growth = dev.currentOVR - dev.startOVR;
                            dev.games++;
                            dev.lastChecked = gameState.currentDay;
                        }
                    }
                });
                
                result.awayPlayerStats.forEach(playerGameStats => {
                    const player = gameState.players.find(p => p.id === playerGameStats.player.id);
                    if (player) {
                        if (player.position === 'G') {
                            if (playerGameStats.shotsAgainst > 0) {
                                player.playoffStats.gamesPlayed++;
                                player.playoffStats.timeOnIce += playerGameStats.toi;
                                player.playoffStats.saves = (player.playoffStats.saves || 0) + playerGameStats.saves;
                                player.playoffStats.goalsAgainst = (player.playoffStats.goalsAgainst || 0) + playerGameStats.goalsAgainst;
                                player.playoffStats.shotsAgainst = (player.playoffStats.shotsAgainst || 0) + playerGameStats.shotsAgainst;
                                
                                if (result.winner === 'away') {
                                    player.playoffStats.wins = (player.playoffStats.wins || 0) + 1;
                                } else {
                                    player.playoffStats.losses = (player.playoffStats.losses || 0) + 1;
                                }
                                
                                if (playerGameStats.goalsAgainst === 0) {
                                    player.playoffStats.shutouts = (player.playoffStats.shutouts || 0) + 1;
                                }
                                
                                player.playoffStats.savePercentage = player.playoffStats.saves / (player.playoffStats.shotsAgainst || 1);
                                player.playoffStats.gaa = (player.playoffStats.goalsAgainst / (player.playoffStats.gamesPlayed || 1)) * 1.0;
                            }
                        } else {
                            player.playoffStats.gamesPlayed++;
                            player.playoffStats.goals += playerGameStats.goals;
                            player.playoffStats.assists += playerGameStats.assists;
                            player.playoffStats.points += playerGameStats.points;
                            player.playoffStats.plusMinus += playerGameStats.plusMinus;
                            player.playoffStats.pim += playerGameStats.pim;
                            player.playoffStats.shots += playerGameStats.shots;
                            player.playoffStats.timeOnIce += playerGameStats.toi;
                        }
                        
                        // NEW: Update player streaks (playoffs count toward streaks too!)
                        if (player.position !== 'G') {
                            if (!player.currentStreak) player.currentStreak = { type: null, games: 0, bonus: 0 };
                            
                            const hadPoints = playerGameStats.goals + playerGameStats.assists > 0;
                            
                            if (hadPoints) {
                                if (player.currentStreak.type === 'point') {
                                    player.currentStreak.games++;
                                } else {
                                    player.currentStreak = { type: 'point', games: 1, bonus: 0 };
                                }
                                
                                if (player.currentStreak.games >= 15) {
                                    player.currentStreak.bonus = 4;
                                } else if (player.currentStreak.games >= 10) {
                                    player.currentStreak.bonus = 3;
                                } else if (player.currentStreak.games >= 5) {
                                    player.currentStreak.bonus = 2;
                                } else {
                                    player.currentStreak.bonus = 0;
                                }
                            } else {
                                if (player.currentStreak.type === 'scoreless') {
                                    player.currentStreak.games++;
                                } else {
                                    player.currentStreak = { type: 'scoreless', games: 1, bonus: 0 };
                                }
                                
                                if (player.currentStreak.games >= 10) {
                                    player.currentStreak.bonus = -2;
                                } else {
                                    player.currentStreak.bonus = 0;
                                }
                            }
                        }
                        
                        // NEW: Update player development (playoffs count!)
                        if (gameState.playerDevelopment && gameState.playerDevelopment[player.id]) {
                            const dev = gameState.playerDevelopment[player.id];
                            dev.currentOVR = player.ratings.overall;
                            dev.growth = dev.currentOVR - dev.startOVR;
                            dev.games++;
                            dev.lastChecked = gameState.currentDay;
                        }
                    }
                });
                
                return {
                    homeTeam: isHomeGame ? matchup.home : matchup.away,
                    awayTeam: isHomeGame ? matchup.away : matchup.home,
                    homeScore: result.homeGoals,
                    awayScore: result.awayGoals,
                    winner: result.winner === 'home' ? (isHomeGame ? matchup.home : matchup.away) : (isHomeGame ? matchup.away : matchup.home),
                    details: gameDetails
                };
            };
            
            const simulatePlayoffSeries = () => {
                if (!playoffState || playoffState.completed) return;
                
                let newState = { ...playoffState };
                
                // Handle Stanley Cup Finals (Round 4) separately
                if (newState.round === 4 && newState.finalMatchup) {
                    if (newState.finalMatchup.homeWins < 4 && newState.finalMatchup.awayWins < 4) {
                        const homeGamePattern = [true, true, false, false, true, false, true];
                        while (newState.finalMatchup.homeWins < 4 && newState.finalMatchup.awayWins < 4) {
                            const gameNum = newState.finalMatchup.homeWins + newState.finalMatchup.awayWins;
                            const isHomeGame = homeGamePattern[gameNum];
                            const game = simulatePlayoffGame(newState.finalMatchup, isHomeGame);
                            newState.finalMatchup.games.push(game);
                            
                            if (game.winner === newState.finalMatchup.home) {
                                newState.finalMatchup.homeWins++;
                            } else {
                                newState.finalMatchup.awayWins++;
                            }
                        }
                        
                        // Save to history
                        if (!newState.history) newState.history = {};
                        newState.history.final = { ...newState.finalMatchup };
                        
                        // Finals complete - calculate Playoff MVP
                        const mvp = calculatePlayoffMVP(gameState.players);
                        setPlayoffMVP(mvp);
                        
                        // Show champion
                        const champion = newState.finalMatchup.homeWins >= 4 ? newState.finalMatchup.home : newState.finalMatchup.away;
                        const championTeam = TEAMS.find(t => t.id === champion);
                        newState.completed = true;
                        newState.champion = champion;
                        
                        // Save season to history
                        saveSeasonToHistory(gameState, newState, userTeamId);
                        
                        // Navigate to playoff MVP view
                        setCurrentView('playoffMVP');
                    }
                    
                    setPlayoffState(newState);
                    setGameState({ ...gameState });
                    return;
                }
                
                // Simulate conference rounds (Rounds 1-3)
                const simulateSeries = (matchups) => {
                    return matchups.map(matchup => {
                        if (matchup.homeWins >= 4 || matchup.awayWins >= 4) return matchup; // Already finished
                        
                        const newMatchup = { ...matchup, games: [...matchup.games] };
                        const gamesPlayed = newMatchup.homeWins + newMatchup.awayWins;
                        
                        // Simulate remaining games (2-2-1-1-1 format: HH-AA-H-A-H)
                        const homeGamePattern = [true, true, false, false, true, false, true];
                        
                        while (newMatchup.homeWins < 4 && newMatchup.awayWins < 4) {
                            const gameNum = newMatchup.homeWins + newMatchup.awayWins;
                            const isHomeGame = homeGamePattern[gameNum];
                            
                            const game = simulatePlayoffGame(newMatchup, isHomeGame);
                            newMatchup.games.push(game);
                            
                            if (game.winner === newMatchup.home) {
                                newMatchup.homeWins++;
                            } else {
                                newMatchup.awayWins++;
                            }
                        }
                        
                        return newMatchup;
                    });
                };
                
                newState.eastMatchups = simulateSeries(newState.eastMatchups);
                newState.westMatchups = simulateSeries(newState.westMatchups);
                
                // Check if round is complete
                const allComplete = [...newState.eastMatchups, ...newState.westMatchups].every(m => 
                    m.homeWins >= 4 || m.awayWins >= 4
                );
                
                if (allComplete) {
                    if (newState.round < 4) {
                        // Advance to next round
                        const getWinners = (matchups) => matchups.map(m => m.homeWins >= 4 ? m.home : m.away);
                        const eastWinners = getWinners(newState.eastMatchups);
                        const westWinners = getWinners(newState.westMatchups);
                        
                        // Save completed round to history
                        if (!newState.history) newState.history = {};
                        if (newState.round === 1) {
                            newState.history.eastRound1 = [...newState.eastMatchups];
                            newState.history.westRound1 = [...newState.westMatchups];
                        } else if (newState.round === 2) {
                            newState.history.eastRound2 = [...newState.eastMatchups];
                            newState.history.westRound2 = [...newState.westMatchups];
                        } else if (newState.round === 3) {
                            newState.history.eastRound3 = [...newState.eastMatchups];
                            newState.history.westRound3 = [...newState.westMatchups];
                        }
                        
                        if (newState.round === 3) {
                            // Stanley Cup Final
                            newState.round = 4;
                            newState.finalMatchup = {
                                home: eastWinners[0],
                                away: westWinners[0],
                                homeWins: 0,
                                awayWins: 0,
                                games: []
                            };
                            newState.eastMatchups = [];
                            newState.westMatchups = [];
                        } else {
                            // Next conference round
                            newState.round++;
                            const createNextRound = (winners) => {
                                if (winners.length === 4) {
                                    return [
                                        { home: winners[0], away: winners[3], homeWins: 0, awayWins: 0, games: [] },
                                        { home: winners[1], away: winners[2], homeWins: 0, awayWins: 0, games: [] }
                                    ];
                                } else {
                                    return [
                                        { home: winners[0], away: winners[1], homeWins: 0, awayWins: 0, games: [] }
                                    ];
                                }
                            };
                            newState.eastMatchups = createNextRound(eastWinners);
                            newState.westMatchups = createNextRound(westWinners);
                        }
                        
                        alert(`Round ${newState.round === 2 ? '2 (Conference Semifinals)' : newState.round === 3 ? '3 (Conference Finals)' : '4 (Stanley Cup Finals)'} begins!`);
                    }
                }
                
                setPlayoffState(newState);
                // Force gameState update to persist playoff stats changes
                setGameState({ ...gameState });
            };

            // NEW: Simulate all remaining playoff rounds
            const simulateAllPlayoffs = () => {
                if (!playoffState || playoffState.completed) return;
                
                // Turn on auto-simulation flag
                // The useEffect will handle the actual simulation round-by-round
                setIsAutoSimulatingPlayoffs(true);
            };

            const simulateOnePlayoffDay = () => {
                if (!playoffState || playoffState.completed) return;
                
                let newState = { ...playoffState };
                const homeGamePattern = [true, true, false, false, true, false, true];
                
                // Initialize playoff day tracker
                if (!newState.currentDay) newState.currentDay = 1;
                newState.lastDaySummary = null;
                
                // STANLEY CUP FINALS (Round 4) - one game per day
                if (newState.round === 4 && newState.finalMatchup) {
                    if (newState.finalMatchup.homeWins < 4 && newState.finalMatchup.awayWins < 4) {
                        const gameNum = newState.finalMatchup.homeWins + newState.finalMatchup.awayWins;
                        const isHomeGame = homeGamePattern[gameNum];
                        const game = simulatePlayoffGame(newState.finalMatchup, isHomeGame);
                        newState.finalMatchup.games.push(game);
                        
                        if (game.winner === newState.finalMatchup.home) {
                            newState.finalMatchup.homeWins++;
                        } else {
                            newState.finalMatchup.awayWins++;
                        }
                        
                        const homeTeam = TEAMS.find(t => t.id === newState.finalMatchup.home);
                        const awayTeam = TEAMS.find(t => t.id === newState.finalMatchup.away);
                        const winner = game.winner === newState.finalMatchup.home ? homeTeam : awayTeam;
                        const loser = game.winner === newState.finalMatchup.home ? awayTeam : homeTeam;
                        
                        // Check if finals complete
                        if (newState.finalMatchup.homeWins >= 4 || newState.finalMatchup.awayWins >= 4) {
                            if (!newState.history) newState.history = {};
                            newState.history.final = { ...newState.finalMatchup };
                            const champion = newState.finalMatchup.homeWins >= 4 ? homeTeam : awayTeam;
                            newState.completed = true;
                            
                            newState.lastDaySummary = {
                                title: `ðŸ† Stanley Cup Finals - Game ${gameNum + 1} ðŸ†`,
                                conference: 'Finals',
                                results: [{
                                    homeTeam, awayTeam,
                                    homeScore: game.homeScore,
                                    awayScore: game.awayScore,
                                    winner, loser,
                                    homeWins: newState.finalMatchup.homeWins,
                                    awayWins: newState.finalMatchup.awayWins,
                                    seriesComplete: true,
                                    champion: champion.city + ' ' + champion.name
                                }]
                            };
                        } else {
                            newState.lastDaySummary = {
                                title: `ðŸ† Stanley Cup Finals - Game ${gameNum + 1} ðŸ†`,
                                conference: 'Finals',
                                results: [{
                                    homeTeam, awayTeam,
                                    homeScore: game.homeScore,
                                    awayScore: game.awayScore,
                                    winner, loser,
                                    homeWins: newState.finalMatchup.homeWins,
                                    awayWins: newState.finalMatchup.awayWins,
                                    seriesComplete: false
                                }]
                            };
                        }
                        
                        newState.currentDay++;
                    }
                    
                    setPlayoffState(newState);
                    setGameState({ ...gameState });
                    return;
                }
                
                // CONFERENCE ROUNDS - alternate East/West by day
                const isEastDay = newState.currentDay % 2 === 1;
                const conference = isEastDay ? 'East' : 'West';
                const matchups = isEastDay ? newState.eastMatchups : newState.westMatchups;
                const incompleteSeries = matchups.filter(m => m.homeWins < 4 && m.awayWins < 4);
                
                if (incompleteSeries.length === 0) {
                    // This conference has no games
                    const otherMatchups = isEastDay ? newState.westMatchups : newState.eastMatchups;
                    const otherIncompleteSeries = otherMatchups.filter(m => m.homeWins < 4 && m.awayWins < 4);
                    
                    if (otherIncompleteSeries.length === 0) {
                        // BOTH conferences done - advance round
                        const getWinners = (matchups) => matchups.map(m => m.homeWins >= 4 ? m.home : m.away);
                        const eastWinners = getWinners(newState.eastMatchups);
                        const westWinners = getWinners(newState.westMatchups);
                        
                        // Save to history
                        if (!newState.history) newState.history = {};
                        if (newState.round === 1) {
                            newState.history.eastRound1 = [...newState.eastMatchups];
                            newState.history.westRound1 = [...newState.westMatchups];
                        } else if (newState.round === 2) {
                            newState.history.eastRound2 = [...newState.eastMatchups];
                            newState.history.westRound2 = [...newState.westMatchups];
                        } else if (newState.round === 3) {
                            newState.history.eastRound3 = [...newState.eastMatchups];
                            newState.history.westRound3 = [...newState.westMatchups];
                        }
                        
                        if (newState.round === 3) {
                            // Create Stanley Cup Finals
                            newState.round = 4;
                            newState.finalMatchup = {
                                home: eastWinners[0],
                                away: westWinners[0],
                                homeWins: 0,
                                awayWins: 0,
                                games: []
                            };
                            newState.eastMatchups = [];
                            newState.westMatchups = [];
                            newState.currentDay = 1;
                            
                            const homeTeam = TEAMS.find(t => t.id === newState.finalMatchup.home);
                            const awayTeam = TEAMS.find(t => t.id === newState.finalMatchup.away);
                            newState.lastDaySummary = {
                                title: 'ðŸ† Conference Finals Complete! ðŸ†',
                                conference: 'Finals Setup',
                                message: `Stanley Cup Finals: ${awayTeam.city} @ ${homeTeam.city}`,
                                restDays: 2
                            };
                        } else {
                            // Advance to next round
                            newState.round++;
                            const createNextRound = (winners) => {
                                if (winners.length === 4) {
                                    return [
                                        { home: winners[0], away: winners[3], homeWins: 0, awayWins: 0, games: [] },
                                        { home: winners[1], away: winners[2], homeWins: 0, awayWins: 0, games: [] }
                                    ];
                                } else {
                                    return [{ home: winners[0], away: winners[1], homeWins: 0, awayWins: 0, games: [] }];
                                }
                            };
                            newState.eastMatchups = createNextRound(eastWinners);
                            newState.westMatchups = createNextRound(westWinners);
                            newState.currentDay = 1;
                            
                            newState.lastDaySummary = {
                                title: `Round ${newState.round - 1} Complete!`,
                                conference: 'Round Transition',
                                message: `Round ${newState.round} (${newState.round === 2 ? 'Conference Semifinals' : 'Conference Finals'}) begins in 2 days`,
                                restDays: 2
                            };
                        }
                    } else {
                        // This conference done, waiting for other
                        newState.currentDay++;
                        newState.lastDaySummary = {
                            title: `${conference}ern Conference - Day ${newState.currentDay - 1}`,
                            conference,
                            message: `No games today (all series completed). Waiting for ${isEastDay ? 'Western' : 'Eastern'} Conference.`
                        };
                    }
                    
                    setPlayoffState(newState);
                    setGameState({ ...gameState });
                    return;
                }
                
                // SIMULATE ONE GAME for each incomplete series
                const results = [];
                
                incompleteSeries.forEach(matchup => {
                    const gameNum = matchup.homeWins + matchup.awayWins;
                    const isHomeGame = homeGamePattern[gameNum];
                    const game = simulatePlayoffGame(matchup, isHomeGame);
                    matchup.games.push(game);
                    
                    if (game.winner === matchup.home) {
                        matchup.homeWins++;
                    } else {
                        matchup.awayWins++;
                    }
                    
                    const homeTeam = TEAMS.find(t => t.id === matchup.home);
                    const awayTeam = TEAMS.find(t => t.id === matchup.away);
                    const winner = game.winner === matchup.home ? homeTeam : awayTeam;
                    const loser = game.winner === matchup.home ? awayTeam : homeTeam;
                    const seriesComplete = matchup.homeWins >= 4 || matchup.awayWins >= 4;
                    
                    results.push({
                        homeTeam, awayTeam,
                        homeScore: game.homeScore,
                        awayScore: game.awayScore,
                        winner, loser,
                        homeWins: matchup.homeWins,
                        awayWins: matchup.awayWins,
                        seriesComplete
                    });
                });
                
                // Store summary
                newState.lastDaySummary = {
                    title: `${conference}ern Conference - Day ${newState.currentDay}`,
                    subtitle: `Round ${newState.round} ${newState.round === 1 ? '(First Round)' : newState.round === 2 ? '(Conference Semifinals)' : '(Conference Finals)'}`,
                    conference,
                    results
                };
                
                newState.currentDay++;
                setPlayoffState(newState);
                setGameState({ ...gameState });
            };


            const simulateDay82 = () => {
                if (!gameState || !gameState.schedule) return;
                
                // Check if season complete
                if (gameState.currentDay > 82) {
                    const awards = calculateAwards(gameState.players, gameState.standings);
                    setSeasonAwards(awards);
                    setCurrentView('awards');
                    return;
                }
                
                // Get current day's matchups
                const currentDaySchedule = gameState.schedule.find(d => d.day === gameState.currentDay);
                if (!currentDaySchedule || !currentDaySchedule.matchups) {
                    alert('No games scheduled for this day');
                    return;
                }
                
                const newPlayers = [...gameState.players];
                const newStandings = [...gameState.standings];
                const newSchedule = [...gameState.schedule];
                const newHeadToHead = { ...gameState.headToHead };
                
                // Simulate all matchups for this day
                const dayMatchups = currentDaySchedule.matchups;
                const dayResults = [];
                
                dayMatchups.forEach(matchup => {
                    if (matchup.played) return;
                    
                    // Get players for both teams
                    const homePlayers = newPlayers.filter(p => 
                        p.teamId === matchup.homeTeam &&
                        p.roster === 'nhl' &&
                        !p.injury.injured &&
                        (p.position === 'G' ? p.dressed : p.lineNumber > 0)
                    );
                    
                    const awayPlayers = newPlayers.filter(p => 
                        p.teamId === matchup.awayTeam &&
                        p.roster === 'nhl' &&
                        !p.injury.injured &&
                        (p.position === 'G' ? p.dressed : p.lineNumber > 0)
                    );
                    
                    // Simulate game
                    const result = simulateGameResult(homePlayers, awayPlayers);
                    
                    // Update matchup with complete game details
                    matchup.played = true;
                    matchup.homeScore = result.homeGoals;
                    matchup.awayScore = result.awayGoals;
                    matchup.homeStats = result.homePlayerStats;
                    matchup.awayStats = result.awayPlayerStats;
                    matchup.periodScoring = result.periodScoring;
                    matchup.details = {
                        scoringSummary: result.scoringSummary,
                        penaltyLog: result.penaltyLog,
                        teamStats: result.teamStats,
                        homePlayerStats: result.homePlayerStats,
                        awayPlayerStats: result.awayPlayerStats
                    };
                    
                    // Update standings
                    const homeStanding = newStandings.find(s => s.teamId === matchup.homeTeam);
                    const awayStanding = newStandings.find(s => s.teamId === matchup.awayTeam);
                    
                    homeStanding.goalsFor += result.homeGoals;
                    homeStanding.goalsAgainst += result.awayGoals;
                    awayStanding.goalsFor += result.awayGoals;
                    awayStanding.goalsAgainst += result.homeGoals;
                    
                    homeStanding.teamStats.gamesPlayed++;
                    awayStanding.teamStats.gamesPlayed++;
                    
                    if (result.winner === 'home') {
                        homeStanding.wins++;
                        homeStanding.home.wins++;
                        homeStanding.points += 2;
                        awayStanding.losses++;
                        awayStanding.away.losses++;
                    } else {
                        awayStanding.wins++;
                        awayStanding.away.wins++;
                        awayStanding.points += 2;
                        homeStanding.losses++;
                        homeStanding.home.losses++;
                    }
                    
                    // Update head-to-head record
                    const h2hKey = matchup.homeTeam < matchup.awayTeam ? 
                        `${matchup.homeTeam}vs${matchup.awayTeam}` : 
                        `${matchup.awayTeam}vs${matchup.homeTeam}`;
                    
                    if (!newHeadToHead[h2hKey]) {
                        newHeadToHead[h2hKey] = {
                            team1: matchup.homeTeam < matchup.awayTeam ? matchup.homeTeam : matchup.awayTeam,
                            team2: matchup.homeTeam < matchup.awayTeam ? matchup.awayTeam : matchup.homeTeam,
                            team1Wins: 0,
                            team2Wins: 0
                        };
                    }
                    
                    // Increment win count for winner
                    if (result.winner === 'home') {
                        if (matchup.homeTeam === newHeadToHead[h2hKey].team1) {
                            newHeadToHead[h2hKey].team1Wins++;
                        } else {
                            newHeadToHead[h2hKey].team2Wins++;
                        }
                    } else {
                        if (matchup.awayTeam === newHeadToHead[h2hKey].team1) {
                            newHeadToHead[h2hKey].team1Wins++;
                        } else {
                            newHeadToHead[h2hKey].team2Wins++;
                        }
                    }
                    
                    // Update player stats
                    [...result.homePlayerStats, ...result.awayPlayerStats].forEach(playerGameStats => {
                        const player = newPlayers.find(p => p.id === playerGameStats.player.id);
                        if (!player) return;
                        
                        if (player.position === 'G') {
                            if (playerGameStats.shotsAgainst > 0) {
                                player.stats.gamesPlayed++;
                                player.stats.timeOnIce += playerGameStats.toi;
                                player.stats.saves = (player.stats.saves || 0) + playerGameStats.saves;
                                player.stats.goalsAgainst = (player.stats.goalsAgainst || 0) + playerGameStats.goalsAgainst;
                                player.stats.shotsAgainst = (player.stats.shotsAgainst || 0) + playerGameStats.shotsAgainst;
                                
                                const isWin = (player.teamId === matchup.homeTeam && result.winner === 'home') ||
                                             (player.teamId === matchup.awayTeam && result.winner === 'away');
                                
                                if (isWin) {
                                    player.stats.wins = (player.stats.wins || 0) + 1;
                                } else {
                                    player.stats.losses = (player.stats.losses || 0) + 1;
                                }
                                
                                if (playerGameStats.goalsAgainst === 0) {
                                    player.stats.shutouts = (player.stats.shutouts || 0) + 1;
                                }
                                
                                player.stats.savePercentage = player.stats.saves / (player.stats.shotsAgainst || 1);
                                player.stats.gaa = (player.stats.goalsAgainst / (player.stats.gamesPlayed || 1)) * 1.0;
                            }
                        } else {
                            player.stats.gamesPlayed++;
                            player.stats.goals += playerGameStats.goals;
                            player.stats.assists += playerGameStats.assists;
                            player.stats.points += playerGameStats.points;
                            player.stats.plusMinus += playerGameStats.plusMinus;
                            player.stats.pim += playerGameStats.pim;
                            player.stats.shots += playerGameStats.shots;
                            player.stats.timeOnIce += playerGameStats.toi;
                        }
                        
                        // Check for injury
                        const injury = checkForInjury(player, playerGameStats.toi);
                        if (injury) {
                            player.injury = injury;
                            autoCallUpReplacement(newPlayers, player);
                        }
                        
                        checkMilestones(player, gameState);
                    });
                    
                    dayResults.push({
                        homeTeam: TEAMS.find(t => t.id === matchup.homeTeam),
                        awayTeam: TEAMS.find(t => t.id === matchup.awayTeam),
                        homeScore: result.homeGoals,
                        awayScore: result.awayGoals,
                        winner: result.winner
                    });
                });
                
                // Process AI trades (chance each day before trade deadline)
                const tradeDeadlineDay = 56;
                if (gameState.currentDay <= tradeDeadlineDay) {
                    // Calculate current game number
                    const teamGamesPlayed = {};
                    TEAMS.forEach(t => teamGamesPlayed[t.id] = 0);
                    newSchedule.filter(g => g.played).forEach(g => {
                        teamGamesPlayed[g.homeTeam]++;
                        teamGamesPlayed[g.awayTeam]++;
                    });
                    const avgGamesPlayed = Object.values(teamGamesPlayed).reduce((a, b) => a + b, 0) / TEAMS.length;
                    const gameNumber = Math.floor(avgGamesPlayed);
                    
                    processAITrades({
                        ...gameState,
                        players: newPlayers,
                        standings: newStandings,
                        schedule: newSchedule
                    }, gameNumber);
                }
                
                // Advance to next day
                const updatedState = {
                    ...gameState,
                    players: newPlayers,
                    standings: newStandings,
                    schedule: newSchedule,
                    headToHead: newHeadToHead,
                    currentDay: gameState.currentDay + 1,
                    lastGameDay: gameState.currentDay
                };
                
                setGameState(updatedState);
            };
            
            const simulate7Games = () => {
                if (!gameState) return;
                
                let currentState = { ...gameState };
                let gamesPlayed = 0;
                const targetGames = 7;
                
                // Keep simulating days until user team has played 7 games
                while (gamesPlayed < targetGames && currentState.currentDay <= 82) {
                    const currentDaySchedule = currentState.schedule.find(d => d.day === currentState.currentDay);
                    if (!currentDaySchedule) break;
                    
                    // Check if user team plays today
                    const userTeamMatchup = currentDaySchedule.matchups.find(m => 
                        (m.homeTeam === userTeamId || m.awayTeam === userTeamId) && !m.played
                    );
                    
                    // Simulate all matchups for this day
                    currentDaySchedule.matchups.forEach(matchup => {
                        if (matchup.played) return;
                        
                        const homePlayers = currentState.players.filter(p => 
                            p.teamId === matchup.homeTeam && p.roster === 'nhl' && !p.injury.injured &&
                            (p.position === 'G' ? p.dressed : p.lineNumber > 0)
                        );
                        
                        const awayPlayers = currentState.players.filter(p => 
                            p.teamId === matchup.awayTeam && p.roster === 'nhl' && !p.injury.injured &&
                            (p.position === 'G' ? p.dressed : p.lineNumber > 0)
                        );
                        
                        const result = simulateGameResult(homePlayers, awayPlayers);
                        
                        matchup.played = true;
                        matchup.homeScore = result.homeGoals;
                        matchup.awayScore = result.awayGoals;
                        
                        const homeStanding = currentState.standings.find(s => s.teamId === matchup.homeTeam);
                        const awayStanding = currentState.standings.find(s => s.teamId === matchup.awayTeam);
                        
                        homeStanding.goalsFor += result.homeGoals;
                        homeStanding.goalsAgainst += result.awayGoals;
                        awayStanding.goalsFor += result.awayGoals;
                        awayStanding.goalsAgainst += result.homeGoals;
                        homeStanding.teamStats.gamesPlayed++;
                        awayStanding.teamStats.gamesPlayed++;
                        
                        if (result.winner === 'home') {
                            homeStanding.wins++;
                            homeStanding.home.wins++;
                            homeStanding.points += 2;
                            awayStanding.losses++;
                            awayStanding.away.losses++;
                        } else {
                            awayStanding.wins++;
                            awayStanding.away.wins++;
                            awayStanding.points += 2;
                            homeStanding.losses++;
                            homeStanding.home.losses++;
                        }
                        
                        [...result.homePlayerStats, ...result.awayPlayerStats].forEach(pgs => {
                            const player = currentState.players.find(p => p.id === pgs.player.id);
                            if (!player) return;
                            
                            if (player.position === 'G' && pgs.shotsAgainst > 0) {
                                player.stats.gamesPlayed++;
                                player.stats.saves = (player.stats.saves || 0) + pgs.saves;
                                player.stats.goalsAgainst = (player.stats.goalsAgainst || 0) + pgs.goalsAgainst;
                                player.stats.shotsAgainst = (player.stats.shotsAgainst || 0) + pgs.shotsAgainst;
                                player.stats.savePercentage = player.stats.saves / player.stats.shotsAgainst;
                                player.stats.gaa = player.stats.goalsAgainst / player.stats.gamesPlayed;
                            } else if (player.position !== 'G') {
                                player.stats.gamesPlayed++;
                                player.stats.goals += pgs.goals;
                                player.stats.assists += pgs.assists;
                                player.stats.points += pgs.points;
                                player.stats.plusMinus += pgs.plusMinus;
                            }
                        });
                    });
                    
                    // If user team played, increment counter
                    if (userTeamMatchup) {
                        gamesPlayed++;
                    }
                    
                    // Increment day, but cap at 83 (one past the end to indicate season complete)
                    currentState.currentDay++;
                    if (currentState.currentDay > 83) {
                        currentState.currentDay = 83;
                    }
                }
                
                setGameState(currentState);
            };
            
            const simulate30Games = () => {
                if (!gameState) return;
                
                let currentState = { ...gameState };
                let gamesPlayed = 0;
                const targetGames = 30;
                
                while (gamesPlayed < targetGames && currentState.currentDay <= 82) {
                    const currentDaySchedule = currentState.schedule.find(d => d.day === currentState.currentDay);
                    if (!currentDaySchedule) break;
                    
                    const userTeamMatchup = currentDaySchedule.matchups.find(m => 
                        (m.homeTeam === userTeamId || m.awayTeam === userTeamId) && !m.played
                    );
                    
                    currentDaySchedule.matchups.forEach(matchup => {
                        if (matchup.played) return;
                        
                        const homePlayers = currentState.players.filter(p => 
                            p.teamId === matchup.homeTeam && p.roster === 'nhl' && !p.injury.injured &&
                            (p.position === 'G' ? p.dressed : p.lineNumber > 0)
                        );
                        
                        const awayPlayers = currentState.players.filter(p => 
                            p.teamId === matchup.awayTeam && p.roster === 'nhl' && !p.injury.injured &&
                            (p.position === 'G' ? p.dressed : p.lineNumber > 0)
                        );
                        
                        const result = simulateGameResult(homePlayers, awayPlayers);
                        
                        matchup.played = true;
                        matchup.homeScore = result.homeGoals;
                        matchup.awayScore = result.awayGoals;
                        
                        const homeStanding = currentState.standings.find(s => s.teamId === matchup.homeTeam);
                        const awayStanding = currentState.standings.find(s => s.teamId === matchup.awayTeam);
                        
                        homeStanding.goalsFor += result.homeGoals;
                        homeStanding.goalsAgainst += result.awayGoals;
                        awayStanding.goalsFor += result.awayGoals;
                        awayStanding.goalsAgainst += result.homeGoals;
                        homeStanding.teamStats.gamesPlayed++;
                        awayStanding.teamStats.gamesPlayed++;
                        
                        if (result.winner === 'home') {
                            homeStanding.wins++; homeStanding.home.wins++; homeStanding.points += 2;
                            awayStanding.losses++; awayStanding.away.losses++;
                        } else {
                            awayStanding.wins++; awayStanding.away.wins++; awayStanding.points += 2;
                            homeStanding.losses++; homeStanding.home.losses++;
                        }
                        
                        [...result.homePlayerStats, ...result.awayPlayerStats].forEach(pgs => {
                            const player = currentState.players.find(p => p.id === pgs.player.id);
                            if (!player) return;
                            
                            if (player.position === 'G' && pgs.shotsAgainst > 0) {
                                player.stats.gamesPlayed++;
                                player.stats.saves = (player.stats.saves || 0) + pgs.saves;
                                player.stats.goalsAgainst = (player.stats.goalsAgainst || 0) + pgs.goalsAgainst;
                                player.stats.shotsAgainst = (player.stats.shotsAgainst || 0) + pgs.shotsAgainst;
                                player.stats.savePercentage = player.stats.saves / player.stats.shotsAgainst;
                                player.stats.gaa = player.stats.goalsAgainst / player.stats.gamesPlayed;
                            } else if (player.position !== 'G') {
                                player.stats.gamesPlayed++; player.stats.goals += pgs.goals;
                                player.stats.assists += pgs.assists; player.stats.points += pgs.points;
                                player.stats.plusMinus += pgs.plusMinus;
                            }
                        });
                    });
                    
                    if (userTeamMatchup) {
                        gamesPlayed++;
                    }
                    
                    // Process AI trades
                    const tradeDeadlineDay = 56;
                    if (currentState.currentDay <= tradeDeadlineDay) {
                        // Calculate current game number
                        const teamGamesPlayed = {};
                        TEAMS.forEach(t => teamGamesPlayed[t.id] = 0);
                        currentState.schedule.filter(g => g.played).forEach(g => {
                            teamGamesPlayed[g.homeTeam]++;
                            teamGamesPlayed[g.awayTeam]++;
                        });
                        const avgGamesPlayed = Object.values(teamGamesPlayed).reduce((a, b) => a + b, 0) / TEAMS.length;
                        const gameNumber = Math.floor(avgGamesPlayed);
                        
                        processAITrades(currentState, gameNumber);
                    }
                    
                    // Increment day, but cap at 83
                    currentState.currentDay++;
                    if (currentState.currentDay > 83) {
                        currentState.currentDay = 83;
                    }
                }
                
                setGameState(currentState);
            };
            
            // Keep old function for backward compatibility
            const simulate7Days82 = () => {
                if (!gameState) return;
                
                let currentState = { ...gameState };
                
                for (let i = 0; i < 7; i++) {
                    if (currentState.currentDay > 82) break;
                    
                    // Get current day's matchups
                    const currentDaySchedule = currentState.schedule.find(d => d.day === currentState.currentDay);
                    if (!currentDaySchedule) break;
                    
                    // Simulate the day (inline to avoid state issues)
                    const dayMatchups = currentDaySchedule.matchups;
                    
                    dayMatchups.forEach(matchup => {
                        if (matchup.played) return;
                        
                        const homePlayers = currentState.players.filter(p => 
                            p.teamId === matchup.homeTeam && p.roster === 'nhl' && !p.injury.injured &&
                            (p.position === 'G' ? p.dressed : p.lineNumber > 0)
                        );
                        
                        const awayPlayers = currentState.players.filter(p => 
                            p.teamId === matchup.awayTeam && p.roster === 'nhl' && !p.injury.injured &&
                            (p.position === 'G' ? p.dressed : p.lineNumber > 0)
                        );
                        
                        const result = simulateGameResult(homePlayers, awayPlayers);
                        
                        matchup.played = true;
                        matchup.homeScore = result.homeGoals;
                        matchup.awayScore = result.awayGoals;
                        
                        // Update standings (simplified)
                        const homeStanding = currentState.standings.find(s => s.teamId === matchup.homeTeam);
                        const awayStanding = currentState.standings.find(s => s.teamId === matchup.awayTeam);
                        
                        homeStanding.goalsFor += result.homeGoals;
                        homeStanding.goalsAgainst += result.awayGoals;
                        awayStanding.goalsFor += result.awayGoals;
                        awayStanding.goalsAgainst += result.homeGoals;
                        homeStanding.teamStats.gamesPlayed++;
                        awayStanding.teamStats.gamesPlayed++;
                        
                        if (result.winner === 'home') {
                            homeStanding.wins++;
                            homeStanding.home.wins++;
                            homeStanding.points += 2;
                            awayStanding.losses++;
                            awayStanding.away.losses++;
                        } else {
                            awayStanding.wins++;
                            awayStanding.away.wins++;
                            awayStanding.points += 2;
                            homeStanding.losses++;
                            homeStanding.home.losses++;
                        }
                        
                        // Update player stats (simplified)
                        [...result.homePlayerStats, ...result.awayPlayerStats].forEach(pgs => {
                            const player = currentState.players.find(p => p.id === pgs.player.id);
                            if (!player) return;
                            
                            if (player.position === 'G' && pgs.shotsAgainst > 0) {
                                player.stats.gamesPlayed++;
                                player.stats.saves = (player.stats.saves || 0) + pgs.saves;
                                player.stats.goalsAgainst = (player.stats.goalsAgainst || 0) + pgs.goalsAgainst;
                                player.stats.shotsAgainst = (player.stats.shotsAgainst || 0) + pgs.shotsAgainst;
                                player.stats.savePercentage = player.stats.saves / player.stats.shotsAgainst;
                                player.stats.gaa = player.stats.goalsAgainst / player.stats.gamesPlayed;
                            } else if (player.position !== 'G') {
                                player.stats.gamesPlayed++;
                                player.stats.goals += pgs.goals;
                                player.stats.assists += pgs.assists;
                                player.stats.points += pgs.points;
                                player.stats.plusMinus += pgs.plusMinus;
                            }
                        });
                    });
                    
                    currentState.currentDay++;
                }
                
                setGameState(currentState);
            };
            
            const simulateSeason82 = () => {
                if (!gameState) return;
                
                let currentState = { ...gameState };
                
                while (currentState.currentDay <= 82) {
                    const currentDaySchedule = currentState.schedule.find(d => d.day === currentState.currentDay);
                    if (!currentDaySchedule) break;
                    
                    currentDaySchedule.matchups.forEach(matchup => {
                        if (matchup.played) return;
                        
                        const homePlayers = currentState.players.filter(p => 
                            p.teamId === matchup.homeTeam && p.roster === 'nhl' && !p.injury.injured &&
                            (p.position === 'G' ? p.dressed : p.lineNumber > 0)
                        );
                        
                        const awayPlayers = currentState.players.filter(p => 
                            p.teamId === matchup.awayTeam && p.roster === 'nhl' && !p.injury.injured &&
                            (p.position === 'G' ? p.dressed : p.lineNumber > 0)
                        );
                        
                        const result = simulateGameResult(homePlayers, awayPlayers);
                        
                        matchup.played = true;
                        matchup.homeScore = result.homeGoals;
                        matchup.awayScore = result.awayGoals;
                        
                        const homeStanding = currentState.standings.find(s => s.teamId === matchup.homeTeam);
                        const awayStanding = currentState.standings.find(s => s.teamId === matchup.awayTeam);
                        
                        homeStanding.goalsFor += result.homeGoals;
                        homeStanding.goalsAgainst += result.awayGoals;
                        awayStanding.goalsFor += result.awayGoals;
                        awayStanding.goalsAgainst += result.homeGoals;
                        homeStanding.teamStats.gamesPlayed++;
                        awayStanding.teamStats.gamesPlayed++;
                        
                        if (result.winner === 'home') {
                            homeStanding.wins++; homeStanding.home.wins++; homeStanding.points += 2;
                            awayStanding.losses++; awayStanding.away.losses++;
                        } else {
                            awayStanding.wins++; awayStanding.away.wins++; awayStanding.points += 2;
                            homeStanding.losses++; homeStanding.home.losses++;
                        }
                        
                        [...result.homePlayerStats, ...result.awayPlayerStats].forEach(pgs => {
                            const player = currentState.players.find(p => p.id === pgs.player.id);
                            if (!player) return;
                            
                            if (player.position === 'G' && pgs.shotsAgainst > 0) {
                                player.stats.gamesPlayed++;
                                player.stats.saves = (player.stats.saves || 0) + pgs.saves;
                                player.stats.goalsAgainst = (player.stats.goalsAgainst || 0) + pgs.goalsAgainst;
                                player.stats.shotsAgainst = (player.stats.shotsAgainst || 0) + pgs.shotsAgainst;
                                player.stats.savePercentage = player.stats.saves / player.stats.shotsAgainst;
                                player.stats.gaa = player.stats.goalsAgainst / player.stats.gamesPlayed;
                            } else if (player.position !== 'G') {
                                player.stats.gamesPlayed++; player.stats.goals += pgs.goals;
                                player.stats.assists += pgs.assists; player.stats.points += pgs.points;
                                player.stats.plusMinus += pgs.plusMinus;
                            }
                        });
                    });
                    
                    currentState.currentDay++;
                }
                
                // Season complete - show awards
                const awards = calculateAwards(currentState.players, currentState.standings);
                setSeasonAwards(awards);
                setGameState(currentState);
                setCurrentView('awards');
            };


            const proposeTrade = (yourPlayer, theirPlayer) => {
                if (!gameState) return;
                
                // Check if trade deadline has passed (Day 55)
                const tradeDeadlineDay = 55;
                
                if (gameState.currentDay > tradeDeadlineDay) {
                    alert(`âŒ TRADE DEADLINE HAS PASSED\n\nThe trade deadline was Day ${tradeDeadlineDay}.\nTrades are no longer allowed this season.`);
                    setSelectedPlayer(null);
                    setSelectedTeam(null);
                    return;
                }
                
                const ratingDiff = Math.abs(yourPlayer.ratings.overall - theirPlayer.ratings.overall);
                const accepted = ratingDiff < 10 && Math.random() > 0.3;
                
                if (accepted) {
                    const newPlayers = gameState.players.map(p => {
                        if (p.id === yourPlayer.id) return { ...p, teamId: theirPlayer.teamId };
                        if (p.id === theirPlayer.id) return { ...p, teamId: yourPlayer.teamId };
                        return p;
                    });
                    
                    setGameState({ ...gameState, players: newPlayers });
                    alert('Trade accepted!');
                } else {
                    alert('Trade rejected.');
                }
                
                setSelectedPlayer(null);
                setSelectedTeam(null);
            };

            const formatTOI = (minutes) => {
                const mins = Math.floor(minutes);
                const secs = Math.round((minutes - mins) * 60);
                return `${mins}:${secs.toString().padStart(2, '0')}`;
            };

            const renderStandings = () => {
                if (!gameState) return null;

                // Helper function to get last 10 games record and current streak
                const getTeamLast10AndStreak = (teamId) => {
                    // Get all games for this team (played only)
                    const teamGames = gameState.schedule
                        .filter(g => g.played && (g.homeTeam === teamId || g.awayTeam === teamId))
                        .sort((a, b) => new Date(a.date) - new Date(b.date)); // Chronological order
                    
                    // Get last 10 games
                    const last10Games = teamGames.slice(-10);
                    
                    let wins = 0, losses = 0, otLosses = 0;
                    const results = []; // Will store 'W', 'L', 'OTL'
                    
                    last10Games.forEach(game => {
                        const isHome = game.homeTeam === teamId;
                        const teamScore = isHome ? game.homeScore : game.awayScore;
                        const oppScore = isHome ? game.awayScore : game.homeScore;
                        
                        if (teamScore > oppScore) {
                            wins++;
                            results.push('W');
                        } else if (game.overtime) {
                            otLosses++;
                            results.push('OTL');
                        } else {
                            losses++;
                            results.push('L');
                        }
                    });
                    
                    const last10Record = `${wins}-${losses}-${otLosses}`;
                    
                    // Calculate streak (current)
                    let streak = '';
                    let streakCount = 0;
                    if (results.length > 0) {
                        const lastResult = results[results.length - 1];
                        streakCount = 1;
                        
                        // Count backwards from end
                        for (let i = results.length - 2; i >= 0; i--) {
                            if (results[i] === lastResult) {
                                streakCount++;
                            } else {
                                break;
                            }
                        }
                        
                        streak = lastResult + streakCount;
                    }
                    
                    return { last10Record, streak, streakType: results.length > 0 ? results[results.length - 1] : '' };
                };

                const sortedStandings = [...gameState.standings].sort((a, b) => b.points - a.points);

                if (standingsView === 'division') {
                    return ['Atlantic', 'Metropolitan', 'Central', 'Pacific'].map(division => {
                        const divTeams = TEAMS.filter(t => t.division === division);
                        const divStandings = sortedStandings.filter(s => divTeams.some(t => t.id === s.teamId));
                        
                        return (
                            <div key={division} className="card">
                                <h2>{division} Division</h2>
                                <table className="standings-table">
                                    <thead>
                                        <tr>
                                            <th className="rank">#</th>
                                            <th>Team</th>
                                            <th className="text-center">GP</th>
                                            <th className="text-center">W</th>
                                            <th className="text-center">L</th>
                                            <th className="text-center">OTL</th>
                                            <th className="text-center">PTS</th>
                                            <th className="text-center">GF</th>
                                            <th className="text-center">GA</th>
                                            <th className="text-center">DIFF</th>
                                            <th className="text-center">HOME</th>
                                            <th className="text-center">AWAY</th>
                                            <th className="text-center">L10</th>
                                            <th className="text-center">STRK</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {divStandings.map((standing, idx) => {
                                            const team = TEAMS.find(t => t.id === standing.teamId);
                                            const isUserTeam = team.id === userTeamId;
                                            const isPlayoff = idx < 3;
                                            const gp = standing.wins + standing.losses + standing.otLosses;
                                            const diff = standing.goalsFor - standing.goalsAgainst;
                                            const { last10Record, streak, streakType } = getTeamLast10AndStreak(team.id);
                                            
                                            // Determine streak color
                                            const streakColor = streakType === 'W' ? '#22c55e' : streakType === 'L' ? '#ef4444' : '#fbbf24';
                                            
                                            return (
                                                <tr key={team.id} className={`${isUserTeam ? 'highlight' : ''} ${isPlayoff ? 'playoff' : ''}`}>
                                                    <td className="rank">{idx + 1}</td>
                                                    <td className="team-name" style={{ cursor: 'pointer', textDecoration: 'underline' }} onClick={() => navigateTo('teamProfile', team.id)}>
                                                        {team.city} {team.name}
                                                    </td>
                                                    <td className="text-center">{gp}</td>
                                                    <td className="text-center">{standing.wins}</td>
                                                    <td className="text-center">{standing.losses}</td>
                                                    <td className="text-center">{standing.otLosses}</td>
                                                    <td className="text-center">{standing.points}</td>
                                                    <td className="text-center">{standing.goalsFor}</td>
                                                    <td className="text-center">{standing.goalsAgainst}</td>
                                                    <td className="text-center">{diff > 0 ? '+' : ''}{diff}</td>
                                                    <td className="text-center">{standing.home.wins}-{standing.home.losses}</td>
                                                    <td className="text-center">{standing.away.wins}-{standing.away.losses}</td>
                                                    <td className="text-center">{last10Record}</td>
                                                    <td className="text-center" style={{ color: streakColor, fontWeight: 'bold' }}>
                                                        {streak}
                                                    </td>
                                                </tr>
                                            );
                                        })}
                                    </tbody>
                                </table>
                            </div>
                        );
                    });
                }

                if (standingsView === 'conference') {
                    return ['East', 'West'].map(conference => {
                        const confTeams = TEAMS.filter(t => t.conference === conference);
                        const confStandings = sortedStandings.filter(s => confTeams.some(t => t.id === s.teamId));
                        
                        return (
                            <div key={conference} className="card">
                                <h2>{conference}ern Conference</h2>
                                <table className="standings-table">
                                    <thead>
                                        <tr>
                                            <th className="rank">#</th>
                                            <th>Team</th>
                                            <th className="text-center">GP</th>
                                            <th className="text-center">W</th>
                                            <th className="text-center">L</th>
                                            <th className="text-center">OTL</th>
                                            <th className="text-center">PTS</th>
                                            <th className="text-center">GF</th>
                                            <th className="text-center">GA</th>
                                            <th className="text-center">DIFF</th>
                                            <th className="text-center">HOME</th>
                                            <th className="text-center">AWAY</th>
                                            <th className="text-center">L10</th>
                                            <th className="text-center">STRK</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {confStandings.map((standing, idx) => {
                                            const team = TEAMS.find(t => t.id === standing.teamId);
                                            const isUserTeam = team.id === userTeamId;
                                            const isPlayoff = idx < 8;
                                            const gp = standing.wins + standing.losses + standing.otLosses;
                                            const diff = standing.goalsFor - standing.goalsAgainst;
                                            const { last10Record, streak, streakType } = getTeamLast10AndStreak(team.id);
                                            const streakColor = streakType === 'W' ? '#22c55e' : streakType === 'L' ? '#ef4444' : '#fbbf24';
                                            
                                            return (
                                                <tr key={team.id} className={`${isUserTeam ? 'highlight' : ''} ${isPlayoff ? 'playoff' : ''}`}>
                                                    <td className="rank">{idx + 1}</td>
                                                    <td className="team-name" style={{ cursor: 'pointer', textDecoration: 'underline' }} onClick={() => navigateTo('teamProfile', team.id)}>{team.city} {team.name} ({team.division})</td>
                                                    <td className="text-center">{gp}</td>
                                                    <td className="text-center">{standing.wins}</td>
                                                    <td className="text-center">{standing.losses}</td>
                                                    <td className="text-center">{standing.otLosses}</td>
                                                    <td className="text-center">{standing.points}</td>
                                                    <td className="text-center">{standing.goalsFor}</td>
                                                    <td className="text-center">{standing.goalsAgainst}</td>
                                                    <td className="text-center">{diff > 0 ? '+' : ''}{diff}</td>
                                                    <td className="text-center">{standing.home.wins}-{standing.home.losses}</td>
                                                    <td className="text-center">{standing.away.wins}-{standing.away.losses}</td>
                                                    <td className="text-center">{last10Record}</td>
                                                    <td className="text-center" style={{ color: streakColor, fontWeight: 'bold' }}>
                                                        {streak}
                                                    </td>
                                                </tr>
                                            );
                                        })}
                                    </tbody>
                                </table>
                            </div>
                        );
                    });
                }

                if (standingsView === 'wildcard') {
                    return ['East', 'West'].map(conference => {
                        const confTeams = TEAMS.filter(t => t.conference === conference);
                        const confStandings = sortedStandings.filter(s => confTeams.some(t => t.id === s.teamId));
                        
                        const divisions = conference === 'East' ? ['Atlantic', 'Metropolitan'] : ['Central', 'Pacific'];
                        const divisionLeaders = [];
                        
                        divisions.forEach(division => {
                            const divTeams = TEAMS.filter(t => t.division === division);
                            const divStandings = confStandings.filter(s => divTeams.some(t => t.id === s.teamId));
                            divisionLeaders.push(...divStandings.slice(0, 3));
                        });
                        
                        const wildcardTeams = confStandings.filter(s => !divisionLeaders.some(dl => dl.teamId === s.teamId)).slice(0, 2);
                        
                        return (
                            <div key={conference} className="card">
                                <h2>{conference}ern Conference</h2>
                                {divisions.map(division => {
                                    const divTeams = TEAMS.filter(t => t.division === division);
                                    const divStandings = confStandings.filter(s => divTeams.some(t => t.id === s.teamId)).slice(0, 3);
                                    
                                    return (
                                        <div key={division}>
                                            <h3>{division} Division</h3>
                                            <table className="standings-table">
                                                <thead>
                                                    <tr>
                                                        <th className="rank">#</th>
                                                        <th>Team</th>
                                                        <th className="text-center">GP</th>
                                                        <th className="text-center">W</th>
                                                        <th className="text-center">L</th>
                                                        <th className="text-center">OTL</th>
                                                        <th className="text-center">PTS</th>
                                                        <th className="text-center">DIFF</th>
                                                        <th className="text-center">L10</th>
                                                        <th className="text-center">STRK</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {divStandings.map((standing, idx) => {
                                                        const team = TEAMS.find(t => t.id === standing.teamId);
                                                        const isUserTeam = team.id === userTeamId;
                                                        const gp = standing.wins + standing.losses + standing.otLosses;
                                                        const diff = standing.goalsFor - standing.goalsAgainst;
                                                        const { last10Record, streak, streakType } = getTeamLast10AndStreak(team.id);
                                                        const streakColor = streakType === 'W' ? '#22c55e' : streakType === 'L' ? '#ef4444' : '#fbbf24';
                                                        
                                                        return (
                                                            <tr key={team.id} className={`${isUserTeam ? 'highlight' : ''} playoff`}>
                                                                <td className="rank">{idx + 1}</td>
                                                                <td className="team-name" style={{ cursor: 'pointer', textDecoration: 'underline' }} onClick={() => navigateTo('teamProfile', team.id)}>{team.city} {team.name}</td>
                                                                <td className="text-center">{gp}</td>
                                                                <td className="text-center">{standing.wins}</td>
                                                                <td className="text-center">{standing.losses}</td>
                                                                <td className="text-center">{standing.otLosses}</td>
                                                                <td className="text-center">{standing.points}</td>
                                                                <td className="text-center">{diff > 0 ? '+' : ''}{diff}</td>
                                                                <td className="text-center">{last10Record}</td>
                                                                <td className="text-center" style={{ color: streakColor, fontWeight: 'bold' }}>
                                                                    {streak}
                                                                </td>
                                                            </tr>
                                                        );
                                                    })}
                                                </tbody>
                                            </table>
                                        </div>
                                    );
                                })}
                                <h3>Wild Card</h3>
                                <table className="standings-table">
                                    <thead>
                                        <tr>
                                            <th className="rank">#</th>
                                            <th>Team</th>
                                            <th className="text-center">GP</th>
                                            <th className="text-center">W</th>
                                            <th className="text-center">L</th>
                                            <th className="text-center">OTL</th>
                                            <th className="text-center">PTS</th>
                                            <th className="text-center">DIFF</th>
                                            <th className="text-center">L10</th>
                                            <th className="text-center">STRK</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {wildcardTeams.map((standing, idx) => {
                                            const team = TEAMS.find(t => t.id === standing.teamId);
                                            const isUserTeam = team.id === userTeamId;
                                            const gp = standing.wins + standing.losses + standing.otLosses;
                                            const diff = standing.goalsFor - standing.goalsAgainst;
                                            const { last10Record, streak, streakType } = getTeamLast10AndStreak(team.id);
                                            const streakColor = streakType === 'W' ? '#22c55e' : streakType === 'L' ? '#ef4444' : '#fbbf24';
                                            
                                            return (
                                                <tr key={team.id} className={`${isUserTeam ? 'highlight' : ''} wildcard`}>
                                                    <td className="rank">WC{idx + 1}</td>
                                                    <td className="team-name" style={{ cursor: 'pointer', textDecoration: 'underline' }} onClick={() => navigateTo('teamProfile', team.id)}>{team.city} {team.name} ({team.division})</td>
                                                    <td className="text-center">{gp}</td>
                                                    <td className="text-center">{standing.wins}</td>
                                                    <td className="text-center">{standing.losses}</td>
                                                    <td className="text-center">{standing.otLosses}</td>
                                                    <td className="text-center">{standing.points}</td>
                                                    <td className="text-center">{diff > 0 ? '+' : ''}{diff}</td>
                                                    <td className="text-center">{last10Record}</td>
                                                    <td className="text-center" style={{ color: streakColor, fontWeight: 'bold' }}>
                                                        {streak}
                                                    </td>
                                                </tr>
                                            );
                                        })}
                                    </tbody>
                                </table>
                            </div>
                        );
                    });
                }

                if (standingsView === 'league') {
                    const sortedLeagueStandings = sortData(sortedStandings, standingsSortConfig.key, standingsSortConfig.direction);
                    
                    return (
                        <div className="card">
                            <h2>League Standings</h2>
                            <table className="standings-table">
                                <thead>
                                    <tr>
                                        <th className="rank">#</th>
                                        <th style={{ cursor: 'pointer' }} onClick={() => { 
                                            const dir = standingsSortConfig.key === 'teamName' && standingsSortConfig.direction === 'desc' ? 'asc' : 'desc';
                                            setStandingsSortConfig({ key: 'teamName', direction: dir });
                                        }}>
                                            Team {standingsSortConfig.key === 'teamName' && (standingsSortConfig.direction === 'desc' ? 'â–¼' : 'â–²')}
                                        </th>
                                        <th className="text-center" style={{ cursor: 'pointer' }} onClick={() => { 
                                            const dir = standingsSortConfig.key === 'gamesPlayed' && standingsSortConfig.direction === 'desc' ? 'asc' : 'desc';
                                            setStandingsSortConfig({ key: 'gamesPlayed', direction: dir });
                                        }}>
                                            GP {standingsSortConfig.key === 'gamesPlayed' && (standingsSortConfig.direction === 'desc' ? 'â–¼' : 'â–²')}
                                        </th>
                                        <th className="text-center" style={{ cursor: 'pointer' }} onClick={() => { 
                                            const dir = standingsSortConfig.key === 'wins' && standingsSortConfig.direction === 'desc' ? 'asc' : 'desc';
                                            setStandingsSortConfig({ key: 'wins', direction: dir });
                                        }}>
                                            W {standingsSortConfig.key === 'wins' && (standingsSortConfig.direction === 'desc' ? 'â–¼' : 'â–²')}
                                        </th>
                                        <th className="text-center" style={{ cursor: 'pointer' }} onClick={() => { 
                                            const dir = standingsSortConfig.key === 'losses' && standingsSortConfig.direction === 'desc' ? 'asc' : 'desc';
                                            setStandingsSortConfig({ key: 'losses', direction: dir });
                                        }}>
                                            L {standingsSortConfig.key === 'losses' && (standingsSortConfig.direction === 'desc' ? 'â–¼' : 'â–²')}
                                        </th>
                                        <th className="text-center" style={{ cursor: 'pointer' }} onClick={() => { 
                                            const dir = standingsSortConfig.key === 'otLosses' && standingsSortConfig.direction === 'desc' ? 'asc' : 'desc';
                                            setStandingsSortConfig({ key: 'otLosses', direction: dir });
                                        }}>
                                            OTL {standingsSortConfig.key === 'otLosses' && (standingsSortConfig.direction === 'desc' ? 'â–¼' : 'â–²')}
                                        </th>
                                        <th className="text-center" style={{ cursor: 'pointer' }} onClick={() => { 
                                            const dir = standingsSortConfig.key === 'points' && standingsSortConfig.direction === 'desc' ? 'asc' : 'desc';
                                            setStandingsSortConfig({ key: 'points', direction: dir });
                                        }}>
                                            PTS {standingsSortConfig.key === 'points' && (standingsSortConfig.direction === 'desc' ? 'â–¼' : 'â–²')}
                                        </th>
                                        <th className="text-center" style={{ cursor: 'pointer' }} onClick={() => { 
                                            const dir = standingsSortConfig.key === 'goalsFor' && standingsSortConfig.direction === 'desc' ? 'asc' : 'desc';
                                            setStandingsSortConfig({ key: 'goalsFor', direction: dir });
                                        }}>
                                            GF {standingsSortConfig.key === 'goalsFor' && (standingsSortConfig.direction === 'desc' ? 'â–¼' : 'â–²')}
                                        </th>
                                        <th className="text-center" style={{ cursor: 'pointer' }} onClick={() => { 
                                            const dir = standingsSortConfig.key === 'goalsAgainst' && standingsSortConfig.direction === 'desc' ? 'asc' : 'desc';
                                            setStandingsSortConfig({ key: 'goalsAgainst', direction: dir });
                                        }}>
                                            GA {standingsSortConfig.key === 'goalsAgainst' && (standingsSortConfig.direction === 'desc' ? 'â–¼' : 'â–²')}
                                        </th>
                                        <th className="text-center" style={{ cursor: 'pointer' }} onClick={() => { 
                                            const dir = standingsSortConfig.key === 'diff' && standingsSortConfig.direction === 'desc' ? 'asc' : 'desc';
                                            setStandingsSortConfig({ key: 'diff', direction: dir });
                                        }}>
                                            DIFF {standingsSortConfig.key === 'diff' && (standingsSortConfig.direction === 'desc' ? 'â–¼' : 'â–²')}
                                        </th>
                                        <th className="text-center">HOME</th>
                                        <th className="text-center">AWAY</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {sortedLeagueStandings.map((standing, idx) => {
                                        const team = TEAMS.find(t => t.id === standing.teamId);
                                        const isUserTeam = team.id === userTeamId;
                                        const gp = standing.wins + standing.losses + standing.otLosses;
                                        const diff = standing.goalsFor - standing.goalsAgainst;
                                        
                                        // Add sortable fields to standing object
                                        const standingWithSort = { ...standing, teamName: `${team.city} ${team.name}`, gamesPlayed: gp, diff };
                                        
                                        return (
                                            <tr key={team.id} className={`${isUserTeam ? 'highlight' : ''}`}>
                                                <td className="rank">{idx + 1}</td>
                                                <td className="team-name" style={{ cursor: 'pointer', textDecoration: 'underline' }} onClick={() => navigateTo('teamProfile', team.id)}>{team.city} {team.name} ({team.conference} - {team.division})</td>
                                                <td className="text-center">{gp}</td>
                                                <td className="text-center">{standing.wins}</td>
                                                <td className="text-center">{standing.losses}</td>
                                                <td className="text-center">{standing.otLosses}</td>
                                                <td className="text-center">{standing.points}</td>
                                                <td className="text-center">{standing.goalsFor}</td>
                                                <td className="text-center">{standing.goalsAgainst}</td>
                                                <td className="text-center">{diff > 0 ? '+' : ''}{diff}</td>
                                                <td className="text-center">{standing.home.wins}-{standing.home.losses}</td>
                                                <td className="text-center">{standing.away.wins}-{standing.away.losses}</td>
                                            </tr>
                                        );
                                    })}
                                </tbody>
                            </table>
                        </div>
                    );
                }
            };

            if (!gameState) {
                // Check if save exists
                const hasSave = localStorage.getItem('hockeyGmSave') !== null;
                
                // Generate team flavor text based on stats
                const getTeamFlavorText = (teamId) => {
                    // Generate temporary players to analyze team
                    const tempPlayers = [];
                    for (let i = 0; i < 23; i++) {
                        const position = i < 13 ? 'F' : (i < 19 ? 'D' : 'G');
                        tempPlayers.push(generatePlayer(position, teamId, 0, false));
                    }
                    
                    const avgOvr = Math.round(tempPlayers.reduce((sum, p) => sum + p.ratings.overall, 0) / tempPlayers.length);
                    const avgAge = Math.round(tempPlayers.reduce((sum, p) => sum + p.age, 0) / tempPlayers.length * 10) / 10;
                    
                    if (avgOvr >= 85) {
                        if (avgAge < 26) return "Young superteam. Championship expectations.";
                        else if (avgAge > 29) return "Veteran powerhouse. Win-now mode.";
                        else return "Elite contender. Cup favorites.";
                    } else if (avgOvr >= 80) {
                        if (avgAge < 26) return "Promising young core. Building toward contention.";
                        else if (avgAge > 29) return "Experienced playoff team. Final championship window.";
                        else return "Solid playoff contender. Dark horse candidate.";
                    } else if (avgOvr >= 75) {
                        if (avgAge < 26) return "Rebuilding with youth. Patience required.";
                        else if (avgAge > 29) return "Aging roster. Difficult rebuild ahead.";
                        else return "Bubble team. Compete or rebuild?";
                    } else {
                        if (avgAge < 26) return "Full rebuild. Focus on development and draft picks.";
                        else return "Bottom-feeder. Complete overhaul needed.";
                    }
                };
                
                // Calculate team preview stats
                const getTeamPreviewStats = (teamId) => {
                    const tempPlayers = [];
                    for (let i = 0; i < 23; i++) {
                        const position = i < 13 ? 'F' : (i < 19 ? 'D' : 'G');
                        tempPlayers.push(generatePlayer(position, teamId, 0, false));
                    }
                    
                    const avgOvr = Math.round(tempPlayers.reduce((sum, p) => sum + p.ratings.overall, 0) / tempPlayers.length);
                    const avgAge = Math.round(tempPlayers.reduce((sum, p) => sum + p.age, 0) / tempPlayers.length * 10) / 10;
                    const topPlayers = [...tempPlayers].sort((a, b) => b.ratings.overall - a.ratings.overall).slice(0, 5);
                    
                    return { avgOvr, avgAge, topPlayers, allPlayers: tempPlayers };
                };
                
                return (
                    <div className="container">
                        {/* Hero Section */}
                        <div style={{
                            textAlign: 'center',
                            marginBottom: '3rem',
                            padding: '2rem',
                            background: 'rgba(30, 58, 138, 0.3)',
                            borderRadius: '1rem',
                            border: '2px solid rgba(59, 130, 246, 0.3)'
                        }}>
                            <h1 style={{ marginBottom: '1rem' }}>HOCKEY GM SIMULATOR</h1>
                            
                            {/* Description */}
                            <p style={{
                                fontSize: '1.1rem',
                                color: '#e0e7ff',
                                maxWidth: '700px',
                                margin: '0 auto 1.5rem',
                                lineHeight: '1.6'
                            }}>
                                Manage a professional hockey team through complete seasons. Make trades, 
                                set lineups, and compete for the championship. Full league 
                                simulation with realistic stats and AI opponents.
                            </p>
                            
                            <p style={{
                                fontSize: '0.95rem',
                                color: '#93c5fd',
                                fontStyle: 'italic'
                            }}>
                                Free to play. No account needed. Start managing today.
                            </p>
                        </div>
                        
                        {/* Stats Dashboard */}
                        <div style={{
                            display: 'grid',
                            gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))',
                            gap: '1.5rem',
                            marginBottom: '3rem',
                            maxWidth: '900px',
                            margin: '0 auto 3rem'
                        }}>
                            <div style={{
                                textAlign: 'center',
                                padding: '1.5rem',
                                background: 'rgba(0, 0, 0, 0.3)',
                                borderRadius: '0.75rem',
                                border: '1px solid rgba(59, 130, 246, 0.2)'
                            }}>
                                <div style={{ fontSize: '2.5rem', fontWeight: 'bold', color: '#60a5fa', marginBottom: '0.5rem' }}>
                                    32
                                </div>
                                <div style={{ fontSize: '0.875rem', color: '#93c5fd', textTransform: 'uppercase', letterSpacing: '0.05em' }}>
                                    Teams
                                </div>
                            </div>
                            
                            <div style={{
                                textAlign: 'center',
                                padding: '1.5rem',
                                background: 'rgba(0, 0, 0, 0.3)',
                                borderRadius: '0.75rem',
                                border: '1px solid rgba(59, 130, 246, 0.2)'
                            }}>
                                <div style={{ fontSize: '2.5rem', fontWeight: 'bold', color: '#22c55e', marginBottom: '0.5rem' }}>
                                    1000+
                                </div>
                                <div style={{ fontSize: '0.875rem', color: '#93c5fd', textTransform: 'uppercase', letterSpacing: '0.05em' }}>
                                    Players
                                </div>
                            </div>
                            
                            <div style={{
                                textAlign: 'center',
                                padding: '1.5rem',
                                background: 'rgba(0, 0, 0, 0.3)',
                                borderRadius: '0.75rem',
                                border: '1px solid rgba(59, 130, 246, 0.2)'
                            }}>
                                <div style={{ fontSize: '2.5rem', fontWeight: 'bold', color: '#fbbf24', marginBottom: '0.5rem' }}>
                                    82
                                </div>
                                <div style={{ fontSize: '0.875rem', color: '#93c5fd', textTransform: 'uppercase', letterSpacing: '0.05em' }}>
                                    Games/Season
                                </div>
                            </div>
                            
                            <div style={{
                                textAlign: 'center',
                                padding: '1.5rem',
                                background: 'rgba(0, 0, 0, 0.3)',
                                borderRadius: '0.75rem',
                                border: '1px solid rgba(59, 130, 246, 0.2)'
                            }}>
                                <div style={{ fontSize: '2.5rem', fontWeight: 'bold', color: '#a78bfa', marginBottom: '0.5rem' }}>
                                    âˆž
                                </div>
                                <div style={{ fontSize: '0.875rem', color: '#93c5fd', textTransform: 'uppercase', letterSpacing: '0.05em' }}>
                                    Seasons
                                </div>
                            </div>
                        </div>
                        
                        {/* Continue Save Button */}
                        {hasSave && (
                            <div style={{ textAlign: 'center', marginBottom: '3rem' }}>
                                <button 
                                    onClick={() => {
                                        if (loadGameFromLocalStorage()) {
                                            console.log('Save loaded successfully');
                                        } else {
                                            alert('Failed to load save');
                                        }
                                    }}
                                    style={{
                                        padding: '1.25rem 3rem',
                                        fontSize: '1.2rem',
                                        fontWeight: 'bold',
                                        background: '#22c55e',
                                        color: '#fff',
                                        border: '2px solid #22c55e',
                                        borderRadius: '0.5rem',
                                        cursor: 'pointer',
                                        marginBottom: '1rem',
                                        transition: 'all 0.2s',
                                        boxShadow: '0 4px 6px rgba(0, 0, 0, 0.3)'
                                    }}
                                    onMouseOver={(e) => {
                                        e.target.style.background = '#16a34a';
                                        e.target.style.transform = 'translateY(-2px)';
                                        e.target.style.boxShadow = '0 6px 12px rgba(0, 0, 0, 0.4)';
                                    }}
                                    onMouseOut={(e) => {
                                        e.target.style.background = '#22c55e';
                                        e.target.style.transform = 'translateY(0)';
                                        e.target.style.boxShadow = '0 4px 6px rgba(0, 0, 0, 0.3)';
                                    }}
                                >
                                    â–¶ï¸ Continue Saved Game
                                </button>
                                <p style={{ color: '#93c5fd', fontSize: '0.875rem' }}>
                                    or start a new game below
                                </p>
                            </div>
                        )}
                        
                        {/* Select Team Header */}
                        <div style={{
                            textAlign: 'center',
                            marginBottom: '2rem'
                        }}>
                            <h2 style={{
                                fontSize: '1.75rem',
                                color: '#60a5fa',
                                marginBottom: '0.5rem'
                            }}>
                                Select Your Team
                            </h2>
                            <p style={{
                                color: '#93c5fd',
                                fontSize: '1rem'
                            }}>
                                Choose a franchise and begin your journey to the championship
                            </p>
                        </div>
                        
                        {/* Team Grid */}
                        <div className="grid" style={{
                            opacity: previewTeamId ? 0.3 : 1,
                            transition: 'opacity 0.3s ease',
                            pointerEvents: previewTeamId ? 'none' : 'auto'
                        }}>
                            {TEAMS.map(team => (
                                <button 
                                    key={team.id} 
                                    onClick={() => setPreviewTeamId(team.id)} 
                                    className="team-button"
                                >
                                    {team.city} {team.name}
                                </button>
                            ))}
                        </div>
                        
                        {/* Team Preview Slide-In Panel */}
                        {previewTeamId && (() => {
                            const team = TEAMS.find(t => t.id === previewTeamId);
                            const stats = getTeamPreviewStats(previewTeamId);
                            const flavorText = getTeamFlavorText(previewTeamId);
                            const currentIndex = TEAMS.findIndex(t => t.id === previewTeamId);
                            
                            return (
                                <div style={{
                                    position: 'fixed',
                                    top: 0,
                                    right: 0,
                                    width: '100%',
                                    maxWidth: '600px',
                                    height: '100vh',
                                    background: 'linear-gradient(135deg, #1e293b 0%, #1e3a8a 100%)',
                                    boxShadow: '-4px 0 20px rgba(0, 0, 0, 0.5)',
                                    zIndex: 1000,
                                    animation: 'slideInRight 0.3s ease-out',
                                    display: 'flex',
                                    flexDirection: 'column',
                                    overflow: 'auto'
                                }}>
                                    <style>
                                        {`
                                            @keyframes slideInRight {
                                                from {
                                                    transform: translateX(100%);
                                                }
                                                to {
                                                    transform: translateX(0);
                                                }
                                            }
                                            @media (max-width: 768px) {
                                                .team-preview-panel {
                                                    max-width: 100% !important;
                                                }
                                            }
                                        `}
                                    </style>
                                    
                                    {/* Close Button */}
                                    <button
                                        onClick={() => setPreviewTeamId(null)}
                                        style={{
                                            position: 'absolute',
                                            top: '1rem',
                                            right: '1rem',
                                            background: 'rgba(239, 68, 68, 0.2)',
                                            border: '2px solid #ef4444',
                                            color: '#ef4444',
                                            width: '40px',
                                            height: '40px',
                                            borderRadius: '50%',
                                            fontSize: '1.5rem',
                                            cursor: 'pointer',
                                            display: 'flex',
                                            alignItems: 'center',
                                            justifyContent: 'center',
                                            transition: 'all 0.2s',
                                            zIndex: 10
                                        }}
                                        onMouseOver={(e) => {
                                            e.target.style.background = '#ef4444';
                                            e.target.style.color = '#fff';
                                        }}
                                        onMouseOut={(e) => {
                                            e.target.style.background = 'rgba(239, 68, 68, 0.2)';
                                            e.target.style.color = '#ef4444';
                                        }}
                                    >
                                        âœ•
                                    </button>
                                    
                                    {/* Content */}
                                    <div style={{ padding: '2rem', flex: 1 }}>
                                        {/* Team Header */}
                                        <div style={{ marginBottom: '2rem', paddingTop: '2rem' }}>
                                            <h2 style={{
                                                fontSize: '2.5rem',
                                                background: 'linear-gradient(to right, #60a5fa, #22d3ee)',
                                                WebkitBackgroundClip: 'text',
                                                WebkitTextFillColor: 'transparent',
                                                backgroundClip: 'text',
                                                marginBottom: '0.5rem'
                                            }}>
                                                {team.city} {team.name}
                                            </h2>
                                            <div style={{ color: '#93c5fd', fontSize: '1rem' }}>
                                                {team.abbreviation} â€¢ {team.conference} Conference â€¢ {team.division} Division
                                            </div>
                                        </div>
                                        
                                        {/* Stats Cards */}
                                        <div style={{
                                            display: 'grid',
                                            gridTemplateColumns: 'repeat(2, 1fr)',
                                            gap: '1rem',
                                            marginBottom: '2rem'
                                        }}>
                                            <div style={{
                                                background: 'rgba(59, 130, 246, 0.2)',
                                                border: '2px solid #3b82f6',
                                                borderRadius: '0.75rem',
                                                padding: '1.5rem',
                                                textAlign: 'center'
                                            }}>
                                                <div style={{ fontSize: '0.875rem', color: '#93c5fd', marginBottom: '0.5rem' }}>
                                                    TEAM OVERALL
                                                </div>
                                                <div style={{ fontSize: '3rem', fontWeight: 'bold', color: '#60a5fa' }}>
                                                    {stats.avgOvr}
                                                </div>
                                            </div>
                                            
                                            <div style={{
                                                background: 'rgba(34, 197, 94, 0.2)',
                                                border: '2px solid #22c55e',
                                                borderRadius: '0.75rem',
                                                padding: '1.5rem',
                                                textAlign: 'center'
                                            }}>
                                                <div style={{ fontSize: '0.875rem', color: '#86efac', marginBottom: '0.5rem' }}>
                                                    AVERAGE AGE
                                                </div>
                                                <div style={{ fontSize: '3rem', fontWeight: 'bold', color: '#22c55e' }}>
                                                    {stats.avgAge}
                                                </div>
                                            </div>
                                        </div>
                                        
                                        {/* Flavor Text */}
                                        <div style={{
                                            background: 'rgba(251, 191, 36, 0.1)',
                                            border: '2px solid rgba(251, 191, 36, 0.3)',
                                            borderRadius: '0.75rem',
                                            padding: '1.5rem',
                                            marginBottom: '2rem',
                                            textAlign: 'center'
                                        }}>
                                            <div style={{ fontSize: '0.875rem', color: '#fbbf24', marginBottom: '0.5rem', textTransform: 'uppercase', letterSpacing: '0.05em' }}>
                                                TEAM OUTLOOK
                                            </div>
                                            <div style={{ fontSize: '1.1rem', color: '#fde68a', fontStyle: 'italic' }}>
                                                "{flavorText}"
                                            </div>
                                        </div>
                                        
                                        {/* Top Players */}
                                        <div style={{ marginBottom: '2rem' }}>
                                            <h3 style={{
                                                fontSize: '1.5rem',
                                                color: '#60a5fa',
                                                marginBottom: '1rem',
                                                textAlign: 'center'
                                            }}>
                                                Top 5 Players
                                            </h3>
                                            
                                            <div style={{ display: 'flex', flexDirection: 'column', gap: '0.75rem' }}>
                                                {stats.topPlayers.map((player, idx) => (
                                                    <div key={idx} style={{
                                                        background: 'rgba(0, 0, 0, 0.3)',
                                                        border: '1px solid rgba(59, 130, 246, 0.3)',
                                                        borderRadius: '0.5rem',
                                                        padding: '1rem',
                                                        display: 'flex',
                                                        justifyContent: 'space-between',
                                                        alignItems: 'center'
                                                    }}>
                                                        <div style={{ display: 'flex', alignItems: 'center', gap: '1rem' }}>
                                                            <div style={{
                                                                width: '32px',
                                                                height: '32px',
                                                                borderRadius: '50%',
                                                                background: 'linear-gradient(135deg, #3b82f6, #22d3ee)',
                                                                display: 'flex',
                                                                alignItems: 'center',
                                                                justifyContent: 'center',
                                                                fontWeight: 'bold',
                                                                fontSize: '1.1rem'
                                                            }}>
                                                                {idx + 1}
                                                            </div>
                                                            <div>
                                                                <div style={{ fontWeight: 'bold', fontSize: '1.1rem' }}>
                                                                    {player.firstName} {player.lastName}
                                                                </div>
                                                                <div style={{ fontSize: '0.875rem', color: '#93c5fd' }}>
                                                                    {player.preferredPosition || player.position} â€¢ Age {player.age}
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div style={{
                                                            fontSize: '1.5rem',
                                                            fontWeight: 'bold',
                                                            color: player.ratings.overall >= 85 ? '#22c55e' : 
                                                                   player.ratings.overall >= 80 ? '#60a5fa' : 
                                                                   player.ratings.overall >= 75 ? '#fbbf24' : '#94a3b8'
                                                        }}>
                                                            {player.ratings.overall}
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                    
                                    {/* Bottom Actions */}
                                    <div style={{
                                        padding: '2rem',
                                        background: 'rgba(0, 0, 0, 0.3)',
                                        borderTop: '2px solid rgba(59, 130, 246, 0.3)'
                                    }}>
                                        {/* Navigation Arrows */}
                                        <div style={{
                                            display: 'flex',
                                            justifyContent: 'space-between',
                                            marginBottom: '1.5rem'
                                        }}>
                                            <button
                                                onClick={() => {
                                                    const prevIndex = currentIndex > 0 ? currentIndex - 1 : TEAMS.length - 1;
                                                    setPreviewTeamId(TEAMS[prevIndex].id);
                                                }}
                                                style={{
                                                    padding: '0.75rem 1.5rem',
                                                    background: 'rgba(59, 130, 246, 0.2)',
                                                    border: '2px solid #3b82f6',
                                                    color: '#60a5fa',
                                                    borderRadius: '0.5rem',
                                                    cursor: 'pointer',
                                                    fontWeight: 'bold',
                                                    fontSize: '1rem',
                                                    transition: 'all 0.2s'
                                                }}
                                                onMouseOver={(e) => {
                                                    e.target.style.background = '#3b82f6';
                                                    e.target.style.color = '#fff';
                                                }}
                                                onMouseOut={(e) => {
                                                    e.target.style.background = 'rgba(59, 130, 246, 0.2)';
                                                    e.target.style.color = '#60a5fa';
                                                }}
                                            >
                                                â—„ Previous Team
                                            </button>
                                            
                                            <button
                                                onClick={() => {
                                                    const nextIndex = currentIndex < TEAMS.length - 1 ? currentIndex + 1 : 0;
                                                    setPreviewTeamId(TEAMS[nextIndex].id);
                                                }}
                                                style={{
                                                    padding: '0.75rem 1.5rem',
                                                    background: 'rgba(59, 130, 246, 0.2)',
                                                    border: '2px solid #3b82f6',
                                                    color: '#60a5fa',
                                                    borderRadius: '0.5rem',
                                                    cursor: 'pointer',
                                                    fontWeight: 'bold',
                                                    fontSize: '1rem',
                                                    transition: 'all 0.2s'
                                                }}
                                                onMouseOver={(e) => {
                                                    e.target.style.background = '#3b82f6';
                                                    e.target.style.color = '#fff';
                                                }}
                                                onMouseOut={(e) => {
                                                    e.target.style.background = 'rgba(59, 130, 246, 0.2)';
                                                    e.target.style.color = '#60a5fa';
                                                }}
                                            >
                                                Next Team â–º
                                            </button>
                                        </div>
                                        
                                        {/* Confirm Button */}
                                        <button
                                            onClick={() => {
                                                setPreviewTeamId(null);
                                                initGame(team.id);
                                            }}
                                            style={{
                                                width: '100%',
                                                padding: '1.5rem',
                                                fontSize: '1.3rem',
                                                fontWeight: 'bold',
                                                background: '#22c55e',
                                                color: '#fff',
                                                border: '3px solid #22c55e',
                                                borderRadius: '0.75rem',
                                                cursor: 'pointer',
                                                transition: 'all 0.2s',
                                                boxShadow: '0 4px 12px rgba(34, 197, 94, 0.3)'
                                            }}
                                            onMouseOver={(e) => {
                                                e.target.style.background = '#16a34a';
                                                e.target.style.transform = 'translateY(-2px)';
                                                e.target.style.boxShadow = '0 8px 20px rgba(34, 197, 94, 0.4)';
                                            }}
                                            onMouseOut={(e) => {
                                                e.target.style.background = '#22c55e';
                                                e.target.style.transform = 'translateY(0)';
                                                e.target.style.boxShadow = '0 4px 12px rgba(34, 197, 94, 0.3)';
                                            }}
                                        >
                                            ðŸ’ START WITH {team.city.toUpperCase()} {team.name.toUpperCase()}
                                        </button>
                                    </div>
                                </div>
                            );
                        })()}
                    </div>
                );
            }

            const userTeam = getTeam(userTeamId);
            const userStanding = gameState.standings.find(s => s.teamId === userTeamId);
            // userRoster already declared with useMemo above
            const gamesPlayed = userStanding.wins + userStanding.losses + userStanding.otLosses;
            
            // Calculate league-wide games played
            // Check if season is complete (all 82 days simulated)
            const seasonComplete = gameState.currentDay > 82;
            
            // Calculate games played per team
            const teamGameCounts = {};
            TEAMS.forEach(t => teamGameCounts[t.id] = 0);
            gameState.schedule.forEach(day => {
                if (day.matchups) {
                    day.matchups.forEach(m => {
                        if (m.played) {
                            teamGameCounts[m.homeTeam]++;
                            teamGameCounts[m.awayTeam]++;
                        }
                    });
                }
            });
            const allGameCounts = Object.values(teamGameCounts);
            const minGamesPlayed = Math.min(...allGameCounts);
            const maxGamesPlayed = Math.max(...allGameCounts);
            const avgGamesPlayed = Math.round(allGameCounts.reduce((a, b) => a + b, 0) / allGameCounts.length);
            
            // Trade deadline is Day 55 (2/3 through 82-day season)
            const tradeDeadlineDay = 55;
            const isTradeDeadlinePassed = gameState.currentDay > tradeDeadlineDay;
            
            // All-Star break is Day 41 (mid-season)
            const allStarBreakDay = 41;

            return (
                <div>
                    <div className="header">
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start' }}>
                            <div>
                                <h1>HOCKEY GM SIMULATOR</h1>
                                <p className="header-info">Managing: {userTeam.city} {userTeam.name} | Season {gameState.season} ({gameState.year}) | Day {gameState.currentDay} of 82</p>
                                <p className="header-info">
                                    Record: {userStanding.wins}-{userStanding.losses}-{userStanding.otLosses} ({userStanding.points} pts) | 
                                    Games: {gamesPlayed}/82 | 
                                    Home: {userStanding.home.wins}-{userStanding.home.losses} | 
                                    Away: {userStanding.away.wins}-{userStanding.away.losses} | 
                                    Goal Diff: {userStanding.goalsFor - userStanding.goalsAgainst > 0 ? '+' : ''}{userStanding.goalsFor - userStanding.goalsAgainst}
                                </p>
                                <p className="header-info" style={{ color: gameState.currentDay > 82 ? '#22c55e' : '#93c5fd' }}>
                                    Season Progress: Day {gameState.currentDay} of 82
                                    {gameState.currentDay > 82 && ' âœ“ COMPLETE'}
                                </p>
                            </div>
                            <div style={{ display: 'flex', gap: '0.5rem', flexDirection: 'column', alignItems: 'flex-end' }}>
                                <button 
                                    onClick={() => setCurrentView('roadmap')}
                                    className="action-button"
                                    style={{ 
                                        background: currentView === 'roadmap' ? '#22d3ee' : '#1e40af',
                                        padding: '0.5rem 1rem',
                                        fontSize: '0.875rem',
                                        whiteSpace: 'nowrap'
                                    }}
                                >
                                    ðŸš€ Future Roadmap
                                </button>
                                <div style={{ display: 'flex', gap: '0.5rem' }}>
                                    <button 
                                        onClick={() => {
                                            if (gameState && userTeamId) {
                                                saveGameToLocalStorage(gameState, userTeamId, playoffState, seasonMode);
                                                alert('âœ… Game saved!');
                                            }
                                        }}
                                        className="action-button"
                                        style={{ 
                                            background: '#22c55e',
                                            padding: '0.4rem 0.8rem',
                                            fontSize: '0.75rem'
                                        }}
                                        disabled={!gameState}
                                    >
                                        ðŸ’¾ Save
                                    </button>
                                    <button 
                                        onClick={() => {
                                            if (loadGameFromLocalStorage()) {
                                                alert('âœ… Game loaded!');
                                            } else {
                                                alert('âŒ No save found');
                                            }
                                        }}
                                        className="action-button"
                                        style={{ 
                                            background: '#3b82f6',
                                            padding: '0.4rem 0.8rem',
                                            fontSize: '0.75rem'
                                        }}
                                    >
                                        ðŸ“ Load
                                    </button>
                                    <button 
                                        onClick={deleteSave}
                                        className="action-button"
                                        style={{ 
                                            background: '#ef4444',
                                            padding: '0.4rem 0.8rem',
                                            fontSize: '0.75rem'
                                        }}
                                    >
                                        ðŸ—‘ï¸ Delete
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Season Mode Toggle - Regular Season vs Playoffs */}
                    <div style={{ 
                        background: 'rgba(30, 58, 138, 0.3)', 
                        padding: '0.75rem 2rem',
                        display: 'flex',
                        gap: '1rem',
                        justifyContent: 'center',
                        borderBottom: '2px solid rgba(59, 130, 246, 0.3)'
                    }}>
                        <button
                            onClick={() => setSeasonMode('regular')}
                            style={{
                                padding: '0.5rem 2rem',
                                background: seasonMode === 'regular' ? '#3b82f6' : 'transparent',
                                border: seasonMode === 'regular' ? '2px solid #3b82f6' : '1px solid rgba(100, 116, 139, 0.5)',
                                borderRadius: '0.5rem',
                                color: '#fff',
                                cursor: 'pointer',
                                fontWeight: 'bold',
                                fontSize: '1rem',
                                transition: 'all 0.2s'
                            }}
                        >
                            ðŸ“Š Regular Season
                        </button>
                        <button
                            onClick={() => setSeasonMode('playoffs')}
                            style={{
                                padding: '0.5rem 2rem',
                                background: seasonMode === 'playoffs' ? '#f59e0b' : 'transparent',
                                border: seasonMode === 'playoffs' ? '2px solid #f59e0b' : '1px solid rgba(100, 116, 139, 0.5)',
                                borderRadius: '0.5rem',
                                color: '#fff',
                                cursor: 'pointer',
                                fontWeight: 'bold',
                                fontSize: '1rem',
                                transition: 'all 0.2s',
                                opacity: playoffState ? 1 : 0.5
                            }}
                            disabled={!playoffState}
                        >
                            ðŸ† Playoffs
                        </button>
                    </div>

                    <div className="nav">
                        <div className="nav-content">
                            {/* Dashboard */}
                            <button
                                onClick={() => setCurrentView('standings')}
                                className={`nav-button ${currentView === 'standings' ? 'active' : ''}`}
                            >
                                ðŸ“Š Dashboard
                            </button>

                            {/* Roster Management Dropdown */}
                            <div className="nav-group">
                                <button className={`nav-button has-dropdown ${['roster', 'lines', 'trade', 'injuries', 'freeagents'].includes(currentView) ? 'active' : ''}`}>
                                    ðŸ’ Roster Management
                                </button>
                                <div className="nav-dropdown">
                                    <button
                                        onClick={() => setCurrentView('roster')}
                                        className={`nav-dropdown-item ${currentView === 'roster' ? 'active' : ''}`}
                                    >
                                        Roster
                                    </button>
                                    <button
                                        onClick={() => setCurrentView('lines')}
                                        className={`nav-dropdown-item ${currentView === 'lines' ? 'active' : ''}`}
                                    >
                                        ðŸ“‹ Lines & Scratches
                                    </button>
                                    <button
                                        onClick={() => setCurrentView('callups')}
                                        className={`nav-dropdown-item ${currentView === 'callups' ? 'active' : ''}`}
                                    >
                                        ðŸ”„ Call-Ups / Send-Downs
                                    </button>
                                    <button
                                        onClick={() => setCurrentView('trade')}
                                        className={`nav-dropdown-item ${currentView === 'trade' ? 'active' : ''}`}
                                    >
                                        Trades
                                    </button>
                                    <button
                                        onClick={() => setCurrentView('injuries')}
                                        className={`nav-dropdown-item ${currentView === 'injuries' ? 'active' : ''}`}
                                    >
                                        Injuries
                                    </button>
                                    <button
                                        className="nav-dropdown-item disabled"
                                    >
                                        Free Agents
                                    </button>
                                </div>
                            </div>

                            {/* Stats Dropdown */}
                            <div className="nav-group">
                                <button className={`nav-button has-dropdown ${['stats', 'leaders', 'playerProfile', 'teamProfile'].includes(currentView) ? 'active' : ''}`}>
                                    ðŸ“ˆ Stats
                                </button>
                                <div className="nav-dropdown">
                                    <button
                                        onClick={() => setCurrentView('stats')}
                                        className={`nav-dropdown-item ${currentView === 'stats' ? 'active' : ''}`}
                                    >
                                        Player Stats
                                    </button>
                                    <button
                                        onClick={() => setCurrentView('teamProfile')}
                                        className={`nav-dropdown-item ${currentView === 'teamProfile' ? 'active' : ''}`}
                                    >
                                        Team Roster
                                    </button>
                                    <button
                                        onClick={() => setCurrentView('teamStats')}
                                        className={`nav-dropdown-item ${currentView === 'teamStats' ? 'active' : ''}`}
                                    >
                                        Team Stats
                                    </button>
                                    <button
                                        onClick={() => setCurrentView('teamHistory')}
                                        className={`nav-dropdown-item ${currentView === 'teamHistory' ? 'active' : ''}`}
                                    >
                                        Team History
                                    </button>
                                    <button
                                        onClick={() => setCurrentView('leaders')}
                                        className={`nav-dropdown-item ${currentView === 'leaders' ? 'active' : ''}`}
                                    >
                                        League Leaders
                                    </button>
                                </div>
                            </div>

                            {/* Season Dropdown */}
                            <div className="nav-group">
                                <button className={`nav-button has-dropdown ${['calendar', 'awards'].includes(currentView) ? 'active' : ''}`}>
                                    ðŸ“… Season
                                </button>
                                <div className="nav-dropdown">
                                    <button
                                        onClick={() => setCurrentView('standings')}
                                        className={`nav-dropdown-item ${currentView === 'standings' ? 'active' : ''}`}
                                    >
                                        Standings
                                    </button>
                                    <button
                                        onClick={() => setCurrentView('calendar')}
                                        className={`nav-dropdown-item ${currentView === 'calendar' ? 'active' : ''}`}
                                    >
                                        Calendar
                                    </button>
                                    {seasonAwards && (
                                        <button
                                            onClick={() => setCurrentView('awards')}
                                            className={`nav-dropdown-item ${currentView === 'awards' ? 'active' : ''}`}
                                        >
                                            ðŸ† Awards
                                        </button>
                                    )}
                                </div>
                            </div>

                            {/* League Dropdown */}
                            <div className="nav-group">
                                <button className={`nav-button has-dropdown ${['transactions', 'keyDates'].includes(currentView) ? 'active' : ''}`}>
                                    ðŸŒ League
                                </button>
                                <div className="nav-dropdown">
                                    <button
                                        onClick={() => setCurrentView('keyDates')}
                                        className={`nav-dropdown-item ${currentView === 'keyDates' ? 'active' : ''}`}
                                    >
                                        ðŸ“… Key Dates
                                    </button>
                                    <button
                                        onClick={() => setCurrentView('transactions')}
                                        className={`nav-dropdown-item ${currentView === 'transactions' ? 'active' : ''}`}
                                    >
                                        ðŸ“‹ Transactions
                                    </button>
                                </div>
                            </div>

                            {/* Playoffs Dropdown */}
                            {(seasonComplete || playoffState) && (
                                <div className="nav-group">
                                    <button className={`nav-button has-dropdown ${['bracket', 'playoffGames'].includes(currentView) ? 'active' : ''}`}>
                                        ðŸ† Playoffs
                                    </button>
                                    <div className="nav-dropdown">
                                        <button
                                            onClick={() => setCurrentView('bracket')}
                                            className={`nav-dropdown-item ${currentView === 'bracket' ? 'active' : ''}`}
                                        >
                                            Bracket
                                        </button>
                                        <button
                                            onClick={() => setCurrentView('playoffGames')}
                                            className={`nav-dropdown-item ${currentView === 'playoffGames' ? 'active' : ''}`}
                                        >
                                            Games
                                        </button>
                                    </div>
                                </div>
                            )}

                            {/* Settings Dropdown */}
                            <div className="nav-group">
                                <button className={`nav-button has-dropdown ${['roadmap'].includes(currentView) ? 'active' : ''}`}>
                                    âš™ï¸ Settings
                                </button>
                                <div className="nav-dropdown">
                                    <button
                                        onClick={() => setCurrentView('roadmap')}
                                        className={`nav-dropdown-item ${currentView === 'roadmap' ? 'active' : ''}`}
                                    >
                                        Roadmap
                                    </button>
                                    <button
                                        onClick={() => setCurrentView('help')}
                                        className={`nav-dropdown-item ${currentView === 'help' ? 'active' : ''}`}
                                    >
                                        ðŸ“– Help & Manual
                                    </button>
                                    <button
                                        onClick={saveGameToLocalStorage}
                                        className="nav-dropdown-item"
                                    >
                                        ðŸ’¾ Save Game
                                    </button>
                                    <button
                                        onClick={deleteSave}
                                        className="nav-dropdown-item"
                                        style={{ color: '#ef4444' }}
                                    >
                                        ðŸ—‘ï¸ Delete Save
                                    </button>
                                </div>
                            </div>

                            {/* Action Buttons */}
                            <div style={{ marginLeft: 'auto', display: 'flex', gap: '0.5rem', alignItems: 'center' }}>
                                {/* Regular Season Sim Dropdown */}
                                {!seasonComplete && (
                                    <div className="nav-group">
                                        <button className="action-button has-dropdown" style={{ display: 'flex', alignItems: 'center', gap: '0.25rem' }}>
                                            âš¡ Simulate
                                        </button>
                                        <div className="nav-dropdown" style={{ right: 0, left: 'auto' }}>
                                            <button 
                                                onClick={simulateDay82}
                                                className="nav-dropdown-item"
                                            >
                                                1 Day (1 Game)
                                            </button>
                                            <button 
                                                onClick={simulate7Games}
                                                className="nav-dropdown-item"
                                            >
                                                7 Games
                                            </button>
                                            <button 
                                                onClick={simulate30Games}
                                                className="nav-dropdown-item"
                                            >
                                                30 Games
                                            </button>
                                            <button 
                                                onClick={simulateSeason82}
                                                className="nav-dropdown-item"
                                            >
                                                Full Season
                                            </button>
                                        </div>
                                    </div>
                                )}
                                
                                {seasonComplete && !playoffState && (
                                    <button 
                                        onClick={startPlayoffs} 
                                        className="action-button"
                                        style={{ background: '#f59e0b', fontWeight: 'bold' }}
                                    >
                                        ðŸ† Start Playoffs
                                    </button>
                                )}
                                
                                {/* Playoff Sim Dropdown */}
                                {playoffState && !playoffState.completed && (
                                    <div className="nav-group">
                                        <button className="action-button has-dropdown" style={{ display: 'flex', alignItems: 'center', gap: '0.25rem', background: '#f59e0b', fontWeight: 'bold' }}>
                                            ðŸ† Simulate Playoffs
                                        </button>
                                        <div className="nav-dropdown" style={{ right: 0, left: 'auto' }}>
                                            <button 
                                                onClick={simulateOnePlayoffDay} 
                                                className="nav-dropdown-item"
                                            >
                                                1 Day
                                            </button>
                                            <button 
                                                onClick={simulatePlayoffSeries} 
                                                className="nav-dropdown-item"
                                            >
                                                1 Round
                                            </button>
                                            <button 
                                                onClick={simulateAllPlayoffs} 
                                                className="nav-dropdown-item"
                                            >
                                                All Rounds
                                            </button>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>

                    <div className="content">
                        {/* NEW: Mid-Season Report Card */}
                        {gameState?.midSeasonReport && (
                            <div className="card" style={{ 
                                background: 'linear-gradient(135deg, rgba(251, 191, 36, 0.2), rgba(245, 158, 11, 0.1))',
                                border: '2px solid #f59e0b',
                                marginBottom: '2rem'
                            }}>
                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1rem' }}>
                                    <h2 style={{ color: '#fbbf24', margin: 0 }}>ðŸ“Š Mid-Season Report Card</h2>
                                    <button
                                        onClick={() => {
                                            setGameState(prevState => ({
                                                ...prevState,
                                                midSeasonReport: null
                                            }));
                                        }}
                                        style={{
                                            padding: '0.25rem 0.75rem',
                                            background: '#ef4444',
                                            color: '#fff',
                                            border: 'none',
                                            borderRadius: '0.375rem',
                                            cursor: 'pointer',
                                            fontSize: '0.875rem'
                                        }}
                                    >
                                        Dismiss
                                    </button>
                                </div>
                                
                                <p style={{ color: '#93c5fd', fontSize: '1.1rem', marginBottom: '1.5rem' }}>
                                    All-Star Break â€¢ {gameState.midSeasonReport.gamesPlayed} Games Played
                                </p>
                                
                                {/* Performance Summary */}
                                <div style={{ 
                                    display: 'grid', 
                                    gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))',
                                    gap: '1rem',
                                    marginBottom: '2rem'
                                }}>
                                    <div style={{ 
                                        padding: '1rem', 
                                        background: gameState.midSeasonReport.performance === 'exceeding' ? 'rgba(34, 197, 94, 0.2)' : 
                                                   gameState.midSeasonReport.performance === 'underperforming' ? 'rgba(239, 68, 68, 0.2)' : 
                                                   'rgba(59, 130, 246, 0.2)',
                                        borderRadius: '0.5rem',
                                        border: `2px solid ${gameState.midSeasonReport.performance === 'exceeding' ? '#22c55e' : 
                                                            gameState.midSeasonReport.performance === 'underperforming' ? '#ef4444' : 
                                                            '#3b82f6'}`
                                    }}>
                                        <div style={{ fontSize: '0.875rem', color: '#93c5fd', marginBottom: '0.5rem' }}>RECORD</div>
                                        <div style={{ fontSize: '1.5rem', fontWeight: 'bold', marginBottom: '0.25rem' }}>
                                            {gameState.midSeasonReport.record}
                                        </div>
                                        <div style={{ fontSize: '0.875rem', color: '#93c5fd' }}>
                                            Expected: {gameState.midSeasonReport.expected}
                                        </div>
                                    </div>
                                    
                                    <div style={{ padding: '1rem', background: 'rgba(139, 92, 246, 0.2)', borderRadius: '0.5rem', border: '2px solid #8b5cf6' }}>
                                        <div style={{ fontSize: '0.875rem', color: '#93c5fd', marginBottom: '0.5rem' }}>PERFORMANCE</div>
                                        <div style={{ fontSize: '1.2rem', fontWeight: 'bold', color: gameState.midSeasonReport.performance === 'exceeding' ? '#22c55e' : 
                                                                                                                    gameState.midSeasonReport.performance === 'underperforming' ? '#ef4444' : 
                                                                                                                    '#3b82f6' }}>
                                            {gameState.midSeasonReport.performance === 'exceeding' ? 'ðŸ”¥ EXCEEDING' : 
                                             gameState.midSeasonReport.performance === 'underperforming' ? 'âš ï¸ BELOW' : 
                                             'âœ… ON PACE'}
                                        </div>
                                        <div style={{ fontSize: '0.875rem', color: '#93c5fd', marginTop: '0.25rem' }}>
                                            {gameState.midSeasonReport.performanceText}
                                        </div>
                                    </div>
                                    
                                    <div style={{ padding: '1rem', background: 'rgba(34, 211, 238, 0.2)', borderRadius: '0.5rem', border: '2px solid #22d3ee' }}>
                                        <div style={{ fontSize: '0.875rem', color: '#93c5fd', marginBottom: '0.5rem' }}>PLAYOFF ODDS</div>
                                        <div style={{ fontSize: '1.5rem', fontWeight: 'bold', marginBottom: '0.25rem' }}>
                                            {gameState.midSeasonReport.playoffOdds}%
                                        </div>
                                        <div style={{ fontSize: '0.875rem', color: '#93c5fd' }}>
                                            Current Rank: #{gameState.midSeasonReport.currentRank}
                                        </div>
                                    </div>
                                    
                                    <div style={{ padding: '1rem', background: 'rgba(236, 72, 153, 0.2)', borderRadius: '0.5rem', border: '2px solid #ec4899' }}>
                                        <div style={{ fontSize: '0.875rem', color: '#93c5fd', marginBottom: '0.5rem' }}>PROJECTED FINISH</div>
                                        <div style={{ fontSize: '1.5rem', fontWeight: 'bold', marginBottom: '0.25rem' }}>
                                            {gameState.midSeasonReport.projectedPoints} pts
                                        </div>
                                        <div style={{ fontSize: '0.875rem', color: '#93c5fd' }}>
                                            Goal Diff: {gameState.midSeasonReport.goalDiff > 0 ? '+' : ''}{gameState.midSeasonReport.goalDiff}
                                        </div>
                                    </div>
                                </div>
                                
                                {/* Strengths & Concerns */}
                                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1.5rem' }}>
                                    <div>
                                        <h3 style={{ color: '#22c55e', marginBottom: '1rem' }}>âœ… Strengths</h3>
                                        {gameState.midSeasonReport.strengths.length > 0 ? (
                                            <div style={{ display: 'flex', flexDirection: 'column', gap: '0.75rem' }}>
                                                {gameState.midSeasonReport.strengths.map((strength, idx) => (
                                                    <div key={idx} style={{ 
                                                        padding: '0.75rem', 
                                                        background: 'rgba(34, 197, 94, 0.1)', 
                                                        borderRadius: '0.375rem',
                                                        borderLeft: '3px solid #22c55e'
                                                    }}>
                                                        <div style={{ fontWeight: 'bold', marginBottom: '0.25rem' }}>{strength.stat}</div>
                                                        <div style={{ fontSize: '0.875rem', color: '#93c5fd' }}>{strength.value} â€¢ {strength.rank}</div>
                                                    </div>
                                                ))}
                                            </div>
                                        ) : (
                                            <div style={{ color: '#93c5fd', fontStyle: 'italic' }}>No standout strengths identified</div>
                                        )}
                                    </div>
                                    
                                    <div>
                                        <h3 style={{ color: '#f59e0b', marginBottom: '1rem' }}>âš ï¸ Concerns</h3>
                                        {gameState.midSeasonReport.concerns.length > 0 ? (
                                            <div style={{ display: 'flex', flexDirection: 'column', gap: '0.75rem' }}>
                                                {gameState.midSeasonReport.concerns.map((concern, idx) => (
                                                    <div key={idx} style={{ 
                                                        padding: '0.75rem', 
                                                        background: 'rgba(245, 158, 11, 0.1)', 
                                                        borderRadius: '0.375rem',
                                                        borderLeft: '3px solid #f59e0b'
                                                    }}>
                                                        <div style={{ fontWeight: 'bold', marginBottom: '0.25rem' }}>{concern.stat}</div>
                                                        <div style={{ fontSize: '0.875rem', color: '#93c5fd', marginBottom: '0.25rem' }}>{concern.value}</div>
                                                        <div style={{ fontSize: '0.75rem', color: '#fde68a', fontStyle: 'italic' }}>ðŸ’¡ {concern.suggestion}</div>
                                                    </div>
                                                ))}
                                            </div>
                                        ) : (
                                            <div style={{ color: '#93c5fd', fontStyle: 'italic' }}>No major concerns - keep it up!</div>
                                        )}
                                    </div>
                                </div>
                            </div>
                        )}
                        
                        {currentView === 'keyDates' && gameState && (
                            <div className="card">
                                <h2 style={{ marginBottom: '1.5rem', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
                                    ðŸ“… Key Days - Season {gameState.season} ({gameState.year})
                                </h2>
                                <div style={{
                                    display: 'grid',
                                    gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))',
                                    gap: '1rem'
                                }}>
                                    {/* Season Start */}
                                    <div style={{
                                        padding: '1rem',
                                        background: 'rgba(59, 130, 246, 0.1)',
                                        borderRadius: '0.5rem',
                                        border: '1px solid rgba(59, 130, 246, 0.3)'
                                    }}>
                                        <div style={{ fontSize: '0.875rem', color: '#93c5fd', marginBottom: '0.25rem' }}>
                                            SEASON START
                                        </div>
                                        <div style={{ fontSize: '1.25rem', fontWeight: 'bold' }}>
                                            Day 1
                                        </div>
                                    </div>
                                    
                                    {/* All-Star Break */}
                                    <div style={{
                                        padding: '1rem',
                                        background: 'rgba(251, 191, 36, 0.1)',
                                        borderRadius: '0.5rem',
                                        border: '1px solid rgba(251, 191, 36, 0.3)'
                                    }}>
                                        <div style={{ fontSize: '0.875rem', color: '#fde68a', marginBottom: '0.25rem' }}>
                                            ALL-STAR BREAK
                                        </div>
                                        <div style={{ fontSize: '1.25rem', fontWeight: 'bold', color: '#fbbf24' }}>
                                            Day {allStarBreakDay}
                                        </div>
                                    </div>
                                    
                                    {/* Trade Deadline */}
                                    <div style={{
                                        padding: '1rem',
                                        background: isTradeDeadlinePassed ? 'rgba(239, 68, 68, 0.1)' : 'rgba(34, 197, 94, 0.1)',
                                        borderRadius: '0.5rem',
                                        border: `1px solid ${isTradeDeadlinePassed ? 'rgba(239, 68, 68, 0.3)' : 'rgba(34, 197, 94, 0.3)'}`
                                    }}>
                                        <div style={{ 
                                            fontSize: '0.875rem', 
                                            color: isTradeDeadlinePassed ? '#fca5a5' : '#86efac', 
                                            marginBottom: '0.25rem' 
                                        }}>
                                            TRADE DEADLINE
                                        </div>
                                        <div style={{ 
                                            fontSize: '1.25rem', 
                                            fontWeight: 'bold',
                                            color: isTradeDeadlinePassed ? '#ef4444' : '#22c55e'
                                        }}>
                                            Day {tradeDeadlineDay}
                                            {isTradeDeadlinePassed && (
                                                <span style={{ fontSize: '0.875rem', marginLeft: '0.5rem', color: '#ef4444' }}>
                                                    PASSED
                                                </span>
                                            )}
                                        </div>
                                    </div>
                                    
                                    {/* Regular Season End */}
                                    <div style={{
                                        padding: '1rem',
                                        background: 'rgba(139, 92, 246, 0.1)',
                                        borderRadius: '0.5rem',
                                        border: '1px solid rgba(139, 92, 246, 0.3)'
                                    }}>
                                        <div style={{ fontSize: '0.875rem', color: '#c4b5fd', marginBottom: '0.25rem' }}>
                                            REGULAR SEASON END
                                        </div>
                                        <div style={{ fontSize: '1.25rem', fontWeight: 'bold', color: '#a78bfa' }}>
                                            Day 82
                                        </div>
                                    </div>
                                    
                                    {/* Playoffs */}
                                    <div style={{
                                        padding: '1rem',
                                        background: 'rgba(236, 72, 153, 0.1)',
                                        borderRadius: '0.5rem',
                                        border: '1px solid rgba(236, 72, 153, 0.3)'
                                    }}>
                                        <div style={{ fontSize: '0.875rem', color: '#fbcfe8', marginBottom: '0.25rem' }}>
                                            PLAYOFFS
                                        </div>
                                        <div style={{ fontSize: '1.25rem', fontWeight: 'bold', color: '#ec4899' }}>
                                            After Day 82
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                        
                        {currentView === 'standings' && gameState && (
                            <div>
                                <div className="standings-nav">
                                    {['division', 'conference', 'wildcard', 'league'].map(view => (
                                        <button
                                            key={view}
                                            onClick={() => setStandingsView(view)}
                                            className={standingsView === view ? 'active' : ''}
                                        >
                                            {view === 'wildcard' ? 'Wild Card' : view.charAt(0).toUpperCase() + view.slice(1)}
                                        </button>
                                    ))}
                                </div>
                                {renderStandings()}
                            </div>
                        )}

                        {currentView === 'roster' && gameState && (() => {
                            const teamOverallData = getTeamOverall(userTeamId);
                            const ovr = teamOverallData?.overall || 0;
                            const rank = teamOverallData?.rank || NUM_TEAMS;
                            
                            // Color based on league rank
                            let ovrColor = '#fff';
                            if (rank <= 5) ovrColor = '#4ade80';      // Top 5: Green
                            else if (rank <= 10) ovrColor = '#60a5fa'; // Top 10: Blue
                            else if (rank <= 20) ovrColor = '#fbbf24'; // Middle: Yellow
                            else ovrColor = '#f87171';                 // Bottom: Red
                            
                            return (
                            <>
                            {/* NEW: Player Development Tracker */}
                            {gameState.playerDevelopment && Object.keys(gameState.playerDevelopment).length > 0 && (
                                <div className="card" style={{ marginBottom: '2rem' }}>
                                    <h2 style={{ color: '#22c55e', marginBottom: '1rem' }}>ðŸŒŸ Player Development Tracker</h2>
                                    <p style={{ color: '#93c5fd', marginBottom: '1.5rem' }}>
                                        Tracking young players (age â‰¤ 25) throughout the season
                                    </p>
                                    
                                    {(() => {
                                        // Get developing players with changes
                                        const developingPlayers = Object.entries(gameState.playerDevelopment)
                                            .map(([playerId, dev]) => {
                                                const player = gameState.players.find(p => p.id === parseInt(playerId));
                                                return player ? { player, dev } : null;
                                            })
                                            .filter(item => item !== null && item.player.teamId === userTeamId)
                                            .sort((a, b) => Math.abs(b.dev.growth) - Math.abs(a.dev.growth));
                                        
                                        if (developingPlayers.length === 0) {
                                            return (
                                                <div style={{ color: '#93c5fd', fontStyle: 'italic' }}>
                                                    No young players (age â‰¤ 25) on your roster
                                                </div>
                                            );
                                        }
                                        
                                        return (
                                            <div style={{ display: 'grid', gap: '0.75rem' }}>
                                                {developingPlayers.map(({ player, dev }) => {
                                                    const growthText = dev.growth > 0 ? `+${dev.growth}` : dev.growth < 0 ? `${dev.growth}` : 'Â±0';
                                                    const growthColor = dev.growth > 0 ? '#22c55e' : dev.growth < 0 ? '#ef4444' : '#94a3b8';
                                                    
                                                    let statusText = '';
                                                    let statusColor = '#93c5fd';
                                                    if (dev.growth >= 3) {
                                                        statusText = 'Exceeding Expectations!';
                                                        statusColor = '#22c55e';
                                                    } else if (dev.growth >= 1) {
                                                        statusText = 'Developing Well';
                                                        statusColor = '#22c55e';
                                                    } else if (dev.growth === 0) {
                                                        statusText = 'Maintaining Level';
                                                        statusColor = '#93c5fd';
                                                    } else if (dev.growth >= -1) {
                                                        statusText = 'Slight Regression';
                                                        statusColor = '#f59e0b';
                                                    } else {
                                                        statusText = 'Regressing';
                                                        statusColor = '#ef4444';
                                                    }
                                                    
                                                    return (
                                                        <div 
                                                            key={player.id}
                                                            style={{
                                                                padding: '1rem',
                                                                background: 'rgba(0, 0, 0, 0.3)',
                                                                borderRadius: '0.5rem',
                                                                borderLeft: `4px solid ${growthColor}`,
                                                                display: 'flex',
                                                                justifyContent: 'space-between',
                                                                alignItems: 'center'
                                                            }}
                                                        >
                                                            <div style={{ flex: 1 }}>
                                                                <div style={{ 
                                                                    fontWeight: 'bold', 
                                                                    fontSize: '1.1rem',
                                                                    marginBottom: '0.25rem',
                                                                    cursor: 'pointer',
                                                                    textDecoration: 'underline'
                                                                }}
                                                                onClick={() => navigateTo('playerProfile', player)}
                                                                >
                                                                    {player.firstName} {player.lastName}
                                                                </div>
                                                                <div style={{ fontSize: '0.875rem', color: '#93c5fd' }}>
                                                                    {player.position} â€¢ Age {player.age} â€¢ {dev.games} games played
                                                                </div>
                                                            </div>
                                                            
                                                            <div style={{ textAlign: 'center', marginRight: '1.5rem' }}>
                                                                <div style={{ fontSize: '0.75rem', color: '#93c5fd', marginBottom: '0.25rem' }}>
                                                                    OVR Progress
                                                                </div>
                                                                <div style={{ fontSize: '1.5rem', fontWeight: 'bold' }}>
                                                                    {dev.startOVR} â†’ {dev.currentOVR}
                                                                </div>
                                                                <div style={{ 
                                                                    fontSize: '1rem', 
                                                                    fontWeight: 'bold',
                                                                    color: growthColor,
                                                                    marginTop: '0.25rem'
                                                                }}>
                                                                    {growthText} OVR
                                                                </div>
                                                            </div>
                                                            
                                                            <div style={{ 
                                                                padding: '0.5rem 1rem',
                                                                background: `${statusColor}20`,
                                                                borderRadius: '0.375rem',
                                                                border: `1px solid ${statusColor}`,
                                                                minWidth: '150px',
                                                                textAlign: 'center'
                                                            }}>
                                                                <div style={{ 
                                                                    fontSize: '0.875rem',
                                                                    fontWeight: 'bold',
                                                                    color: statusColor
                                                                }}>
                                                                    {statusText}
                                                                </div>
                                                            </div>
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                        );
                                    })()}
                                </div>
                            )}
                            
                            <div className="card">
                                {/* Team Overall Header */}
                                <div style={{ 
                                    display: 'flex', 
                                    justifyContent: 'space-between', 
                                    alignItems: 'center',
                                    marginBottom: '2rem',
                                    padding: '1.5rem',
                                    background: 'rgba(30, 58, 138, 0.3)',
                                    borderRadius: '0.5rem',
                                    border: '2px solid rgba(59, 130, 246, 0.3)'
                                }}>
                                    <h2 style={{ margin: 0 }}>Your Roster ({userRoster.length} players)</h2>
                                    <div style={{ textAlign: 'right' }}>
                                        <div style={{ 
                                            fontSize: '2.5rem', 
                                            fontWeight: 'bold',
                                            color: ovrColor,
                                            lineHeight: 1
                                        }}>
                                            {ovr} OVR
                                        </div>
                                        <div style={{ 
                                            fontSize: '1rem',
                                            color: '#93c5fd',
                                            marginTop: '0.25rem'
                                        }}>
                                            Rank: {rank} / {NUM_TEAMS}
                                        </div>
                                    </div>
                                </div>
                                
                                {['F', 'D', 'G'].map(pos => (
                                    <div key={pos}>
                                        <h3>
                                            {pos === 'F' ? 'Forwards (13)' : pos === 'D' ? 'Defensemen (7)' : 'Goalies (3)'}
                                        </h3>
                                        {userRoster.filter(p => p.position === pos).map(player => (
                                            <div 
                                                key={player.id} 
                                                className="list-item"
                                                onClick={() => navigateTo('playerProfile', player)}
                                                style={{ cursor: 'pointer' }}
                                            >
                                                <div>
                                                    <span className="player-name clickable-player">{player.firstName} {player.lastName}</span>
                                                    <span className="player-pos">{player.position}</span>
                                                    {player.preferredPosition && player.position !== 'G' && (
                                                        <span style={{ 
                                                            padding: '0.25rem 0.5rem',
                                                            marginLeft: '0.5rem',
                                                            borderRadius: '0.25rem',
                                                            fontSize: '0.7rem',
                                                            fontWeight: 'bold',
                                                            background: 'rgba(59, 130, 246, 0.2)',
                                                            color: '#3b82f6',
                                                            border: '1px solid rgba(59, 130, 246, 0.3)'
                                                        }}>
                                                            Pref: {player.preferredPosition}
                                                        </span>
                                                    )}
                                                    {player.ratings.overall >= 85 && <span className="badge badge-green">Elite</span>}
                                                    {player.ratings.overall >= 75 && player.ratings.overall < 85 && <span className="badge badge-yellow">Good</span>}
                                                    {player.injury.injured && (
                                                        <span style={{ 
                                                            padding: '0.25rem 0.5rem', 
                                                            borderRadius: '0.25rem', 
                                                            fontSize: '0.75rem', 
                                                            fontWeight: 'bold',
                                                            marginLeft: '0.5rem',
                                                            background: player.injury.isCareerEnding ? '#ef4444' : 
                                                                       player.injury.severity === 'Season-Ending' ? '#f59e0b' : 
                                                                       player.injury.severity === 'Month-to-Month' ? '#f97316' : '#fbbf24',
                                                            color: '#fff'
                                                        }}>
                                                            {getPlayerStatus(player)}
                                                        </span>
                                                    )}
                                                </div>
                                                <span style={{ color: '#22d3ee', fontSize: '0.875rem' }}>
                                                    Age: {player.age} | OVR: {player.ratings.overall} | POT: {player.ratings.potential}
                                                    {player.injury.injured && !player.injury.isCareerEnding && (
                                                        <span style={{ color: '#f59e0b', marginLeft: '0.5rem' }}>
                                                            | {player.injury.type} ({player.injury.daysUntilReturn}d)
                                                        </span>
                                                    )}
                                                </span>
                                            </div>
                                        ))}
                                    </div>
                                ))}
                            </div>
                            </>
                            );
                        })()}

                        {/* LINES & SCRATCHES VIEW */}
                        {currentView === 'lines' && gameState && (
                            <div>
                                {/* Header Card */}
                                <div className="card" style={{ background: 'rgba(34, 197, 94, 0.1)', border: '2px solid #22c55e' }}>
                                    <h2 style={{ color: '#22c55e' }}>ðŸ“‹ Advanced Line Management</h2>
                                    <p style={{ color: '#93c5fd', marginBottom: '0.5rem' }}>
                                        Set forward lines (C, LW, RW), defense pairs (LD, RD), and special teams (PP/PK)
                                    </p>
                                    
                                    {/* LIVE OVERALL DISPLAY */}
                                    {(() => {
                                        const teamOverallData = getTeamOverall(userTeamId);
                                        const currentOverall = teamOverallData?.overall || 0;
                                        const currentRank = teamOverallData?.rank || NUM_TEAMS;
                                        
                                        // Calculate individual line overalls
                                        const calculateLineOverall = (players) => {
                                            if (players.length === 0) return 0;
                                            const sum = players.reduce((acc, p) => acc + p.ratings.overall, 0);
                                            return Math.round(sum / players.length);
                                        };
                                        
                                        const forwards = userRoster.filter(p => p.position === 'F' && p.lineNumber > 0);
                                        const defense = userRoster.filter(p => p.position === 'D' && p.lineNumber > 0);
                                        const goalies = userRoster.filter(p => p.position === 'G' && p.dressed);
                                        
                                        const line1 = forwards.filter(p => p.lineNumber === 1);
                                        const line2 = forwards.filter(p => p.lineNumber === 2);
                                        const line3 = forwards.filter(p => p.lineNumber === 3);
                                        const line4 = forwards.filter(p => p.lineNumber === FORWARD_LINES);
                                        
                                        const pair1 = defense.filter(p => p.lineNumber === 1);
                                        const pair2 = defense.filter(p => p.lineNumber === 2);
                                        const pair3 = defense.filter(p => p.lineNumber === 3);
                                        
                                        const pp1 = userRoster.filter(p => p.ppUnit === 1 && p.lineNumber > 0);
                                        const pp2 = userRoster.filter(p => p.ppUnit === 2 && p.lineNumber > 0);
                                        const pk1 = userRoster.filter(p => p.pkUnit === 1 && p.lineNumber > 0);
                                        const pk2 = userRoster.filter(p => p.pkUnit === 2 && p.lineNumber > 0);
                                        
                                        return (
                                            <div style={{
                                                padding: '1.5rem',
                                                background: 'rgba(59, 130, 246, 0.15)',
                                                borderRadius: '0.5rem',
                                                border: '2px solid rgba(59, 130, 246, 0.4)',
                                                marginBottom: '1rem'
                                            }}>
                                                {/* Team Overall */}
                                                <div style={{ 
                                                    display: 'flex',
                                                    justifyContent: 'space-between',
                                                    alignItems: 'center',
                                                    marginBottom: '1.5rem',
                                                    paddingBottom: '1rem',
                                                    borderBottom: '2px solid rgba(59, 130, 246, 0.3)'
                                                }}>
                                                    <div>
                                                        <div style={{ fontSize: '0.875rem', color: '#93c5fd', marginBottom: '0.25rem' }}>
                                                            TEAM OVERALL
                                                        </div>
                                                        <div style={{ 
                                                            fontSize: '3rem', 
                                                            fontWeight: 'bold', 
                                                            color: currentRank <= 5 ? '#4ade80' : currentRank <= 10 ? '#60a5fa' : currentRank <= 20 ? '#fbbf24' : '#f87171',
                                                            lineHeight: 1
                                                        }}>
                                                            {currentOverall}
                                                        </div>
                                                    </div>
                                                    <div style={{ textAlign: 'right' }}>
                                                        <div style={{ fontSize: '0.875rem', color: '#93c5fd', marginBottom: '0.25rem' }}>
                                                            LEAGUE RANK
                                                        </div>
                                                        <div style={{ fontSize: '1.5rem', fontWeight: 'bold', color: '#fff' }}>
                                                            {currentRank} / {NUM_TEAMS}
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                {/* Line Overalls Grid */}
                                                <div style={{ 
                                                    display: 'grid',
                                                    gridTemplateColumns: 'repeat(auto-fit, minmax(150px, 1fr))',
                                                    gap: '0.75rem'
                                                }}>
                                                    {/* Forward Lines */}
                                                    <div style={{ 
                                                        padding: '0.75rem',
                                                        background: 'rgba(0, 0, 0, 0.2)',
                                                        borderRadius: '0.375rem'
                                                    }}>
                                                        <div style={{ fontSize: '0.75rem', color: '#93c5fd', marginBottom: '0.25rem' }}>Line 1</div>
                                                        <div style={{ fontSize: '1.25rem', fontWeight: 'bold', color: '#fff' }}>
                                                            {calculateLineOverall(line1) || '--'}
                                                        </div>
                                                    </div>
                                                    <div style={{ 
                                                        padding: '0.75rem',
                                                        background: 'rgba(0, 0, 0, 0.2)',
                                                        borderRadius: '0.375rem'
                                                    }}>
                                                        <div style={{ fontSize: '0.75rem', color: '#93c5fd', marginBottom: '0.25rem' }}>Line 2</div>
                                                        <div style={{ fontSize: '1.25rem', fontWeight: 'bold', color: '#fff' }}>
                                                            {calculateLineOverall(line2) || '--'}
                                                        </div>
                                                    </div>
                                                    <div style={{ 
                                                        padding: '0.75rem',
                                                        background: 'rgba(0, 0, 0, 0.2)',
                                                        borderRadius: '0.375rem'
                                                    }}>
                                                        <div style={{ fontSize: '0.75rem', color: '#93c5fd', marginBottom: '0.25rem' }}>Line 3</div>
                                                        <div style={{ fontSize: '1.25rem', fontWeight: 'bold', color: '#fff' }}>
                                                            {calculateLineOverall(line3) || '--'}
                                                        </div>
                                                    </div>
                                                    <div style={{ 
                                                        padding: '0.75rem',
                                                        background: 'rgba(0, 0, 0, 0.2)',
                                                        borderRadius: '0.375rem'
                                                    }}>
                                                        <div style={{ fontSize: '0.75rem', color: '#93c5fd', marginBottom: '0.25rem' }}>Line 4</div>
                                                        <div style={{ fontSize: '1.25rem', fontWeight: 'bold', color: '#fff' }}>
                                                            {calculateLineOverall(line4) || '--'}
                                                        </div>
                                                    </div>
                                                    
                                                    {/* Defense Pairs */}
                                                    <div style={{ 
                                                        padding: '0.75rem',
                                                        background: 'rgba(0, 0, 0, 0.2)',
                                                        borderRadius: '0.375rem'
                                                    }}>
                                                        <div style={{ fontSize: '0.75rem', color: '#93c5fd', marginBottom: '0.25rem' }}>D Pair 1</div>
                                                        <div style={{ fontSize: '1.25rem', fontWeight: 'bold', color: '#fff' }}>
                                                            {calculateLineOverall(pair1) || '--'}
                                                        </div>
                                                    </div>
                                                    <div style={{ 
                                                        padding: '0.75rem',
                                                        background: 'rgba(0, 0, 0, 0.2)',
                                                        borderRadius: '0.375rem'
                                                    }}>
                                                        <div style={{ fontSize: '0.75rem', color: '#93c5fd', marginBottom: '0.25rem' }}>D Pair 2</div>
                                                        <div style={{ fontSize: '1.25rem', fontWeight: 'bold', color: '#fff' }}>
                                                            {calculateLineOverall(pair2) || '--'}
                                                        </div>
                                                    </div>
                                                    <div style={{ 
                                                        padding: '0.75rem',
                                                        background: 'rgba(0, 0, 0, 0.2)',
                                                        borderRadius: '0.375rem'
                                                    }}>
                                                        <div style={{ fontSize: '0.75rem', color: '#93c5fd', marginBottom: '0.25rem' }}>D Pair 3</div>
                                                        <div style={{ fontSize: '1.25rem', fontWeight: 'bold', color: '#fff' }}>
                                                            {calculateLineOverall(pair3) || '--'}
                                                        </div>
                                                    </div>
                                                    
                                                    {/* Goalies */}
                                                    <div style={{ 
                                                        padding: '0.75rem',
                                                        background: 'rgba(0, 0, 0, 0.2)',
                                                        borderRadius: '0.375rem'
                                                    }}>
                                                        <div style={{ fontSize: '0.75rem', color: '#93c5fd', marginBottom: '0.25rem' }}>Goalies</div>
                                                        <div style={{ fontSize: '1.25rem', fontWeight: 'bold', color: '#fff' }}>
                                                            {calculateLineOverall(goalies) || '--'}
                                                        </div>
                                                    </div>
                                                    
                                                    {/* Special Teams */}
                                                    <div style={{ 
                                                        padding: '0.75rem',
                                                        background: 'rgba(251, 191, 36, 0.15)',
                                                        borderRadius: '0.375rem',
                                                        border: '1px solid rgba(251, 191, 36, 0.3)'
                                                    }}>
                                                        <div style={{ fontSize: '0.75rem', color: '#fbbf24', marginBottom: '0.25rem' }}>PP1</div>
                                                        <div style={{ fontSize: '1.25rem', fontWeight: 'bold', color: '#fff' }}>
                                                            {calculateLineOverall(pp1) || '--'}
                                                        </div>
                                                    </div>
                                                    <div style={{ 
                                                        padding: '0.75rem',
                                                        background: 'rgba(251, 191, 36, 0.15)',
                                                        borderRadius: '0.375rem',
                                                        border: '1px solid rgba(251, 191, 36, 0.3)'
                                                    }}>
                                                        <div style={{ fontSize: '0.75rem', color: '#fbbf24', marginBottom: '0.25rem' }}>PP2</div>
                                                        <div style={{ fontSize: '1.25rem', fontWeight: 'bold', color: '#fff' }}>
                                                            {calculateLineOverall(pp2) || '--'}
                                                        </div>
                                                    </div>
                                                    <div style={{ 
                                                        padding: '0.75rem',
                                                        background: 'rgba(239, 68, 68, 0.15)',
                                                        borderRadius: '0.375rem',
                                                        border: '1px solid rgba(239, 68, 68, 0.3)'
                                                    }}>
                                                        <div style={{ fontSize: '0.75rem', color: '#ef4444', marginBottom: '0.25rem' }}>PK1</div>
                                                        <div style={{ fontSize: '1.25rem', fontWeight: 'bold', color: '#fff' }}>
                                                            {calculateLineOverall(pk1) || '--'}
                                                        </div>
                                                    </div>
                                                    <div style={{ 
                                                        padding: '0.75rem',
                                                        background: 'rgba(239, 68, 68, 0.15)',
                                                        borderRadius: '0.375rem',
                                                        border: '1px solid rgba(239, 68, 68, 0.3)'
                                                    }}>
                                                        <div style={{ fontSize: '0.75rem', color: '#ef4444', marginBottom: '0.25rem' }}>PK2</div>
                                                        <div style={{ fontSize: '1.25rem', fontWeight: 'bold', color: '#fff' }}>
                                                            {calculateLineOverall(pk2) || '--'}
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <div style={{ 
                                                    marginTop: '1rem',
                                                    padding: '0.75rem',
                                                    background: 'rgba(147, 197, 253, 0.1)',
                                                    borderRadius: '0.375rem',
                                                    fontSize: '0.875rem',
                                                    color: '#93c5fd'
                                                }}>
                                                    ðŸ’¡ <strong>Formula:</strong> Team OVR uses weighted average (Top lines/pairs count more). Line OVR is simple average of players.
                                                </div>
                                            </div>
                                        );
                                    })()}
                                    
                                    {/* Roster Summary */}
                                    <div style={{ 
                                        display: 'flex', 
                                        gap: '2rem',
                                        padding: '0.75rem',
                                        background: 'rgba(0, 0, 0, 0.2)',
                                        borderRadius: '0.5rem',
                                        marginBottom: '0.5rem'
                                    }}>
                                        <div>
                                            <div style={{ color: '#22c55e', fontSize: '0.75rem', marginBottom: '0.25rem' }}>ACTIVE (20)</div>
                                            <div style={{ color: '#fff', fontSize: '0.9rem' }}>
                                                {userRoster.filter(p => p.position === 'F' && p.lineNumber > 0).length} F + 
                                                {' '}{userRoster.filter(p => p.position === 'D' && p.lineNumber > 0).length} D + 
                                                {' '}{userRoster.filter(p => p.position === 'G' && p.dressed).length} G
                                            </div>
                                        </div>
                                        <div>
                                            <div style={{ color: '#ef4444', fontSize: '0.75rem', marginBottom: '0.25rem' }}>SCRATCHED (3)</div>
                                            <div style={{ color: '#fff', fontSize: '0.9rem' }}>
                                                {userRoster.filter(p => p.position === 'F' && p.lineNumber === 0).length} F + 
                                                {' '}{userRoster.filter(p => p.position === 'D' && p.lineNumber === 0).length} D + 
                                                {' '}{userRoster.filter(p => p.position === 'G' && !p.dressed).length} G
                                            </div>
                                        </div>
                                        <div style={{ marginLeft: 'auto' }}>
                                            <div style={{ color: '#93c5fd', fontSize: '0.75rem', marginBottom: '0.25rem' }}>TOTAL ROSTER</div>
                                            <div style={{ color: '#fff', fontSize: '0.9rem', fontWeight: 'bold' }}>
                                                23 Players
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <p style={{ color: '#fbbf24', fontSize: '0.85rem' }}>
                                        âš ï¸ Out-of-position penalty: Forwards -3 OVR | Defense -5 OVR
                                    </p>
                                    
                                    {/* Save/Load Controls */}
                                    <div style={{ 
                                        display: 'flex', 
                                        gap: '1rem', 
                                        marginTop: '1rem',
                                        flexWrap: 'wrap',
                                        alignItems: 'center'
                                    }}>
                                        <button
                                            onClick={() => {
                                                if (confirm('Auto-set best lineup? This will replace your current lineup (lines, PP, PK, goalies) based on player OVR and position preference.')) {
                                                    const newPlayers = [...gameState.players];
                                                    // Only auto-set for user's team players
                                                    const userTeamPlayers = newPlayers.filter(p => p.teamId === userTeamId);
                                                    autoSetLineup(userTeamPlayers);
                                                    setGameState({ ...gameState, players: newPlayers });
                                                    saveGameToLocalStorage({ ...gameState, players: newPlayers }, userTeamId, playoffState, seasonMode);
                                                }
                                            }}
                                            style={{
                                                padding: '0.5rem 1rem',
                                                background: '#8b5cf6',
                                                color: '#fff',
                                                border: 'none',
                                                borderRadius: '0.375rem',
                                                cursor: 'pointer',
                                                fontWeight: 'bold'
                                            }}
                                        >
                                            âš¡ Auto-Set Best Lineup
                                        </button>
                                        
                                        <button
                                            onClick={() => {
                                                const name = prompt('Enter a name for this lineup:');
                                                if (name) saveCurrentLineup(name);
                                            }}
                                            style={{
                                                padding: '0.5rem 1rem',
                                                background: '#22c55e',
                                                color: '#fff',
                                                border: 'none',
                                                borderRadius: '0.375rem',
                                                cursor: 'pointer',
                                                fontWeight: 'bold'
                                            }}
                                        >
                                            ðŸ’¾ Save Lineup
                                        </button>
                                        
                                        {savedLineups.length > 0 && (
                                            <div style={{ display: 'flex', gap: '0.5rem', flexWrap: 'wrap' }}>
                                                <span style={{ color: '#93c5fd' }}>Saved:</span>
                                                {savedLineups.map(lineup => (
                                                    <div key={lineup.id} style={{
                                                        display: 'flex',
                                                        gap: '0.25rem',
                                                        padding: '0.25rem 0.5rem',
                                                        background: 'rgba(59, 130, 246, 0.2)',
                                                        borderRadius: '0.25rem',
                                                        border: '1px solid rgba(59, 130, 246, 0.3)',
                                                        fontSize: '0.85rem'
                                                    }}>
                                                        <span style={{ color: '#fff' }}>{lineup.name}</span>
                                                        <button onClick={() => loadLineup(lineup)} style={{padding: '0 0.25rem', background: '#3b82f6', color: '#fff', border: 'none', borderRadius: '0.2rem', cursor: 'pointer', fontSize: '0.75rem'}}>Load</button>
                                                        <button onClick={() => deleteLineup(lineup.id)} style={{padding: '0 0.25rem', background: '#ef4444', color: '#fff', border: 'none', borderRadius: '0.2rem', cursor: 'pointer', fontSize: '0.75rem'}}>âœ•</button>
                                                    </div>
                                                ))}
                                            </div>
                                        )}
                                    </div>
                                </div>

                                {/* FORWARD LINES */}
                                <div className="card">
                                    <h2 style={{ color: '#22d3ee' }}>âš”ï¸ Forward Lines (12 Active / 13 Total)</h2>
                                    {[1, 2, 3, 4].map(line => {
                                        const positions = ['C', 'LW', 'RW'];
                                        return (
                                            <div key={line} style={{ marginBottom: '1.5rem' }}>
                                                <h3 style={{ color: '#93c5fd', fontSize: '1rem', marginBottom: '0.75rem' }}>
                                                    Line {line}
                                                </h3>
                                                <div style={{ display: 'flex', gap: '0.75rem', flexWrap: 'wrap' }}>
                                                    {positions.map(pos => {
                                                        const player = userRoster.find(p => p.position === 'F' && p.lineNumber === line && p.linePosition === pos && !p.injury.injured);
                                                        const availablePlayers = userRoster.filter(p => p.position === 'F' && !p.injury.injured);
                                                        
                                                        return (
                                                            <div key={pos} style={{ flex: '1', minWidth: '200px' }}>
                                                                <div style={{ 
                                                                    padding: '0.75rem',
                                                                    background: player ? 'rgba(59, 130, 246, 0.1)' : 'rgba(100, 116, 139, 0.1)',
                                                                    borderRadius: '0.375rem',
                                                                    border: player ? '1px solid rgba(59, 130, 246, 0.3)' : '1px dashed rgba(100, 116, 139, 0.3)'
                                                                }}>
                                                                    <div style={{ color: '#93c5fd', fontSize: '0.75rem', fontWeight: 'bold', marginBottom: '0.5rem' }}>
                                                                        {pos}
                                                                    </div>
                                                                    {player ? (
                                                                        <div>
                                                                            <div style={{ color: '#fff', fontWeight: 'bold', fontSize: '0.95rem', marginBottom: '0.25rem' }}>
                                                                                {player.firstName.charAt(0)}. {player.lastName}
                                                                                {player.preferredPosition === pos && <span style={{color: '#22c55e', marginLeft: '0.25rem', fontSize: '0.75rem'}} title="In preferred position">âœ“</span>}
                                                                                {player.preferredPosition !== pos && <span style={{color: '#f59e0b', marginLeft: '0.25rem', fontSize: '0.75rem'}} title="Out of position (-3 OVR)">âš ï¸</span>}
                                                                            </div>
                                                                            <div style={{ fontSize: '0.75rem', color: '#64748b', marginBottom: '0.5rem' }}>
                                                                                OVR: {getEffectiveOverall(player)} 
                                                                                {player.preferredPosition !== pos && ` (was ${player.ratings.overall})`}
                                                                                {' '}| Pref: {player.preferredPosition}
                                                                            </div>
                                                                            <select
                                                                                value={player.id}
                                                                                onChange={(e) => {
                                                                                    if (e.target.value === 'empty') {
                                                                                        assignPlayerToLine(player.id, 0, null);
                                                                                    } else if (e.target.value !== player.id) {
                                                                                        const newPlayer = availablePlayers.find(p => p.id === e.target.value);
                                                                                        if (newPlayer) {
                                                                                            assignPlayerToLine(player.id, newPlayer.lineNumber, newPlayer.linePosition);
                                                                                            assignPlayerToLine(newPlayer.id, line, pos);
                                                                                        }
                                                                                    }
                                                                                }}
                                                                                style={{
                                                                                    width: '100%',
                                                                                    padding: '0.25rem',
                                                                                    background: '#1e3a8a',
                                                                                    border: '1px solid #3b82f6',
                                                                                    borderRadius: '0.25rem',
                                                                                    color: '#fff',
                                                                                    fontSize: '0.75rem'
                                                                                }}
                                                                            >
                                                                                <option value={player.id}>{player.lastName}</option>
                                                                                <option value="empty">-- Empty Slot --</option>
                                                                                <optgroup label="Swap With:">
                                                                                    {availablePlayers
                                                                                        .filter(p => p.id !== player.id)
                                                                                        .sort((a, b) => b.ratings.overall - a.ratings.overall)
                                                                                        .map(p => (
                                                                                            <option key={p.id} value={p.id}>
                                                                                                {p.lastName} (OVR {p.ratings.overall}, {p.preferredPosition})
                                                                                            </option>
                                                                                        ))}
                                                                                </optgroup>
                                                                            </select>
                                                                        </div>
                                                                    ) : (
                                                                        <div>
                                                                            <div style={{ color: '#64748b', fontSize: '0.85rem', marginBottom: '0.5rem' }}>
                                                                                Empty
                                                                            </div>
                                                                            <select
                                                                                onChange={(e) => {
                                                                                    if (e.target.value) {
                                                                                        assignPlayerToLine(e.target.value, line, pos);
                                                                                    }
                                                                                }}
                                                                                value=""
                                                                                style={{
                                                                                    width: '100%',
                                                                                    padding: '0.25rem',
                                                                                    background: '#1e3a8a',
                                                                                    border: '1px solid #3b82f6',
                                                                                    borderRadius: '0.25rem',
                                                                                    color: '#fff',
                                                                                    fontSize: '0.75rem'
                                                                                }}
                                                                            >
                                                                                <option value="">-- Select Player --</option>
                                                                                {availablePlayers
                                                                                    .filter(p => p.lineNumber === 0 || !p.linePosition)
                                                                                    .sort((a, b) => b.ratings.overall - a.ratings.overall)
                                                                                    .map(p => (
                                                                                        <option key={p.id} value={p.id}>
                                                                                            {p.lastName} (OVR {p.ratings.overall}, {p.preferredPosition})
                                                                                        </option>
                                                                                    ))}
                                                                            </select>
                                                                        </div>
                                                                    )}
                                                                </div>
                                                            </div>
                                                        );
                                                    })}
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>

                                {/* DEFENSE PAIRS */}
                                <div className="card">
                                    <h2 style={{ color: '#8b5cf6' }}>ðŸ›¡ï¸ Defense Pairs (6 Active / 7 Total)</h2>
                                    {[1, 2, 3].map(pair => {
                                        const positions = ['LD', 'RD'];
                                        return (
                                            <div key={pair} style={{ marginBottom: '1.5rem' }}>
                                                <h3 style={{ color: '#a78bfa', fontSize: '1rem', marginBottom: '0.75rem' }}>
                                                    Pair {pair}
                                                </h3>
                                                <div style={{ display: 'flex', gap: '0.75rem', flexWrap: 'wrap' }}>
                                                    {positions.map(pos => {
                                                        const player = userRoster.find(p => p.position === 'D' && p.lineNumber === pair && p.linePosition === pos && !p.injury.injured);
                                                        const availablePlayers = userRoster.filter(p => p.position === 'D' && !p.injury.injured);
                                                        
                                                        return (
                                                            <div key={pos} style={{ flex: '1', minWidth: '200px' }}>
                                                                <div style={{ 
                                                                    padding: '0.75rem',
                                                                    background: player ? 'rgba(139, 92, 246, 0.1)' : 'rgba(100, 116, 139, 0.1)',
                                                                    borderRadius: '0.375rem',
                                                                    border: player ? '1px solid rgba(139, 92, 246, 0.3)' : '1px dashed rgba(100, 116, 139, 0.3)'
                                                                }}>
                                                                    <div style={{ color: '#a78bfa', fontSize: '0.75rem', fontWeight: 'bold', marginBottom: '0.5rem' }}>
                                                                        {pos}
                                                                    </div>
                                                                    {player ? (
                                                                        <div>
                                                                            <div style={{ color: '#fff', fontWeight: 'bold', fontSize: '0.95rem', marginBottom: '0.25rem' }}>
                                                                                {player.firstName.charAt(0)}. {player.lastName}
                                                                                {player.preferredPosition === pos && <span style={{color: '#22c55e', marginLeft: '0.25rem', fontSize: '0.75rem'}} title="In preferred position">âœ“</span>}
                                                                                {player.preferredPosition !== pos && <span style={{color: '#f59e0b', marginLeft: '0.25rem', fontSize: '0.75rem'}} title="Out of position (-5 OVR)">âš ï¸</span>}
                                                                            </div>
                                                                            <div style={{ fontSize: '0.75rem', color: '#64748b', marginBottom: '0.5rem' }}>
                                                                                OVR: {getEffectiveOverall(player)}
                                                                                {player.preferredPosition !== pos && ` (was ${player.ratings.overall})`}
                                                                                {' '}| Pref: {player.preferredPosition}
                                                                            </div>
                                                                            <select
                                                                                value={player.id}
                                                                                onChange={(e) => {
                                                                                    if (e.target.value === 'empty') {
                                                                                        assignPlayerToLine(player.id, 0, null);
                                                                                    } else if (e.target.value !== player.id) {
                                                                                        const newPlayer = availablePlayers.find(p => p.id === e.target.value);
                                                                                        if (newPlayer) {
                                                                                            assignPlayerToLine(player.id, newPlayer.lineNumber, newPlayer.linePosition);
                                                                                            assignPlayerToLine(newPlayer.id, pair, pos);
                                                                                        }
                                                                                    }
                                                                                }}
                                                                                style={{
                                                                                    width: '100%',
                                                                                    padding: '0.25rem',
                                                                                    background: '#1e3a8a',
                                                                                    border: '1px solid #3b82f6',
                                                                                    borderRadius: '0.25rem',
                                                                                    color: '#fff',
                                                                                    fontSize: '0.75rem'
                                                                                }}
                                                                            >
                                                                                <option value={player.id}>{player.lastName}</option>
                                                                                <option value="empty">-- Empty Slot --</option>
                                                                                <optgroup label="Swap With:">
                                                                                    {availablePlayers
                                                                                        .filter(p => p.id !== player.id)
                                                                                        .sort((a, b) => b.ratings.overall - a.ratings.overall)
                                                                                        .map(p => (
                                                                                            <option key={p.id} value={p.id}>
                                                                                                {p.lastName} (OVR {p.ratings.overall}, {p.preferredPosition})
                                                                                            </option>
                                                                                        ))}
                                                                                </optgroup>
                                                                            </select>
                                                                        </div>
                                                                    ) : (
                                                                        <div>
                                                                            <div style={{ color: '#64748b', fontSize: '0.85rem', marginBottom: '0.5rem' }}>
                                                                                Empty
                                                                            </div>
                                                                            <select
                                                                                onChange={(e) => {
                                                                                    if (e.target.value) {
                                                                                        assignPlayerToLine(e.target.value, pair, pos);
                                                                                    }
                                                                                }}
                                                                                value=""
                                                                                style={{
                                                                                    width: '100%',
                                                                                    padding: '0.25rem',
                                                                                    background: '#1e3a8a',
                                                                                    border: '1px solid #3b82f6',
                                                                                    borderRadius: '0.25rem',
                                                                                    color: '#fff',
                                                                                    fontSize: '0.75rem'
                                                                                }}
                                                                            >
                                                                                <option value="">-- Select Player --</option>
                                                                                {availablePlayers
                                                                                    .filter(p => p.lineNumber === 0 || !p.linePosition)
                                                                                    .sort((a, b) => b.ratings.overall - a.ratings.overall)
                                                                                    .map(p => (
                                                                                        <option key={p.id} value={p.id}>
                                                                                            {p.lastName} (OVR {p.ratings.overall}, {p.preferredPosition})
                                                                                        </option>
                                                                                    ))}
                                                                            </select>
                                                                        </div>
                                                                    )}
                                                                </div>
                                                            </div>
                                                        );
                                                    })}
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>

                                {/* GOALIES */}
                                <div className="card">
                                    <h2 style={{ color: '#22c55e' }}>ðŸ¥… Goalies (2 Dress Per Game)</h2>
                                    <div style={{ display: 'flex', gap: '1rem', flexWrap: 'wrap' }}>
                                        {userRoster.filter(p => p.position === 'G').sort((a, b) => a.lineNumber - b.lineNumber).map(player => (
                                            <div key={player.id} style={{
                                                flex: '1',
                                                minWidth: '250px',
                                                padding: '1rem',
                                                background: player.dressed ? 'rgba(34, 197, 94, 0.1)' : 'rgba(100, 116, 139, 0.1)',
                                                borderRadius: '0.5rem',
                                                border: player.dressed ? '2px solid #22c55e' : '1px dashed rgba(100, 116, 139, 0.3)',
                                                opacity: player.injury.injured ? 0.5 : 1
                                            }}>
                                                <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '0.75rem' }}>
                                                    <div>
                                                        <div style={{ color: player.dressed ? '#22c55e' : '#64748b', fontSize: '0.75rem', marginBottom: '0.25rem' }}>
                                                            {player.lineNumber === 1 ? 'STARTER' : player.lineNumber === 2 ? 'BACKUP' : 'THIRD'}
                                                        </div>
                                                        <div style={{ color: '#fff', fontWeight: 'bold', fontSize: '1.1rem' }}>
                                                            {player.firstName} {player.lastName}
                                                        </div>
                                                        <div style={{ color: '#93c5fd', fontSize: '0.85rem' }}>
                                                            OVR: {player.ratings.overall} | Age: {player.age}
                                                        </div>
                                                    </div>
                                                </div>
                                                <div style={{ display: 'flex', gap: '0.5rem', marginBottom: '0.75rem' }}>
                                                    <button
                                                        onClick={() => toggleGoalieDressed(player.id)}
                                                        disabled={player.injury.injured}
                                                        style={{
                                                            flex: 1,
                                                            padding: '0.375rem',
                                                            background: player.dressed ? '#ef4444' : '#22c55e',
                                                            color: '#fff',
                                                            border: 'none',
                                                            borderRadius: '0.25rem',
                                                            cursor: player.injury.injured ? 'not-allowed' : 'pointer',
                                                            fontSize: '0.75rem',
                                                            fontWeight: 'bold'
                                                        }}
                                                    >
                                                        {player.dressed ? 'ðŸš« Scratch' : 'âœ“ Dress'}
                                                    </button>
                                                </div>
                                                <div style={{ fontSize: '0.85rem', color: '#e2e8f0' }}>
                                                    {player.stats.wins}-{player.stats.losses} | {player.stats.savePercentage.toFixed(3)} SV% | {player.stats.gaa.toFixed(2)} GAA
                                                </div>
                                                {player.injury.injured && (
                                                    <div style={{ color: '#f59e0b', fontSize: '0.75rem', marginTop: '0.5rem' }}>
                                                        INJURED: {player.injury.type} ({player.injury.daysUntilReturn}d)
                                                    </div>
                                                )}
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                {/* POWER PLAY UNITS */}
                                <div className="card" style={{ background: 'rgba(245, 158, 11, 0.05)', border: '1px solid rgba(245, 158, 11, 0.3)' }}>
                                    <h2 style={{ color: '#f59e0b' }}>âš¡ Power Play Units (5 Players Each)</h2>
                                    {[1, 2].map(unit => {
                                        const positions = ['PP' + unit + '-F1', 'PP' + unit + '-F2', 'PP' + unit + '-F3', 'PP' + unit + '-F4', 'PP' + unit + '-D1'];
                                        return (
                                            <div key={unit} style={{ marginBottom: '1.5rem' }}>
                                                <h3 style={{ color: '#fbbf24', fontSize: '1rem', marginBottom: '0.75rem' }}>
                                                    PP Unit {unit}
                                                </h3>
                                                <div style={{ display: 'flex', gap: '0.75rem', flexWrap: 'wrap' }}>
                                                    {positions.map(pos => {
                                                        const player = userRoster.find(p => p.ppUnit === unit && p.ppPosition === pos && !p.injury.injured);
                                                        const availablePlayers = userRoster.filter(p => 
                                                            p.position !== 'G' && 
                                                            !p.injury.injured && 
                                                            p.lineNumber > 0 && 
                                                            p.linePosition
                                                        );
                                                        
                                                        return (
                                                            <div key={pos} style={{ flex: '1', minWidth: '180px' }}>
                                                                <div style={{ 
                                                                    padding: '0.75rem',
                                                                    background: player ? 'rgba(245, 158, 11, 0.1)' : 'rgba(100, 116, 139, 0.1)',
                                                                    borderRadius: '0.375rem',
                                                                    border: player ? '1px solid rgba(245, 158, 11, 0.3)' : '1px dashed rgba(100, 116, 139, 0.3)'
                                                                }}>
                                                                    <div style={{ color: '#fbbf24', fontSize: '0.75rem', fontWeight: 'bold', marginBottom: '0.5rem' }}>
                                                                        {pos}
                                                                    </div>
                                                                    {player ? (
                                                                        <div>
                                                                            <div style={{ color: '#fff', fontWeight: 'bold', fontSize: '0.95rem', marginBottom: '0.25rem' }}>
                                                                                {player.firstName.charAt(0)}. {player.lastName}
                                                                                {pos.includes('-D') && player.position === 'F' && <span style={{color: '#f59e0b', marginLeft: '0.25rem', fontSize: '0.75rem'}} title="Forward playing defense position">âš ï¸</span>}
                                                                                {pos.includes('-F') && player.position === 'D' && <span style={{color: '#f59e0b', marginLeft: '0.25rem', fontSize: '0.75rem'}} title="Defenseman playing forward position">âš ï¸</span>}
                                                                            </div>
                                                                            <div style={{ fontSize: '0.75rem', color: '#64748b', marginBottom: '0.5rem' }}>
                                                                                OVR: {player.ratings.overall} | {player.position} - {player.preferredPosition}
                                                                            </div>
                                                                            <select
                                                                                value={player.id}
                                                                                onChange={(e) => {
                                                                                    if (e.target.value === 'empty') {
                                                                                        assignToSpecialTeams(player.id, 'pp', null, null);
                                                                                    } else if (e.target.value !== player.id) {
                                                                                        const newPlayer = availablePlayers.find(p => p.id === e.target.value);
                                                                                        if (newPlayer) {
                                                                                            // Swap players
                                                                                            const oldUnit = newPlayer.ppUnit;
                                                                                            const oldPos = newPlayer.ppPosition;
                                                                                            assignToSpecialTeams(newPlayer.id, 'pp', unit, pos);
                                                                                            if (oldUnit && oldPos) {
                                                                                                assignToSpecialTeams(player.id, 'pp', oldUnit, oldPos);
                                                                                            } else {
                                                                                                assignToSpecialTeams(player.id, 'pp', null, null);
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }}
                                                                                style={{
                                                                                    width: '100%',
                                                                                    padding: '0.25rem',
                                                                                    background: '#1e3a8a',
                                                                                    border: '1px solid #f59e0b',
                                                                                    borderRadius: '0.25rem',
                                                                                    color: '#fff',
                                                                                    fontSize: '0.75rem'
                                                                                }}
                                                                            >
                                                                                <option value={player.id}>{player.lastName}</option>
                                                                                <option value="empty">-- Empty Slot --</option>
                                                                                <optgroup label="Swap With:">
                                                                                    {availablePlayers
                                                                                        .filter(p => p.id !== player.id)
                                                                                        .sort((a, b) => b.ratings.overall - a.ratings.overall)
                                                                                        .map(p => (
                                                                                            <option key={p.id} value={p.id}>
                                                                                                {p.lastName} (OVR {p.ratings.overall}, {p.position})
                                                                                                {p.ppUnit ? ` [PP${p.ppUnit}]` : ''}
                                                                                            </option>
                                                                                        ))}
                                                                                </optgroup>
                                                                            </select>
                                                                        </div>
                                                                    ) : (
                                                                        <div>
                                                                            <div style={{ color: '#64748b', fontSize: '0.85rem', marginBottom: '0.5rem' }}>
                                                                                Empty
                                                                            </div>
                                                                            <select
                                                                                value=""
                                                                                onChange={(e) => {
                                                                                    if (e.target.value) {
                                                                                        assignToSpecialTeams(e.target.value, 'pp', unit, pos);
                                                                                    }
                                                                                }}
                                                                                style={{
                                                                                    width: '100%',
                                                                                    padding: '0.25rem',
                                                                                    background: '#1e3a8a',
                                                                                    border: '1px solid #f59e0b',
                                                                                    borderRadius: '0.25rem',
                                                                                    color: '#fff',
                                                                                    fontSize: '0.75rem'
                                                                                }}
                                                                            >
                                                                                <option value="">-- Select Player --</option>
                                                                                {availablePlayers
                                                                                    .filter(p => !p.ppUnit)
                                                                                    .sort((a, b) => b.ratings.overall - a.ratings.overall)
                                                                                    .map(p => (
                                                                                        <option key={p.id} value={p.id}>
                                                                                            {p.lastName} (OVR {p.ratings.overall}, {p.position})
                                                                                        </option>
                                                                                    ))}
                                                                            </select>
                                                                        </div>
                                                                    )}
                                                                </div>
                                                            </div>
                                                        );
                                                    })}
                                                </div>
                                            </div>
                                        );
                                    })}
                                    <div style={{ 
                                        marginTop: '1rem',
                                        padding: '0.75rem',
                                        background: 'rgba(245, 158, 11, 0.1)',
                                        borderRadius: '0.375rem',
                                        fontSize: '0.875rem',
                                        color: '#fbbf24'
                                    }}>
                                        ðŸ’¡ <strong>Tip:</strong> Typical PP setup is 4F + 1D, but any combination works. Players on both PP1 & PP2 will get more ice time. Out-of-position warnings shown with âš ï¸
                                    </div>
                                </div>

                                {/* PENALTY KILL UNITS */}
                                <div className="card" style={{ background: 'rgba(239, 68, 68, 0.05)', border: '1px solid rgba(239, 68, 68, 0.3)' }}>
                                    <h2 style={{ color: '#ef4444' }}>ðŸ›¡ï¸ Penalty Kill Units (4 Players Each)</h2>
                                    {[1, 2].map(unit => {
                                        const positions = ['PK' + unit + '-F1', 'PK' + unit + '-F2', 'PK' + unit + '-D1', 'PK' + unit + '-D2'];
                                        return (
                                            <div key={unit} style={{ marginBottom: '1.5rem' }}>
                                                <h3 style={{ color: '#f87171', fontSize: '1rem', marginBottom: '0.75rem' }}>
                                                    PK Unit {unit}
                                                </h3>
                                                <div style={{ display: 'flex', gap: '0.75rem', flexWrap: 'wrap' }}>
                                                    {positions.map(pos => {
                                                        const player = userRoster.find(p => p.pkUnit === unit && p.pkPosition === pos && !p.injury.injured);
                                                        const availablePlayers = userRoster.filter(p => 
                                                            p.position !== 'G' && 
                                                            !p.injury.injured && 
                                                            p.lineNumber > 0 && 
                                                            p.linePosition
                                                        );
                                                        
                                                        return (
                                                            <div key={pos} style={{ flex: '1', minWidth: '180px' }}>
                                                                <div style={{ 
                                                                    padding: '0.75rem',
                                                                    background: player ? 'rgba(239, 68, 68, 0.1)' : 'rgba(100, 116, 139, 0.1)',
                                                                    borderRadius: '0.375rem',
                                                                    border: player ? '1px solid rgba(239, 68, 68, 0.3)' : '1px dashed rgba(100, 116, 139, 0.3)'
                                                                }}>
                                                                    <div style={{ color: '#f87171', fontSize: '0.75rem', fontWeight: 'bold', marginBottom: '0.5rem' }}>
                                                                        {pos}
                                                                    </div>
                                                                    {player ? (
                                                                        <div>
                                                                            <div style={{ color: '#fff', fontWeight: 'bold', fontSize: '0.95rem', marginBottom: '0.25rem' }}>
                                                                                {player.firstName.charAt(0)}. {player.lastName}
                                                                                {pos.includes('-D') && player.position === 'F' && <span style={{color: '#f59e0b', marginLeft: '0.25rem', fontSize: '0.75rem'}} title="Forward playing defense position">âš ï¸</span>}
                                                                                {pos.includes('-F') && player.position === 'D' && <span style={{color: '#f59e0b', marginLeft: '0.25rem', fontSize: '0.75rem'}} title="Defenseman playing forward position">âš ï¸</span>}
                                                                            </div>
                                                                            <div style={{ fontSize: '0.75rem', color: '#64748b', marginBottom: '0.5rem' }}>
                                                                                OVR: {player.ratings.overall} | {player.position} - {player.preferredPosition}
                                                                            </div>
                                                                            <select
                                                                                value={player.id}
                                                                                onChange={(e) => {
                                                                                    if (e.target.value === 'empty') {
                                                                                        assignToSpecialTeams(player.id, 'pk', null, null);
                                                                                    } else if (e.target.value !== player.id) {
                                                                                        const newPlayer = availablePlayers.find(p => p.id === e.target.value);
                                                                                        if (newPlayer) {
                                                                                            // Swap players
                                                                                            const oldUnit = newPlayer.pkUnit;
                                                                                            const oldPos = newPlayer.pkPosition;
                                                                                            assignToSpecialTeams(newPlayer.id, 'pk', unit, pos);
                                                                                            if (oldUnit && oldPos) {
                                                                                                assignToSpecialTeams(player.id, 'pk', oldUnit, oldPos);
                                                                                            } else {
                                                                                                assignToSpecialTeams(player.id, 'pk', null, null);
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }}
                                                                                style={{
                                                                                    width: '100%',
                                                                                    padding: '0.25rem',
                                                                                    background: '#1e3a8a',
                                                                                    border: '1px solid #ef4444',
                                                                                    borderRadius: '0.25rem',
                                                                                    color: '#fff',
                                                                                    fontSize: '0.75rem'
                                                                                }}
                                                                            >
                                                                                <option value={player.id}>{player.lastName}</option>
                                                                                <option value="empty">-- Empty Slot --</option>
                                                                                <optgroup label="Swap With:">
                                                                                    {availablePlayers
                                                                                        .filter(p => p.id !== player.id)
                                                                                        .sort((a, b) => b.ratings.overall - a.ratings.overall)
                                                                                        .map(p => (
                                                                                            <option key={p.id} value={p.id}>
                                                                                                {p.lastName} (OVR {p.ratings.overall}, {p.position})
                                                                                                {p.pkUnit ? ` [PK${p.pkUnit}]` : ''}
                                                                                            </option>
                                                                                        ))}
                                                                                </optgroup>
                                                                            </select>
                                                                        </div>
                                                                    ) : (
                                                                        <div>
                                                                            <div style={{ color: '#64748b', fontSize: '0.85rem', marginBottom: '0.5rem' }}>
                                                                                Empty
                                                                            </div>
                                                                            <select
                                                                                value=""
                                                                                onChange={(e) => {
                                                                                    if (e.target.value) {
                                                                                        assignToSpecialTeams(e.target.value, 'pk', unit, pos);
                                                                                    }
                                                                                }}
                                                                                style={{
                                                                                    width: '100%',
                                                                                    padding: '0.25rem',
                                                                                    background: '#1e3a8a',
                                                                                    border: '1px solid #ef4444',
                                                                                    borderRadius: '0.25rem',
                                                                                    color: '#fff',
                                                                                    fontSize: '0.75rem'
                                                                                }}
                                                                            >
                                                                                <option value="">-- Select Player --</option>
                                                                                {availablePlayers
                                                                                    .filter(p => !p.pkUnit)
                                                                                    .sort((a, b) => b.ratings.overall - a.ratings.overall)
                                                                                    .map(p => (
                                                                                        <option key={p.id} value={p.id}>
                                                                                            {p.lastName} (OVR {p.ratings.overall}, {p.position})
                                                                                        </option>
                                                                                    ))}
                                                                            </select>
                                                                        </div>
                                                                    )}
                                                                </div>
                                                            </div>
                                                        );
                                                    })}
                                                </div>
                                            </div>
                                        );
                                    })}
                                    <div style={{ 
                                        marginTop: '1rem',
                                        padding: '0.75rem',
                                        background: 'rgba(239, 68, 68, 0.1)',
                                        borderRadius: '0.375rem',
                                        fontSize: '0.875rem',
                                        color: '#f87171'
                                    }}>
                                        ðŸ’¡ <strong>Tip:</strong> Typical PK setup is 2F + 2D for defensive balance. Players on both PK1 & PK2 will get more ice time. Out-of-position warnings shown with âš ï¸
                                    </div>
                                </div>

                                {/* HEALTHY SCRATCHES */}
                                <div className="card" style={{ background: 'rgba(100, 116, 139, 0.05)', border: '1px solid rgba(100, 116, 139, 0.3)' }}>
                                    <h2 style={{ color: '#64748b' }}>ðŸš« Healthy Scratches</h2>
                                    <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(180px, 1fr))', gap: '0.75rem' }}>
                                        {userRoster.filter(p => p.position !== 'G' && (p.lineNumber === 0 || !p.linePosition) && !p.injury.injured).map(player => (
                                            <div key={player.id} style={{
                                                padding: '0.75rem',
                                                background: 'rgba(100, 116, 139, 0.1)',
                                                borderRadius: '0.375rem',
                                                border: '1px solid rgba(100, 116, 139, 0.3)'
                                            }}>
                                                <div style={{ color: '#fff', fontWeight: 'bold', fontSize: '0.9rem', marginBottom: '0.25rem' }}>
                                                    {player.firstName.charAt(0)}. {player.lastName}
                                                </div>
                                                <div style={{ color: '#93c5fd', fontSize: '0.75rem', marginBottom: '0.5rem' }}>
                                                    {player.position} | {player.preferredPosition} | OVR {player.ratings.overall}
                                                </div>
                                                <button
                                                    onClick={() => {
                                                        // Find first empty slot for this player
                                                        if (player.position === 'F') {
                                                            for (let line = 4; line >= 1; line--) {
                                                                const positions = ['C', 'LW', 'RW'];
                                                                for (let pos of positions) {
                                                                    const occupied = userRoster.find(p => p.lineNumber === line && p.linePosition === pos && p.position === 'F');
                                                                    if (!occupied) {
                                                                        assignPlayerToLine(player.id, line, pos);
                                                                        return;
                                                                    }
                                                                }
                                                            }
                                                        } else if (player.position === 'D') {
                                                            for (let pair = 3; pair >= 1; pair--) {
                                                                const positions = ['LD', 'RD'];
                                                                for (let pos of positions) {
                                                                    const occupied = userRoster.find(p => p.lineNumber === pair && p.linePosition === pos && p.position === 'D');
                                                                    if (!occupied) {
                                                                        assignPlayerToLine(player.id, pair, pos);
                                                                        return;
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }}
                                                    style={{
                                                        width: '100%',
                                                        padding: '0.375rem',
                                                        background: '#22c55e',
                                                        color: '#fff',
                                                        border: 'none',
                                                        borderRadius: '0.25rem',
                                                        cursor: 'pointer',
                                                        fontSize: '0.75rem',
                                                        fontWeight: 'bold'
                                                    }}
                                                >
                                                    Activate
                                                </button>
                                            </div>
                                        ))}
                                        {userRoster.filter(p => p.position !== 'G' && (p.lineNumber === 0 || !p.linePosition) && !p.injury.injured).length === 0 && (
                                            <div style={{ gridColumn: '1 / -1', padding: '2rem', textAlign: 'center', color: '#64748b' }}>
                                                All players are active
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>
                        )}
                        {currentView === 'stats' && gameState && (
                            <div className="card">
                                <h2>
                                    Player Statistics 
                                    <span style={{ 
                                        marginLeft: '1rem', 
                                        fontSize: '1rem', 
                                        color: seasonMode === 'playoffs' ? '#f59e0b' : '#3b82f6',
                                        padding: '0.25rem 0.75rem',
                                        background: seasonMode === 'playoffs' ? 'rgba(245, 158, 11, 0.2)' : 'rgba(59, 130, 246, 0.2)',
                                        borderRadius: '0.25rem'
                                    }}>
                                        {seasonMode === 'playoffs' ? 'ðŸ† Playoffs' : 'ðŸ“Š Regular Season'}
                                    </span>
                                </h2>
                                {seasonMode === 'playoffs' && !playoffState && (
                                    <p style={{ color: '#f59e0b', marginBottom: '1rem' }}>
                                        Complete the regular season to view playoff stats
                                    </p>
                                )}
                                <table className="stats-table">
                                    <thead>
                                        <tr>
                                            <th className="rank">#</th>
                                            <th style={{ cursor: 'pointer' }} onClick={() => handleSort('lastName')}>
                                                Player {sortConfig.key === 'lastName' && (sortConfig.direction === 'desc' ? 'â–¼' : 'â–²')}
                                            </th>
                                            <th className="text-center" style={{ cursor: 'pointer' }} onClick={() => handleSort('stats.gamesPlayed')}>
                                                GP {sortConfig.key === 'stats.gamesPlayed' && (sortConfig.direction === 'desc' ? 'â–¼' : 'â–²')}
                                            </th>
                                            <th className="text-center" style={{ cursor: 'pointer' }} onClick={() => handleSort('stats.goals')}>
                                                G {sortConfig.key === 'stats.goals' && (sortConfig.direction === 'desc' ? 'â–¼' : 'â–²')}
                                            </th>
                                            <th className="text-center" style={{ cursor: 'pointer' }} onClick={() => handleSort('stats.assists')}>
                                                A {sortConfig.key === 'stats.assists' && (sortConfig.direction === 'desc' ? 'â–¼' : 'â–²')}
                                            </th>
                                            <th className="text-center" style={{ cursor: 'pointer' }} onClick={() => handleSort('stats.points')}>
                                                PTS {sortConfig.key === 'stats.points' && (sortConfig.direction === 'desc' ? 'â–¼' : 'â–²')}
                                            </th>
                                            <th className="text-center" style={{ cursor: 'pointer' }} onClick={() => handleSort('stats.plusMinus')}>
                                                +/- {sortConfig.key === 'stats.plusMinus' && (sortConfig.direction === 'desc' ? 'â–¼' : 'â–²')}
                                            </th>
                                            <th className="text-center" style={{ cursor: 'pointer' }} onClick={() => handleSort('stats.pim')}>
                                                PIM {sortConfig.key === 'stats.pim' && (sortConfig.direction === 'desc' ? 'â–¼' : 'â–²')}
                                            </th>
                                            <th className="text-center" style={{ cursor: 'pointer' }} onClick={() => handleSort('stats.shots')}>
                                                SOG {sortConfig.key === 'stats.shots' && (sortConfig.direction === 'desc' ? 'â–¼' : 'â–²')}
                                            </th>
                                            <th className="text-center" style={{ cursor: 'pointer' }} onClick={() => handleSort('stats.timeOnIce')}>
                                                TOI/G {sortConfig.key === 'stats.timeOnIce' && (sortConfig.direction === 'desc' ? 'â–¼' : 'â–²')}
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {sortData(userRoster.filter(p => p.position !== 'G'), sortConfig.key, sortConfig.direction)
                                            .map((player, idx) => {
                                                // Use playoff stats if in playoff mode, otherwise regular season stats
                                                const statsToShow = seasonMode === 'playoffs' ? (player.playoffStats || player.stats) : player.stats;
                                                const avgTOI = statsToShow.gamesPlayed > 0 ? statsToShow.timeOnIce / statsToShow.gamesPlayed : 0;
                                                return (
                                                    <tr key={player.id}>
                                                        <td className="rank">{idx + 1}</td>
                                                        <td className="player-name" style={{ cursor: 'pointer', textDecoration: 'underline' }} onClick={() => navigateTo('playerProfile', player)}>
                                                            {player.firstName} {player.lastName}
                                                            <span className="player-pos">{player.position}</span>
                                                        </td>
                                                        <td className="text-center">{statsToShow.gamesPlayed}</td>
                                                        <td className="text-center">{statsToShow.goals}</td>
                                                        <td className="text-center">{statsToShow.assists}</td>
                                                        <td className="text-center">{statsToShow.points}</td>
                                                        <td className="text-center">{statsToShow.plusMinus > 0 ? '+' : ''}{statsToShow.plusMinus}</td>
                                                        <td className="text-center">{statsToShow.pim}</td>
                                                        <td className="text-center">{statsToShow.shots}</td>
                                                        <td className="text-center">{formatTOI(avgTOI)}</td>
                                                    </tr>
                                                );
                                            })}
                                    </tbody>
                                </table>
                                
                                <h2 style={{ marginTop: '2rem' }}>Goalie Statistics</h2>
                                <table className="stats-table">
                                    <thead>
                                        <tr>
                                            <th className="rank">#</th>
                                            <th>Player</th>
                                            <th className="text-center">GP</th>
                                            <th className="text-center">W</th>
                                            <th className="text-center">L</th>
                                            <th className="text-center">SV%</th>
                                            <th className="text-center">GAA</th>
                                            <th className="text-center">SO</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {userRoster
                                            .filter(p => p.position === 'G')
                                            .sort((a, b) => (b.stats.savePercentage || 0) - (a.stats.savePercentage || 0))
                                            .map((player, idx) => (
                                                <tr key={player.id}>
                                                    <td className="rank">{idx + 1}</td>
                                                    <td className="player-name" style={{ cursor: 'pointer', textDecoration: 'underline' }} onClick={() => navigateTo('playerProfile', player)}>
                                                        {player.firstName} {player.lastName}
                                                    </td>
                                                    <td className="text-center">{player.stats.gamesPlayed}</td>
                                                    <td className="text-center">{player.stats.wins || 0}</td>
                                                    <td className="text-center">{player.stats.losses || 0}</td>
                                                    <td className="text-center">{player.stats.gamesPlayed > 0 ? (player.stats.savePercentage || 0).toFixed(3) : '.000'}</td>
                                                    <td className="text-center">{player.stats.gamesPlayed > 0 ? (player.stats.gaa || 0).toFixed(2) : '0.00'}</td>
                                                    <td className="text-center">{player.stats.shutouts || 0}</td>
                                                </tr>
                                            ))}
                                    </tbody>
                                </table>
                            </div>
                        )}

                        {currentView === 'leaders' && gameState && (
                            <div>
                                <div className="card">
                                    <h2>
                                        League Leaders 
                                        <span style={{ 
                                            marginLeft: '1rem', 
                                            fontSize: '1rem', 
                                            color: seasonMode === 'playoffs' ? '#f59e0b' : '#3b82f6',
                                            padding: '0.25rem 0.75rem',
                                            background: seasonMode === 'playoffs' ? 'rgba(245, 158, 11, 0.2)' : 'rgba(59, 130, 246, 0.2)',
                                            borderRadius: '0.25rem'
                                        }}>
                                            {seasonMode === 'playoffs' ? 'ðŸ† Playoffs' : 'ðŸ“Š Regular Season'}
                                        </span>
                                    </h2>
                                    {seasonMode === 'playoffs' && !playoffState && (
                                        <p style={{ color: '#f59e0b', marginBottom: '1rem' }}>
                                            Complete the regular season to view playoff leaders
                                        </p>
                                    )}
                                    {seasonMode === 'playoffs' && playoffState && gameState.players.filter(p => p.playoffStats && p.playoffStats.gamesPlayed > 0).length === 0 && (
                                        <p style={{ color: '#f59e0b', marginBottom: '1rem' }}>
                                            No playoff stats yet - simulate some playoff games to see leaders
                                        </p>
                                    )}
                                    
                                    <h3>Points</h3>
                                    <table className="stats-table">
                                        <thead>
                                            <tr>
                                                <th className="rank">#</th>
                                                <th>Player</th>
                                                <th>Team</th>
                                                <th className="text-center">GP</th>
                                                <th className="text-center">G</th>
                                                <th className="text-center">A</th>
                                                <th className="text-center">PTS</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {gameState.players
                                                .filter(p => {
                                                    if (p.position === 'G' || p.roster !== 'nhl') return false;
                                                    const statsToCheck = seasonMode === 'playoffs' ? p.playoffStats : p.stats;
                                                    return statsToCheck && statsToCheck.gamesPlayed > 0;
                                                })
                                                .sort((a, b) => {
                                                    const aStats = seasonMode === 'playoffs' ? (a.playoffStats || a.stats) : a.stats;
                                                    const bStats = seasonMode === 'playoffs' ? (b.playoffStats || b.stats) : b.stats;
                                                    return (bStats.points || 0) - (aStats.points || 0);
                                                })
                                                .slice(0, 10)
                                                .map((player, idx) => {
                                                    const team = TEAMS.find(t => t.id === player.teamId);
                                                    const statsToShow = seasonMode === 'playoffs' ? (player.playoffStats || player.stats) : player.stats;
                                                    return (
                                                        <tr key={player.id}>
                                                            <td className="rank">{idx + 1}</td>
                                                            <td className="player-name" style={{ cursor: 'pointer', textDecoration: 'underline' }} onClick={() => navigateTo('playerProfile', player)}>
                                                                {player.firstName} {player.lastName}
                                                                <span className="player-pos">{player.position}</span>
                                                            </td>
                                                            <td>{team?.city || 'N/A'}</td>
                                                            <td className="text-center">{statsToShow.gamesPlayed || 0}</td>
                                                            <td className="text-center">{statsToShow.goals || 0}</td>
                                                            <td className="text-center">{statsToShow.assists || 0}</td>
                                                            <td className="text-center">{statsToShow.points || 0}</td>
                                                        </tr>
                                                    );
                                                })}
                                        </tbody>
                                    </table>

                                    <h3>Goals</h3>
                                    <table className="stats-table">
                                        <thead>
                                            <tr>
                                                <th className="rank">#</th>
                                                <th>Player</th>
                                                <th>Team</th>
                                                <th className="text-center">GP</th>
                                                <th className="text-center">G</th>
                                                <th className="text-center">PTS</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {gameState.players
                                                .filter(p => p.position !== 'G' && p.roster === 'nhl')
                                                .sort((a, b) => {
                                                    const aStats = seasonMode === 'playoffs' ? (a.playoffStats || a.stats) : a.stats;
                                                    const bStats = seasonMode === 'playoffs' ? (b.playoffStats || b.stats) : b.stats;
                                                    return bStats.goals - aStats.goals;
                                                })
                                                .slice(0, 10)
                                                .map((player, idx) => {
                                                    const team = TEAMS.find(t => t.id === player.teamId);
                                                    const statsToShow = seasonMode === 'playoffs' ? (player.playoffStats || player.stats) : player.stats;
                                                    return (
                                                        <tr key={player.id}>
                                                            <td className="rank">{idx + 1}</td>
                                                            <td className="player-name" style={{ cursor: 'pointer', textDecoration: 'underline' }} onClick={() => navigateTo('playerProfile', player)}>
                                                                {player.firstName} {player.lastName}
                                                                <span className="player-pos">{player.position}</span>
                                                            </td>
                                                            <td>{team?.city || 'N/A'}</td>
                                                            <td className="text-center">{statsToShow.gamesPlayed}</td>
                                                            <td className="text-center">{statsToShow.goals}</td>
                                                            <td className="text-center">{statsToShow.points}</td>
                                                        </tr>
                                                    );
                                                })}
                                        </tbody>
                                    </table>

                                    <h3>Assists</h3>
                                    <table className="stats-table">
                                        <thead>
                                            <tr>
                                                <th className="rank">#</th>
                                                <th>Player</th>
                                                <th>Team</th>
                                                <th className="text-center">GP</th>
                                                <th className="text-center">A</th>
                                                <th className="text-center">PTS</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {gameState.players
                                                .filter(p => p.position !== 'G' && p.roster === 'nhl')
                                                .sort((a, b) => {
                                                    const aStats = seasonMode === 'playoffs' ? (a.playoffStats || a.stats) : a.stats;
                                                    const bStats = seasonMode === 'playoffs' ? (b.playoffStats || b.stats) : b.stats;
                                                    return bStats.assists - aStats.assists;
                                                })
                                                .slice(0, 10)
                                                .map((player, idx) => {
                                                    const team = TEAMS.find(t => t.id === player.teamId);
                                                    const statsToShow = seasonMode === 'playoffs' ? (player.playoffStats || player.stats) : player.stats;
                                                    return (
                                                        <tr key={player.id}>
                                                            <td className="rank">{idx + 1}</td>
                                                            <td className="player-name" style={{ cursor: 'pointer', textDecoration: 'underline' }} onClick={() => navigateTo('playerProfile', player)}>
                                                                {player.firstName} {player.lastName}
                                                                <span className="player-pos">{player.position}</span>
                                                            </td>
                                                            <td>{team?.city || 'N/A'}</td>
                                                            <td className="text-center">{statsToShow.gamesPlayed}</td>
                                                            <td className="text-center">{statsToShow.assists}</td>
                                                            <td className="text-center">{statsToShow.points}</td>
                                                        </tr>
                                                    );
                                                })}
                                        </tbody>
                                    </table>

                                    <h3>Plus/Minus</h3>
                                    <table className="stats-table">
                                        <thead>
                                            <tr>
                                                <th className="rank">#</th>
                                                <th>Player</th>
                                                <th>Team</th>
                                                <th className="text-center">GP</th>
                                                <th className="text-center">+/-</th>
                                                <th className="text-center">PTS</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {gameState.players
                                                .filter(p => p.position !== 'G' && p.roster === 'nhl')
                                                .sort((a, b) => {
                                                    const aStats = seasonMode === 'playoffs' ? (a.playoffStats || a.stats) : a.stats;
                                                    const bStats = seasonMode === 'playoffs' ? (b.playoffStats || b.stats) : b.stats;
                                                    return bStats.plusMinus - aStats.plusMinus;
                                                })
                                                .slice(0, 10)
                                                .map((player, idx) => {
                                                    const team = TEAMS.find(t => t.id === player.teamId);
                                                    const statsToShow = seasonMode === 'playoffs' ? (player.playoffStats || player.stats) : player.stats;
                                                    return (
                                                        <tr key={player.id}>
                                                            <td className="rank">{idx + 1}</td>
                                                            <td className="player-name" style={{ cursor: 'pointer', textDecoration: 'underline' }} onClick={() => navigateTo('playerProfile', player)}>
                                                                {player.firstName} {player.lastName}
                                                                <span className="player-pos">{player.position}</span>
                                                            </td>
                                                            <td>{team?.city || 'N/A'}</td>
                                                            <td className="text-center">{statsToShow.gamesPlayed}</td>
                                                            <td className="text-center">{statsToShow.plusMinus > 0 ? '+' : ''}{statsToShow.plusMinus}</td>
                                                            <td className="text-center">{statsToShow.points}</td>
                                                        </tr>
                                                    );
                                                })}
                                        </tbody>
                                    </table>

                                    <h3>Penalty Minutes</h3>
                                    <table className="stats-table">
                                        <thead>
                                            <tr>
                                                <th className="rank">#</th>
                                                <th>Player</th>
                                                <th>Team</th>
                                                <th className="text-center">GP</th>
                                                <th className="text-center">PIM</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {gameState.players
                                                .filter(p => {
                                                    const statsToCheck = seasonMode === 'playoffs' ? p.playoffStats : p.stats;
                                                    return p.position !== 'G' && p.roster === 'nhl' && statsToCheck.gamesPlayed > 0;
                                                })
                                                .sort((a, b) => {
                                                    const aStats = seasonMode === 'playoffs' ? (a.playoffStats || a.stats) : a.stats;
                                                    const bStats = seasonMode === 'playoffs' ? (b.playoffStats || b.stats) : b.stats;
                                                    return bStats.pim - aStats.pim;
                                                })
                                                .slice(0, 10)
                                                .map((player, idx) => {
                                                    const team = TEAMS.find(t => t.id === player.teamId);
                                                    const statsToShow = seasonMode === 'playoffs' ? (player.playoffStats || player.stats) : player.stats;
                                                    return (
                                                        <tr key={player.id}>
                                                            <td className="rank">{idx + 1}</td>
                                                            <td className="player-name" style={{ cursor: 'pointer', textDecoration: 'underline' }} onClick={() => navigateTo('playerProfile', player)}>
                                                                {player.firstName} {player.lastName}
                                                                <span className="player-pos">{player.position}</span>
                                                            </td>
                                                            <td>{team?.city || 'N/A'}</td>
                                                            <td className="text-center">{statsToShow.gamesPlayed}</td>
                                                            <td className="text-center">{statsToShow.pim}</td>
                                                        </tr>
                                                    );
                                                })}
                                        </tbody>
                                    </table>

                                    <h3>Shots on Goal</h3>
                                    <table className="stats-table">
                                        <thead>
                                            <tr>
                                                <th className="rank">#</th>
                                                <th>Player</th>
                                                <th>Team</th>
                                                <th className="text-center">GP</th>
                                                <th className="text-center">SOG</th>
                                                <th className="text-center">G</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {gameState.players
                                                .filter(p => p.position !== 'G' && p.roster === 'nhl')
                                                .sort((a, b) => {
                                                    const aStats = seasonMode === 'playoffs' ? (a.playoffStats || a.stats) : a.stats;
                                                    const bStats = seasonMode === 'playoffs' ? (b.playoffStats || b.stats) : b.stats;
                                                    return bStats.shots - aStats.shots;
                                                })
                                                .slice(0, 10)
                                                .map((player, idx) => {
                                                    const team = TEAMS.find(t => t.id === player.teamId);
                                                    const statsToShow = seasonMode === 'playoffs' ? (player.playoffStats || player.stats) : player.stats;
                                                    return (
                                                        <tr key={player.id}>
                                                            <td className="rank">{idx + 1}</td>
                                                            <td className="player-name" style={{ cursor: 'pointer', textDecoration: 'underline' }} onClick={() => navigateTo('playerProfile', player)}>
                                                                {player.firstName} {player.lastName}
                                                                <span className="player-pos">{player.position}</span>
                                                            </td>
                                                            <td>{team?.city || 'N/A'}</td>
                                                            <td className="text-center">{statsToShow.gamesPlayed}</td>
                                                            <td className="text-center">{statsToShow.shots}</td>
                                                            <td className="text-center">{statsToShow.goals}</td>
                                                        </tr>
                                                    );
                                                })}
                                        </tbody>
                                    </table>

                                    <h3>Time on Ice Per Game</h3>
                                    <table className="stats-table">
                                        <thead>
                                            <tr>
                                                <th className="rank">#</th>
                                                <th>Player</th>
                                                <th>Team</th>
                                                <th className="text-center">GP</th>
                                                <th className="text-center">TOI/G</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {gameState.players
                                                .filter(p => {
                                                    const statsToCheck = seasonMode === 'playoffs' ? p.playoffStats : p.stats;
                                                    return p.position !== 'G' && statsToCheck.gamesPlayed > 0;
                                                })
                                                .sort((a, b) => {
                                                    const aStats = seasonMode === 'playoffs' ? (a.playoffStats || a.stats) : a.stats;
                                                    const bStats = seasonMode === 'playoffs' ? (b.playoffStats || b.stats) : b.stats;
                                                    return (bStats.timeOnIce / bStats.gamesPlayed) - (aStats.timeOnIce / aStats.gamesPlayed);
                                                })
                                                .slice(0, 10)
                                                .map((player, idx) => {
                                                    const team = TEAMS.find(t => t.id === player.teamId);
                                                    const statsToShow = seasonMode === 'playoffs' ? (player.playoffStats || player.stats) : player.stats;
                                                    const avgTOI = statsToShow.timeOnIce / statsToShow.gamesPlayed;
                                                    return (
                                                        <tr key={player.id}>
                                                            <td className="rank">{idx + 1}</td>
                                                            <td className="player-name" style={{ cursor: 'pointer', textDecoration: 'underline' }} onClick={() => navigateTo('playerProfile', player)}>
                                                                {player.firstName} {player.lastName}
                                                                <span className="player-pos">{player.position}</span>
                                                            </td>
                                                            <td>{team?.city || 'N/A'}</td>
                                                            <td className="text-center">{statsToShow.gamesPlayed}</td>
                                                            <td className="text-center">{formatTOI(avgTOI)}</td>
                                                        </tr>
                                                    );
                                                })}
                                        </tbody>
                                    </table>
                                    
                                    {/* Goalie Stats */}
                                    <h3 style={{ marginTop: '3rem', paddingTop: '2rem', borderTop: '2px solid rgba(100, 116, 139, 0.3)' }}>ðŸ¥… Goalie Leaders</h3>
                                    
                                    <h3 style={{ fontSize: '1.1rem', color: '#93c5fd', marginTop: '2rem' }}>Wins</h3>
                                    <table className="stats-table">
                                        <thead>
                                            <tr>
                                                <th className="rank">#</th>
                                                <th>Player</th>
                                                <th>Team</th>
                                                <th className="text-center">GP</th>
                                                <th className="text-center">W</th>
                                                <th className="text-center">L</th>
                                                <th className="text-center">SV%</th>
                                                <th className="text-center">GAA</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {gameState.players
                                                .filter(p => {
                                                    const statsToCheck = seasonMode === 'playoffs' ? p.playoffStats : p.stats;
                                                    return p.position === 'G' && p.roster === 'nhl' && statsToCheck.gamesPlayed > 0;
                                                })
                                                .sort((a, b) => {
                                                    const aStats = seasonMode === 'playoffs' ? (a.playoffStats || a.stats) : a.stats;
                                                    const bStats = seasonMode === 'playoffs' ? (b.playoffStats || b.stats) : b.stats;
                                                    return (bStats.wins || 0) - (aStats.wins || 0);
                                                })
                                                .slice(0, 10)
                                                .map((player, idx) => {
                                                    const team = TEAMS.find(t => t.id === player.teamId);
                                                    const statsToShow = seasonMode === 'playoffs' ? (player.playoffStats || player.stats) : player.stats;
                                                    return (
                                                        <tr key={player.id}>
                                                            <td className="rank">{idx + 1}</td>
                                                            <td className="player-name" style={{ cursor: 'pointer', textDecoration: 'underline' }} onClick={() => navigateTo('playerProfile', player)}>
                                                                {player.firstName} {player.lastName}
                                                                <span className="player-pos">{player.position}</span>
                                                            </td>
                                                            <td>{team?.city || 'N/A'}</td>
                                                            <td className="text-center">{statsToShow.gamesPlayed}</td>
                                                            <td className="text-center">{statsToShow.wins || 0}</td>
                                                            <td className="text-center">{statsToShow.losses || 0}</td>
                                                            <td className="text-center">{statsToShow.savePercentage ? statsToShow.savePercentage.toFixed(3) : '.000'}</td>
                                                            <td className="text-center">{statsToShow.gaa ? statsToShow.gaa.toFixed(2) : '0.00'}</td>
                                                        </tr>
                                                    );
                                                })}
                                        </tbody>
                                    </table>
                                    
                                    <h3 style={{ fontSize: '1.1rem', color: '#93c5fd', marginTop: '2rem' }}>Save Percentage</h3>
                                    <table className="stats-table">
                                        <thead>
                                            <tr>
                                                <th className="rank">#</th>
                                                <th>Player</th>
                                                <th>Team</th>
                                                <th className="text-center">GP</th>
                                                <th className="text-center">SV%</th>
                                                <th className="text-center">GAA</th>
                                                <th className="text-center">W</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {gameState.players
                                                .filter(p => {
                                                    const statsToCheck = seasonMode === 'playoffs' ? p.playoffStats : p.stats;
                                                    return p.position === 'G' && p.roster === 'nhl' && statsToCheck.gamesPlayed >= 27; // NHL minimum: 27 GP
                                                })
                                                .sort((a, b) => {
                                                    const aStats = seasonMode === 'playoffs' ? (a.playoffStats || a.stats) : a.stats;
                                                    const bStats = seasonMode === 'playoffs' ? (b.playoffStats || b.stats) : b.stats;
                                                    return (bStats.savePercentage || 0) - (aStats.savePercentage || 0);
                                                })
                                                .slice(0, 10)
                                                .map((player, idx) => {
                                                    const team = TEAMS.find(t => t.id === player.teamId);
                                                    const statsToShow = seasonMode === 'playoffs' ? (player.playoffStats || player.stats) : player.stats;
                                                    return (
                                                        <tr key={player.id}>
                                                            <td className="rank">{idx + 1}</td>
                                                            <td className="player-name" style={{ cursor: 'pointer', textDecoration: 'underline' }} onClick={() => navigateTo('playerProfile', player)}>
                                                                {player.firstName} {player.lastName}
                                                                <span className="player-pos">{player.position}</span>
                                                            </td>
                                                            <td>{team?.city || 'N/A'}</td>
                                                            <td className="text-center">{statsToShow.gamesPlayed}</td>
                                                            <td className="text-center">{statsToShow.savePercentage ? statsToShow.savePercentage.toFixed(3) : '.000'}</td>
                                                            <td className="text-center">{statsToShow.gaa ? statsToShow.gaa.toFixed(2) : '0.00'}</td>
                                                            <td className="text-center">{statsToShow.wins || 0}</td>
                                                        </tr>
                                                    );
                                                })}
                                        </tbody>
                                    </table>
                                    
                                    <h3 style={{ fontSize: '1.1rem', color: '#93c5fd', marginTop: '2rem' }}>Goals Against Average</h3>
                                    <table className="stats-table">
                                        <thead>
                                            <tr>
                                                <th className="rank">#</th>
                                                <th>Player</th>
                                                <th>Team</th>
                                                <th className="text-center">GP</th>
                                                <th className="text-center">GAA</th>
                                                <th className="text-center">SV%</th>
                                                <th className="text-center">W</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {gameState.players
                                                .filter(p => {
                                                    const statsToCheck = seasonMode === 'playoffs' ? p.playoffStats : p.stats;
                                                    return p.position === 'G' && p.roster === 'nhl' && statsToCheck.gamesPlayed >= 27; // NHL minimum: 27 GP
                                                })
                                                .sort((a, b) => {
                                                    const aStats = seasonMode === 'playoffs' ? (a.playoffStats || a.stats) : a.stats;
                                                    const bStats = seasonMode === 'playoffs' ? (b.playoffStats || b.stats) : b.stats;
                                                    return (aStats.gaa || 999) - (bStats.gaa || 999); // Lower is better
                                                })
                                                .slice(0, 10)
                                                .map((player, idx) => {
                                                    const team = TEAMS.find(t => t.id === player.teamId);
                                                    const statsToShow = seasonMode === 'playoffs' ? (player.playoffStats || player.stats) : player.stats;
                                                    return (
                                                        <tr key={player.id}>
                                                            <td className="rank">{idx + 1}</td>
                                                            <td className="player-name" style={{ cursor: 'pointer', textDecoration: 'underline' }} onClick={() => navigateTo('playerProfile', player)}>
                                                                {player.firstName} {player.lastName}
                                                                <span className="player-pos">{player.position}</span>
                                                            </td>
                                                            <td>{team?.city || 'N/A'}</td>
                                                            <td className="text-center">{statsToShow.gamesPlayed}</td>
                                                            <td className="text-center">{statsToShow.gaa ? statsToShow.gaa.toFixed(2) : '0.00'}</td>
                                                            <td className="text-center">{statsToShow.savePercentage ? statsToShow.savePercentage.toFixed(3) : '.000'}</td>
                                                            <td className="text-center">{statsToShow.wins || 0}</td>
                                                        </tr>
                                                    );
                                                })}
                                        </tbody>
                                    </table>
                                    
                                    <h3 style={{ fontSize: '1.1rem', color: '#93c5fd', marginTop: '2rem' }}>Shutouts</h3>
                                    <table className="stats-table">
                                        <thead>
                                            <tr>
                                                <th className="rank">#</th>
                                                <th>Player</th>
                                                <th>Team</th>
                                                <th className="text-center">GP</th>
                                                <th className="text-center">SO</th>
                                                <th className="text-center">W</th>
                                                <th className="text-center">SV%</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {gameState.players
                                                .filter(p => {
                                                    const statsToCheck = seasonMode === 'playoffs' ? p.playoffStats : p.stats;
                                                    return p.position === 'G' && p.roster === 'nhl' && statsToCheck.gamesPlayed > 0;
                                                })
                                                .sort((a, b) => {
                                                    const aStats = seasonMode === 'playoffs' ? (a.playoffStats || a.stats) : a.stats;
                                                    const bStats = seasonMode === 'playoffs' ? (b.playoffStats || b.stats) : b.stats;
                                                    return (bStats.shutouts || 0) - (aStats.shutouts || 0);
                                                })
                                                .slice(0, 10)
                                                .map((player, idx) => {
                                                    const team = TEAMS.find(t => t.id === player.teamId);
                                                    const statsToShow = seasonMode === 'playoffs' ? (player.playoffStats || player.stats) : player.stats;
                                                    return (
                                                        <tr key={player.id}>
                                                            <td className="rank">{idx + 1}</td>
                                                            <td className="player-name" style={{ cursor: 'pointer', textDecoration: 'underline' }} onClick={() => navigateTo('playerProfile', player)}>
                                                                {player.firstName} {player.lastName}
                                                                <span className="player-pos">{player.position}</span>
                                                            </td>
                                                            <td>{team?.city || 'N/A'}</td>
                                                            <td className="text-center">{statsToShow.gamesPlayed}</td>
                                                            <td className="text-center">{statsToShow.shutouts || 0}</td>
                                                            <td className="text-center">{statsToShow.wins || 0}</td>
                                                            <td className="text-center">{statsToShow.savePercentage ? statsToShow.savePercentage.toFixed(3) : '.000'}</td>
                                                        </tr>
                                                    );
                                                })}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        )}

                        {currentView === 'teamStats' && gameState && (
                            <div className="card">
                                <h2>Team Statistics</h2>
                                
                                <table className="stats-table">
                                    <thead>
                                        <tr>
                                            <th>Team</th>
                                            <th className="text-center">GP</th>
                                            <th className="text-center">GF/G</th>
                                            <th className="text-center">GA/G</th>
                                            <th className="text-center">Diff</th>
                                            <th className="text-center">SF/G</th>
                                            <th className="text-center">SA/G</th>
                                            <th className="text-center">S%</th>
                                            <th className="text-center">PP%</th>
                                            <th className="text-center">PK%</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {gameState.standings
                                            .sort((a, b) => {
                                                // Sort by points first
                                                return b.points - a.points;
                                            })
                                            .map(standing => {
                                                const team = getTeam(standing.teamId);
                                                const stats = standing.teamStats;
                                                const gp = stats.gamesPlayed || 1; // Avoid division by zero
                                                
                                                // Calculate per-game averages
                                                const gfPerGame = (standing.goalsFor / gp).toFixed(2);
                                                const gaPerGame = (standing.goalsAgainst / gp).toFixed(2);
                                                const goalDiff = (standing.goalsFor - standing.goalsAgainst) / gp;
                                                const shotsPerGame = (stats.shots / gp).toFixed(1);
                                                const shotsAgainstPerGame = (stats.shotsAgainst / gp).toFixed(1);
                                                const shootingPct = stats.shots > 0 ? ((standing.goalsFor / stats.shots) * 100).toFixed(1) : '0.0';
                                                const ppPct = stats.ppOpportunities > 0 ? ((stats.ppGoals / stats.ppOpportunities) * 100).toFixed(1) : '0.0';
                                                const pkPct = stats.pkOpportunities > 0 ? (((stats.pkOpportunities - stats.pkGoalsAgainst) / stats.pkOpportunities) * 100).toFixed(1) : '0.0';
                                                
                                                return (
                                                    <tr key={standing.teamId}>
                                                        <td>
                                                            <span 
                                                                style={{ cursor: 'pointer', textDecoration: 'underline' }}
                                                                onClick={() => {
                                                                    setSelectedTeamId(standing.teamId);
                                                                    setCurrentView('teamProfile');
                                                                }}
                                                            >
                                                                {team?.city || 'Unknown'}
                                                            </span>
                                                        </td>
                                                        <td className="text-center">{gp}</td>
                                                        <td className="text-center">{gfPerGame}</td>
                                                        <td className="text-center">{gaPerGame}</td>
                                                        <td className="text-center" style={{ color: goalDiff > 0 ? '#4ade80' : goalDiff < 0 ? '#f87171' : '#fff' }}>
                                                            {goalDiff > 0 ? '+' : ''}{goalDiff.toFixed(2)}
                                                        </td>
                                                        <td className="text-center">{shotsPerGame}</td>
                                                        <td className="text-center">{shotsAgainstPerGame}</td>
                                                        <td className="text-center">{shootingPct}%</td>
                                                        <td className="text-center" style={{ color: parseFloat(ppPct) >= 20 ? '#4ade80' : parseFloat(ppPct) < 15 ? '#f87171' : '#fff' }}>
                                                            {ppPct}%
                                                        </td>
                                                        <td className="text-center" style={{ color: parseFloat(pkPct) >= 82 ? '#4ade80' : parseFloat(pkPct) < 78 ? '#f87171' : '#fff' }}>
                                                            {pkPct}%
                                                        </td>
                                                    </tr>
                                                );
                                            })}
                                    </tbody>
                                </table>
                                
                                <div style={{ marginTop: '2rem', padding: '1rem', background: 'rgba(30, 58, 138, 0.2)', borderRadius: '0.5rem' }}>
                                    <h3 style={{ marginBottom: '1rem', color: '#93c5fd' }}>Legend</h3>
                                    <div style={{ display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: '0.5rem', fontSize: '0.9rem' }}>
                                        <div><strong>GF/G:</strong> Goals For per Game</div>
                                        <div><strong>GA/G:</strong> Goals Against per Game</div>
                                        <div><strong>Diff:</strong> Goal Differential per Game</div>
                                        <div><strong>SF/G:</strong> Shots For per Game</div>
                                        <div><strong>SA/G:</strong> Shots Against per Game</div>
                                        <div><strong>S%:</strong> Shooting Percentage</div>
                                        <div><strong>PP%:</strong> Power Play Success Rate</div>
                                        <div><strong>PK%:</strong> Penalty Kill Success Rate</div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {currentView === 'playerProfile' && selectedPlayerProfile && (() => {
                            const team = getTeam(selectedPlayerProfile.teamId);
                            return (
                            <div>
                                <button 
                                    onClick={goBack}
                                    style={{
                                        padding: '0.5rem 1rem',
                                        background: '#2563eb',
                                        color: '#fff',
                                        border: 'none',
                                        borderRadius: '0.375rem',
                                        cursor: 'pointer',
                                        marginBottom: '1rem',
                                        fontWeight: 'bold'
                                    }}
                                >
                                    â† Back
                                </button>
                                
                            <div className="card">
                                <h2>{selectedPlayerProfile.firstName} {selectedPlayerProfile.lastName}</h2>
                                <div style={{ marginBottom: '1.5rem', padding: '1rem', background: 'rgba(30, 58, 138, 0.3)', borderRadius: '0.5rem' }}>
                                    <p style={{ marginBottom: '0.5rem' }}><strong>Position:</strong> {selectedPlayerProfile.position}</p>
                                    <p style={{ marginBottom: '0.5rem' }}><strong>Age:</strong> {selectedPlayerProfile.age}</p>
                                    <p style={{ marginBottom: '0.5rem' }}><strong>Team:</strong> {team?.city} {team?.name}</p>
                                    <p style={{ marginBottom: '0.5rem' }}><strong>Overall Rating:</strong> {selectedPlayerProfile.ratings.overall}</p>
                                    <p><strong>Potential:</strong> {selectedPlayerProfile.ratings.potential}</p>
                                </div>

                                {/* Achievements Section */}
                                {selectedPlayerProfile.achievements && selectedPlayerProfile.achievements.length > 0 && (
                                    <div style={{ marginBottom: '2rem', padding: '1.5rem', background: 'rgba(251, 191, 36, 0.1)', border: '2px solid rgba(251, 191, 36, 0.3)', borderRadius: '0.5rem' }}>
                                        <h3 style={{ marginBottom: '1rem', color: '#fbbf24', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
                                            ðŸ† Achievements
                                        </h3>
                                        <div style={{ display: 'flex', flexDirection: 'column', gap: '0.5rem' }}>
                                            {selectedPlayerProfile.achievements
                                                .sort((a, b) => {
                                                    // First, sort by year (most recent first)
                                                    if (b.year !== a.year) return b.year - a.year;
                                                    
                                                    // Second, sort by importance level
                                                    const getImportance = (achievement) => {
                                                        // League-level (most important)
                                                        if (achievement.type === 'award') return 1; // League trophies
                                                        if (achievement.type === 'allstar_team') return 2; // All-Star teams (1st/2nd/3rd)
                                                        if (achievement.type === 'leagueLeader' || achievement.type === 'league_leader') return 3; // League leaders
                                                        
                                                        // Conference-level
                                                        if (achievement.type === 'allstar') return 4; // Conference All-Stars
                                                        
                                                        // Division-level (least important)
                                                        if (achievement.type === 'division_award') return 5; // Division awards
                                                        if (achievement.type === 'division_allstar') return 6; // Division All-Star teams
                                                        
                                                        return 7; // Unknown types last
                                                    };
                                                    
                                                    const importanceA = getImportance(a);
                                                    const importanceB = getImportance(b);
                                                    
                                                    if (importanceA !== importanceB) return importanceA - importanceB;
                                                    
                                                    // Third, within same importance level, sort by specific criteria
                                                    
                                                    // For All-Star teams, sort by rank (1st, 2nd, 3rd)
                                                    if (a.type === 'allstar_team' && b.type === 'allstar_team') {
                                                        const rankA = a.team.includes('1st') ? 1 : a.team.includes('2nd') ? 2 : 3;
                                                        const rankB = b.team.includes('1st') ? 1 : b.team.includes('2nd') ? 2 : 3;
                                                        return rankA - rankB;
                                                    }
                                                    
                                                    // For awards, sort alphabetically
                                                    if (a.type === 'award' && b.type === 'award') {
                                                        return (a.award || '').localeCompare(b.award || '');
                                                    }
                                                    
                                                    // For league leaders, sort by stat name
                                                    if ((a.type === 'leagueLeader' || a.type === 'league_leader') && 
                                                        (b.type === 'leagueLeader' || b.type === 'league_leader')) {
                                                        return (a.stat || a.category || '').localeCompare(b.stat || b.category || '');
                                                    }
                                                    
                                                    // For division awards, sort alphabetically
                                                    if (a.type === 'division_award' && b.type === 'division_award') {
                                                        return (a.award || '').localeCompare(b.award || '');
                                                    }
                                                    
                                                    return 0;
                                                })
                                                .map((achievement, idx) => (
                                                    <div key={idx} style={{ 
                                                        padding: '0.75rem', 
                                                        background: 'rgba(30, 58, 138, 0.3)', 
                                                        borderRadius: '0.375rem',
                                                        display: 'flex',
                                                        alignItems: 'center',
                                                        gap: '0.75rem'
                                                    }}>
                                                        <span style={{ fontSize: '1.5rem' }}>{achievement.icon}</span>
                                                        <div>
                                                            <strong style={{ color: '#fbbf24' }}>{achievement.year}</strong>
                                                            {achievement.type === 'award' && (
                                                                <span style={{ marginLeft: '0.5rem' }}>{achievement.award}</span>
                                                            )}
                                                            {achievement.type === 'allstar' && (
                                                                <span style={{ marginLeft: '0.5rem' }}>{achievement.conference} Conference All-Star</span>
                                                            )}
                                                            {achievement.type === 'allstar_team' && (
                                                                <span style={{ marginLeft: '0.5rem' }}>{achievement.team}</span>
                                                            )}
                                                            {achievement.type === 'division_award' && (
                                                                <span style={{ marginLeft: '0.5rem' }}>{achievement.award}</span>
                                                            )}
                                                            {achievement.type === 'division_allstar' && (
                                                                <span style={{ marginLeft: '0.5rem' }}>{achievement.team}</span>
                                                            )}
                                                            {(achievement.type === 'leagueLeader' || achievement.type === 'league_leader') && (
                                                                <span style={{ marginLeft: '0.5rem' }}>
                                                                    League Leader - {achievement.stat || achievement.category} ({achievement.value})
                                                                </span>
                                                            )}
                                                        </div>
                                                    </div>
                                                ))}
                                        </div>
                                    </div>
                                )}

                                {/* Stats Type Dropdown (Regular Season / Playoffs) */}
                                <div style={{ marginBottom: '1rem', display: 'flex', alignItems: 'center', gap: '1rem' }}>
                                    <label style={{ fontWeight: 'bold', color: '#93c5fd' }}>Stats Type:</label>
                                    <select 
                                        value={playerStatMode}
                                        onChange={(e) => setPlayerStatMode(e.target.value)}
                                        style={{
                                            padding: '0.5rem 1rem',
                                            background: '#1e3a8a',
                                            border: '1px solid #3b82f6',
                                            borderRadius: '0.375rem',
                                            color: '#fff',
                                            fontSize: '1rem',
                                            cursor: 'pointer'
                                        }}
                                    >
                                        <option value="regular">Regular Season</option>
                                        <option value="playoffs" disabled={!playoffState}>Playoffs {!playoffState && '(Not Started)'}</option>
                                    </select>
                                </div>

                                <h3>
                                    {playerStatMode === 'playoffs' ? 'Playoff' : 'Regular Season'} Stats 
                                    <span style={{ color: '#93c5fd', marginLeft: '0.5rem', fontSize: '0.9rem' }}>
                                        ({gameState.year}-{(gameState.year + 1).toString().slice(-2)})
                                    </span>
                                </h3>
                                
                                {playerStatMode === 'playoffs' && !playoffState && (
                                    <p style={{ color: '#f59e0b', marginBottom: '1rem' }}>
                                        Playoffs have not started yet. Complete the regular season first.
                                    </p>
                                )}
                                
                                {/* Different stats table for goalies vs skaters */}
                                {selectedPlayerProfile.position === 'G' ? (
                                    // GOALIE STATS
                                    <table className="stats-table">
                                        <thead>
                                            <tr>
                                                <th className="text-center">GP</th>
                                                <th className="text-center">W</th>
                                                <th className="text-center">L</th>
                                                <th className="text-center">SV%</th>
                                                <th className="text-center">GAA</th>
                                                <th className="text-center">SO</th>
                                                <th className="text-center">SA</th>
                                                <th className="text-center">SV</th>
                                                <th className="text-center">GA</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {(() => {
                                                const statsToShow = playerStatMode === 'playoffs' ? selectedPlayerProfile.playoffStats : selectedPlayerProfile.stats;
                                                return (
                                                    <tr>
                                                        <td className="text-center">{statsToShow.gamesPlayed || 0}</td>
                                                        <td className="text-center">{statsToShow.wins || 0}</td>
                                                        <td className="text-center">{statsToShow.losses || 0}</td>
                                                        <td className="text-center">
                                                            {statsToShow.savePercentage ? statsToShow.savePercentage.toFixed(3) : '.000'}
                                                        </td>
                                                        <td className="text-center">
                                                            {statsToShow.gaa ? statsToShow.gaa.toFixed(2) : '0.00'}
                                                        </td>
                                                        <td className="text-center">{statsToShow.shutouts || 0}</td>
                                                        <td className="text-center">{statsToShow.shotsAgainst || 0}</td>
                                                        <td className="text-center">{statsToShow.saves || 0}</td>
                                                        <td className="text-center">{statsToShow.goalsAgainst || 0}</td>
                                                    </tr>
                                                );
                                            })()}
                                        </tbody>
                                    </table>
                                ) : (
                                    // SKATER STATS
                                    <table className="stats-table">
                                        <thead>
                                            <tr>
                                                <th className="text-center">GP</th>
                                                <th className="text-center">G</th>
                                                <th className="text-center">A</th>
                                                <th className="text-center">PTS</th>
                                                <th className="text-center">+/-</th>
                                                <th className="text-center">PIM</th>
                                                <th className="text-center">SOG</th>
                                                <th className="text-center">TOI/G</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {(() => {
                                                const statsToShow = playerStatMode === 'playoffs' ? selectedPlayerProfile.playoffStats : selectedPlayerProfile.stats;
                                                return (
                                                    <tr>
                                                        <td className="text-center">{statsToShow.gamesPlayed}</td>
                                                        <td className="text-center">{statsToShow.goals}</td>
                                                        <td className="text-center">{statsToShow.assists}</td>
                                                        <td className="text-center">{statsToShow.points}</td>
                                                        <td className="text-center">{statsToShow.plusMinus > 0 ? '+' : ''}{statsToShow.plusMinus}</td>
                                                        <td className="text-center">{statsToShow.pim}</td>
                                                        <td className="text-center">{statsToShow.shots}</td>
                                                        <td className="text-center">
                                                            {statsToShow.gamesPlayed > 0 
                                                                ? formatTOI(statsToShow.timeOnIce / statsToShow.gamesPlayed)
                                                                : '0:00'}
                                                        </td>
                                                    </tr>
                                                );
                                            })()}
                                        </tbody>
                                    </table>
                                )}

                                {selectedPlayerProfile.careerStats && selectedPlayerProfile.careerStats.length > 0 && (
                                    <>
                                        <h3 style={{ marginTop: '2rem' }}>
                                            Career {playerStatMode === 'playoffs' ? 'Playoff' : 'Regular Season'} Stats by Season
                                        </h3>
                                        
                                        {selectedPlayerProfile.position === 'G' ? (
                                            // GOALIE CAREER STATS BY SEASON
                                            <table className="stats-table">
                                                <thead>
                                                    <tr>
                                                        <th>Year</th>
                                                        <th>Type</th>
                                                        <th>Team</th>
                                                        <th className="text-center">GP</th>
                                                        <th className="text-center">W</th>
                                                        <th className="text-center">L</th>
                                                        <th className="text-center">SV%</th>
                                                        <th className="text-center">GAA</th>
                                                        <th className="text-center">SO</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {selectedPlayerProfile.careerStats.map((seasonStats, idx) => {
                                                        return (
                                                            <tr key={idx}>
                                                                <td>{seasonStats.year || seasonStats.season}</td>
                                                                <td>{seasonStats.type || 'Regular'}</td>
                                                                <td>{seasonStats.teamName}</td>
                                                                <td className="text-center">{seasonStats.gamesPlayed || 0}</td>
                                                                <td className="text-center">{seasonStats.wins || 0}</td>
                                                                <td className="text-center">{seasonStats.losses || 0}</td>
                                                                <td className="text-center">
                                                                    {seasonStats.savePercentage ? seasonStats.savePercentage.toFixed(3) : '.000'}
                                                                </td>
                                                                <td className="text-center">
                                                                    {seasonStats.gaa ? seasonStats.gaa.toFixed(2) : '0.00'}
                                                                </td>
                                                                <td className="text-center">{seasonStats.shutouts || 0}</td>
                                                            </tr>
                                                        );
                                                    })}
                                                </tbody>
                                            </table>
                                        ) : (
                                            // SKATER CAREER STATS BY SEASON
                                            <table className="stats-table">
                                                <thead>
                                                    <tr>
                                                        <th>Year</th>
                                                        <th>Type</th>
                                                        <th>Team</th>
                                                        <th className="text-center">GP</th>
                                                        <th className="text-center">G</th>
                                                        <th className="text-center">A</th>
                                                        <th className="text-center">PTS</th>
                                                        <th className="text-center">+/-</th>
                                                        <th className="text-center">PIM</th>
                                                        <th className="text-center">SOG</th>
                                                        <th className="text-center">TOI/G</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {selectedPlayerProfile.careerStats.map((seasonStats, idx) => {
                                                        const avgTOI = seasonStats.gamesPlayed > 0 ? seasonStats.timeOnIce / seasonStats.gamesPlayed : 0;
                                                        return (
                                                            <tr key={idx}>
                                                                <td>{seasonStats.year || seasonStats.season}</td>
                                                                <td>{seasonStats.type || 'Regular'}</td>
                                                                <td>{seasonStats.teamName}</td>
                                                                <td className="text-center">{seasonStats.gamesPlayed}</td>
                                                                <td className="text-center">{seasonStats.goals}</td>
                                                                <td className="text-center">{seasonStats.assists}</td>
                                                                <td className="text-center">{seasonStats.points}</td>
                                                                <td className="text-center">{seasonStats.plusMinus > 0 ? '+' : ''}{seasonStats.plusMinus}</td>
                                                                <td className="text-center">{seasonStats.pim}</td>
                                                                <td className="text-center">{seasonStats.shots}</td>
                                                                <td className="text-center">{formatTOI(avgTOI)}</td>
                                                            </tr>
                                                        );
                                                    })}
                                                </tbody>
                                            </table>
                                        )}
                                    </>
                                )}

                                <h3 style={{ marginTop: '2rem' }}>
                                    Career {playerStatMode === 'playoffs' ? 'Playoff' : 'Regular Season'} Totals
                                </h3>
                                
                                {selectedPlayerProfile.position === 'G' ? (
                                    // GOALIE CAREER TOTALS
                                    <table className="stats-table">
                                        <thead>
                                            <tr>
                                                <th className="text-center">GP</th>
                                                <th className="text-center">W</th>
                                                <th className="text-center">L</th>
                                                <th className="text-center">SV%</th>
                                                <th className="text-center">GAA</th>
                                                <th className="text-center">SO</th>
                                                <th className="text-center">SA</th>
                                                <th className="text-center">SV</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {(() => {
                                                const currentStats = playerStatMode === 'playoffs' ? selectedPlayerProfile.playoffStats : selectedPlayerProfile.stats;
                                                const careerTotal = (stat) => {
                                                    return (currentStats[stat] || 0) + 
                                                        (selectedPlayerProfile.careerStats?.reduce((sum, s) => sum + (s[stat] || 0), 0) || 0);
                                                };
                                                
                                                // Calculate career averages for percentage stats
                                                const totalSaves = careerTotal('saves');
                                                const totalShotsAgainst = careerTotal('shotsAgainst');
                                                const careerSavePercentage = totalShotsAgainst > 0 ? totalSaves / totalShotsAgainst : 0;
                                                
                                                const totalGP = careerTotal('gamesPlayed');
                                                const totalGA = careerTotal('goalsAgainst');
                                                const careerGAA = totalGP > 0 ? totalGA / totalGP : 0;
                                                
                                                return (
                                                    <tr>
                                                        <td className="text-center">{totalGP}</td>
                                                        <td className="text-center">{careerTotal('wins')}</td>
                                                        <td className="text-center">{careerTotal('losses')}</td>
                                                        <td className="text-center">{careerSavePercentage.toFixed(3)}</td>
                                                        <td className="text-center">{careerGAA.toFixed(2)}</td>
                                                        <td className="text-center">{careerTotal('shutouts')}</td>
                                                        <td className="text-center">{totalShotsAgainst}</td>
                                                        <td className="text-center">{totalSaves}</td>
                                                    </tr>
                                                );
                                            })()}
                                        </tbody>
                                    </table>
                                ) : (
                                    // SKATER CAREER TOTALS
                                    <table className="stats-table">
                                        <thead>
                                            <tr>
                                                <th className="text-center">GP</th>
                                                <th className="text-center">G</th>
                                                <th className="text-center">A</th>
                                                <th className="text-center">PTS</th>
                                                <th className="text-center">+/-</th>
                                                <th className="text-center">PIM</th>
                                                <th className="text-center">SOG</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {(() => {
                                                const currentStats = playerStatMode === 'playoffs' ? selectedPlayerProfile.playoffStats : selectedPlayerProfile.stats;
                                                const careerTotal = (stat) => {
                                                    return currentStats[stat] + 
                                                        (selectedPlayerProfile.careerStats?.reduce((sum, s) => sum + (s[stat] || 0), 0) || 0);
                                                };
                                                
                                                return (
                                                    <tr>
                                                        <td className="text-center">{careerTotal('gamesPlayed')}</td>
                                                        <td className="text-center">{careerTotal('goals')}</td>
                                                        <td className="text-center">{careerTotal('assists')}</td>
                                                        <td className="text-center">{careerTotal('points')}</td>
                                                        <td className="text-center">
                                                            {careerTotal('plusMinus') > 0 ? '+' : ''}{careerTotal('plusMinus')}
                                                        </td>
                                                        <td className="text-center">{careerTotal('pim')}</td>
                                                        <td className="text-center">{careerTotal('shots')}</td>
                                                    </tr>
                                                );
                                            })()}
                                        </tbody>
                                    </table>
                                )}
                                
                                {/* Milestones Section - DEBUG */}
                                <div>
                                    <h3 style={{ marginTop: '2rem', color: '#f59e0b' }}>ðŸ† Career Milestones</h3>
                                    {!selectedPlayerProfile.milestones && (
                                        <div style={{ padding: '1rem', background: 'rgba(239, 68, 68, 0.1)', borderRadius: '0.5rem', marginTop: '1rem' }}>
                                            <p style={{ color: '#f87171' }}>DEBUG: No milestones array found on player object</p>
                                        </div>
                                    )}
                                    {selectedPlayerProfile.milestones && selectedPlayerProfile.milestones.length === 0 && (
                                        <div style={{ padding: '1rem', background: 'rgba(250, 204, 21, 0.1)', borderRadius: '0.5rem', marginTop: '1rem' }}>
                                            <p style={{ color: '#fbbf24' }}>No milestones achieved yet. Player has {selectedPlayerProfile.stats?.gamesPlayed || 0} games played, {selectedPlayerProfile.stats?.goals || 0} goals, {selectedPlayerProfile.stats?.points || 0} points.</p>
                                        </div>
                                    )}
                                    {selectedPlayerProfile.milestones && selectedPlayerProfile.milestones.length > 0 && (
                                        <div style={{ 
                                            display: 'grid', 
                                            gridTemplateColumns: 'repeat(auto-fill, minmax(280px, 1fr))', 
                                            gap: '1rem',
                                            marginTop: '1rem'
                                        }}>
                                            {selectedPlayerProfile.milestones
                                                .sort((a, b) => {
                                                    const aGame = a.careerGame || 0;
                                                    const bGame = b.careerGame || 0;
                                                    return bGame - aGame;
                                                })
                                                .map((milestone, idx) => (
                                                    <div key={idx} style={{
                                                        padding: '1rem',
                                                        background: 'rgba(245, 158, 11, 0.1)',
                                                        borderRadius: '0.5rem',
                                                        border: '1px solid rgba(245, 158, 11, 0.3)'
                                                    }}>
                                                        <div style={{ 
                                                            fontWeight: 'bold', 
                                                            color: '#fbbf24',
                                                            marginBottom: '0.5rem',
                                                            fontSize: '1rem'
                                                        }}>
                                                            {milestone.description}
                                                        </div>
                                                        <div style={{ 
                                                            fontSize: '0.875rem', 
                                                            color: '#94a3b8' 
                                                        }}>
                                                            {milestone.seasonGame && milestone.careerGame ? (
                                                                <div>
                                                                    Season {milestone.season || 1}, Game {milestone.seasonGame}
                                                                    <br />
                                                                    <span style={{ fontSize: '0.75rem', color: '#64748b' }}>
                                                                        ({milestone.careerGame} career games)
                                                                    </span>
                                                                </div>
                                                            ) : (
                                                                <div>Season {milestone.season || 1}, Day {milestone.day}</div>
                                                            )}
                                                        </div>
                                                    </div>
                                                ))}
                                        </div>
                                    )}
                                </div>
                                
                                {/* Transactions Section */}
                                {selectedPlayerProfile.tradeHistory && selectedPlayerProfile.tradeHistory.length > 0 && (
                                    <>
                                        <h3 style={{ marginTop: '2rem', color: '#3b82f6' }}>ðŸ”„ Transaction History</h3>
                                        <div style={{ 
                                            display: 'flex', 
                                            flexDirection: 'column', 
                                            gap: '1rem',
                                            marginTop: '1rem'
                                        }}>
                                            {selectedPlayerProfile.tradeHistory
                                                .sort((a, b) => new Date(b.date) - new Date(a.date))
                                                .map((trade, idx) => {
                                                    const fromTeam = getTeam(trade.from);
                                                    const toTeam = getTeam(trade.to);
                                                    const tradeDate = new Date(trade.date);
                                                    
                                                    return (
                                                        <div key={idx} style={{
                                                            padding: '1.25rem',
                                                            background: 'rgba(59, 130, 246, 0.1)',
                                                            borderRadius: '0.5rem',
                                                            border: '1px solid rgba(59, 130, 246, 0.3)'
                                                        }}>
                                                            <div style={{ 
                                                                fontWeight: 'bold', 
                                                                color: '#60a5fa',
                                                                marginBottom: '0.75rem',
                                                                display: 'flex',
                                                                justifyContent: 'space-between',
                                                                alignItems: 'center'
                                                            }}>
                                                                <span>
                                                                    {fromTeam?.city} {fromTeam?.name} â†’ {toTeam?.city} {toTeam?.name}
                                                                </span>
                                                                <span style={{ 
                                                                    fontSize: '0.875rem',
                                                                    color: '#93c5fd',
                                                                    fontWeight: 'normal'
                                                                }}>
                                                                    {tradeDate.toLocaleDateString('en-US', { 
                                                                        month: 'short', 
                                                                        day: 'numeric', 
                                                                        year: 'numeric' 
                                                                    })}
                                                                </span>
                                                            </div>
                                                            
                                                            <div style={{ 
                                                                color: '#e2e8f0',
                                                                lineHeight: '1.6'
                                                            }}>
                                                                {/* Show who was traded together */}
                                                                {trade.tradedWith && trade.tradedWith.length > 0 && (
                                                                    <div style={{ marginBottom: '0.5rem' }}>
                                                                        <span style={{ color: '#93c5fd' }}>Traded with: </span>
                                                                        {trade.tradedWith.map((player, i) => {
                                                                            const fullPlayer = gameState.players.find(p => p.id === player.id);
                                                                            return (
                                                                                <span key={i}>
                                                                                    {fullPlayer ? (
                                                                                        <span 
                                                                                            className="clickable-player"
                                                                                            onClick={() => navigateTo('playerProfile', fullPlayer)}
                                                                                        >
                                                                                            {player.name}
                                                                                        </span>
                                                                                    ) : (
                                                                                        <span>{player.name}</span>
                                                                                    )}
                                                                                    <span style={{ color: '#93c5fd' }}> ({player.position})</span>
                                                                                    {i < trade.tradedWith.length - 1 ? ', ' : ''}
                                                                                </span>
                                                                            );
                                                                        })}
                                                                    </div>
                                                                )}
                                                                
                                                                {/* Show who they were traded for */}
                                                                {trade.tradedFor && trade.tradedFor.length > 0 && (
                                                                    <div>
                                                                        <span style={{ color: '#93c5fd' }}>In exchange for: </span>
                                                                        {trade.tradedFor.map((player, i) => {
                                                                            const fullPlayer = gameState.players.find(p => p.id === player.id);
                                                                            return (
                                                                                <span key={i}>
                                                                                    {fullPlayer ? (
                                                                                        <span 
                                                                                            className="clickable-player"
                                                                                            onClick={() => navigateTo('playerProfile', fullPlayer)}
                                                                                        >
                                                                                            {player.name}
                                                                                        </span>
                                                                                    ) : (
                                                                                        <span>{player.name}</span>
                                                                                    )}
                                                                                    <span style={{ color: '#93c5fd' }}> ({player.position})</span>
                                                                                    {i < trade.tradedFor.length - 1 ? ', ' : ''}
                                                                                </span>
                                                                            );
                                                                        })}
                                                                    </div>
                                                                )}
                                                            </div>
                                                        </div>
                                                    );
                                                })}
                                        </div>
                                    </>
                                )}
                            </div>
                            </div>
                            );
                        })()}

                        {currentView === 'teamProfile' && selectedTeamProfile && (
                            <div>
                                <button 
                                    onClick={goBack}
                                    style={{
                                        padding: '0.5rem 1rem',
                                        background: '#2563eb',
                                        color: '#fff',
                                        border: 'none',
                                        borderRadius: '0.375rem',
                                        cursor: 'pointer',
                                        marginBottom: '1rem',
                                        fontWeight: 'bold'
                                    }}
                                >
                                    â† Back
                                </button>
                                {(() => {
                                    const team = TEAMS.find(t => t.id === selectedTeamProfile);
                                    const teamStanding = gameState.standings.find(s => s.teamId === selectedTeamProfile);
                                    const teamRoster = gameState.players.filter(p => p.teamId === selectedTeamProfile);
                                    
                                    // Extract all games for this team from the schedule (which is organized by day)
                                    const teamSchedule = [];
                                    gameState.schedule.forEach(daySchedule => {
                                        daySchedule.matchups.forEach(matchup => {
                                            if (matchup.homeTeam === selectedTeamProfile || matchup.awayTeam === selectedTeamProfile) {
                                                teamSchedule.push({
                                                    ...matchup,
                                                    day: daySchedule.day
                                                });
                                            }
                                        });
                                    });
                                    
                                    const gp = teamStanding.wins + teamStanding.losses + teamStanding.otLosses;
                                    const diff = teamStanding.goalsFor - teamStanding.goalsAgainst;

                                    return (
                                        <>
                                            <div className="card">
                                                <h2>{team.city} {team.name}</h2>
                                                <div style={{ marginBottom: '1.5rem', padding: '1rem', background: 'rgba(30, 58, 138, 0.3)', borderRadius: '0.5rem' }}>
                                                    <p style={{ marginBottom: '0.5rem' }}><strong>Conference:</strong> {team.conference}</p>
                                                    <p style={{ marginBottom: '0.5rem' }}><strong>Division:</strong> {team.division}</p>
                                                    <p style={{ marginBottom: '0.5rem' }}><strong>Record:</strong> {teamStanding.wins}-{teamStanding.losses}-{teamStanding.otLosses} ({teamStanding.points} pts)</p>
                                                    <p style={{ marginBottom: '0.5rem' }}><strong>Games Played:</strong> {gp}/82</p>
                                                    <p style={{ marginBottom: '0.5rem' }}><strong>Home:</strong> {teamStanding.home.wins}-{teamStanding.home.losses} | <strong>Away:</strong> {teamStanding.away.wins}-{teamStanding.away.losses}</p>
                                                    <p><strong>Goal Differential:</strong> {diff > 0 ? '+' : ''}{diff} ({teamStanding.goalsFor} GF, {teamStanding.goalsAgainst} GA)</p>
                                                </div>
                                            </div>

                                            <div className="card">
                                                <h2>Roster</h2>
                                                <h3>Forwards ({teamRoster.filter(p => p.position === 'F').length})</h3>
                                                <table className="stats-table">
                                                    <thead>
                                                        <tr>
                                                            <th>Player</th>
                                                            <th className="text-center">Age</th>
                                                            <th className="text-center">OVR</th>
                                                            <th className="text-center">GP</th>
                                                            <th className="text-center">G</th>
                                                            <th className="text-center">A</th>
                                                            <th className="text-center">PTS</th>
                                                            <th className="text-center">+/-</th>
                                                            <th className="text-center">PIM</th>
                                                            <th className="text-center">TOI/G</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {teamRoster
                                                            .filter(p => p.position === 'F')
                                                            .sort((a, b) => b.stats.points - a.stats.points)
                                                            .map(player => {
                                                                const avgTOI = player.stats.gamesPlayed > 0 ? player.stats.timeOnIce / player.stats.gamesPlayed : 0;
                                                                return (
                                                                    <tr key={player.id}>
                                                                        <td className="player-name" style={{ cursor: 'pointer', textDecoration: 'underline' }} onClick={() => navigateTo('playerProfile', player)}>
                                                                            {player.firstName} {player.lastName}
                                                                        </td>
                                                                        <td className="text-center">{player.age}</td>
                                                                        <td className="text-center">{player.ratings.overall}</td>
                                                                        <td className="text-center">{player.stats.gamesPlayed}</td>
                                                                        <td className="text-center">{player.stats.goals}</td>
                                                                        <td className="text-center">{player.stats.assists}</td>
                                                                        <td className="text-center">{player.stats.points}</td>
                                                                        <td className="text-center">{player.stats.plusMinus > 0 ? '+' : ''}{player.stats.plusMinus}</td>
                                                                        <td className="text-center">{player.stats.pim}</td>
                                                                        <td className="text-center">{formatTOI(avgTOI)}</td>
                                                                    </tr>
                                                                );
                                                            })}
                                                    </tbody>
                                                </table>

                                                <h3>Defensemen ({teamRoster.filter(p => p.position === 'D').length})</h3>
                                                <table className="stats-table">
                                                    <thead>
                                                        <tr>
                                                            <th>Player</th>
                                                            <th className="text-center">Age</th>
                                                            <th className="text-center">OVR</th>
                                                            <th className="text-center">GP</th>
                                                            <th className="text-center">G</th>
                                                            <th className="text-center">A</th>
                                                            <th className="text-center">PTS</th>
                                                            <th className="text-center">+/-</th>
                                                            <th className="text-center">PIM</th>
                                                            <th className="text-center">TOI/G</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {teamRoster
                                                            .filter(p => p.position === 'D')
                                                            .sort((a, b) => b.stats.points - a.stats.points)
                                                            .map(player => {
                                                                const avgTOI = player.stats.gamesPlayed > 0 ? player.stats.timeOnIce / player.stats.gamesPlayed : 0;
                                                                return (
                                                                    <tr key={player.id}>
                                                                        <td className="player-name" style={{ cursor: 'pointer', textDecoration: 'underline' }} onClick={() => navigateTo('playerProfile', player)}>
                                                                            {player.firstName} {player.lastName}
                                                                        </td>
                                                                        <td className="text-center">{player.age}</td>
                                                                        <td className="text-center">{player.ratings.overall}</td>
                                                                        <td className="text-center">{player.stats.gamesPlayed}</td>
                                                                        <td className="text-center">{player.stats.goals}</td>
                                                                        <td className="text-center">{player.stats.assists}</td>
                                                                        <td className="text-center">{player.stats.points}</td>
                                                                        <td className="text-center">{player.stats.plusMinus > 0 ? '+' : ''}{player.stats.plusMinus}</td>
                                                                        <td className="text-center">{player.stats.pim}</td>
                                                                        <td className="text-center">{formatTOI(avgTOI)}</td>
                                                                    </tr>
                                                                );
                                                            })}
                                                    </tbody>
                                                </table>

                                                <h3>Goalies ({teamRoster.filter(p => p.position === 'G').length})</h3>
                                                <table className="stats-table">
                                                    <thead>
                                                        <tr>
                                                            <th>Player</th>
                                                            <th className="text-center">Age</th>
                                                            <th className="text-center">OVR</th>
                                                            <th className="text-center">GP</th>
                                                            <th className="text-center">W</th>
                                                            <th className="text-center">L</th>
                                                            <th className="text-center">SV%</th>
                                                            <th className="text-center">GAA</th>
                                                            <th className="text-center">SO</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {teamRoster
                                                            .filter(p => p.position === 'G')
                                                            .sort((a, b) => b.ratings.overall - a.ratings.overall)
                                                            .map(player => {
                                                                return (
                                                                    <tr key={player.id}>
                                                                        <td className="player-name" style={{ cursor: 'pointer', textDecoration: 'underline' }} onClick={() => navigateTo('playerProfile', player)}>
                                                                            {player.firstName} {player.lastName}
                                                                        </td>
                                                                        <td className="text-center">{player.age}</td>
                                                                        <td className="text-center">{player.ratings.overall}</td>
                                                                        <td className="text-center">{player.stats.gamesPlayed}</td>
                                                                        <td className="text-center">{player.stats.wins || 0}</td>
                                                                        <td className="text-center">{player.stats.losses || 0}</td>
                                                                        <td className="text-center">{player.stats.gamesPlayed > 0 ? (player.stats.savePercentage || 0).toFixed(3) : '.000'}</td>
                                                                        <td className="text-center">{player.stats.gamesPlayed > 0 ? (player.stats.gaa || 0).toFixed(2) : '0.00'}</td>
                                                                        <td className="text-center">{player.stats.shutouts || 0}</td>
                                                                    </tr>
                                                                );
                                                            })}
                                                    </tbody>
                                                </table>
                                            </div>

                                            <div className="card">
                                                <h2>Head-to-Head Records</h2>
                                                <p style={{ color: '#93c5fd', marginBottom: '1rem' }}>
                                                    Season series records against all opponents
                                                </p>
                                                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(300px, 1fr))', gap: '1rem' }}>
                                                    {TEAMS
                                                        .filter(t => t.id !== selectedTeamProfile)
                                                        .sort((a, b) => a.city.localeCompare(b.city))
                                                        .map(opponent => {
                                                            const h2hKey = selectedTeamProfile < opponent.id ? 
                                                                `${selectedTeamProfile}vs${opponent.id}` : 
                                                                `${opponent.id}vs${selectedTeamProfile}`;
                                                            
                                                            const h2h = gameState.headToHead?.[h2hKey];
                                                            
                                                            if (!h2h) {
                                                                return (
                                                                    <div key={opponent.id} style={{ 
                                                                        padding: '0.75rem',
                                                                        background: 'rgba(30, 58, 138, 0.2)',
                                                                        borderRadius: '0.375rem',
                                                                        border: '1px solid rgba(59, 130, 246, 0.3)'
                                                                    }}>
                                                                        <div style={{ fontWeight: 'bold', marginBottom: '0.25rem', color: '#93c5fd' }}>
                                                                            vs {opponent.city} {opponent.name}
                                                                        </div>
                                                                        <div style={{ fontSize: '0.875rem', color: '#94a3b8' }}>
                                                                            No games played yet
                                                                        </div>
                                                                    </div>
                                                                );
                                                            }
                                                            
                                                            const myWins = h2h.team1 === selectedTeamProfile ? h2h.team1Wins : h2h.team2Wins;
                                                            const theirWins = h2h.team1 === selectedTeamProfile ? h2h.team2Wins : h2h.team1Wins;
                                                            const totalGames = myWins + theirWins;
                                                            
                                                            return (
                                                                <div key={opponent.id} style={{ 
                                                                    padding: '0.75rem',
                                                                    background: myWins > theirWins ? 'rgba(34, 197, 94, 0.1)' : 
                                                                               myWins < theirWins ? 'rgba(239, 68, 68, 0.1)' : 
                                                                               'rgba(100, 116, 139, 0.1)',
                                                                    borderRadius: '0.375rem',
                                                                    border: `1px solid ${myWins > theirWins ? 'rgba(34, 197, 94, 0.3)' : 
                                                                                       myWins < theirWins ? 'rgba(239, 68, 68, 0.3)' : 
                                                                                       'rgba(100, 116, 139, 0.3)'}`
                                                                }}>
                                                                    <div style={{ fontWeight: 'bold', marginBottom: '0.25rem', color: '#e2e8f0' }}>
                                                                        vs {opponent.city} {opponent.name}
                                                                    </div>
                                                                    <div style={{ fontSize: '1.25rem', fontWeight: 'bold', marginBottom: '0.25rem' }}>
                                                                        <span style={{ color: myWins > theirWins ? '#22c55e' : '#fff' }}>{myWins}</span>
                                                                        <span style={{ color: '#64748b', margin: '0 0.5rem' }}>-</span>
                                                                        <span style={{ color: theirWins > myWins ? '#ef4444' : '#fff' }}>{theirWins}</span>
                                                                    </div>
                                                                    <div style={{ fontSize: '0.75rem', color: '#94a3b8' }}>
                                                                        {totalGames} {totalGames === 1 ? 'game' : 'games'} played
                                                                    </div>
                                                                </div>
                                                            );
                                                        })}
                                                </div>
                                            </div>

                                            <div className="card">
                                                <h2>Schedule & Results</h2>
                                                <p style={{ color: '#93c5fd', marginBottom: '1rem' }}>
                                                    Games Played: {teamSchedule.filter(g => g.played).length} | 
                                                    Remaining: {teamSchedule.filter(g => !g.played).length} | 
                                                    Total: {teamSchedule.length}
                                                </p>
                                                <table className="stats-table">
                                                    <thead>
                                                        <tr>
                                                            <th>Day</th>
                                                            <th>Opponent</th>
                                                            <th className="text-center">Home/Away</th>
                                                            <th className="text-center">Result</th>
                                                            <th className="text-center">Score</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {teamSchedule
                                                            .sort((a, b) => a.day - b.day)
                                                            .map((game, idx) => {
                                                            const isHome = game.homeTeam === selectedTeamProfile;
                                                            const opponent = TEAMS.find(t => t.id === (isHome ? game.awayTeam : game.homeTeam));
                                                            const teamScore = isHome ? game.homeScore : game.awayScore;
                                                            const oppScore = isHome ? game.awayScore : game.homeScore;
                                                            let result = '';
                                                            if (game.played) {
                                                                if (teamScore > oppScore) result = 'W';
                                                                else if (teamScore < oppScore) result = 'L';
                                                                else result = 'T';
                                                            }

                                                            return (
                                                                <tr key={idx} style={game.played ? { cursor: 'pointer' } : {}} 
                                                                    onClick={() => game.played && navigateTo('gameDetail', game)}>
                                                                    <td>Day {game.day}</td>
                                                                    <td>{opponent.city} {opponent.name}</td>
                                                                    <td className="text-center">{isHome ? 'HOME' : 'AWAY'}</td>
                                                                    <td className="text-center" style={{ 
                                                                        fontWeight: 'bold',
                                                                        color: result === 'W' ? '#22c55e' : result === 'L' ? '#ef4444' : '#93c5fd'
                                                                    }}>
                                                                        {game.played ? result : '-'}
                                                                    </td>
                                                                    <td className="text-center" style={{ fontWeight: game.played ? 'bold' : 'normal' }}>
                                                                        {game.played ? `${teamScore} - ${oppScore}` : '-'}
                                                                    </td>
                                                                </tr>
                                                            );
                                                        })}
                                                    </tbody>
                                                </table>
                                            </div>
                                        </>
                                    );
                                })()}
                            </div>
                        )}

                        {currentView === 'injuries' && gameState && (
                            <div>
                                <div className="card">
                                    <h2>ðŸ¥ Injury Report</h2>
                                    <p style={{ color: '#93c5fd', marginBottom: '1.5rem' }}>
                                        Current injuries across the league. Injured players cannot play and are replaced by backups in the lineup.
                                    </p>
                                    
                                    {gameState.players.filter(p => p.injury.injured).length === 0 ? (
                                        <p style={{ color: '#22c55e', textAlign: 'center', padding: '2rem' }}>
                                            âœ“ No players currently injured! Everyone is healthy.
                                        </p>
                                    ) : (
                                        TEAMS.map(team => {
                                            const teamInjuries = gameState.players.filter(p => p.teamId === team.id && p.injury.injured);
                                            if (teamInjuries.length === 0) return null;
                                            
                                            return (
                                                <div key={team.id} style={{ marginBottom: '2rem' }}>
                                                    <h3 style={{ color: '#22d3ee', marginBottom: '1rem' }}>
                                                        {team.city} {team.name} ({teamInjuries.length} injured)
                                                    </h3>
                                                    <table className="stats-table">
                                                        <thead>
                                                            <tr>
                                                                <th>Player</th>
                                                                <th className="text-center">Pos</th>
                                                                <th className="text-center">Status</th>
                                                                <th>Injury Type</th>
                                                                <th className="text-center">Days Out</th>
                                                                <th className="text-center">GP</th>
                                                                <th className="text-center">PTS</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            {teamInjuries
                                                                .sort((a, b) => {
                                                                    const order = { 'Retired': 0, 'Out': 1, 'IR': 2, 'DTD': 3 };
                                                                    return (order[getPlayerStatus(a)] || 4) - (order[getPlayerStatus(b)] || 4);
                                                                })
                                                                .map(player => {
                                                                    const status = getPlayerStatus(player);
                                                                    const statusColor = status === 'Retired' ? '#ef4444' : 
                                                                                      status === 'Out' ? '#f59e0b' : 
                                                                                      status === 'IR' ? '#f97316' : '#fbbf24';
                                                                    return (
                                                                        <tr key={player.id}>
                                                                            <td className="player-name" style={{ cursor: 'pointer', textDecoration: 'underline' }} onClick={() => navigateTo('playerProfile', player)}>
                                                                                {player.firstName} {player.lastName}
                                                                            </td>
                                                                            <td className="text-center">{player.position}</td>
                                                                            <td className="text-center">
                                                                                <span style={{ color: statusColor, fontWeight: 'bold' }}>
                                                                                    {status}
                                                                                </span>
                                                                            </td>
                                                                            <td>
                                                                                {player.injury.type}
                                                                                {player.injury.severity !== 'Day-to-Day' && (
                                                                                    <span style={{ color: '#64748b', fontSize: '0.875rem', marginLeft: '0.5rem' }}>
                                                                                        ({player.injury.severity})
                                                                                    </span>
                                                                                )}
                                                                            </td>
                                                                            <td className="text-center">
                                                                                {player.injury.isCareerEnding ? 'âˆž' : 
                                                                                 player.injury.severity === 'Season-Ending' ? 'Season' :
                                                                                 player.injury.daysUntilReturn}
                                                                            </td>
                                                                            <td className="text-center">{player.stats.gamesPlayed}</td>
                                                                            <td className="text-center">{player.stats.points || 0}</td>
                                                                        </tr>
                                                                    );
                                                                })}
                                                        </tbody>
                                                    </table>
                                                </div>
                                            );
                                        }).filter(Boolean)
                                    )}
                                </div>
                                
                                <div className="card" style={{ background: 'rgba(30, 58, 138, 0.3)' }}>
                                    <h3 style={{ color: '#22d3ee' }}>Injury Information</h3>
                                    <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))', gap: '1rem', marginTop: '1rem' }}>
                                        <div>
                                            <h4 style={{ color: '#fbbf24' }}>Day-to-Day (DTD)</h4>
                                            <p style={{ color: '#e2e8f0', fontSize: '0.875rem' }}>1-7 days. Player will return soon.</p>
                                        </div>
                                        <div>
                                            <h4 style={{ color: '#f97316' }}>Week-to-Week / Out</h4>
                                            <p style={{ color: '#e2e8f0', fontSize: '0.875rem' }}>7-14 days. Short-term absence.</p>
                                        </div>
                                        <div>
                                            <h4 style={{ color: '#f59e0b' }}>Month-to-Month (IR)</h4>
                                            <p style={{ color: '#e2e8f0', fontSize: '0.875rem' }}>15-60 days. Medium-term injury.</p>
                                        </div>
                                        <div>
                                            <h4 style={{ color: '#f59e0b' }}>Season-Ending</h4>
                                            <p style={{ color: '#e2e8f0', fontSize: '0.875rem' }}>Out for remainder of season.</p>
                                        </div>
                                        <div>
                                            <h4 style={{ color: '#ef4444' }}>Career-Ending (Retired)</h4>
                                            <p style={{ color: '#e2e8f0', fontSize: '0.875rem' }}>Player has retired due to injury. Very rare.</p>
                                        </div>
                                    </div>
                                    <p style={{ color: '#93c5fd', marginTop: '1rem', fontSize: '0.875rem' }}>
                                        <strong>Injury System:</strong> ~0.15% chance per game (1 in ~7 games). Higher for forwards, older players, and high TOI.<br/>
                                        <strong>Load Management:</strong> Healthy players may be rested (~1% chance) to prevent fatigue. Stars rest less.<br/>
                                        <strong>Injured players cannot play</strong> - backups fill in until they return.<br/>
                                        <strong>Result:</strong> Most starters play 70-80 games, not all 82. Elite stars may reach 82.
                                    </p>
                                </div>
                            </div>
                        )}

                        {currentView === 'callups' && gameState && (() => {
                            const userNHLRoster = gameState.players.filter(p => 
                                p.teamId === userTeamId && 
                                p.roster === 'nhl'
                            ).sort((a, b) => b.ratings.overall - a.ratings.overall);
                            
                            const farmTeam = FARM_TEAMS.find(t => t.nhlAffiliation === userTeamId);
                            const userFarmRoster = farmTeam ? gameState.players.filter(p => 
                                p.teamId === farmTeam.id && 
                                p.roster === 'farm'
                            ).sort((a, b) => b.ratings.overall - a.ratings.overall) : [];
                            
                            return (
                            <div className="card">
                                <h2>ðŸ”„ Call-Ups & Send-Downs</h2>
                                <p style={{ color: '#93c5fd', marginBottom: '2rem' }}>
                                    Manage your roster between NHL and farm team. Call up prospects or send down players.
                                </p>
                                
                                {/* NHL Roster */}
                                <div style={{ marginBottom: '3rem' }}>
                                    <h3 style={{ color: '#22c55e', marginBottom: '1rem' }}>
                                        NHL Roster ({userNHLRoster.length} / 23)
                                    </h3>
                                    
                                    {['F', 'D', 'G'].map(pos => {
                                        const players = userNHLRoster.filter(p => p.position === pos);
                                        const posName = pos === 'F' ? 'Forwards' : pos === 'D' ? 'Defensemen' : 'Goalies';
                                        const maxCount = pos === 'F' ? 13 : pos === 'D' ? 7 : 3;
                                        
                                        return (
                                            <div key={pos} style={{ marginBottom: '2rem' }}>
                                                <h4 style={{ color: '#93c5fd' }}>
                                                    {posName} ({players.length} / {maxCount})
                                                </h4>
                                                <div style={{ display: 'grid', gap: '0.75rem' }}>
                                                    {players.map(player => (
                                                        <div key={player.id} style={{
                                                            display: 'flex',
                                                            justifyContent: 'space-between',
                                                            alignItems: 'center',
                                                            padding: '1rem',
                                                            background: 'rgba(30, 58, 138, 0.3)',
                                                            borderRadius: '0.375rem',
                                                            border: '1px solid rgba(59, 130, 246, 0.3)'
                                                        }}>
                                                            <div style={{ flex: 1 }}>
                                                                <div style={{ fontWeight: 'bold' }}>
                                                                    {player.firstName} {player.lastName}
                                                                    <span style={{ 
                                                                        marginLeft: '0.5rem',
                                                                        padding: '0.25rem 0.5rem',
                                                                        background: 'rgba(59, 130, 246, 0.2)',
                                                                        borderRadius: '0.25rem',
                                                                        fontSize: '0.75rem'
                                                                    }}>
                                                                        {player.position}
                                                                    </span>
                                                                    {player.linePosition && (
                                                                        <span style={{ 
                                                                            marginLeft: '0.5rem',
                                                                            fontSize: '0.75rem',
                                                                            color: '#93c5fd'
                                                                        }}>
                                                                            {player.position === 'G' ? (player.dressed ? 'Dressed' : 'Scratch') : 
                                                                             player.lineNumber > 0 ? `Line ${player.lineNumber}` : 'Scratch'}
                                                                        </span>
                                                                    )}
                                                                </div>
                                                                <div style={{ fontSize: '0.875rem', color: '#93c5fd', marginTop: '0.25rem' }}>
                                                                    OVR: {player.ratings.overall} | Age: {player.age}
                                                                    {player.injury.injured && (
                                                                        <span style={{ 
                                                                            marginLeft: '0.5rem',
                                                                            color: '#f87171',
                                                                            fontWeight: 'bold'
                                                                        }}>
                                                                            (Injured - {player.injury.type})
                                                                        </span>
                                                                    )}
                                                                </div>
                                                            </div>
                                                            <button
                                                                onClick={() => sendDownPlayer(player.id)}
                                                                disabled={player.injury.injured}
                                                                style={{
                                                                    padding: '0.5rem 1rem',
                                                                    background: player.injury.injured ? '#374151' : '#ef4444',
                                                                    color: 'white',
                                                                    border: 'none',
                                                                    borderRadius: '0.375rem',
                                                                    cursor: player.injury.injured ? 'not-allowed' : 'pointer',
                                                                    fontSize: '0.875rem',
                                                                    fontWeight: 'bold',
                                                                    opacity: player.injury.injured ? 0.5 : 1
                                                                }}
                                                            >
                                                                â¬‡ï¸ Send Down
                                                            </button>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                                
                                {/* Farm Team Roster */}
                                <div style={{ 
                                    borderTop: '2px solid rgba(59, 130, 246, 0.3)',
                                    paddingTop: '2rem'
                                }}>
                                    <h3 style={{ color: '#fbbf24', marginBottom: '1rem' }}>
                                        Farm Team ({farmTeam?.city} {farmTeam?.name}) - {userFarmRoster.length} / 23
                                    </h3>
                                    
                                    {['F', 'D', 'G'].map(pos => {
                                        const players = userFarmRoster.filter(p => p.position === pos);
                                        const posName = pos === 'F' ? 'Forwards' : pos === 'D' ? 'Defensemen' : 'Goalies';
                                        
                                        return (
                                            <div key={pos} style={{ marginBottom: '2rem' }}>
                                                <h4 style={{ color: '#93c5fd' }}>
                                                    {posName} ({players.length})
                                                </h4>
                                                <div style={{ display: 'grid', gap: '0.75rem' }}>
                                                    {players.map(player => (
                                                        <div key={player.id} style={{
                                                            display: 'flex',
                                                            justifyContent: 'space-between',
                                                            alignItems: 'center',
                                                            padding: '1rem',
                                                            background: 'rgba(251, 191, 36, 0.1)',
                                                            borderRadius: '0.375rem',
                                                            border: '1px solid rgba(251, 191, 36, 0.3)'
                                                        }}>
                                                            <div style={{ flex: 1 }}>
                                                                <div style={{ fontWeight: 'bold' }}>
                                                                    {player.firstName} {player.lastName}
                                                                    <span style={{ 
                                                                        marginLeft: '0.5rem',
                                                                        padding: '0.25rem 0.5rem',
                                                                        background: 'rgba(251, 191, 36, 0.2)',
                                                                        borderRadius: '0.25rem',
                                                                        fontSize: '0.75rem'
                                                                    }}>
                                                                        {player.position}
                                                                    </span>
                                                                </div>
                                                                <div style={{ fontSize: '0.875rem', color: '#93c5fd', marginTop: '0.25rem' }}>
                                                                    OVR: {player.ratings.overall} | Age: {player.age} | POT: {player.ratings.potential}
                                                                </div>
                                                            </div>
                                                            <button
                                                                onClick={() => callUpPlayer(player.id)}
                                                                style={{
                                                                    padding: '0.5rem 1rem',
                                                                    background: '#22c55e',
                                                                    color: 'white',
                                                                    border: 'none',
                                                                    borderRadius: '0.375rem',
                                                                    cursor: 'pointer',
                                                                    fontSize: '0.875rem',
                                                                    fontWeight: 'bold'
                                                                }}
                                                            >
                                                                â¬†ï¸ Call Up
                                                            </button>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                                
                                {/* Info Box */}
                                <div style={{ 
                                    marginTop: '2rem',
                                    padding: '1rem',
                                    background: 'rgba(59, 130, 246, 0.1)',
                                    borderRadius: '0.5rem',
                                    border: '1px solid rgba(59, 130, 246, 0.3)'
                                }}>
                                    <h4 style={{ color: '#60a5fa', marginBottom: '0.5rem' }}>â„¹ï¸ Roster Rules</h4>
                                    <ul style={{ marginLeft: '1.5rem', color: '#93c5fd', fontSize: '0.875rem' }}>
                                        <li>NHL roster: 13 forwards + 7 defensemen + 3 goalies = 23 players</li>
                                        <li>Farm roster: Same structure (23 players)</li>
                                        <li>Cannot send down injured players (must wait until healthy)</li>
                                        <li>Called-up players start as scratches - assign them to lines</li>
                                        <li>Injured players auto-call-up replacements from farm</li>
                                        <li>When injured players heal, farm call-ups auto-return</li>
                                    </ul>
                                </div>
                            </div>
                            );
                        })()}

                        {currentView === 'teamHistory' && gameState && (() => {
                            const userTeam = TEAMS.find(t => t.id === userTeamId);
                            const history = gameState.teamHistory || { seasons: [], achievements: {} };
                            
                            return (
                            <div>
                                <div className="card">
                                    <h2 style={{ color: '#f59e0b' }}>ðŸ“œ {userTeam.city} {userTeam.name} - Team History</h2>
                                    
                                    {history.seasons.length === 0 ? (
                                        <div style={{ padding: '3rem', textAlign: 'center', color: '#64748b' }}>
                                            <div style={{ fontSize: '3rem', marginBottom: '1rem' }}>ðŸ’</div>
                                            <p style={{ fontSize: '1.25rem', marginBottom: '0.5rem' }}>No History Yet</p>
                                            <p>Complete a season to start building your team's legacy!</p>
                                        </div>
                                    ) : (
                                        <>
                                            {/* Season Records Table */}
                                            <h3 style={{ color: '#93c5fd', marginTop: '1.5rem', marginBottom: '1rem' }}>Season Records</h3>
                                            <div style={{ overflowX: 'auto' }}>
                                                <table className="stats-table">
                                                    <thead>
                                                        <tr>
                                                            <th>Season</th>
                                                            <th>Year</th>
                                                            <th>W-L-OTL</th>
                                                            <th>Pts</th>
                                                            <th>GF</th>
                                                            <th>GA</th>
                                                            <th>Diff</th>
                                                            <th>Div</th>
                                                            <th>Conf</th>
                                                            <th>Playoff Result</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {history.seasons.map((season, idx) => (
                                                            <tr key={idx}>
                                                                <td className="text-center">{season.season}</td>
                                                                <td className="text-center">{season.year}</td>
                                                                <td className="text-center">{season.wins}-{season.losses}-{season.otLosses}</td>
                                                                <td className="text-center" style={{ fontWeight: 'bold' }}>{season.points}</td>
                                                                <td className="text-center">{season.goalsFor}</td>
                                                                <td className="text-center">{season.goalsAgainst}</td>
                                                                <td className="text-center" style={{ 
                                                                    color: season.goalDifferential > 0 ? '#22c55e' : season.goalDifferential < 0 ? '#ef4444' : '#fff' 
                                                                }}>
                                                                    {season.goalDifferential > 0 ? '+' : ''}{season.goalDifferential}
                                                                </td>
                                                                <td className="text-center">
                                                                    {season.wonDivision ? <span style={{ color: '#fbbf24' }}>ðŸ† {season.divisionFinish}</span> : season.divisionFinish}
                                                                </td>
                                                                <td className="text-center">{season.conferenceFinish}</td>
                                                                <td style={{ 
                                                                    color: season.wonChampionship ? '#fbbf24' : '#e2e8f0',
                                                                    fontWeight: season.wonChampionship ? 'bold' : 'normal'
                                                                }}>
                                                                    {season.wonChampionship && 'ðŸ† '}
                                                                    {season.playoffResult}
                                                                </td>
                                                            </tr>
                                                        ))}
                                                    </tbody>
                                                </table>
                                            </div>

                                            {/* Achievements Section */}
                                            <h3 style={{ color: '#93c5fd', marginTop: '2rem', marginBottom: '1rem' }}>Team Achievements</h3>
                                            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))', gap: '1rem' }}>
                                                {/* Championships */}
                                                <div style={{ 
                                                    padding: '1.5rem',
                                                    background: 'rgba(251, 191, 36, 0.1)',
                                                    borderRadius: '0.5rem',
                                                    border: '2px solid rgba(251, 191, 36, 0.3)'
                                                }}>
                                                    <div style={{ fontSize: '2rem', marginBottom: '0.5rem' }}>ðŸ†</div>
                                                    <div style={{ fontSize: '1.5rem', fontWeight: 'bold', color: '#fbbf24', marginBottom: '0.5rem' }}>
                                                        {history.achievements.championships?.length || 0}
                                                    </div>
                                                    <div style={{ color: '#93c5fd', marginBottom: '0.75rem' }}>Stanley Cups</div>
                                                    {history.achievements.championships?.length > 0 && (
                                                        <div style={{ color: '#e2e8f0', fontSize: '0.85rem' }}>
                                                            {history.achievements.championships.join(', ')}
                                                        </div>
                                                    )}
                                                </div>

                                                {/* Conference Titles */}
                                                <div style={{ 
                                                    padding: '1.5rem',
                                                    background: 'rgba(59, 130, 246, 0.1)',
                                                    borderRadius: '0.5rem',
                                                    border: '2px solid rgba(59, 130, 246, 0.3)'
                                                }}>
                                                    <div style={{ fontSize: '2rem', marginBottom: '0.5rem' }}>ðŸ¥ˆ</div>
                                                    <div style={{ fontSize: '1.5rem', fontWeight: 'bold', color: '#3b82f6', marginBottom: '0.5rem' }}>
                                                        {history.achievements.conferenceTitles?.length || 0}
                                                    </div>
                                                    <div style={{ color: '#93c5fd', marginBottom: '0.75rem' }}>Conference Championships</div>
                                                    {history.achievements.conferenceTitles?.length > 0 && (
                                                        <div style={{ color: '#e2e8f0', fontSize: '0.85rem' }}>
                                                            {history.achievements.conferenceTitles.join(', ')}
                                                        </div>
                                                    )}
                                                </div>

                                                {/* Division Titles */}
                                                <div style={{ 
                                                    padding: '1.5rem',
                                                    background: 'rgba(34, 197, 94, 0.1)',
                                                    borderRadius: '0.5rem',
                                                    border: '2px solid rgba(34, 197, 94, 0.3)'
                                                }}>
                                                    <div style={{ fontSize: '2rem', marginBottom: '0.5rem' }}>ðŸ¥‰</div>
                                                    <div style={{ fontSize: '1.5rem', fontWeight: 'bold', color: '#22c55e', marginBottom: '0.5rem' }}>
                                                        {history.achievements.divisionTitles?.length || 0}
                                                    </div>
                                                    <div style={{ color: '#93c5fd', marginBottom: '0.75rem' }}>Division Titles</div>
                                                    {history.achievements.divisionTitles?.length > 0 && (
                                                        <div style={{ color: '#e2e8f0', fontSize: '0.85rem' }}>
                                                            {history.achievements.divisionTitles.join(', ')}
                                                        </div>
                                                    )}
                                                </div>

                                                {/* Playoff Appearances */}
                                                <div style={{ 
                                                    padding: '1.5rem',
                                                    background: 'rgba(139, 92, 246, 0.1)',
                                                    borderRadius: '0.5rem',
                                                    border: '2px solid rgba(139, 92, 246, 0.3)'
                                                }}>
                                                    <div style={{ fontSize: '2rem', marginBottom: '0.5rem' }}>ðŸŽ¯</div>
                                                    <div style={{ fontSize: '1.5rem', fontWeight: 'bold', color: '#8b5cf6', marginBottom: '0.5rem' }}>
                                                        {history.achievements.playoffAppearances?.length || 0}
                                                    </div>
                                                    <div style={{ color: '#93c5fd' }}>Playoff Appearances</div>
                                                </div>
                                            </div>

                                            {/* Best Records Section */}
                                            <h3 style={{ color: '#93c5fd', marginTop: '2rem', marginBottom: '1rem' }}>All-Time Bests</h3>
                                            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))', gap: '1rem' }}>
                                                {history.achievements.bestRecord && (
                                                    <div style={{ 
                                                        padding: '1rem',
                                                        background: 'rgba(147, 197, 253, 0.1)',
                                                        borderRadius: '0.375rem',
                                                        border: '1px solid rgba(147, 197, 253, 0.3)'
                                                    }}>
                                                        <div style={{ color: '#93c5fd', fontSize: '0.85rem', marginBottom: '0.5rem' }}>
                                                            Best Record
                                                        </div>
                                                        <div style={{ color: '#fff', fontSize: '1.25rem', fontWeight: 'bold', marginBottom: '0.25rem' }}>
                                                            {history.achievements.bestRecord.points} pts
                                                        </div>
                                                        <div style={{ color: '#e2e8f0', fontSize: '0.85rem' }}>
                                                            {history.achievements.bestRecord.wins}-{history.achievements.bestRecord.losses}-{history.achievements.bestRecord.otLosses} ({history.achievements.bestRecord.year})
                                                        </div>
                                                    </div>
                                                )}

                                                {history.achievements.bestGoalsFor && (
                                                    <div style={{ 
                                                        padding: '1rem',
                                                        background: 'rgba(34, 197, 94, 0.1)',
                                                        borderRadius: '0.375rem',
                                                        border: '1px solid rgba(34, 197, 94, 0.3)'
                                                    }}>
                                                        <div style={{ color: '#93c5fd', fontSize: '0.85rem', marginBottom: '0.5rem' }}>
                                                            Most Goals
                                                        </div>
                                                        <div style={{ color: '#22c55e', fontSize: '1.25rem', fontWeight: 'bold', marginBottom: '0.25rem' }}>
                                                            {history.achievements.bestGoalsFor.goalsFor} goals
                                                        </div>
                                                        <div style={{ color: '#e2e8f0', fontSize: '0.85rem' }}>
                                                            {history.achievements.bestGoalsFor.year}
                                                        </div>
                                                    </div>
                                                )}

                                                {history.achievements.bestGoalDiff && (
                                                    <div style={{ 
                                                        padding: '1rem',
                                                        background: 'rgba(251, 191, 36, 0.1)',
                                                        borderRadius: '0.375rem',
                                                        border: '1px solid rgba(251, 191, 36, 0.3)'
                                                    }}>
                                                        <div style={{ color: '#93c5fd', fontSize: '0.85rem', marginBottom: '0.5rem' }}>
                                                            Best Goal Differential
                                                        </div>
                                                        <div style={{ color: '#fbbf24', fontSize: '1.25rem', fontWeight: 'bold', marginBottom: '0.25rem' }}>
                                                            +{history.achievements.bestGoalDiff.diff}
                                                        </div>
                                                        <div style={{ color: '#e2e8f0', fontSize: '0.85rem' }}>
                                                            {history.achievements.bestGoalDiff.year}
                                                        </div>
                                                    </div>
                                                )}
                                            </div>
                                        </>
                                    )}
                                </div>
                            </div>
                            );
                        })()}

                        {currentView === 'calendar' && gameState && (
                            <div>
                                <div className="card">
                                    <h2>ðŸ“… Game Calendar</h2>
                                    <p style={{ color: '#93c5fd', marginBottom: '1.5rem' }}>
                                        Browse games by month and date
                                    </p>
                                    
                                    {(() => {
                                        // Get all unique dates with games, organized by month
                                        const gamesByMonth = {};
                                        gameState.schedule.filter(g => g.played && g.date).forEach(game => {
                                            const monthYear = game.date.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
                                            const dateStr = game.date.toLocaleDateString();
                                            
                                            if (!gamesByMonth[monthYear]) {
                                                gamesByMonth[monthYear] = {
                                                    sortDate: game.date,
                                                    dates: {}
                                                };
                                            }
                                            
                                            if (!gamesByMonth[monthYear].dates[dateStr]) {
                                                gamesByMonth[monthYear].dates[dateStr] = {
                                                    date: game.date,
                                                    games: []
                                                };
                                            }
                                            
                                            gamesByMonth[monthYear].dates[dateStr].games.push(game);
                                        });
                                        
                                        const sortedMonths = Object.keys(gamesByMonth).sort((a, b) => 
                                            gamesByMonth[b].sortDate - gamesByMonth[a].sortDate
                                        );
                                        
                                        return (
                                            <>
                                                {sortedMonths.map(monthYear => {
                                                    const monthData = gamesByMonth[monthYear];
                                                    const sortedDates = Object.keys(monthData.dates).sort((a, b) => 
                                                        monthData.dates[b].date - monthData.dates[a].date
                                                    );
                                                    const totalGames = sortedDates.reduce((sum, date) => sum + monthData.dates[date].games.length, 0);
                                                    
                                                    return (
                                                        <div key={monthYear} style={{ marginBottom: '2rem' }}>
                                                            <h3 style={{ 
                                                                color: '#22d3ee', 
                                                                marginBottom: '1rem',
                                                                paddingBottom: '0.5rem',
                                                                borderBottom: '2px solid rgba(34, 211, 238, 0.3)'
                                                            }}>
                                                                {monthYear} ({sortedDates.length} game days, {totalGames} games)
                                                            </h3>
                                                            
                                                            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(180px, 1fr))', gap: '0.5rem', marginBottom: '1.5rem' }}>
                                                                {sortedDates.map(dateStr => {
                                                                    const dateInfo = monthData.dates[dateStr];
                                                                    const isSelected = selectedDate === dateStr;
                                                                    
                                                                    return (
                                                                        <button
                                                                            key={dateStr}
                                                                            onClick={() => setSelectedDate(dateStr)}
                                                                            style={{
                                                                                padding: '0.75rem',
                                                                                background: isSelected ? '#22d3ee' : 'rgba(30, 58, 138, 0.3)',
                                                                                border: isSelected ? '2px solid #22d3ee' : '1px solid rgba(100, 116, 139, 0.3)',
                                                                                borderRadius: '0.5rem',
                                                                                color: isSelected ? '#0f172a' : '#fff',
                                                                                cursor: 'pointer',
                                                                                textAlign: 'left',
                                                                                transition: 'all 0.2s',
                                                                                fontWeight: isSelected ? 'bold' : 'normal'
                                                                            }}
                                                                            onMouseEnter={(e) => { 
                                                                                if (!isSelected) {
                                                                                    e.target.style.background = 'rgba(30, 58, 138, 0.5)';
                                                                                    e.target.style.borderColor = 'rgba(34, 211, 238, 0.5)';
                                                                                }
                                                                            }}
                                                                            onMouseLeave={(e) => { 
                                                                                if (!isSelected) {
                                                                                    e.target.style.background = 'rgba(30, 58, 138, 0.3)';
                                                                                    e.target.style.borderColor = 'rgba(100, 116, 139, 0.3)';
                                                                                }
                                                                            }}
                                                                        >
                                                                            <div style={{ fontWeight: 'bold', marginBottom: '0.25rem', color: isSelected ? '#0f172a' : '#fff' }}>
                                                                                {dateInfo.date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' })}
                                                                            </div>
                                                                            <div style={{ fontSize: '0.875rem', color: isSelected ? '#0f172a' : '#93c5fd' }}>
                                                                                {dateInfo.games.length} game{dateInfo.games.length !== 1 ? 's' : ''}
                                                                            </div>
                                                                        </button>
                                                                    );
                                                                })}
                                                            </div>
                                                            
                                                            {selectedDate && monthData.dates[selectedDate] && (
                                                                <div style={{ 
                                                                    padding: '1.5rem', 
                                                                    background: 'rgba(34, 211, 238, 0.1)', 
                                                                    borderRadius: '0.5rem',
                                                                    border: '2px solid #22d3ee',
                                                                    marginTop: '1rem'
                                                                }}>
                                                                    <h4 style={{ color: '#22d3ee', marginBottom: '1rem', fontSize: '1.2rem' }}>
                                                                        ðŸ“… Games on {selectedDate} ({monthData.dates[selectedDate].games.length} games)
                                                                    </h4>
                                                                    <table className="stats-table">
                                                                        <thead>
                                                                            <tr>
                                                                                <th>Away Team</th>
                                                                                <th className="text-center">Score</th>
                                                                                <th>Home Team</th>
                                                                                <th className="text-center">Result</th>
                                                                            </tr>
                                                                        </thead>
                                                                        <tbody>
                                                                            {monthData.dates[selectedDate].games.map((game, idx) => {
                                                                                const homeTeam = TEAMS.find(t => t.id === game.homeTeam);
                                                                                const awayTeam = TEAMS.find(t => t.id === game.awayTeam);
                                                                                const homeWon = game.homeScore > game.awayScore;
                                                                                
                                                                                return (
                                                                                    <tr 
                                                                                        key={idx} 
                                                                                        style={{ cursor: 'pointer' }}
                                                                                        onClick={() => navigateTo('gameDetail', game)}
                                                                                    >
                                                                                        <td style={{ fontWeight: homeWon ? 'normal' : 'bold' }}>
                                                                                            {awayTeam.city} {awayTeam.name}
                                                                                            {/* NEW: Game tags */}
                                                                                            {game.tags && game.tags.length > 0 && (
                                                                                                <div style={{ marginTop: '0.25rem', display: 'flex', gap: '0.25rem', flexWrap: 'wrap' }}>
                                                                                                    {game.tags.includes('rivalry') && (
                                                                                                        <span style={{
                                                                                                            padding: '0.1rem 0.35rem',
                                                                                                            background: '#f59e0b',
                                                                                                            color: '#fff',
                                                                                                            borderRadius: '0.2rem',
                                                                                                            fontSize: '0.65rem',
                                                                                                            fontWeight: 'bold'
                                                                                                        }}>
                                                                                                            ðŸ”¥ RIVALRY
                                                                                                        </span>
                                                                                                    )}
                                                                                                    {game.tags.includes('back-to-back') && (
                                                                                                        <span style={{
                                                                                                            padding: '0.1rem 0.35rem',
                                                                                                            background: '#ef4444',
                                                                                                            color: '#fff',
                                                                                                            borderRadius: '0.2rem',
                                                                                                            fontSize: '0.65rem',
                                                                                                            fontWeight: 'bold'
                                                                                                        }}>
                                                                                                            âš ï¸ B2B
                                                                                                        </span>
                                                                                                    )}
                                                                                                    {game.tags.includes('playoff-race') && (
                                                                                                        <span style={{
                                                                                                            padding: '0.1rem 0.35rem',
                                                                                                            background: '#8b5cf6',
                                                                                                            color: '#fff',
                                                                                                            borderRadius: '0.2rem',
                                                                                                            fontSize: '0.65rem',
                                                                                                            fontWeight: 'bold'
                                                                                                        }}>
                                                                                                            ðŸ† PLAYOFF RACE
                                                                                                        </span>
                                                                                                    )}
                                                                                                </div>
                                                                                            )}
                                                                                        </td>
                                                                                        <td className="text-center" style={{ fontWeight: 'bold', fontSize: '1.1rem' }}>
                                                                                            <span style={{ color: homeWon ? '#e2e8f0' : '#22c55e' }}>{game.awayScore}</span>
                                                                                            {' - '}
                                                                                            <span style={{ color: homeWon ? '#22c55e' : '#e2e8f0' }}>{game.homeScore}</span>
                                                                                        </td>
                                                                                        <td style={{ fontWeight: homeWon ? 'bold' : 'normal' }}>
                                                                                            {homeTeam.city} {homeTeam.name}
                                                                                        </td>
                                                                                        <td className="text-center">
                                                                                            <span style={{ 
                                                                                                padding: '0.25rem 0.5rem',
                                                                                                borderRadius: '0.25rem',
                                                                                                fontSize: '0.75rem',
                                                                                                background: homeWon ? '#22c55e' : '#ef4444',
                                                                                                fontWeight: 'bold'
                                                                                            }}>
                                                                                                {homeWon ? 'HOME WIN' : 'AWAY WIN'}
                                                                                            </span>
                                                                                        </td>
                                                                                    </tr>
                                                                                );
                                                                            })}
                                                                        </tbody>
                                                                    </table>
                                                                </div>
                                                            )}
                                                        </div>
                                                    );
                                                })}
                                            </>
                                        );
                                    })()}
                                </div>
                            </div>
                        )}

                        {currentView === 'gameDetail' && selectedGame && (
                            <div>
                                <button 
                                    onClick={goBack}
                                    style={{
                                        padding: '0.5rem 1rem',
                                        background: '#2563eb',
                                        color: '#fff',
                                        border: 'none',
                                        borderRadius: '0.375rem',
                                        cursor: 'pointer',
                                        marginBottom: '1rem',
                                        fontWeight: 'bold'
                                    }}
                                >
                                    â† Back
                                </button>
                                
                                <div className="card">
                                    <h2>Game Summary</h2>
                                    <p style={{ color: '#93c5fd', marginBottom: '1rem' }}>
                                        {selectedGame.date ? selectedGame.date.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' }) : 'Regular Season Game'}
                                    </p>
                                    
                                    <div style={{ 
                                        display: 'flex', 
                                        justifyContent: 'space-between', 
                                        alignItems: 'center',
                                        padding: '2rem',
                                        background: 'rgba(30, 58, 138, 0.3)',
                                        borderRadius: '0.5rem',
                                        marginBottom: '2rem'
                                    }}>
                                        {(() => {
                                            const homeTeam = TEAMS.find(t => t.id === selectedGame.homeTeam);
                                            const awayTeam = TEAMS.find(t => t.id === selectedGame.awayTeam);
                                            const homeWon = selectedGame.homeScore > selectedGame.awayScore;
                                            
                                            return (
                                                <>
                                                    <div style={{ textAlign: 'center', flex: 1 }}>
                                                        <div style={{ fontSize: '1.5rem', fontWeight: 'bold', marginBottom: '0.5rem' }}>
                                                            {awayTeam.city} {awayTeam.name}
                                                        </div>
                                                        <div style={{ fontSize: '0.875rem', color: '#93c5fd', marginBottom: '0.5rem' }}>
                                                            AWAY
                                                        </div>
                                                        <div style={{ 
                                                            fontSize: '4rem', 
                                                            fontWeight: 'bold',
                                                            color: !homeWon ? '#22c55e' : '#fff'
                                                        }}>
                                                            {selectedGame.awayScore}
                                                        </div>
                                                    </div>
                                                    <div style={{ fontSize: '3rem', color: '#93c5fd', padding: '0 2rem' }}>
                                                        @
                                                    </div>
                                                    <div style={{ textAlign: 'center', flex: 1 }}>
                                                        <div style={{ fontSize: '1.5rem', fontWeight: 'bold', marginBottom: '0.5rem' }}>
                                                            {homeTeam.city} {homeTeam.name}
                                                        </div>
                                                        <div style={{ fontSize: '0.875rem', color: '#93c5fd', marginBottom: '0.5rem' }}>
                                                            HOME
                                                        </div>
                                                        <div style={{ 
                                                            fontSize: '4rem', 
                                                            fontWeight: 'bold',
                                                            color: homeWon ? '#22c55e' : '#fff'
                                                        }}>
                                                            {selectedGame.homeScore}
                                                        </div>
                                                    </div>
                                                </>
                                            );
                                        })()}
                                    </div>
                                    
                                    {/* Winner Badge */}
                                    {(() => {
                                        const homeTeam = TEAMS.find(t => t.id === selectedGame.homeTeam);
                                        const awayTeam = TEAMS.find(t => t.id === selectedGame.awayTeam);
                                        const homeWon = selectedGame.homeScore > selectedGame.awayScore;
                                        const winner = homeWon ? homeTeam : awayTeam;
                                        
                                        return (
                                            <div style={{ 
                                                padding: '1rem',
                                                background: 'rgba(34, 197, 94, 0.15)',
                                                borderRadius: '0.5rem',
                                                marginBottom: '2rem',
                                                textAlign: 'center',
                                                border: '2px solid #22c55e'
                                            }}>
                                                <div style={{ color: '#22c55e', fontSize: '1.2rem', fontWeight: 'bold' }}>
                                                    ðŸ† WINNER: {winner.city} {winner.name}
                                                </div>
                                            </div>
                                        );
                                    })()}
                                    
                                    {/* Period-by-Period Scoring Summary */}
                                    {selectedGame.details && selectedGame.details.scoringSummary && selectedGame.details.scoringSummary.some(p => p.goals.length > 0) && (
                                        (() => {
                                            const homeTeam = TEAMS.find(t => t.id === selectedGame.homeTeam);
                                            const awayTeam = TEAMS.find(t => t.id === selectedGame.awayTeam);
                                            
                                            // Calculate pre-game stats for running totals
                                            const getPreGameStats = (playerId) => {
                                                // Find all games this player played BEFORE the current game
                                                let goals = 0;
                                                let assists = 0;
                                                
                                                // Iterate through schedule days before this game's day
                                                gameState.schedule.forEach(daySchedule => {
                                                    if (daySchedule.day >= selectedGame.day) return; // Skip this game and future games
                                                    
                                                    daySchedule.matchups.forEach(game => {
                                                        if (!game.played || !game.details) return;
                                                        
                                                        // Check if this player played in this game
                                                        const homeStats = game.details.homePlayerStats?.find(ps => ps.player.id === playerId);
                                                        const awayStats = game.details.awayPlayerStats?.find(ps => ps.player.id === playerId);
                                                        
                                                        if (homeStats) {
                                                            goals += homeStats.goals || 0;
                                                            assists += homeStats.assists || 0;
                                                        }
                                                        if (awayStats) {
                                                            goals += awayStats.goals || 0;
                                                            assists += awayStats.assists || 0;
                                                        }
                                                    });
                                                });
                                                
                                                return { goals, assists };
                                            };
                                            
                                            return (
                                                <div style={{ marginBottom: '2rem' }}>
                                                    <h3 style={{ color: '#22d3ee', marginBottom: '1.5rem' }}>âš¡ Scoring Summary</h3>
                                                    {selectedGame.details.scoringSummary.map((period, idx) => {
                                                        if (period.goals.length === 0) return null;
                                                        
                                                        // Track running totals within this game
                                                        const gameRunningTotals = {};
                                                        
                                                        return (
                                                            <div key={period.period} style={{ 
                                                                marginBottom: '1.5rem',
                                                                padding: '1rem',
                                                                background: 'rgba(30, 58, 138, 0.2)',
                                                                borderRadius: '0.5rem',
                                                                border: '1px solid rgba(59, 130, 246, 0.3)'
                                                            }}>
                                                                <h4 style={{ color: '#93c5fd', marginBottom: '1rem', fontSize: '1rem' }}>
                                                                    {period.period === 1 ? '1st' : period.period === 2 ? '2nd' : '3rd'} Period
                                                                </h4>
                                                                {period.goals.map((goal, goalIdx) => {
                                                                    const team = goal.team === 'home' ? homeTeam : awayTeam;
                                                                    const preGameStats = getPreGameStats(goal.scorer.id);
                                                                    
                                                                    // Initialize running total for this player if not exists
                                                                    if (!gameRunningTotals[goal.scorer.id]) {
                                                                        gameRunningTotals[goal.scorer.id] = { goals: 0, assists: 0 };
                                                                    }
                                                                    gameRunningTotals[goal.scorer.id].goals++;
                                                                    
                                                                    const seasonGoalTotal = preGameStats.goals + gameRunningTotals[goal.scorer.id].goals;
                                                                    
                                                                    return (
                                                                        <div key={goalIdx} style={{ 
                                                                            marginBottom: goalIdx < period.goals.length - 1 ? '0.75rem' : '0',
                                                                            paddingBottom: goalIdx < period.goals.length - 1 ? '0.75rem' : '0',
                                                                            borderBottom: goalIdx < period.goals.length - 1 ? '1px solid rgba(100, 116, 139, 0.3)' : 'none'
                                                                        }}>
                                                                            <div style={{ display: 'flex', alignItems: 'center', gap: '0.75rem', marginBottom: '0.25rem' }}>
                                                                                <span style={{ 
                                                                                    padding: '0.25rem 0.5rem',
                                                                                    background: goal.team === 'home' ? 'rgba(34, 197, 94, 0.2)' : 'rgba(59, 130, 246, 0.2)',
                                                                                    borderRadius: '0.25rem',
                                                                                    fontSize: '0.75rem',
                                                                                    fontWeight: 'bold',
                                                                                    color: goal.team === 'home' ? '#22c55e' : '#3b82f6'
                                                                                }}>
                                                                                    {team.abbreviation}
                                                                                </span>
                                                                                <span style={{ fontWeight: 'bold', color: '#fff' }}>
                                                                                    {goal.scorer.name}
                                                                                </span>
                                                                                <span style={{ 
                                                                                    fontSize: '0.85rem',
                                                                                    color: '#22c55e',
                                                                                    fontWeight: 'bold'
                                                                                }}>
                                                                                    ({seasonGoalTotal})
                                                                                </span>
                                                                            </div>
                                                                            {goal.assists.length > 0 && (
                                                                                <div style={{ 
                                                                                    fontSize: '0.875rem', 
                                                                                    color: '#94a3b8',
                                                                                    marginLeft: '2.5rem'
                                                                                }}>
                                                                                    Assists: {goal.assists.map((assist, aIdx) => {
                                                                                        const assistPreGameStats = getPreGameStats(assist.id);
                                                                                        
                                                                                        if (!gameRunningTotals[assist.id]) {
                                                                                            gameRunningTotals[assist.id] = { goals: 0, assists: 0 };
                                                                                        }
                                                                                        gameRunningTotals[assist.id].assists++;
                                                                                        
                                                                                        const seasonAssistTotal = assistPreGameStats.assists + gameRunningTotals[assist.id].assists;
                                                                                        
                                                                                        return (
                                                                                            <span key={assist.id}>
                                                                                                {assist.name} <span style={{ color: '#22c55e', fontWeight: 'bold' }}>({seasonAssistTotal})</span>
                                                                                                {aIdx < goal.assists.length - 1 ? ', ' : ''}
                                                                                            </span>
                                                                                        );
                                                                                    })}
                                                                                </div>
                                                                            )}
                                                                        </div>
                                                                    );
                                                                })}
                                                            </div>
                                                        );
                                                    })}
                                                </div>
                                            );
                                        })()
                                    )}
                                    
                                    {/* Period-by-Period Scoring */}
                                    {selectedGame.details && selectedGame.periodScoring && (
                                        <div style={{ marginBottom: '2rem' }}>
                                            <h3 style={{ color: '#22d3ee', marginBottom: '1rem' }}>ðŸ“Š Period Breakdown</h3>
                                            <table className="stats-table">
                                                <thead>
                                                    <tr>
                                                        <th>Team</th>
                                                        <th className="text-center">1st</th>
                                                        <th className="text-center">2nd</th>
                                                        <th className="text-center">3rd</th>
                                                        <th className="text-center">Final</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {(() => {
                                                        const homeTeam = TEAMS.find(t => t.id === selectedGame.homeTeam);
                                                        const awayTeam = TEAMS.find(t => t.id === selectedGame.awayTeam);
                                                        
                                                        return (
                                                            <>
                                                                <tr>
                                                                    <td>{awayTeam.city} {awayTeam.name}</td>
                                                                    <td className="text-center">{selectedGame.periodScoring[0]?.away || 0}</td>
                                                                    <td className="text-center">{selectedGame.periodScoring[1]?.away || 0}</td>
                                                                    <td className="text-center">{selectedGame.periodScoring[2]?.away || 0}</td>
                                                                    <td className="text-center" style={{ fontWeight: 'bold', fontSize: '1.1rem' }}>
                                                                        {selectedGame.awayScore}
                                                                    </td>
                                                                </tr>
                                                                <tr>
                                                                    <td>{homeTeam.city} {homeTeam.name}</td>
                                                                    <td className="text-center">{selectedGame.periodScoring[0]?.home || 0}</td>
                                                                    <td className="text-center">{selectedGame.periodScoring[1]?.home || 0}</td>
                                                                    <td className="text-center">{selectedGame.periodScoring[2]?.home || 0}</td>
                                                                    <td className="text-center" style={{ fontWeight: 'bold', fontSize: '1.1rem' }}>
                                                                        {selectedGame.homeScore}
                                                                    </td>
                                                                </tr>
                                                            </>
                                                        );
                                                    })()}
                                                </tbody>
                                            </table>
                                        </div>
                                    )}
                                    
                                    {/* Team Statistics */}
                                    {selectedGame.details && selectedGame.details.teamStats && (
                                        <div style={{ marginBottom: '2rem' }}>
                                            <h3 style={{ color: '#22d3ee', marginBottom: '1rem' }}>ðŸ“ˆ Team Statistics</h3>
                                            <table className="stats-table">
                                                <thead>
                                                    <tr>
                                                        <th>Team</th>
                                                        <th className="text-center">Shots</th>
                                                        <th className="text-center">PP</th>
                                                        <th className="text-center">PP Goals</th>
                                                        <th className="text-center">SH Goals</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {(() => {
                                                        const homeTeam = TEAMS.find(t => t.id === selectedGame.homeTeam);
                                                        const awayTeam = TEAMS.find(t => t.id === selectedGame.awayTeam);
                                                        const stats = selectedGame.details.teamStats;
                                                        
                                                        return (
                                                            <>
                                                                <tr>
                                                                    <td>{awayTeam.city} {awayTeam.name}</td>
                                                                    <td className="text-center">{stats.awayShots}</td>
                                                                    <td className="text-center">
                                                                        {stats.awayPPGoals}/{stats.awayPPOpportunities}
                                                                    </td>
                                                                    <td className="text-center">{stats.awayPPGoals}</td>
                                                                    <td className="text-center">{stats.awaySHGoals}</td>
                                                                </tr>
                                                                <tr>
                                                                    <td>{homeTeam.city} {homeTeam.name}</td>
                                                                    <td className="text-center">{stats.homeShots}</td>
                                                                    <td className="text-center">
                                                                        {stats.homePPGoals}/{stats.homePPOpportunities}
                                                                    </td>
                                                                    <td className="text-center">{stats.homePPGoals}</td>
                                                                    <td className="text-center">{stats.homeSHGoals}</td>
                                                                </tr>
                                                            </>
                                                        );
                                                    })()}
                                                </tbody>
                                            </table>
                                        </div>
                                    )}
                                    
                                    {/* Penalties */}
                                    {selectedGame.details && selectedGame.details.penaltyLog && selectedGame.details.penaltyLog.length > 0 && (
                                        <div style={{ marginBottom: '2rem' }}>
                                            <h3 style={{ color: '#22d3ee', marginBottom: '1rem' }}>âš ï¸ Penalties</h3>
                                            <div style={{ 
                                                display: 'flex', 
                                                flexDirection: 'column', 
                                                gap: '0.5rem'
                                            }}>
                                                {selectedGame.details.penaltyLog.map((penalty, idx) => {
                                                    const homeTeam = TEAMS.find(t => t.id === selectedGame.homeTeam);
                                                    const awayTeam = TEAMS.find(t => t.id === selectedGame.awayTeam);
                                                    const team = penalty.team === 'home' ? homeTeam : awayTeam;
                                                    
                                                    return (
                                                        <div key={idx} style={{
                                                            padding: '0.75rem',
                                                            background: 'rgba(245, 158, 11, 0.1)',
                                                            borderRadius: '0.375rem',
                                                            border: '1px solid rgba(245, 158, 11, 0.3)',
                                                            display: 'flex',
                                                            alignItems: 'center',
                                                            gap: '1rem'
                                                        }}>
                                                            <span style={{
                                                                padding: '0.25rem 0.5rem',
                                                                background: penalty.team === 'home' ? 'rgba(34, 197, 94, 0.2)' : 'rgba(59, 130, 246, 0.2)',
                                                                borderRadius: '0.25rem',
                                                                fontSize: '0.75rem',
                                                                fontWeight: 'bold',
                                                                color: penalty.team === 'home' ? '#22c55e' : '#3b82f6',
                                                                minWidth: '50px',
                                                                textAlign: 'center'
                                                            }}>
                                                                {team.abbreviation}
                                                            </span>
                                                            <span style={{ 
                                                                fontSize: '0.875rem',
                                                                color: '#94a3b8',
                                                                minWidth: '60px'
                                                            }}>
                                                                Period {penalty.period}
                                                            </span>
                                                            <span style={{ fontWeight: 'bold', color: '#fff', flex: 1 }}>
                                                                {penalty.player}
                                                            </span>
                                                            <span style={{ 
                                                                color: '#fbbf24',
                                                                fontSize: '0.875rem',
                                                                fontWeight: 'bold',
                                                                minWidth: '120px',
                                                                textAlign: 'right'
                                                            }}>
                                                                {penalty.type}
                                                            </span>
                                                            <span style={{ 
                                                                color: '#94a3b8',
                                                                fontSize: '0.875rem',
                                                                minWidth: '60px',
                                                                textAlign: 'right'
                                                            }}>
                                                                {penalty.duration} min
                                                            </span>
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                        </div>
                                    )}
                                    
                                    {/* Game Stats - Check if we have per-game stats */}
                                    {selectedGame.details && selectedGame.details.homePlayerStats ? (
                                        // Show per-game stats with tabs
                                        (() => {
                                            const homeTeam = TEAMS.find(t => t.id === selectedGame.homeTeam);
                                            const awayTeam = TEAMS.find(t => t.id === selectedGame.awayTeam);
                                            
                                            return (
                                                <>
                                                    {/* Team Tabs */}
                                                    <div style={{ 
                                                        display: 'flex', 
                                                        gap: '0.5rem',
                                                        marginBottom: '1.5rem',
                                                        borderBottom: '2px solid rgba(100, 116, 139, 0.3)'
                                                    }}>
                                                        <button
                                                            onClick={() => setGameDetailTeamTab('away')}
                                                            style={{
                                                                padding: '0.75rem 1.5rem',
                                                                background: gameDetailTeamTab === 'away' ? 'rgba(34, 211, 238, 0.2)' : 'transparent',
                                                                border: 'none',
                                                                borderBottom: gameDetailTeamTab === 'away' ? '3px solid #22d3ee' : '3px solid transparent',
                                                                color: gameDetailTeamTab === 'away' ? '#22d3ee' : '#94a3b8',
                                                                cursor: 'pointer',
                                                                fontWeight: gameDetailTeamTab === 'away' ? 'bold' : 'normal',
                                                                fontSize: '1rem',
                                                                transition: 'all 0.2s'
                                                            }}
                                                        >
                                                            {awayTeam.city} {awayTeam.name} (Away)
                                                        </button>
                                                        <button
                                                            onClick={() => setGameDetailTeamTab('home')}
                                                            style={{
                                                                padding: '0.75rem 1.5rem',
                                                                background: gameDetailTeamTab === 'home' ? 'rgba(34, 211, 238, 0.2)' : 'transparent',
                                                                border: 'none',
                                                                borderBottom: gameDetailTeamTab === 'home' ? '3px solid #22d3ee' : '3px solid transparent',
                                                                color: gameDetailTeamTab === 'home' ? '#22d3ee' : '#94a3b8',
                                                                cursor: 'pointer',
                                                                fontWeight: gameDetailTeamTab === 'home' ? 'bold' : 'normal',
                                                                fontSize: '1rem',
                                                                transition: 'all 0.2s'
                                                            }}
                                                        >
                                                            {homeTeam.city} {homeTeam.name} (Home)
                                                        </button>
                                                    </div>
                                                    
                                                    {/* Away Team Stats */}
                                                    {gameDetailTeamTab === 'away' && (
                                                        <div>
                                                            {/* Skaters */}
                                                            <h4 style={{ color: '#93c5fd', marginTop: '1rem', marginBottom: '0.75rem' }}>Skaters</h4>
                                                            <table className="stats-table">
                                                                <thead>
                                                                    <tr>
                                                                        <th>Player</th>
                                                                        <th className="text-center">G</th>
                                                                        <th className="text-center">A</th>
                                                                        <th className="text-center">PTS</th>
                                                                        <th className="text-center">+/-</th>
                                                                        <th className="text-center">SOG</th>
                                                                        <th className="text-center">TOI</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    {selectedGame.details.awayPlayerStats.filter(ps => ps.player.position !== 'G').sort((a, b) => b.points - a.points).map(ps => (
                                                                        <tr key={ps.player.id} style={{ background: ps.points > 0 ? 'rgba(34, 197, 94, 0.1)' : 'transparent' }}>
                                                                            <td>
                                                                                <span style={{ cursor: 'pointer', color: '#22d3ee' }} onClick={() => navigateTo('playerProfile', ps.player)}>
                                                                                    {ps.player.firstName} {ps.player.lastName}
                                                                                </span>
                                                                                <span style={{ color: '#64748b', marginLeft: '0.5rem', fontSize: '0.85em' }}>
                                                                                    {ps.player.position}
                                                                                </span>
                                                                            </td>
                                                                            <td className="text-center" style={{ fontWeight: ps.goals > 0 ? 'bold' : 'normal', color: ps.goals > 0 ? '#22c55e' : 'inherit' }}>{ps.goals}</td>
                                                                            <td className="text-center" style={{ fontWeight: ps.assists > 0 ? 'bold' : 'normal', color: ps.assists > 0 ? '#22c55e' : 'inherit' }}>{ps.assists}</td>
                                                                            <td className="text-center" style={{ fontWeight: ps.points > 0 ? 'bold' : 'normal', color: ps.points > 0 ? '#22c55e' : 'inherit' }}>{ps.points}</td>
                                                                            <td className="text-center">{ps.plusMinus > 0 ? '+' : ''}{ps.plusMinus}</td>
                                                                            <td className="text-center">{ps.shots}</td>
                                                                            <td className="text-center">{formatTOI(ps.toi)}</td>
                                                                        </tr>
                                                                    ))}
                                                                </tbody>
                                                            </table>
                                                            
                                                            {/* Goalies */}
                                                            <h4 style={{ color: '#93c5fd', marginTop: '1.5rem', marginBottom: '0.75rem' }}>Goalies</h4>
                                                            <table className="stats-table">
                                                                <thead>
                                                                    <tr>
                                                                        <th>Player</th>
                                                                        <th className="text-center">SA</th>
                                                                        <th className="text-center">SV</th>
                                                                        <th className="text-center">GA</th>
                                                                        <th className="text-center">SV%</th>
                                                                        <th className="text-center">Result</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    {selectedGame.details.awayPlayerStats.filter(ps => ps.player.position === 'G' && ps.shotsAgainst > 0).map(ps => {
                                                                        const svPct = ps.shotsAgainst > 0 ? (ps.saves / ps.shotsAgainst).toFixed(3) : '.000';
                                                                        const isWinner = selectedGame.awayScore > selectedGame.homeScore;
                                                                        return (
                                                                            <tr key={ps.player.id}>
                                                                                <td>
                                                                                    <span style={{ cursor: 'pointer', color: '#22d3ee' }} onClick={() => navigateTo('playerProfile', ps.player)}>
                                                                                        {ps.player.firstName} {ps.player.lastName}
                                                                                    </span>
                                                                                </td>
                                                                                <td className="text-center">{ps.shotsAgainst}</td>
                                                                                <td className="text-center">{ps.saves}</td>
                                                                                <td className="text-center">{ps.goalsAgainst}</td>
                                                                                <td className="text-center">{svPct}</td>
                                                                                <td className="text-center">
                                                                                    <span style={{ 
                                                                                        padding: '0.25rem 0.5rem',
                                                                                        borderRadius: '0.25rem',
                                                                                        fontSize: '0.75rem',
                                                                                        fontWeight: 'bold',
                                                                                        background: isWinner ? '#22c55e' : '#ef4444'
                                                                                    }}>
                                                                                        {isWinner ? 'W' : 'L'}
                                                                                    </span>
                                                                                </td>
                                                                            </tr>
                                                                        );
                                                                    })}
                                                                </tbody>
                                                            </table>
                                                            
                                                            {/* DNP Players */}
                                                            {selectedGame.details.awayScratched?.length > 0 && (
                                                                <div style={{ marginTop: '1.5rem', padding: '0.75rem', background: 'rgba(100, 116, 139, 0.1)', borderRadius: '0.375rem' }}>
                                                                    <h5 style={{ color: '#64748b', fontSize: '0.875rem', marginBottom: '0.5rem' }}>Healthy Scratches:</h5>
                                                                    <div style={{ display: 'flex', flexWrap: 'wrap', gap: '0.5rem' }}>
                                                                        {selectedGame.details.awayScratched.map(p => (
                                                                            <span key={p.id} style={{ 
                                                                                padding: '0.25rem 0.5rem',
                                                                                background: 'rgba(100, 116, 139, 0.2)',
                                                                                borderRadius: '0.25rem',
                                                                                fontSize: '0.75rem',
                                                                                color: '#94a3b8'
                                                                            }}>
                                                                                {p.name}
                                                                            </span>
                                                                        ))}
                                                                    </div>
                                                                </div>
                                                            )}
                                                        </div>
                                                    )}
                                                    
                                                    {/* Home Team Stats */}
                                                    {gameDetailTeamTab === 'home' && (
                                                        <div>
                                                            {/* Skaters */}
                                                            <h4 style={{ color: '#93c5fd', marginTop: '1rem', marginBottom: '0.75rem' }}>Skaters</h4>
                                                            <table className="stats-table">
                                                                <thead>
                                                                    <tr>
                                                                        <th>Player</th>
                                                                        <th className="text-center">G</th>
                                                                        <th className="text-center">A</th>
                                                                        <th className="text-center">PTS</th>
                                                                        <th className="text-center">+/-</th>
                                                                        <th className="text-center">SOG</th>
                                                                        <th className="text-center">TOI</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    {selectedGame.details.homePlayerStats.filter(ps => ps.player.position !== 'G').sort((a, b) => b.points - a.points).map(ps => (
                                                                        <tr key={ps.player.id} style={{ background: ps.points > 0 ? 'rgba(34, 197, 94, 0.1)' : 'transparent' }}>
                                                                            <td>
                                                                                <span style={{ cursor: 'pointer', color: '#22d3ee' }} onClick={() => navigateTo('playerProfile', ps.player)}>
                                                                                    {ps.player.firstName} {ps.player.lastName}
                                                                                </span>
                                                                                <span style={{ color: '#64748b', marginLeft: '0.5rem', fontSize: '0.85em' }}>
                                                                                    {ps.player.position}
                                                                                </span>
                                                                            </td>
                                                                            <td className="text-center" style={{ fontWeight: ps.goals > 0 ? 'bold' : 'normal', color: ps.goals > 0 ? '#22c55e' : 'inherit' }}>{ps.goals}</td>
                                                                            <td className="text-center" style={{ fontWeight: ps.assists > 0 ? 'bold' : 'normal', color: ps.assists > 0 ? '#22c55e' : 'inherit' }}>{ps.assists}</td>
                                                                            <td className="text-center" style={{ fontWeight: ps.points > 0 ? 'bold' : 'normal', color: ps.points > 0 ? '#22c55e' : 'inherit' }}>{ps.points}</td>
                                                                            <td className="text-center">{ps.plusMinus > 0 ? '+' : ''}{ps.plusMinus}</td>
                                                                            <td className="text-center">{ps.shots}</td>
                                                                            <td className="text-center">{formatTOI(ps.toi)}</td>
                                                                        </tr>
                                                                    ))}
                                                                </tbody>
                                                            </table>
                                                            
                                                            {/* Goalies */}
                                                            <h4 style={{ color: '#93c5fd', marginTop: '1.5rem', marginBottom: '0.75rem' }}>Goalies</h4>
                                                            <table className="stats-table">
                                                                <thead>
                                                                    <tr>
                                                                        <th>Player</th>
                                                                        <th className="text-center">SA</th>
                                                                        <th className="text-center">SV</th>
                                                                        <th className="text-center">GA</th>
                                                                        <th className="text-center">SV%</th>
                                                                        <th className="text-center">Result</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    {selectedGame.details.homePlayerStats.filter(ps => ps.player.position === 'G' && ps.shotsAgainst > 0).map(ps => {
                                                                        const svPct = ps.shotsAgainst > 0 ? (ps.saves / ps.shotsAgainst).toFixed(3) : '.000';
                                                                        const isWinner = selectedGame.homeScore > selectedGame.awayScore;
                                                                        return (
                                                                            <tr key={ps.player.id}>
                                                                                <td>
                                                                                    <span style={{ cursor: 'pointer', color: '#22d3ee' }} onClick={() => navigateTo('playerProfile', ps.player)}>
                                                                                        {ps.player.firstName} {ps.player.lastName}
                                                                                    </span>
                                                                                </td>
                                                                                <td className="text-center">{ps.shotsAgainst}</td>
                                                                                <td className="text-center">{ps.saves}</td>
                                                                                <td className="text-center">{ps.goalsAgainst}</td>
                                                                                <td className="text-center">{svPct}</td>
                                                                                <td className="text-center">
                                                                                    <span style={{ 
                                                                                        padding: '0.25rem 0.5rem',
                                                                                        borderRadius: '0.25rem',
                                                                                        fontSize: '0.75rem',
                                                                                        fontWeight: 'bold',
                                                                                        background: isWinner ? '#22c55e' : '#ef4444'
                                                                                    }}>
                                                                                        {isWinner ? 'W' : 'L'}
                                                                                    </span>
                                                                                </td>
                                                                            </tr>
                                                                        );
                                                                    })}
                                                                </tbody>
                                                            </table>
                                                            
                                                            {/* DNP Players */}
                                                            {selectedGame.details.homeScratched?.length > 0 && (
                                                                <div style={{ marginTop: '1.5rem', padding: '0.75rem', background: 'rgba(100, 116, 139, 0.1)', borderRadius: '0.375rem' }}>
                                                                    <h5 style={{ color: '#64748b', fontSize: '0.875rem', marginBottom: '0.5rem' }}>Healthy Scratches:</h5>
                                                                    <div style={{ display: 'flex', flexWrap: 'wrap', gap: '0.5rem' }}>
                                                                        {selectedGame.details.homeScratched.map(p => (
                                                                            <span key={p.id} style={{ 
                                                                                padding: '0.25rem 0.5rem',
                                                                                background: 'rgba(100, 116, 139, 0.2)',
                                                                                borderRadius: '0.25rem',
                                                                                fontSize: '0.75rem',
                                                                                color: '#94a3b8'
                                                                            }}>
                                                                                {p.name}
                                                                            </span>
                                                                        ))}
                                                                    </div>
                                                                </div>
                                                            )}
                                                        </div>
                                                    )}
                                                </>
                                            );
                                        })()
                                    ) : (
                                        // Old game without per-game stats
                                        <div style={{ 
                                            padding: '2rem',
                                            background: 'rgba(251, 191, 36, 0.1)',
                                            borderRadius: '0.5rem',
                                            border: '1px solid rgba(251, 191, 36, 0.3)',
                                            textAlign: 'center'
                                        }}>
                                            <h3 style={{ color: '#fbbf24', marginBottom: '1rem' }}>
                                                âš ï¸ Per-Game Stats Not Available
                                            </h3>
                                            <p style={{ color: '#e2e8f0', marginBottom: '1rem', lineHeight: '1.6' }}>
                                                This game was simulated before the per-game stat tracking system was implemented.
                                            </p>
                                            <p style={{ color: '#93c5fd', fontSize: '0.9rem' }}>
                                                ðŸ’¡ <strong>To see per-game stats:</strong> Simulate new games going forward. All future games will track detailed per-player statistics for each game!
                                            </p>
                                        </div>
                                    )}
                                    
                                    {/* Injury Report - Bottom of Page */}
                                    {(() => {
                                        const homeTeam = TEAMS.find(t => t.id === selectedGame.homeTeam);
                                        const awayTeam = TEAMS.find(t => t.id === selectedGame.awayTeam);
                                        const homeInjured = gameState.players.filter(p => p.teamId === selectedGame.homeTeam && p.injury.injured);
                                        const awayInjured = gameState.players.filter(p => p.teamId === selectedGame.awayTeam && p.injury.injured);
                                        
                                        if (homeInjured.length === 0 && awayInjured.length === 0) return null;
                                        
                                        return (
                                            <div style={{ 
                                                marginTop: '3rem',
                                                padding: '1.5rem',
                                                background: 'rgba(239, 68, 68, 0.1)',
                                                borderRadius: '0.5rem',
                                                border: '1px solid rgba(239, 68, 68, 0.3)'
                                            }}>
                                                <h3 style={{ color: '#ef4444', marginBottom: '1.5rem', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
                                                    ðŸ¥ Injury Report
                                                </h3>
                                                
                                                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1.5rem' }}>
                                                    {/* Away Team Injuries */}
                                                    <div>
                                                        <h4 style={{ color: '#93c5fd', marginBottom: '1rem', fontSize: '1rem' }}>
                                                            {awayTeam.city} {awayTeam.name}
                                                        </h4>
                                                        {awayInjured.length > 0 ? (
                                                            <div style={{ display: 'flex', flexDirection: 'column', gap: '0.5rem' }}>
                                                                {awayInjured.map(player => (
                                                                    <div key={player.id} style={{
                                                                        padding: '0.75rem',
                                                                        background: 'rgba(239, 68, 68, 0.15)',
                                                                        borderRadius: '0.375rem',
                                                                        border: '1px solid rgba(239, 68, 68, 0.3)'
                                                                    }}>
                                                                        <div style={{ fontWeight: 'bold', color: '#fff', marginBottom: '0.25rem' }}>
                                                                            {player.firstName} {player.lastName}
                                                                            <span style={{ marginLeft: '0.5rem', fontSize: '0.85em', color: '#94a3b8' }}>
                                                                                {player.position}
                                                                            </span>
                                                                        </div>
                                                                        <div style={{ fontSize: '0.875rem', color: '#fca5a5' }}>
                                                                            {player.injury.type} - {player.injury.severity}
                                                                        </div>
                                                                        {player.injury.daysUntilReturn < 999 && (
                                                                            <div style={{ fontSize: '0.75rem', color: '#94a3b8', marginTop: '0.25rem' }}>
                                                                                ~{player.injury.daysUntilReturn} days until return
                                                                            </div>
                                                                        )}
                                                                    </div>
                                                                ))}
                                                            </div>
                                                        ) : (
                                                            <p style={{ color: '#64748b', fontSize: '0.875rem', fontStyle: 'italic' }}>
                                                                No injuries
                                                            </p>
                                                        )}
                                                    </div>
                                                    
                                                    {/* Home Team Injuries */}
                                                    <div>
                                                        <h4 style={{ color: '#93c5fd', marginBottom: '1rem', fontSize: '1rem' }}>
                                                            {homeTeam.city} {homeTeam.name}
                                                        </h4>
                                                        {homeInjured.length > 0 ? (
                                                            <div style={{ display: 'flex', flexDirection: 'column', gap: '0.5rem' }}>
                                                                {homeInjured.map(player => (
                                                                    <div key={player.id} style={{
                                                                        padding: '0.75rem',
                                                                        background: 'rgba(239, 68, 68, 0.15)',
                                                                        borderRadius: '0.375rem',
                                                                        border: '1px solid rgba(239, 68, 68, 0.3)'
                                                                    }}>
                                                                        <div style={{ fontWeight: 'bold', color: '#fff', marginBottom: '0.25rem' }}>
                                                                            {player.firstName} {player.lastName}
                                                                            <span style={{ marginLeft: '0.5rem', fontSize: '0.85em', color: '#94a3b8' }}>
                                                                                {player.position}
                                                                            </span>
                                                                        </div>
                                                                        <div style={{ fontSize: '0.875rem', color: '#fca5a5' }}>
                                                                            {player.injury.type} - {player.injury.severity}
                                                                        </div>
                                                                        {player.injury.daysUntilReturn < 999 && (
                                                                            <div style={{ fontSize: '0.75rem', color: '#94a3b8', marginTop: '0.25rem' }}>
                                                                                ~{player.injury.daysUntilReturn} days until return
                                                                            </div>
                                                                        )}
                                                                    </div>
                                                                ))}
                                                            </div>
                                                        ) : (
                                                            <p style={{ color: '#64748b', fontSize: '0.875rem', fontStyle: 'italic' }}>
                                                                No injuries
                                                            </p>
                                                        )}
                                                    </div>
                                                </div>
                                            </div>
                                        );
                                    })()}
                                </div>
                            </div>
                        )}

                        {currentView === 'bracket' && (
                            <div className="card">
                                <h2>ðŸ† Stanley Cup Playoffs Bracket</h2>
                                
                                {!playoffState && (
                                    <div style={{ padding: '2rem', textAlign: 'center' }}>
                                        <p style={{ fontSize: '1.2rem', color: '#93c5fd', marginBottom: '1rem' }}>
                                            Complete the regular season to start the playoffs!
                                        </p>
                                        <p style={{ color: '#64748b' }}>
                                            Top 8 teams from each conference will compete in best-of-7 series
                                        </p>
                                    </div>
                                )}
                                
                                {playoffState && (
                                    <>
                                        <BracketView playoffState={playoffState} TEAMS={TEAMS} />
                                        
                                        {playoffState.lastDaySummary && (
                                            <div style={{ marginTop: '2rem', padding: '1.5rem', background: 'rgba(34, 211, 238, 0.1)', borderRadius: '0.5rem', border: '2px solid rgba(34, 211, 238, 0.3)' }}>
                                                <h3 style={{ color: '#22d3ee', marginBottom: '1rem', textAlign: 'center' }}>
                                                    {playoffState.lastDaySummary.title}
                                                </h3>
                                                
                                                {playoffState.lastDaySummary.subtitle && (
                                                    <p style={{ textAlign: 'center', color: '#93c5fd', marginBottom: '1rem', fontSize: '0.9rem' }}>
                                                        {playoffState.lastDaySummary.subtitle}
                                                    </p>
                                                )}
                                                
                                                {playoffState.lastDaySummary.message && (
                                                    <p style={{ textAlign: 'center', color: '#fff', fontSize: '1.1rem', padding: '1rem' }}>
                                                        {playoffState.lastDaySummary.message}
                                                    </p>
                                                )}
                                                
                                                {playoffState.lastDaySummary.restDays && (
                                                    <p style={{ textAlign: 'center', color: '#fbbf24', fontWeight: 'bold', marginTop: '0.5rem' }}>
                                                        â¸ï¸ {playoffState.lastDaySummary.restDays} days rest before next games
                                                    </p>
                                                )}
                                                
                                                {playoffState.lastDaySummary.results && playoffState.lastDaySummary.results.length > 0 && (
                                                    <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))', gap: '0.75rem', marginTop: '1rem' }}>
                                                        {playoffState.lastDaySummary.results.map((result, idx) => (
                                                            <div key={idx} style={{ 
                                                                padding: '0.75rem', 
                                                                background: result.seriesComplete ? 'rgba(34, 197, 94, 0.15)' : 'rgba(30, 58, 138, 0.3)',
                                                                borderRadius: '0.375rem',
                                                                border: result.seriesComplete ? '2px solid #22c55e' : '1px solid rgba(59, 130, 246, 0.3)',
                                                                cursor: 'pointer',
                                                                transition: 'all 0.2s'
                                                            }}
                                                            onMouseOver={(e) => e.currentTarget.style.transform = 'scale(1.02)'}
                                                            onMouseOut={(e) => e.currentTarget.style.transform = 'scale(1)'}
                                                            onClick={() => {
                                                                setSelectedPlayoffGame(result);
                                                                setCurrentView('playoffGameStats');
                                                            }}
                                                            >
                                                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '0.5rem' }}>
                                                                    <div style={{ flex: 1 }}>
                                                                        <div style={{ 
                                                                            fontWeight: result.winner.id === result.homeTeam.id ? 'bold' : 'normal',
                                                                            color: result.winner.id === result.homeTeam.id ? '#22c55e' : '#fff',
                                                                            fontSize: '0.95rem'
                                                                        }}>
                                                                            {result.homeTeam.city}
                                                                        </div>
                                                                        <div style={{ 
                                                                            fontWeight: result.winner.id === result.awayTeam.id ? 'bold' : 'normal',
                                                                            color: result.winner.id === result.awayTeam.id ? '#22c55e' : '#fff',
                                                                            fontSize: '0.95rem',
                                                                            marginTop: '0.25rem'
                                                                        }}>
                                                                            {result.awayTeam.city}
                                                                        </div>
                                                                    </div>
                                                                    
                                                                    <div style={{ textAlign: 'center', padding: '0 0.75rem' }}>
                                                                        <div style={{ fontSize: '1.25rem', fontWeight: 'bold', color: result.winner.id === result.homeTeam.id ? '#22c55e' : '#fff' }}>
                                                                            {result.homeScore}
                                                                        </div>
                                                                        <div style={{ fontSize: '1.25rem', fontWeight: 'bold', color: result.winner.id === result.awayTeam.id ? '#22c55e' : '#fff', marginTop: '0.25rem' }}>
                                                                            {result.awayScore}
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div style={{ color: '#93c5fd', fontSize: '0.75rem', textAlign: 'center' }}>
                                                                    Series: {result.homeWins}-{result.awayWins}
                                                                </div>
                                                                {result.seriesComplete && !result.champion && (
                                                                    <div style={{ color: '#22c55e', fontWeight: 'bold', marginTop: '0.5rem', fontSize: '0.8rem', textAlign: 'center' }}>
                                                                        ðŸ† {result.winner.city} wins!
                                                                    </div>
                                                                )}
                                                                {result.champion && (
                                                                    <div style={{ color: '#fbbf24', fontWeight: 'bold', fontSize: '0.85rem', marginTop: '0.5rem', textAlign: 'center' }}>
                                                                        ðŸ† CHAMPIONS! ðŸ†
                                                                    </div>
                                                                )}
                                                            </div>
                                                        ))}
                                                    </div>
                                                )}
                                            </div>
                                        )}
                                    </>
                                )}
                            </div>
                        )}

                        {currentView === 'playoffGames' && playoffState && (
                            <div className="card">
                                <h2>Playoff Games</h2>
                                <p style={{ color: '#93c5fd', marginBottom: '1.5rem' }}>
                                    Click on any game to view detailed stats
                                </p>
                                
                                {(() => {
                                    const allGames = [];
                                    
                                    // Collect all games from history
                                    if (playoffState.history) {
                                        const rounds = [
                                            { key: 'eastRound1', name: 'Eastern Conference - Round 1', matchups: playoffState.history.eastRound1 },
                                            { key: 'westRound1', name: 'Western Conference - Round 1', matchups: playoffState.history.westRound1 },
                                            { key: 'eastRound2', name: 'Eastern Conference - Round 2', matchups: playoffState.history.eastRound2 },
                                            { key: 'westRound2', name: 'Western Conference - Round 2', matchups: playoffState.history.westRound2 },
                                            { key: 'eastRound3', name: 'Eastern Conference Finals', matchups: playoffState.history.eastRound3 },
                                            { key: 'westRound3', name: 'Western Conference Finals', matchups: playoffState.history.westRound3 },
                                            { key: 'final', name: 'Stanley Cup Finals', matchups: playoffState.history.final ? [playoffState.history.final] : [] }
                                        ];
                                        
                                        rounds.forEach(round => {
                                            if (round.matchups && round.matchups.length > 0) {
                                                round.matchups.forEach((matchup, matchupIdx) => {
                                                    if (matchup.games && matchup.games.length > 0) {
                                                        matchup.games.forEach((game, gameIdx) => {
                                                            const homeTeam = TEAMS.find(t => t.id === game.homeTeam);
                                                            const awayTeam = TEAMS.find(t => t.id === game.awayTeam);
                                                            allGames.push({
                                                                ...game,
                                                                round: round.name,
                                                                gameNumber: gameIdx + 1,
                                                                homeTeam,
                                                                awayTeam,
                                                                matchup
                                                            });
                                                        });
                                                    }
                                                });
                                            }
                                        });
                                    }
                                    
                                    if (allGames.length === 0) {
                                        return <p style={{ color: '#93c5fd' }}>No playoff games have been played yet.</p>;
                                    }
                                    
                                    // Group games by round
                                    const gamesByRound = {};
                                    allGames.forEach(game => {
                                        if (!gamesByRound[game.round]) gamesByRound[game.round] = [];
                                        gamesByRound[game.round].push(game);
                                    });
                                    
                                    return Object.keys(gamesByRound).map(roundName => (
                                        <div key={roundName} style={{ marginBottom: '2rem' }}>
                                            <h3 style={{ color: '#22d3ee', marginBottom: '1rem' }}>{roundName}</h3>
                                            <div style={{ display: 'grid', gap: '0.75rem' }}>
                                                {gamesByRound[roundName].map((game, idx) => (
                                                    <div 
                                                        key={idx}
                                                        onClick={() => {
                                                            setSelectedPlayoffGame(game);
                                                            setCurrentView('playoffGameStats');
                                                        }}
                                                        style={{
                                                            padding: '1rem',
                                                            background: 'rgba(30, 58, 138, 0.3)',
                                                            borderRadius: '0.5rem',
                                                            border: '1px solid rgba(59, 130, 246, 0.3)',
                                                            cursor: 'pointer',
                                                            transition: 'all 0.2s',
                                                            display: 'flex',
                                                            justifyContent: 'space-between',
                                                            alignItems: 'center'
                                                        }}
                                                        onMouseOver={(e) => e.currentTarget.style.background = 'rgba(30, 64, 175, 0.4)'}
                                                        onMouseOut={(e) => e.currentTarget.style.background = 'rgba(30, 58, 138, 0.3)'}
                                                    >
                                                        <div style={{ flex: 1 }}>
                                                            <div style={{ color: '#93c5fd', fontSize: '0.875rem', marginBottom: '0.5rem' }}>
                                                                Game {game.gameNumber}
                                                            </div>
                                                            <div style={{ fontSize: '1.1rem' }}>
                                                                <span style={{ 
                                                                    fontWeight: game.winner === game.homeTeam.id ? 'bold' : 'normal',
                                                                    color: game.winner === game.homeTeam.id ? '#22c55e' : '#fff'
                                                                }}>
                                                                    {game.homeTeam.city} {game.homeTeam.name}
                                                                </span>
                                                                <span style={{ margin: '0 0.5rem', color: '#93c5fd' }}>vs</span>
                                                                <span style={{ 
                                                                    fontWeight: game.winner === game.awayTeam.id ? 'bold' : 'normal',
                                                                    color: game.winner === game.awayTeam.id ? '#22c55e' : '#fff'
                                                                }}>
                                                                    {game.awayTeam.city} {game.awayTeam.name}
                                                                </span>
                                                            </div>
                                                        </div>
                                                        <div style={{ 
                                                            fontSize: '1.5rem', 
                                                            fontWeight: 'bold',
                                                            color: '#22d3ee',
                                                            minWidth: '80px',
                                                            textAlign: 'center'
                                                        }}>
                                                            {game.homeScore} - {game.awayScore}
                                                        </div>
                                                        <div style={{ color: '#93c5fd', fontSize: '0.875rem' }}>
                                                            View Stats â†’
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    ));
                                })()}
                            </div>
                        )}

                        {currentView === 'playoffGameStats' && selectedPlayoffGame && (
                            <div>
                                <button 
                                    onClick={() => setCurrentView('playoffGames')}
                                    style={{
                                        padding: '0.5rem 1rem',
                                        background: '#2563eb',
                                        color: '#fff',
                                        border: 'none',
                                        borderRadius: '0.375rem',
                                        cursor: 'pointer',
                                        marginBottom: '1rem',
                                        fontWeight: 'bold'
                                    }}
                                >
                                    â† Back to Games List
                                </button>
                                
                                <div className="card">
                                    <h2>{selectedPlayoffGame.round} - Game {selectedPlayoffGame.gameNumber}</h2>
                                    <p style={{ color: '#f59e0b', marginBottom: '1rem', fontSize: '1.1rem', fontWeight: 'bold' }}>
                                        ðŸ† Stanley Cup Playoffs
                                    </p>
                                    
                                    <div style={{ 
                                        display: 'flex', 
                                        justifyContent: 'space-between', 
                                        alignItems: 'center',
                                        padding: '2rem',
                                        background: 'rgba(30, 58, 138, 0.3)',
                                        borderRadius: '0.5rem',
                                        marginBottom: '2rem'
                                    }}>
                                        <div style={{ textAlign: 'center', flex: 1 }}>
                                            <div style={{ fontSize: '1.5rem', fontWeight: 'bold', marginBottom: '0.5rem' }}>
                                                {selectedPlayoffGame.awayTeam.city} {selectedPlayoffGame.awayTeam.name}
                                            </div>
                                            <div style={{ fontSize: '0.875rem', color: '#93c5fd', marginBottom: '0.5rem' }}>
                                                AWAY
                                            </div>
                                            <div style={{ 
                                                fontSize: '4rem', 
                                                fontWeight: 'bold',
                                                color: selectedPlayoffGame.winner === selectedPlayoffGame.awayTeam.id ? '#22c55e' : '#fff'
                                            }}>
                                                {selectedPlayoffGame.awayScore}
                                            </div>
                                        </div>
                                        <div style={{ fontSize: '3rem', color: '#93c5fd', padding: '0 2rem' }}>
                                            @
                                        </div>
                                        <div style={{ textAlign: 'center', flex: 1 }}>
                                            <div style={{ fontSize: '1.5rem', fontWeight: 'bold', marginBottom: '0.5rem' }}>
                                                {selectedPlayoffGame.homeTeam.city} {selectedPlayoffGame.homeTeam.name}
                                            </div>
                                            <div style={{ fontSize: '0.875rem', color: '#93c5fd', marginBottom: '0.5rem' }}>
                                                HOME
                                            </div>
                                            <div style={{ 
                                                fontSize: '4rem', 
                                                fontWeight: 'bold',
                                                color: selectedPlayoffGame.winner === selectedPlayoffGame.homeTeam.id ? '#22c55e' : '#fff'
                                            }}>
                                                {selectedPlayoffGame.homeScore}
                                            </div>
                                        </div>
                                    </div>
                                    
                                    {/* Winner Badge */}
                                    {(() => {
                                        const winner = selectedPlayoffGame.winner === selectedPlayoffGame.homeTeam.id ? 
                                            selectedPlayoffGame.homeTeam : selectedPlayoffGame.awayTeam;
                                        
                                        return (
                                            <div style={{ 
                                                padding: '1rem',
                                                background: 'rgba(34, 197, 94, 0.15)',
                                                borderRadius: '0.5rem',
                                                marginBottom: '2rem',
                                                textAlign: 'center',
                                                border: '2px solid #22c55e'
                                            }}>
                                                <div style={{ color: '#22c55e', fontSize: '1.2rem', fontWeight: 'bold' }}>
                                                    ðŸ† WINNER: {winner.city} {winner.name}
                                                </div>
                                            </div>
                                        );
                                    })()}
                                    
                                    {/* Series Status */}
                                    <div style={{ 
                                        padding: '1rem',
                                        background: 'rgba(245, 158, 11, 0.1)',
                                        borderRadius: '0.5rem',
                                        marginBottom: '2rem',
                                        textAlign: 'center',
                                        border: '1px solid rgba(245, 158, 11, 0.3)'
                                    }}>
                                        <div style={{ color: '#f59e0b', fontSize: '1.1rem', fontWeight: 'bold' }}>
                                            Series: {selectedPlayoffGame.homeTeam.city} leads {selectedPlayoffGame.matchup.homeWins}-{selectedPlayoffGame.matchup.awayWins}
                                        </div>
                                    </div>
                                    
                                    {/* Detailed Stats - Same as regular season */}
                                    {selectedPlayoffGame.details && selectedPlayoffGame.details.homePlayerStats ? (
                                        (() => {
                                            // Use same rendering as regular season games but with playoff stats
                                            return (
                                                <>
                                                    {/* Period-by-Period Scoring Summary */}
                                                    {selectedPlayoffGame.details.scoringSummary && selectedPlayoffGame.details.scoringSummary.some(p => p.goals.length > 0) && (
                                                        <div style={{ marginBottom: '2rem' }}>
                                                            <h3 style={{ color: '#f59e0b', marginBottom: '1.5rem' }}>âš¡ Scoring Summary</h3>
                                                            {selectedPlayoffGame.details.scoringSummary.map((period, idx) => {
                                                                if (period.goals.length === 0) return null;
                                                                
                                                                // Track running totals for THIS PLAYOFF RUN
                                                                const gameRunningTotals = {};
                                                                
                                                                // Get pre-game PLAYOFF stats (not regular season)
                                                                const getPreGamePlayoffStats = (playerId) => {
                                                                    // Find all playoff games before this one
                                                                    const allPlayoffGames = [];
                                                                    
                                                                    // Collect games from playoff state
                                                                    if (playoffState) {
                                                                        // Would need to iterate through all matchups/games before this one
                                                                        // For now, just use player's current playoff stats minus this game
                                                                        const player = gameState.players.find(p => p.id === playerId);
                                                                        if (player) {
                                                                            const thisGameStats = selectedPlayoffGame.details.homePlayerStats?.find(ps => ps.player.id === playerId) ||
                                                                                                selectedPlayoffGame.details.awayPlayerStats?.find(ps => ps.player.id === playerId);
                                                                            return {
                                                                                goals: (player.playoffStats.goals || 0) - (thisGameStats?.goals || 0),
                                                                                assists: (player.playoffStats.assists || 0) - (thisGameStats?.assists || 0)
                                                                            };
                                                                        }
                                                                    }
                                                                    return { goals: 0, assists: 0 };
                                                                };
                                                                
                                                                return (
                                                                    <div key={period.period} style={{ 
                                                                        marginBottom: '1.5rem',
                                                                        padding: '1rem',
                                                                        background: 'rgba(245, 158, 11, 0.1)',
                                                                        borderRadius: '0.5rem',
                                                                        border: '1px solid rgba(245, 158, 11, 0.3)'
                                                                    }}>
                                                                        <h4 style={{ color: '#fbbf24', marginBottom: '1rem', fontSize: '1rem' }}>
                                                                            {period.period === 1 ? '1st' : period.period === 2 ? '2nd' : '3rd'} Period
                                                                        </h4>
                                                                        {period.goals.map((goal, goalIdx) => {
                                                                            const team = goal.team === 'home' ? selectedPlayoffGame.homeTeam : selectedPlayoffGame.awayTeam;
                                                                            const preGameStats = getPreGamePlayoffStats(goal.scorer.id);
                                                                            
                                                                            if (!gameRunningTotals[goal.scorer.id]) {
                                                                                gameRunningTotals[goal.scorer.id] = { goals: 0, assists: 0 };
                                                                            }
                                                                            gameRunningTotals[goal.scorer.id].goals++;
                                                                            
                                                                            const playoffGoalTotal = preGameStats.goals + gameRunningTotals[goal.scorer.id].goals;
                                                                            
                                                                            return (
                                                                                <div key={goalIdx} style={{ 
                                                                                    marginBottom: goalIdx < period.goals.length - 1 ? '0.75rem' : '0',
                                                                                    paddingBottom: goalIdx < period.goals.length - 1 ? '0.75rem' : '0',
                                                                                    borderBottom: goalIdx < period.goals.length - 1 ? '1px solid rgba(100, 116, 139, 0.3)' : 'none'
                                                                                }}>
                                                                                    <div style={{ display: 'flex', alignItems: 'center', gap: '0.75rem', marginBottom: '0.25rem' }}>
                                                                                        <span style={{ 
                                                                                            padding: '0.25rem 0.5rem',
                                                                                            background: goal.team === 'home' ? 'rgba(34, 197, 94, 0.2)' : 'rgba(59, 130, 246, 0.2)',
                                                                                            borderRadius: '0.25rem',
                                                                                            fontSize: '0.75rem',
                                                                                            fontWeight: 'bold',
                                                                                            color: goal.team === 'home' ? '#22c55e' : '#3b82f6'
                                                                                        }}>
                                                                                            {team.abbreviation}
                                                                                        </span>
                                                                                        <span style={{ fontWeight: 'bold', color: '#fff' }}>
                                                                                            {goal.scorer.name}
                                                                                        </span>
                                                                                        <span style={{ 
                                                                                            fontSize: '0.85rem',
                                                                                            color: '#f59e0b',
                                                                                            fontWeight: 'bold'
                                                                                        }}>
                                                                                            ({playoffGoalTotal})
                                                                                        </span>
                                                                                    </div>
                                                                                    {goal.assists.length > 0 && (
                                                                                        <div style={{ 
                                                                                            fontSize: '0.875rem', 
                                                                                            color: '#94a3b8',
                                                                                            marginLeft: '2.5rem'
                                                                                        }}>
                                                                                            Assists: {goal.assists.map((assist, aIdx) => {
                                                                                                const assistPreGameStats = getPreGamePlayoffStats(assist.id);
                                                                                                
                                                                                                if (!gameRunningTotals[assist.id]) {
                                                                                                    gameRunningTotals[assist.id] = { goals: 0, assists: 0 };
                                                                                                }
                                                                                                gameRunningTotals[assist.id].assists++;
                                                                                                
                                                                                                const playoffAssistTotal = assistPreGameStats.assists + gameRunningTotals[assist.id].assists;
                                                                                                
                                                                                                return (
                                                                                                    <span key={assist.id}>
                                                                                                        {assist.name} <span style={{ color: '#f59e0b', fontWeight: 'bold' }}>({playoffAssistTotal})</span>
                                                                                                        {aIdx < goal.assists.length - 1 ? ', ' : ''}
                                                                                                    </span>
                                                                                                );
                                                                                            })}
                                                                                        </div>
                                                                                    )}
                                                                                </div>
                                                                            );
                                                                        })}
                                                                    </div>
                                                                );
                                                            })}
                                                        </div>
                                                    )}
                                                    
                                                    {/* Team Tabs */}
                                                    <div style={{ 
                                                        display: 'flex', 
                                                        gap: '0.5rem',
                                                        marginBottom: '1.5rem',
                                                        borderBottom: '2px solid rgba(245, 158, 11, 0.3)'
                                                    }}>
                                                        <button
                                                            onClick={() => setGameDetailTeamTab('away')}
                                                            style={{
                                                                padding: '0.75rem 1.5rem',
                                                                background: gameDetailTeamTab === 'away' ? 'rgba(245, 158, 11, 0.2)' : 'transparent',
                                                                border: 'none',
                                                                borderBottom: gameDetailTeamTab === 'away' ? '3px solid #f59e0b' : '3px solid transparent',
                                                                color: gameDetailTeamTab === 'away' ? '#f59e0b' : '#94a3b8',
                                                                cursor: 'pointer',
                                                                fontWeight: gameDetailTeamTab === 'away' ? 'bold' : 'normal',
                                                                fontSize: '1rem',
                                                                transition: 'all 0.2s'
                                                            }}
                                                        >
                                                            {selectedPlayoffGame.awayTeam.city} {selectedPlayoffGame.awayTeam.name} (Away)
                                                        </button>
                                                        <button
                                                            onClick={() => setGameDetailTeamTab('home')}
                                                            style={{
                                                                padding: '0.75rem 1.5rem',
                                                                background: gameDetailTeamTab === 'home' ? 'rgba(245, 158, 11, 0.2)' : 'transparent',
                                                                border: 'none',
                                                                borderBottom: gameDetailTeamTab === 'home' ? '3px solid #f59e0b' : '3px solid transparent',
                                                                color: gameDetailTeamTab === 'home' ? '#f59e0b' : '#94a3b8',
                                                                cursor: 'pointer',
                                                                fontWeight: gameDetailTeamTab === 'home' ? 'bold' : 'normal',
                                                                fontSize: '1rem',
                                                                transition: 'all 0.2s'
                                                            }}
                                                        >
                                                            {selectedPlayoffGame.homeTeam.city} {selectedPlayoffGame.homeTeam.name} (Home)
                                                        </button>
                                                    </div>
                                                    
                                                    {/* Show stats for selected team */}
                                                    {gameDetailTeamTab === 'away' && (
                                                        <div>
                                                            <h4 style={{ color: '#fbbf24', marginTop: '1rem', marginBottom: '0.75rem' }}>Skaters</h4>
                                                            <table className="stats-table">
                                                                <thead>
                                                                    <tr>
                                                                        <th>Player</th>
                                                                        <th className="text-center">G</th>
                                                                        <th className="text-center">A</th>
                                                                        <th className="text-center">PTS</th>
                                                                        <th className="text-center">+/-</th>
                                                                        <th className="text-center">SOG</th>
                                                                        <th className="text-center">TOI</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    {selectedPlayoffGame.details.awayPlayerStats.filter(ps => ps.player.position !== 'G').sort((a, b) => b.points - a.points).map(ps => (
                                                                        <tr key={ps.player.id} style={{ background: ps.points > 0 ? 'rgba(245, 158, 11, 0.1)' : 'transparent' }}>
                                                                            <td>
                                                                                <span style={{ cursor: 'pointer', color: '#f59e0b' }} onClick={() => navigateTo('playerProfile', ps.player)}>
                                                                                    {ps.player.firstName} {ps.player.lastName}
                                                                                </span>
                                                                                <span style={{ color: '#64748b', marginLeft: '0.5rem', fontSize: '0.85em' }}>
                                                                                    {ps.player.position}
                                                                                </span>
                                                                            </td>
                                                                            <td className="text-center" style={{ fontWeight: ps.goals > 0 ? 'bold' : 'normal', color: ps.goals > 0 ? '#f59e0b' : 'inherit' }}>{ps.goals}</td>
                                                                            <td className="text-center" style={{ fontWeight: ps.assists > 0 ? 'bold' : 'normal', color: ps.assists > 0 ? '#f59e0b' : 'inherit' }}>{ps.assists}</td>
                                                                            <td className="text-center" style={{ fontWeight: ps.points > 0 ? 'bold' : 'normal', color: ps.points > 0 ? '#f59e0b' : 'inherit' }}>{ps.points}</td>
                                                                            <td className="text-center">{ps.plusMinus > 0 ? '+' : ''}{ps.plusMinus}</td>
                                                                            <td className="text-center">{ps.shots}</td>
                                                                            <td className="text-center">{formatTOI(ps.toi)}</td>
                                                                        </tr>
                                                                    ))}
                                                                </tbody>
                                                            </table>
                                                            
                                                            <h4 style={{ color: '#fbbf24', marginTop: '1.5rem', marginBottom: '0.75rem' }}>Goalies</h4>
                                                            <table className="stats-table">
                                                                <thead>
                                                                    <tr>
                                                                        <th>Player</th>
                                                                        <th className="text-center">SA</th>
                                                                        <th className="text-center">SV</th>
                                                                        <th className="text-center">GA</th>
                                                                        <th className="text-center">SV%</th>
                                                                        <th className="text-center">Result</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    {selectedPlayoffGame.details.awayPlayerStats.filter(ps => ps.player.position === 'G' && ps.shotsAgainst > 0).map(ps => {
                                                                        const svPct = ps.shotsAgainst > 0 ? (ps.saves / ps.shotsAgainst).toFixed(3) : '.000';
                                                                        const isWinner = selectedPlayoffGame.winner === selectedPlayoffGame.awayTeam.id;
                                                                        return (
                                                                            <tr key={ps.player.id}>
                                                                                <td>
                                                                                    <span style={{ cursor: 'pointer', color: '#f59e0b' }} onClick={() => navigateTo('playerProfile', ps.player)}>
                                                                                        {ps.player.firstName} {ps.player.lastName}
                                                                                    </span>
                                                                                </td>
                                                                                <td className="text-center">{ps.shotsAgainst}</td>
                                                                                <td className="text-center">{ps.saves}</td>
                                                                                <td className="text-center">{ps.goalsAgainst}</td>
                                                                                <td className="text-center">{svPct}</td>
                                                                                <td className="text-center">
                                                                                    <span style={{ 
                                                                                        padding: '0.25rem 0.5rem',
                                                                                        borderRadius: '0.25rem',
                                                                                        fontSize: '0.75rem',
                                                                                        fontWeight: 'bold',
                                                                                        background: isWinner ? '#22c55e' : '#ef4444'
                                                                                    }}>
                                                                                        {isWinner ? 'W' : 'L'}
                                                                                    </span>
                                                                                </td>
                                                                            </tr>
                                                                        );
                                                                    })}
                                                                </tbody>
                                                            </table>
                                                            
                                                            {selectedPlayoffGame.details.awayScratched?.length > 0 && (
                                                                <div style={{ marginTop: '1.5rem', padding: '0.75rem', background: 'rgba(100, 116, 139, 0.1)', borderRadius: '0.375rem' }}>
                                                                    <h5 style={{ color: '#64748b', fontSize: '0.875rem', marginBottom: '0.5rem' }}>Healthy Scratches:</h5>
                                                                    <div style={{ display: 'flex', flexWrap: 'wrap', gap: '0.5rem' }}>
                                                                        {selectedPlayoffGame.details.awayScratched.map(p => (
                                                                            <span key={p.id} style={{ 
                                                                                padding: '0.25rem 0.5rem',
                                                                                background: 'rgba(100, 116, 139, 0.2)',
                                                                                borderRadius: '0.25rem',
                                                                                fontSize: '0.75rem',
                                                                                color: '#94a3b8'
                                                                            }}>
                                                                                {p.name}
                                                                            </span>
                                                                        ))}
                                                                    </div>
                                                                </div>
                                                            )}
                                                        </div>
                                                    )}
                                                    
                                                    {gameDetailTeamTab === 'home' && (
                                                        <div>
                                                            <h4 style={{ color: '#fbbf24', marginTop: '1rem', marginBottom: '0.75rem' }}>Skaters</h4>
                                                            <table className="stats-table">
                                                                <thead>
                                                                    <tr>
                                                                        <th>Player</th>
                                                                        <th className="text-center">G</th>
                                                                        <th className="text-center">A</th>
                                                                        <th className="text-center">PTS</th>
                                                                        <th className="text-center">+/-</th>
                                                                        <th className="text-center">SOG</th>
                                                                        <th className="text-center">TOI</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    {selectedPlayoffGame.details.homePlayerStats.filter(ps => ps.player.position !== 'G').sort((a, b) => b.points - a.points).map(ps => (
                                                                        <tr key={ps.player.id} style={{ background: ps.points > 0 ? 'rgba(245, 158, 11, 0.1)' : 'transparent' }}>
                                                                            <td>
                                                                                <span style={{ cursor: 'pointer', color: '#f59e0b' }} onClick={() => navigateTo('playerProfile', ps.player)}>
                                                                                    {ps.player.firstName} {ps.player.lastName}
                                                                                </span>
                                                                                <span style={{ color: '#64748b', marginLeft: '0.5rem', fontSize: '0.85em' }}>
                                                                                    {ps.player.position}
                                                                                </span>
                                                                            </td>
                                                                            <td className="text-center" style={{ fontWeight: ps.goals > 0 ? 'bold' : 'normal', color: ps.goals > 0 ? '#f59e0b' : 'inherit' }}>{ps.goals}</td>
                                                                            <td className="text-center" style={{ fontWeight: ps.assists > 0 ? 'bold' : 'normal', color: ps.assists > 0 ? '#f59e0b' : 'inherit' }}>{ps.assists}</td>
                                                                            <td className="text-center" style={{ fontWeight: ps.points > 0 ? 'bold' : 'normal', color: ps.points > 0 ? '#f59e0b' : 'inherit' }}>{ps.points}</td>
                                                                            <td className="text-center">{ps.plusMinus > 0 ? '+' : ''}{ps.plusMinus}</td>
                                                                            <td className="text-center">{ps.shots}</td>
                                                                            <td className="text-center">{formatTOI(ps.toi)}</td>
                                                                        </tr>
                                                                    ))}
                                                                </tbody>
                                                            </table>
                                                            
                                                            <h4 style={{ color: '#fbbf24', marginTop: '1.5rem', marginBottom: '0.75rem' }}>Goalies</h4>
                                                            <table className="stats-table">
                                                                <thead>
                                                                    <tr>
                                                                        <th>Player</th>
                                                                        <th className="text-center">SA</th>
                                                                        <th className="text-center">SV</th>
                                                                        <th className="text-center">GA</th>
                                                                        <th className="text-center">SV%</th>
                                                                        <th className="text-center">Result</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    {selectedPlayoffGame.details.homePlayerStats.filter(ps => ps.player.position === 'G' && ps.shotsAgainst > 0).map(ps => {
                                                                        const svPct = ps.shotsAgainst > 0 ? (ps.saves / ps.shotsAgainst).toFixed(3) : '.000';
                                                                        const isWinner = selectedPlayoffGame.winner === selectedPlayoffGame.homeTeam.id;
                                                                        return (
                                                                            <tr key={ps.player.id}>
                                                                                <td>
                                                                                    <span style={{ cursor: 'pointer', color: '#f59e0b' }} onClick={() => navigateTo('playerProfile', ps.player)}>
                                                                                        {ps.player.firstName} {ps.player.lastName}
                                                                                    </span>
                                                                                </td>
                                                                                <td className="text-center">{ps.shotsAgainst}</td>
                                                                                <td className="text-center">{ps.saves}</td>
                                                                                <td className="text-center">{ps.goalsAgainst}</td>
                                                                                <td className="text-center">{svPct}</td>
                                                                                <td className="text-center">
                                                                                    <span style={{ 
                                                                                        padding: '0.25rem 0.5rem',
                                                                                        borderRadius: '0.25rem',
                                                                                        fontSize: '0.75rem',
                                                                                        fontWeight: 'bold',
                                                                                        background: isWinner ? '#22c55e' : '#ef4444'
                                                                                    }}>
                                                                                        {isWinner ? 'W' : 'L'}
                                                                                    </span>
                                                                                </td>
                                                                            </tr>
                                                                        );
                                                                    })}
                                                                </tbody>
                                                            </table>
                                                            
                                                            {selectedPlayoffGame.details.homeScratched?.length > 0 && (
                                                                <div style={{ marginTop: '1.5rem', padding: '0.75rem', background: 'rgba(100, 116, 139, 0.1)', borderRadius: '0.375rem' }}>
                                                                    <h5 style={{ color: '#64748b', fontSize: '0.875rem', marginBottom: '0.5rem' }}>Healthy Scratches:</h5>
                                                                    <div style={{ display: 'flex', flexWrap: 'wrap', gap: '0.5rem' }}>
                                                                        {selectedPlayoffGame.details.homeScratched.map(p => (
                                                                            <span key={p.id} style={{ 
                                                                                padding: '0.25rem 0.5rem',
                                                                                background: 'rgba(100, 116, 139, 0.2)',
                                                                                borderRadius: '0.25rem',
                                                                                fontSize: '0.75rem',
                                                                                color: '#94a3b8'
                                                                            }}>
                                                                                {p.name}
                                                                            </span>
                                                                        ))}
                                                                    </div>
                                                                </div>
                                                            )}
                                                        </div>
                                                    )}
                                                </>
                                            );
                                        })()
                                    ) : (
                                        <div style={{ 
                                            padding: '2rem',
                                            background: 'rgba(251, 191, 36, 0.1)',
                                            borderRadius: '0.5rem',
                                            border: '1px solid rgba(251, 191, 36, 0.3)',
                                            textAlign: 'center'
                                        }}>
                                            <p style={{ color: '#fbbf24', fontSize: '1.1rem' }}>
                                                Per-game stats not available for this playoff game.
                                            </p>
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}

                        {currentView === 'trade' && gameState && (() => {

                            const handleTradeSort = (key) => {
                                const direction = tradeSortConfig.key === key && tradeSortConfig.direction === 'desc' ? 'asc' : 'desc';
                                setTradeSortConfig({ key, direction });
                            };

                            const sortPlayers = (players, config) => {
                                return [...players].sort((a, b) => {
                                    let aVal, bVal;
                                    
                                    if (config.key.includes('.')) {
                                        const keys = config.key.split('.');
                                        aVal = keys.reduce((obj, k) => obj?.[k], a);
                                        bVal = keys.reduce((obj, k) => obj?.[k], b);
                                    } else {
                                        aVal = a[config.key];
                                        bVal = b[config.key];
                                    }
                                    
                                    if (aVal < bVal) return config.direction === 'asc' ? -1 : 1;
                                    if (aVal > bVal) return config.direction === 'asc' ? 1 : -1;
                                    return 0;
                                });
                            };

                            const togglePlayerSelection = (playerId, isMyTeam) => {
                                if (isMyTeam) {
                                    setMySelectedPlayers(prev => 
                                        prev.includes(playerId) 
                                            ? prev.filter(id => id !== playerId)
                                            : [...prev, playerId]
                                    );
                                } else {
                                    setTheirSelectedPlayers(prev => 
                                        prev.includes(playerId) 
                                            ? prev.filter(id => id !== playerId)
                                            : [...prev, playerId]
                                    );
                                }
                            };

                            const myTeamPlayers = sortPlayers(
                                gameState.players.filter(p => p.teamId === userTeamId && p.roster === 'nhl'),
                                tradeSortConfig
                            );

                            const theirTeamPlayers = tradePartnerTeamId ? sortPlayers(
                                gameState.players.filter(p => p.teamId === tradePartnerTeamId && p.roster === 'nhl'),
                                tradeSortConfig
                            ) : [];

                            const canProposeTrade = mySelectedPlayers.length > 0 && theirSelectedPlayers.length > 0;

                            const calculateTradeValue = (playerIds) => {
                                const players = playerIds.map(id => gameState.players.find(p => p.id === id));
                                const starCount = players.filter(p => p.ratings.overall >= 90).length;
                                const eliteCount = players.filter(p => p.ratings.overall >= 85).length;
                                
                                return {
                                    players: players,
                                    totalOVR: players.reduce((sum, p) => sum + p.ratings.overall, 0),
                                    avgOVR: players.reduce((sum, p) => sum + p.ratings.overall, 0) / players.length,
                                    totalPOT: players.reduce((sum, p) => sum + p.ratings.potential, 0),
                                    avgAge: players.reduce((sum, p) => sum + p.age, 0) / players.length,
                                    totalPts: players.reduce((sum, p) => sum + (p.stats?.points || 0), 0),
                                    starCount: starCount,
                                    eliteCount: eliteCount,
                                    hasGoalie: players.some(p => p.position === 'G'),
                                    positions: {
                                        F: players.filter(p => p.position === 'F').length,
                                        D: players.filter(p => p.position === 'D').length,
                                        G: players.filter(p => p.position === 'G').length
                                    }
                                };
                            };

                            const evaluateTrade = () => {
                                const myValue = calculateTradeValue(mySelectedPlayers);
                                const theirValue = calculateTradeValue(theirSelectedPlayers);
                                
                                const ovrDiff = Math.abs(myValue.totalOVR - theirValue.totalOVR);
                                const ovrDiffPercent = (ovrDiff / Math.max(myValue.totalOVR, theirValue.totalOVR)) * 100;
                                
                                return {
                                    myValue,
                                    theirValue,
                                    ovrDiff,
                                    ovrDiffPercent,
                                    isLopsided: ovrDiffPercent > 15
                                };
                            };

                            const proposeTrade = () => {
                                const evaluation = evaluateTrade();
                                const myPlayers = mySelectedPlayers.map(id => gameState.players.find(p => p.id === id));
                                const theirPlayers = theirSelectedPlayers.map(id => gameState.players.find(p => p.id === id));
                                
                                // Check for injured players
                                const myInjured = myPlayers.filter(p => p.injury.injured);
                                const theirInjured = theirPlayers.filter(p => p.injury.injured);
                                
                                if (myInjured.length > 0 || theirInjured.length > 0) {
                                    setTradeMessage({
                                        type: 'error',
                                        text: 'âŒ Cannot trade injured players!'
                                    });
                                    return;
                                }
                                
                                // AI Trade Logic (Enhanced)
                                const theirTeam = getTeam(tradePartnerTeamId);
                                const theirStanding = gameState.standings.find(s => s.teamId === tradePartnerTeamId);
                                
                                // Determine if they're rebuilding or competing
                                const gamesPlayed = theirStanding.wins + theirStanding.losses + theirStanding.otLosses;
                                const winPct = gamesPlayed > 0 ? theirStanding.wins / gamesPlayed : 0;
                                const isCompeting = winPct > 0.55; // Over .550 = playoff team
                                const isRebuilding = winPct < 0.40; // Under .400 = rebuild
                                
                                // Check roster needs for AI team
                                const theirRoster = gameState.players.filter(p => p.teamId === tradePartnerTeamId && p.roster === 'nhl');
                                const theirGoalies = theirRoster.filter(p => p.position === 'G');
                                const theirForwards = theirRoster.filter(p => p.position === 'F');
                                const theirDefense = theirRoster.filter(p => p.position === 'D');
                                
                                // Check if they're trading away critical positions
                                const tradingAwayGoalie = myPlayers.some(p => p.position === 'G' && p.teamId === tradePartnerTeamId);
                                const wouldHaveNoGoalies = tradingAwayGoalie && (theirGoalies.length - myPlayers.filter(p => p.position === 'G').length) < 1;
                                
                                // Critical: Can't trade away your only/last goalie
                                if (wouldHaveNoGoalies && !evaluation.theirValue.hasGoalie) {
                                    setTradeMessage({
                                        type: 'error',
                                        text: `âŒ ${theirTeam.city} rejects - they cannot trade away their last goalie!`
                                    });
                                    return;
                                }
                                
                                let acceptanceScore = 0;
                                let debugLog = []; // For showing user why trade was accepted/rejected
                                
                                // ========== 1. BASE OVR COMPARISON (STRICTER) ==========
                                if (evaluation.ovrDiffPercent > 25) {
                                    acceptanceScore -= 100; // Instant rejection for extreme imbalance
                                    debugLog.push(`OVR Difference ${evaluation.ovrDiffPercent.toFixed(1)}% - Extremely Lopsided: -100`);
                                } else if (evaluation.ovrDiffPercent > 20) {
                                    acceptanceScore -= 60; // Very unfair
                                    debugLog.push(`OVR Difference ${evaluation.ovrDiffPercent.toFixed(1)}% - Very Lopsided: -60`);
                                } else if (evaluation.ovrDiffPercent > 15) {
                                    acceptanceScore -= 40; // Heavily lopsided
                                    debugLog.push(`OVR Difference ${evaluation.ovrDiffPercent.toFixed(1)}% - Lopsided: -40`);
                                } else if (evaluation.ovrDiffPercent <= 5) {
                                    acceptanceScore += 50; // Fair
                                    debugLog.push(`OVR Difference ${evaluation.ovrDiffPercent.toFixed(1)}% - Fair Trade: +50`);
                                } else if (evaluation.ovrDiffPercent <= 10) {
                                    acceptanceScore += 30; // Acceptable
                                    debugLog.push(`OVR Difference ${evaluation.ovrDiffPercent.toFixed(1)}% - Acceptable: +30`);
                                } else if (evaluation.ovrDiffPercent <= 15) {
                                    acceptanceScore += 10; // Questionable
                                    debugLog.push(`OVR Difference ${evaluation.ovrDiffPercent.toFixed(1)}% - Questionable: +10`);
                                }
                                
                                // ========== 2. STAR PLAYER PREMIUM ==========
                                // Stars (90+) are worth more than the sum of their parts
                                const starDiff = evaluation.theirValue.starCount - evaluation.myValue.starCount;
                                if (starDiff > 0) {
                                    const starBonus = starDiff * 20; // Each star they receive = +20
                                    acceptanceScore += starBonus;
                                    debugLog.push(`Receiving ${starDiff} Star Player(s) (90+ OVR): +${starBonus}`);
                                } else if (starDiff < 0) {
                                    const starPenalty = Math.abs(starDiff) * 25; // Giving up stars = -25 each
                                    acceptanceScore -= starPenalty;
                                    debugLog.push(`Giving Up ${Math.abs(starDiff)} Star Player(s): -${starPenalty}`);
                                }
                                
                                // Elite players (85-89) also get a small bonus
                                const eliteDiff = evaluation.theirValue.eliteCount - evaluation.myValue.eliteCount;
                                if (eliteDiff > 0) {
                                    const eliteBonus = eliteDiff * 10;
                                    acceptanceScore += eliteBonus;
                                    debugLog.push(`Receiving ${eliteDiff} Elite Player(s) (85-89 OVR): +${eliteBonus}`);
                                }
                                
                                // ========== 3. PLAYER COUNT IMBALANCE PENALTY ==========
                                const playerCountDiff = Math.abs(myPlayers.length - theirPlayers.length);
                                if (playerCountDiff >= 3) {
                                    acceptanceScore -= 35; // 4-for-1 or worse
                                    debugLog.push(`Large Player Count Imbalance (${myPlayers.length} for ${theirPlayers.length}): -35`);
                                } else if (playerCountDiff === 2) {
                                    acceptanceScore -= 20; // 3-for-1
                                    debugLog.push(`Player Count Imbalance (${myPlayers.length} for ${theirPlayers.length}): -20`);
                                } else if (playerCountDiff === 1) {
                                    acceptanceScore -= 5; // 2-for-1 slight penalty
                                    debugLog.push(`Minor Player Count Imbalance: -5`);
                                }
                                
                                // ========== 4. AGE FACTOR (IMPROVED) ==========
                                if (isCompeting) {
                                    // Competing teams want win-now players, but not too old
                                    const avgAgeReceiving = evaluation.theirValue.avgAge;
                                    const avgAgeGivingUp = evaluation.myValue.avgAge;
                                    
                                    if (avgAgeReceiving > avgAgeGivingUp && avgAgeReceiving <= 32) {
                                        // Getting experienced vets in their prime
                                        acceptanceScore += 25;
                                        debugLog.push(`Getting Win-Now Veterans (Avg Age ${avgAgeReceiving.toFixed(1)}): +25`);
                                    } else if (avgAgeReceiving > 33) {
                                        // Too old even for contenders
                                        acceptanceScore -= 15;
                                        debugLog.push(`Receiving Aging Players (Avg Age ${avgAgeReceiving.toFixed(1)}): -15`);
                                    } else if (avgAgeReceiving < avgAgeGivingUp) {
                                        // Getting younger = planning for future
                                        acceptanceScore += 15;
                                        debugLog.push(`Getting Younger Players: +15`);
                                    }
                                } else if (isRebuilding) {
                                    // Rebuilding teams heavily prioritize youth
                                    const ageDiff = evaluation.myValue.avgAge - evaluation.theirValue.avgAge;
                                    
                                    if (ageDiff > 5) {
                                        // Getting much younger
                                        acceptanceScore += 45;
                                        debugLog.push(`Getting Much Younger Players (${ageDiff.toFixed(1)} years younger): +45`);
                                    } else if (ageDiff > 2) {
                                        // Getting younger
                                        acceptanceScore += 30;
                                        debugLog.push(`Getting Younger Players (${ageDiff.toFixed(1)} years younger): +30`);
                                    } else if (ageDiff < -2) {
                                        // Getting older - bad for rebuild
                                        acceptanceScore -= 30;
                                        debugLog.push(`Getting Older Players (rebuild mode): -30`);
                                    }
                                } else {
                                    // Middle teams - slight preference for youth
                                    if (evaluation.theirValue.avgAge < evaluation.myValue.avgAge - 2) {
                                        acceptanceScore += 10;
                                        debugLog.push(`Getting Younger: +10`);
                                    }
                                }
                                
                                // ========== 5. POTENTIAL FACTOR ==========
                                const potDiff = evaluation.theirValue.totalPOT - evaluation.myValue.totalPOT;
                                if (isRebuilding && potDiff > 10) {
                                    acceptanceScore += 35; // High POT = very valuable for rebuild
                                    debugLog.push(`High Potential for Rebuild (+${potDiff} POT): +35`);
                                } else if (isRebuilding && potDiff > 5) {
                                    acceptanceScore += 20;
                                    debugLog.push(`Good Potential for Rebuild: +20`);
                                } else if (isCompeting && evaluation.theirValue.avgOVR > evaluation.myValue.avgOVR + 2) {
                                    acceptanceScore += 20; // High OVR now = valuable for contender
                                    debugLog.push(`Higher Current Ability (Competing): +20`);
                                }
                                
                                // ========== 6. STATS/PERFORMANCE (INCREASED WEIGHT) ==========
                                const ptsDiff = evaluation.theirValue.totalPts - evaluation.myValue.totalPts;
                                if (ptsDiff > 30) {
                                    acceptanceScore += 30;
                                    debugLog.push(`Much Better Production (+${ptsDiff} pts): +30`);
                                } else if (ptsDiff > 20) {
                                    acceptanceScore += 25;
                                    debugLog.push(`Better Production (+${ptsDiff} pts): +25`);
                                } else if (ptsDiff > 10) {
                                    acceptanceScore += 15;
                                    debugLog.push(`Improved Production (+${ptsDiff} pts): +15`);
                                } else if (ptsDiff < -20) {
                                    acceptanceScore -= 15;
                                    debugLog.push(`Lower Production (${ptsDiff} pts): -15`);
                                }
                                
                                // ========== 7. POSITION NEEDS ==========
                                // Check if they're getting positions they need
                                const receivingPositions = evaluation.theirValue.positions;
                                const givingPositions = evaluation.myValue.positions;
                                
                                // Goalie needs
                                if (receivingPositions.G > 0 && theirGoalies.length <= 2) {
                                    acceptanceScore += 15;
                                    debugLog.push(`Receiving Needed Goalie: +15`);
                                }
                                
                                // Depth concerns
                                if (givingPositions.F > 0 && theirForwards.length - givingPositions.F < 9) {
                                    acceptanceScore -= 20;
                                    debugLog.push(`Would Lack Forward Depth: -20`);
                                }
                                if (givingPositions.D > 0 && theirDefense.length - givingPositions.D < 6) {
                                    acceptanceScore -= 20;
                                    debugLog.push(`Would Lack Defense Depth: -20`);
                                }
                                
                                // ========== 8. RANDOM VARIANCE ==========
                                const randomFactor = (Math.random() - 0.5) * 20; // +/- 10 points
                                acceptanceScore += randomFactor;
                                debugLog.push(`Random GM Preference: ${randomFactor > 0 ? '+' : ''}${randomFactor.toFixed(1)}`);
                                
                                // ========== FINAL DECISION ==========
                                const tradeAccepted = acceptanceScore >= 55; // Raised threshold slightly
                                
                                if (tradeAccepted) {
                                    // Execute trade
                                    const newPlayers = [...gameState.players];
                                    
                                    // Swap teams
                                    myPlayers.forEach(p => {
                                        const player = newPlayers.find(np => np.id === p.id);
                                        player.teamId = tradePartnerTeamId;
                                        // Reset lineup assignments
                                        player.lineNumber = 0;
                                        player.linePosition = null;
                                        player.ppUnit = null;
                                        player.pkUnit = null;
                                        if (player.position === 'G') player.dressed = false;
                                        
                                        // Add to player's trade history with full transaction details
                                        if (!player.tradeHistory) player.tradeHistory = [];
                                        player.tradeHistory.push({
                                            day: gameState.currentDay, season: gameState.season, year: gameState.year,
                                            from: userTeamId,
                                            to: tradePartnerTeamId,
                                            year: gameState.year,
                                            // Include who they were traded with and for
                                            tradedWith: myPlayers.filter(mp => mp.id !== p.id).map(mp => ({ 
                                                id: mp.id, 
                                                name: `${mp.firstName} ${mp.lastName}`, 
                                                position: mp.position 
                                            })),
                                            tradedFor: theirPlayers.map(tp => ({ 
                                                id: tp.id, 
                                                name: `${tp.firstName} ${tp.lastName}`, 
                                                position: tp.position 
                                            }))
                                        });
                                    });
                                    
                                    theirPlayers.forEach(p => {
                                        const player = newPlayers.find(np => np.id === p.id);
                                        player.teamId = userTeamId;
                                        // Reset lineup assignments
                                        player.lineNumber = 0;
                                        player.linePosition = null;
                                        player.ppUnit = null;
                                        player.pkUnit = null;
                                        if (player.position === 'G') player.dressed = false;
                                        
                                        // Add to player's trade history with full transaction details
                                        if (!player.tradeHistory) player.tradeHistory = [];
                                        player.tradeHistory.push({
                                            day: gameState.currentDay, season: gameState.season, year: gameState.year,
                                            from: tradePartnerTeamId,
                                            to: userTeamId,
                                            year: gameState.year,
                                            // Include who they were traded with and for
                                            tradedWith: theirPlayers.filter(tp => tp.id !== p.id).map(tp => ({ 
                                                id: tp.id, 
                                                name: `${tp.firstName} ${tp.lastName}`, 
                                                position: tp.position 
                                            })),
                                            tradedFor: myPlayers.map(mp => ({ 
                                                id: mp.id, 
                                                name: `${mp.firstName} ${mp.lastName}`, 
                                                position: mp.position 
                                            }))
                                        });
                                    });
                                    
                                    // Add to team trade history
                                    if (!gameState.tradeHistory) gameState.tradeHistory = [];
                                    gameState.tradeHistory.push({
                                        day: gameState.currentDay, season: gameState.season, year: gameState.year,
                                        year: gameState.year,
                                        team1: userTeamId,
                                        team2: tradePartnerTeamId,
                                        team1Gives: myPlayers.map(p => ({ id: p.id, name: `${p.firstName} ${p.lastName}`, position: p.position, ovr: p.ratings.overall })),
                                        team2Gives: theirPlayers.map(p => ({ id: p.id, name: `${p.firstName} ${p.lastName}`, position: p.position, ovr: p.ratings.overall }))
                                    });
                                    
                                    // Auto-assign lines
                                    autoSetAllLines(newPlayers, userTeamId);
                                    autoSetAllLines(newPlayers, tradePartnerTeamId);
                                    
                                    // Create the updated game state
                                    const updatedGameState = { ...gameState, players: newPlayers };
                                    setGameState(updatedGameState);
                                    
                                    const teamStatus = isCompeting ? 'ðŸ† Contending' : isRebuilding ? 'ðŸ”§ Rebuilding' : 'ðŸ“Š Middle Team';
                                    let successMessage = `âœ… Trade Accepted!\n\n`;
                                    successMessage += `${theirTeam.city} ${theirTeam.name} (${teamStatus}) has agreed to the trade.\n`;
                                    successMessage += `Traded: ${myPlayers.length} player(s) for ${theirPlayers.length} player(s)\n\n`;
                                    successMessage += `ðŸ“Š Trade Evaluation:\n`;
                                    successMessage += debugLog.slice(0, 5).map(log => `  â€¢ ${log}`).join('\n'); // Show top 5 factors
                                    successMessage += `\n\nðŸŽ¯ Final Score: ${Math.round(acceptanceScore)}/55`;
                                    
                                    setTradeMessage({
                                        type: 'success',
                                        text: successMessage
                                    });
                                    
                                    // Clear selections
                                    setMySelectedPlayers([]);
                                    setTheirSelectedPlayers([]);
                                    
                                    // Save game with the UPDATED state
                                    saveGameToLocalStorage(updatedGameState, userTeamId, playoffState, seasonMode);
                                } else {
                                    // Build detailed rejection message
                                    const teamStatus = isCompeting ? 'ðŸ† Contending' : isRebuilding ? 'ðŸ”§ Rebuilding' : 'ðŸ“Š Middle Team';
                                    let detailedMessage = `âŒ Trade Rejected!\n\n`;
                                    detailedMessage += `${theirTeam.city} ${theirTeam.name} (${teamStatus}) declined the offer.\n\n`;
                                    detailedMessage += `ðŸ“Š Trade Evaluation Breakdown:\n`;
                                    detailedMessage += debugLog.map(log => `  â€¢ ${log}`).join('\n');
                                    detailedMessage += `\n\nðŸŽ¯ Final Score: ${Math.round(acceptanceScore)}/55 (Need 55 to accept)`;
                                    
                                    setTradeMessage({
                                        type: 'error',
                                        text: detailedMessage
                                    });
                                }
                            };

                            const renderPlayerTable = (players, selectedIds, isMyTeam) => (
                                <div style={{ overflowX: 'auto' }}>
                                    <table className="stats-table">
                                        <thead>
                                            <tr>
                                                <th style={{ width: '40px' }}>â˜‘ï¸</th>
                                                <th onClick={() => handleTradeSort('firstName')} style={{ cursor: 'pointer' }}>
                                                    Name {tradeSortConfig.key === 'firstName' && (tradeSortConfig.direction === 'desc' ? 'â†“' : 'â†‘')}
                                                </th>
                                                <th onClick={() => handleTradeSort('position')} style={{ cursor: 'pointer' }}>
                                                    Pos {tradeSortConfig.key === 'position' && (tradeSortConfig.direction === 'desc' ? 'â†“' : 'â†‘')}
                                                </th>
                                                <th onClick={() => handleTradeSort('age')} style={{ cursor: 'pointer' }}>
                                                    Age {tradeSortConfig.key === 'age' && (tradeSortConfig.direction === 'desc' ? 'â†“' : 'â†‘')}
                                                </th>
                                                <th onClick={() => handleTradeSort('ratings.overall')} style={{ cursor: 'pointer' }}>
                                                    OVR {tradeSortConfig.key === 'ratings.overall' && (tradeSortConfig.direction === 'desc' ? 'â†“' : 'â†‘')}
                                                </th>
                                                <th onClick={() => handleTradeSort('ratings.potential')} style={{ cursor: 'pointer' }}>
                                                    POT {tradeSortConfig.key === 'ratings.potential' && (tradeSortConfig.direction === 'desc' ? 'â†“' : 'â†‘')}
                                                </th>
                                                <th onClick={() => handleTradeSort('stats.gamesPlayed')} style={{ cursor: 'pointer' }}>
                                                    GP {tradeSortConfig.key === 'stats.gamesPlayed' && (tradeSortConfig.direction === 'desc' ? 'â†“' : 'â†‘')}
                                                </th>
                                                <th onClick={() => handleTradeSort('stats.points')} style={{ cursor: 'pointer' }}>
                                                    PTS {tradeSortConfig.key === 'stats.points' && (tradeSortConfig.direction === 'desc' ? 'â†“' : 'â†‘')}
                                                </th>
                                                <th>Line/Role</th>
                                                <th>Status</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {players.map(player => {
                                                const isSelected = selectedIds.includes(player.id);
                                                const isInjured = player.injury.injured;
                                                
                                                return (
                                                    <tr 
                                                        key={player.id}
                                                        style={{ 
                                                            background: isSelected ? 'rgba(59, 130, 246, 0.2)' : 'transparent',
                                                            cursor: isInjured ? 'not-allowed' : 'pointer',
                                                            opacity: isInjured ? 0.5 : 1
                                                        }}
                                                        onClick={() => !isInjured && togglePlayerSelection(player.id, isMyTeam)}
                                                    >
                                                        <td>
                                                            <input 
                                                                type="checkbox" 
                                                                checked={isSelected}
                                                                disabled={isInjured}
                                                                onChange={() => {}}
                                                                style={{ cursor: isInjured ? 'not-allowed' : 'pointer' }}
                                                            />
                                                        </td>
                                                        <td>{player.firstName} {player.lastName}</td>
                                                        <td>{player.position}</td>
                                                        <td className="text-center">{player.age}</td>
                                                        <td className="text-center">{player.ratings.overall}</td>
                                                        <td className="text-center">{player.ratings.potential}</td>
                                                        <td className="text-center">{player.stats.gamesPlayed}</td>
                                                        <td className="text-center">{player.stats.points}</td>
                                                        <td className="text-center">
                                                            {player.position === 'G' 
                                                                ? (player.dressed ? 'Dressed' : 'Scratch')
                                                                : (player.lineNumber > 0 ? `Line ${player.lineNumber}` : 'Scratch')
                                                            }
                                                        </td>
                                                        <td className="text-center">
                                                            {isInjured ? (
                                                                <span style={{ color: '#f87171', fontWeight: 'bold' }}>
                                                                    Injured
                                                                </span>
                                                            ) : (
                                                                <span style={{ color: '#4ade80' }}>
                                                                    Healthy
                                                                </span>
                                                            )}
                                                        </td>
                                                    </tr>
                                                );
                                            })}
                                        </tbody>
                                    </table>
                                </div>
                            );

                            const evaluation = canProposeTrade ? evaluateTrade() : null;

                            return (
                                <div className="card">
                                    <h2>ðŸ”„ Trade Center</h2>
                                    <p style={{ color: '#93c5fd', marginBottom: '2rem' }}>
                                        Select players from both teams to propose a trade. Click column headers to sort.
                                    </p>

                                    {/* Trade Message */}
                                    {tradeMessage && (
                                        <div style={{
                                            padding: '1.5rem',
                                            marginBottom: '2rem',
                                            borderRadius: '0.5rem',
                                            background: tradeMessage.type === 'success' ? 'rgba(34, 197, 94, 0.2)' : 'rgba(239, 68, 68, 0.2)',
                                            border: `2px solid ${tradeMessage.type === 'success' ? '#22c55e' : '#ef4444'}`,
                                            color: tradeMessage.type === 'success' ? '#22c55e' : '#f87171',
                                            fontWeight: 'bold',
                                            whiteSpace: 'pre-line',
                                            fontFamily: 'monospace',
                                            fontSize: '0.9rem',
                                            lineHeight: '1.6'
                                        }}>
                                            {tradeMessage.text}
                                        </div>
                                    )}

                                    {/* Your Team */}
                                    <div style={{ marginBottom: '3rem' }}>
                                        <h3 style={{ color: '#22c55e', marginBottom: '1rem' }}>
                                            Your Team ({getTeam(userTeamId)?.city} {getTeam(userTeamId)?.name})
                                            {mySelectedPlayers.length > 0 && (
                                                <span style={{ marginLeft: '1rem', color: '#93c5fd', fontSize: '0.9rem' }}>
                                                    - {mySelectedPlayers.length} player(s) selected
                                                </span>
                                            )}
                                        </h3>
                                        {renderPlayerTable(myTeamPlayers, mySelectedPlayers, true)}
                                    </div>

                                    {/* Team Selection */}
                                    <div style={{ marginBottom: '2rem' }}>
                                        <label style={{ display: 'block', color: '#93c5fd', marginBottom: '0.5rem', fontWeight: 'bold' }}>
                                            Select Trade Partner:
                                        </label>
                                        <select 
                                            className="select"
                                            value={tradePartnerTeamId || ''}
                                            onChange={(e) => {
                                                setTradePartnerTeamId(e.target.value ? parseInt(e.target.value) : null);
                                                setTheirSelectedPlayers([]);
                                                setTradeMessage(null);
                                            }}
                                            style={{ width: '400px' }}
                                        >
                                            <option value="">-- Choose a team --</option>
                                            {TEAMS.filter(t => t.id !== userTeamId).map(team => (
                                                <option key={team.id} value={team.id}>
                                                    {team.city} {team.name}
                                                </option>
                                            ))}
                                        </select>
                                    </div>

                                    {/* Their Team */}
                                    {tradePartnerTeamId && (
                                        <div style={{ marginBottom: '2rem' }}>
                                            <h3 style={{ color: '#fbbf24', marginBottom: '1rem' }}>
                                                {getTeam(tradePartnerTeamId)?.city} {getTeam(tradePartnerTeamId)?.name}
                                                {theirSelectedPlayers.length > 0 && (
                                                    <span style={{ marginLeft: '1rem', color: '#93c5fd', fontSize: '0.9rem' }}>
                                                        - {theirSelectedPlayers.length} player(s) selected
                                                    </span>
                                                )}
                                            </h3>
                                            {renderPlayerTable(theirTeamPlayers, theirSelectedPlayers, false)}
                                        </div>
                                    )}

                                    {/* Trade Evaluation & Button */}
                                    {canProposeTrade && (
                                        <div style={{
                                            padding: '1.5rem',
                                            background: 'rgba(59, 130, 246, 0.1)',
                                            borderRadius: '0.5rem',
                                            border: '2px solid rgba(59, 130, 246, 0.3)',
                                            marginTop: '2rem'
                                        }}>
                                            <h3 style={{ color: '#60a5fa', marginBottom: '1rem' }}>Trade Summary</h3>
                                            
                                            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '2rem', marginBottom: '1.5rem' }}>
                                                <div>
                                                    <h4 style={{ color: '#22c55e', marginBottom: '0.5rem' }}>You Give:</h4>
                                                    <div style={{ color: '#e2e8f0', fontSize: '0.9rem' }}>
                                                        <div>Players: {mySelectedPlayers.length}</div>
                                                        <div>Total OVR: {evaluation.myValue.totalOVR}</div>
                                                        <div>Avg Age: {evaluation.myValue.avgAge.toFixed(1)}</div>
                                                        <div>Total PTS: {evaluation.myValue.totalPts}</div>
                                                    </div>
                                                </div>
                                                <div>
                                                    <h4 style={{ color: '#fbbf24', marginBottom: '0.5rem' }}>You Receive:</h4>
                                                    <div style={{ color: '#e2e8f0', fontSize: '0.9rem' }}>
                                                        <div>Players: {theirSelectedPlayers.length}</div>
                                                        <div>Total OVR: {evaluation.theirValue.totalOVR}</div>
                                                        <div>Avg Age: {evaluation.theirValue.avgAge.toFixed(1)}</div>
                                                        <div>Total PTS: {evaluation.theirValue.totalPts}</div>
                                                    </div>
                                                </div>
                                            </div>

                                            {/* Lopsided Warning */}
                                            {evaluation.isLopsided && (
                                                <div style={{
                                                    padding: '1rem',
                                                    marginBottom: '1rem',
                                                    background: 'rgba(245, 158, 11, 0.2)',
                                                    border: '2px solid #f59e0b',
                                                    borderRadius: '0.375rem',
                                                    color: '#fbbf24',
                                                    fontWeight: 'bold'
                                                }}>
                                                    âš ï¸ Warning: This trade is lopsided! OVR difference: {evaluation.ovrDiff} ({evaluation.ovrDiffPercent.toFixed(1)}%)
                                                    <br />
                                                    <span style={{ fontSize: '0.85rem', fontWeight: 'normal' }}>
                                                        Trades with large OVR differences are likely to be rejected.
                                                    </span>
                                                </div>
                                            )}

                                            <button
                                                onClick={proposeTrade}
                                                style={{
                                                    width: '100%',
                                                    padding: '1rem',
                                                    background: 'linear-gradient(135deg, #3b82f6, #2563eb)',
                                                    color: 'white',
                                                    border: 'none',
                                                    borderRadius: '0.5rem',
                                                    fontSize: '1.1rem',
                                                    fontWeight: 'bold',
                                                    cursor: 'pointer'
                                                }}
                                            >
                                                ðŸ“¤ Propose Trade
                                            </button>
                                        </div>
                                    )}

                                    {/* Instructions */}
                                    <div style={{ 
                                        marginTop: '2rem',
                                        padding: '1rem',
                                        background: 'rgba(100, 116, 139, 0.2)',
                                        borderRadius: '0.5rem'
                                    }}>
                                        <h4 style={{ color: '#cbd5e1', marginBottom: '0.5rem' }}>ðŸ’¡ How to Trade</h4>
                                        <ul style={{ color: '#94a3b8', fontSize: '0.9rem', lineHeight: '1.8' }}>
                                            <li>Click checkboxes or rows to select players from your team</li>
                                            <li>Select a trade partner from the dropdown</li>
                                            <li>Click checkboxes or rows to select their players</li>
                                            <li>Click "Propose Trade" when ready</li>
                                            <li>AI evaluates: OVR balance, age, potential, stats, team needs (competing vs rebuilding)</li>
                                            <li>Injured players cannot be traded</li>
                                            <li>Successful trades update rosters and assign lines automatically</li>
                                        </ul>
                                    </div>
                                </div>
                            );
                        })()}

                        {/* TRANSACTIONS VIEW */}
                        {currentView === 'transactions' && gameState && (
                            <div className="card">
                                <h2>ðŸ“‹ League Transactions</h2>
                                <p style={{ color: '#93c5fd', marginBottom: '2rem' }}>
                                    All trades completed during the {gameState.year}-{(gameState.year + 1).toString().slice(-2)} season
                                </p>
                                
                                {(() => {
                                    // Combine both trade logs
                                    const allTrades = [];
                                    
                                    // Add AI trades
                                    if (gameState.aiTradeLog) {
                                        gameState.aiTradeLog.forEach(trade => {
                                            allTrades.push({
                                                ...trade,
                                                isAITrade: true,
                                                sortKey: trade.day
                                            });
                                        });
                                    }
                                    
                                    // Add player trades (your trades)
                                    if (gameState.tradeHistory) {
                                        gameState.tradeHistory.forEach(trade => {
                                            allTrades.push({
                                                ...trade,
                                                isAITrade: false,
                                                sortKey: trade.day || 999
                                            });
                                        });
                                    }
                                    
                                    // Sort by day (most recent first)
                                    allTrades.sort((a, b) => b.sortKey - a.sortKey);
                                    
                                    if (allTrades.length === 0) {
                                        return (
                                            <div style={{
                                                padding: '3rem',
                                                textAlign: 'center',
                                                color: '#93c5fd',
                                                background: 'rgba(30, 58, 138, 0.2)',
                                                borderRadius: '0.5rem'
                                            }}>
                                                <div style={{ fontSize: '3rem', marginBottom: '1rem' }}>ðŸ“‹</div>
                                                <p style={{ fontSize: '1.2rem' }}>No trades have been completed this season yet.</p>
                                                <p style={{ marginTop: '0.5rem', fontSize: '0.9rem', color: '#64748b' }}>
                                                    Check back after the trade deadline!
                                                </p>
                                            </div>
                                        );
                                    }
                                    
                                    return (
                                        <div>
                                            {/* Trade Statistics */}
                                            <div style={{
                                                display: 'grid',
                                                gridTemplateColumns: 'repeat(3, 1fr)',
                                                gap: '1rem',
                                                marginBottom: '2rem'
                                            }}>
                                                <div style={{
                                                    padding: '1rem',
                                                    background: 'rgba(59, 130, 246, 0.1)',
                                                    borderRadius: '0.5rem',
                                                    border: '1px solid rgba(59, 130, 246, 0.3)',
                                                    textAlign: 'center'
                                                }}>
                                                    <div style={{ fontSize: '2rem', fontWeight: 'bold', color: '#60a5fa' }}>
                                                        {allTrades.length}
                                                    </div>
                                                    <div style={{ color: '#93c5fd', fontSize: '0.875rem' }}>
                                                        Total Trades
                                                    </div>
                                                </div>
                                                <div style={{
                                                    padding: '1rem',
                                                    background: 'rgba(59, 130, 246, 0.1)',
                                                    borderRadius: '0.5rem',
                                                    border: '1px solid rgba(59, 130, 246, 0.3)',
                                                    textAlign: 'center'
                                                }}>
                                                    <div style={{ fontSize: '2rem', fontWeight: 'bold', color: '#60a5fa' }}>
                                                        {allTrades.filter(t => t.isAITrade).length}
                                                    </div>
                                                    <div style={{ color: '#93c5fd', fontSize: '0.875rem' }}>
                                                        AI Trades
                                                    </div>
                                                </div>
                                                <div style={{
                                                    padding: '1rem',
                                                    background: 'rgba(34, 197, 94, 0.1)',
                                                    borderRadius: '0.5rem',
                                                    border: '1px solid rgba(34, 197, 94, 0.3)',
                                                    textAlign: 'center'
                                                }}>
                                                    <div style={{ fontSize: '2rem', fontWeight: 'bold', color: '#22c55e' }}>
                                                        {allTrades.filter(t => !t.isAITrade).length}
                                                    </div>
                                                    <div style={{ color: '#93c5fd', fontSize: '0.875rem' }}>
                                                        Your Trades
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            {/* Trade List */}
                                            <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem' }}>
                                                {allTrades.map((trade, idx) => {
                                                    const team1 = getTeam(trade.team1?.id || trade.team1);
                                                    const team2 = getTeam(trade.team2?.id || trade.team2);
                                                    
                                                    return (
                                                        <div key={idx} style={{
                                                            padding: '1.5rem',
                                                            background: trade.isAITrade ? 'rgba(59, 130, 246, 0.1)' : 'rgba(34, 197, 94, 0.1)',
                                                            borderRadius: '0.75rem',
                                                            border: `2px solid ${trade.isAITrade ? 'rgba(59, 130, 246, 0.3)' : 'rgba(34, 197, 94, 0.3)'}`
                                                        }}>
                                                            {/* Trade Header */}
                                                            <div style={{ 
                                                                display: 'flex',
                                                                justifyContent: 'space-between',
                                                                alignItems: 'center',
                                                                marginBottom: '1rem',
                                                                paddingBottom: '1rem',
                                                                borderBottom: `2px solid ${trade.isAITrade ? 'rgba(59, 130, 246, 0.2)' : 'rgba(34, 197, 94, 0.2)'}`
                                                            }}>
                                                                <div style={{ 
                                                                    fontSize: '1.3rem',
                                                                    fontWeight: 'bold',
                                                                    color: '#fff'
                                                                }}>
                                                                    {team1?.city} {team1?.name} â†”ï¸ {team2?.city} {team2?.name}
                                                                </div>
                                                                <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'flex-end', gap: '0.25rem' }}>
                                                                    <div style={{ 
                                                                        fontSize: '0.875rem',
                                                                        color: '#93c5fd'
                                                                    }}>
                                                                        Day {trade.day} {trade.gameNumber ? `(Game ${trade.gameNumber})` : ''}
                                                                    </div>
                                                                    {trade.isDeadline && (
                                                                        <div style={{
                                                                            padding: '0.25rem 0.5rem',
                                                                            background: 'rgba(239, 68, 68, 0.3)',
                                                                            borderRadius: '0.25rem',
                                                                            fontSize: '0.75rem',
                                                                            color: '#ef4444',
                                                                            fontWeight: 'bold'
                                                                        }}>
                                                                            ðŸ”¥ DEADLINE
                                                                        </div>
                                                                    )}
                                                                    {trade.isAITrade ? (
                                                                        <div style={{
                                                                            padding: '0.25rem 0.5rem',
                                                                            background: 'rgba(59, 130, 246, 0.3)',
                                                                            borderRadius: '0.25rem',
                                                                            fontSize: '0.75rem',
                                                                            color: '#60a5fa',
                                                                            fontWeight: 'bold'
                                                                        }}>
                                                                            AI TRADE
                                                                        </div>
                                                                    ) : (
                                                                        <div style={{
                                                                            padding: '0.25rem 0.5rem',
                                                                            background: 'rgba(34, 197, 94, 0.3)',
                                                                            borderRadius: '0.25rem',
                                                                            fontSize: '0.75rem',
                                                                            color: '#22c55e',
                                                                            fontWeight: 'bold'
                                                                        }}>
                                                                            YOUR TRADE
                                                                        </div>
                                                                    )}
                                                                </div>
                                                            </div>
                                                            
                                                            {/* Trade Details */}
                                                            <div style={{ 
                                                                display: 'grid',
                                                                gridTemplateColumns: '1fr auto 1fr',
                                                                gap: '2rem',
                                                                alignItems: 'start'
                                                            }}>
                                                                {/* Team 1 Gives */}
                                                                <div>
                                                                    <h4 style={{ 
                                                                        color: '#fbbf24',
                                                                        marginBottom: '0.75rem',
                                                                        fontSize: '1rem'
                                                                    }}>
                                                                        {team1?.city} Trades:
                                                                    </h4>
                                                                    <div style={{ display: 'flex', flexDirection: 'column', gap: '0.5rem' }}>
                                                                        {trade.team1Gives.map((player, pIdx) => {
                                                                            const fullPlayer = gameState.players.find(p => p.id === (player.id || player));
                                                                            const displayName = player.name || `${fullPlayer?.firstName} ${fullPlayer?.lastName}`;
                                                                            const displayPos = player.position || fullPlayer?.position;
                                                                            const displayOvr = player.ovr || fullPlayer?.ratings.overall;
                                                                            const displayAge = player.age || fullPlayer?.age;
                                                                            const displayPot = player.pot || fullPlayer?.ratings.potential;
                                                                            
                                                                            return (
                                                                                <div key={pIdx} style={{
                                                                                    padding: '0.75rem',
                                                                                    background: 'rgba(0, 0, 0, 0.2)',
                                                                                    borderRadius: '0.375rem',
                                                                                    cursor: fullPlayer ? 'pointer' : 'default'
                                                                                }}
                                                                                onClick={() => fullPlayer && navigateTo('playerProfile', fullPlayer)}
                                                                                >
                                                                                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                                                                                        <span 
                                                                                            style={{ color: '#fff', fontWeight: 'bold' }}
                                                                                            className={fullPlayer ? 'clickable-player' : ''}
                                                                                        >
                                                                                            {displayName}
                                                                                        </span>
                                                                                        <div style={{ display: 'flex', gap: '0.75rem', alignItems: 'center' }}>
                                                                                            <span style={{ color: '#93c5fd', fontSize: '0.875rem' }}>
                                                                                                {displayPos}
                                                                                            </span>
                                                                                            <span style={{ color: '#64748b', fontSize: '0.875rem' }}>
                                                                                                Age {displayAge}
                                                                                            </span>
                                                                                        </div>
                                                                                    </div>
                                                                                    <div style={{ display: 'flex', gap: '0.75rem', marginTop: '0.5rem', fontSize: '0.875rem' }}>
                                                                                        <span style={{ color: '#fbbf24', fontWeight: 'bold' }}>
                                                                                            {displayOvr} OVR
                                                                                        </span>
                                                                                        <span style={{ color: '#a78bfa' }}>
                                                                                            {displayPot} POT
                                                                                        </span>
                                                                                    </div>
                                                                                </div>
                                                                            );
                                                                        })}
                                                                    </div>
                                                                </div>
                                                                
                                                                {/* Arrow */}
                                                                <div style={{ 
                                                                    fontSize: '2rem',
                                                                    color: '#93c5fd',
                                                                    display: 'flex',
                                                                    alignItems: 'center',
                                                                    justifyContent: 'center'
                                                                }}>
                                                                    â‡„
                                                                </div>
                                                                
                                                                {/* Team 2 Gives */}
                                                                <div>
                                                                    <h4 style={{ 
                                                                        color: '#fbbf24',
                                                                        marginBottom: '0.75rem',
                                                                        fontSize: '1rem'
                                                                    }}>
                                                                        {team2?.city} Trades:
                                                                    </h4>
                                                                    <div style={{ display: 'flex', flexDirection: 'column', gap: '0.5rem' }}>
                                                                        {trade.team2Gives.map((player, pIdx) => {
                                                                            const fullPlayer = gameState.players.find(p => p.id === (player.id || player));
                                                                            const displayName = player.name || `${fullPlayer?.firstName} ${fullPlayer?.lastName}`;
                                                                            const displayPos = player.position || fullPlayer?.position;
                                                                            const displayOvr = player.ovr || fullPlayer?.ratings.overall;
                                                                            const displayAge = player.age || fullPlayer?.age;
                                                                            const displayPot = player.pot || fullPlayer?.ratings.potential;
                                                                            
                                                                            return (
                                                                                <div key={pIdx} style={{
                                                                                    padding: '0.75rem',
                                                                                    background: 'rgba(0, 0, 0, 0.2)',
                                                                                    borderRadius: '0.375rem',
                                                                                    cursor: fullPlayer ? 'pointer' : 'default'
                                                                                }}
                                                                                onClick={() => fullPlayer && navigateTo('playerProfile', fullPlayer)}
                                                                                >
                                                                                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                                                                                        <span 
                                                                                            style={{ color: '#fff', fontWeight: 'bold' }}
                                                                                            className={fullPlayer ? 'clickable-player' : ''}
                                                                                        >
                                                                                            {displayName}
                                                                                        </span>
                                                                                        <div style={{ display: 'flex', gap: '0.75rem', alignItems: 'center' }}>
                                                                                            <span style={{ color: '#93c5fd', fontSize: '0.875rem' }}>
                                                                                                {displayPos}
                                                                                            </span>
                                                                                            <span style={{ color: '#64748b', fontSize: '0.875rem' }}>
                                                                                                Age {displayAge}
                                                                                            </span>
                                                                                        </div>
                                                                                    </div>
                                                                                    <div style={{ display: 'flex', gap: '0.75rem', marginTop: '0.5rem', fontSize: '0.875rem' }}>
                                                                                        <span style={{ color: '#fbbf24', fontWeight: 'bold' }}>
                                                                                            {displayOvr} OVR
                                                                                        </span>
                                                                                        <span style={{ color: '#a78bfa' }}>
                                                                                            {displayPot} POT
                                                                                        </span>
                                                                                    </div>
                                                                                </div>
                                                                            );
                                                                        })}
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                        </div>
                                    );
                                })()}
                            </div>
                        )}

                        {currentView === 'roadmap' && (
                            <div>
                                <div className="card">
                                    <h1 style={{ color: '#22d3ee', marginBottom: '1rem' }}>ðŸš€ Hockey GM - Development Roadmap</h1>
                                    <p style={{ color: '#93c5fd', marginBottom: '1rem', fontSize: '1.1rem' }}>
                                        Last Updated: December 29, 2024
                                    </p>
                                    <p style={{ color: '#e2e8f0', marginBottom: '2rem' }}>
                                        Building Hockey GM one phase at a time. Focus on completing each phase fully before moving to the next. Current priority: Technical infrastructure for multi-season support.
                                    </p>
                                </div>

                                <div className="card" style={{ border: '2px solid #22c55e' }}>
                                    <h2 style={{ color: '#22c55e' }}>âœ… Phase 1: Core Simulation - COMPLETE</h2>
                                    <ul style={{ color: '#e2e8f0', lineHeight: '1.8' }}>
                                        <li>âœ… 32-team professional league structure (Atlantic, Metropolitan, Central, Pacific divisions)</li>
                                        <li>âœ… 82-game regular season simulation</li>
                                        <li>âœ… Day-by-day and full season simulation</li>
                                        <li>âœ… Realistic game engine (team ratings, home advantage, scoring distribution)</li>
                                        <li>âœ… Full player stats tracking (G, A, PTS, +/-, PIM, TOI, SOG)</li>
                                        <li>âœ… Goalie stats (W, L, SV%, GAA, SO)</li>
                                        <li>âœ… Team standings (division, conference, wildcard, league views)</li>
                                        <li>âœ… League leaders board (7 categories: Goals, Assists, Points, +/-, PIM, TOI, SOG)</li>
                                        <li>âœ… Dynamic player profiles with career stats</li>
                                        <li>âœ… Injury system with realistic recovery times</li>
                                        <li>âœ… Load management and healthy scratches</li>
                                        <li>âœ… Team profiles with roster breakdowns</li>
                                        <li>âœ… Game calendar with schedule view</li>
                                        <li>âœ… Basic trade system</li>
                                        <li>âœ… Save/load game functionality</li>
                                    </ul>
                                </div>

                                <div className="card" style={{ border: '2px solid #22c55e' }}>
                                    <h2 style={{ color: '#22c55e' }}>âœ… Phase 2: Playoffs - COMPLETE</h2>
                                    <p style={{ color: '#22d3ee', marginBottom: '1rem' }}>Full professional postseason with detailed stats!</p>
                                    
                                    <ul style={{ color: '#e2e8f0', lineHeight: '1.8' }}>
                                        <li>âœ… 16-team playoff bracket (8 per conference, 1v8, 2v7, 3v6, 4v5)</li>
                                        <li>âœ… Best-of-7 series for all 4 rounds</li>
                                        <li>âœ… Full tournament bracket visualization (7-column tree view)</li>
                                        <li>âœ… Day-by-day playoff simulation (alternating East/West conferences)</li>
                                        <li>âœ… Live bracket updates after each day</li>
                                        <li>âœ… Game summary display (scores, series status, winner highlights)</li>
                                        <li>âœ… <strong>Separate playoff stats tracking (starts from 0 each playoffs)</strong></li>
                                        <li>âœ… <strong>Detailed playoff game views with per-game stats</strong></li>
                                        <li>âœ… <strong>Period-by-period scoring summaries for playoff games</strong></li>
                                        <li>âœ… <strong>Running playoff totals in scoring summary (e.g., McDavid (8) shows 8th playoff goal)</strong></li>
                                        <li>âœ… <strong>Home/Away team tabs for playoff game stats</strong></li>
                                        <li>âœ… <strong>Full skater stats: G, A, PTS, +/-, SOG, TOI</strong></li>
                                        <li>âœ… <strong>Full goalie stats: SA, SV, GA, SV%, W/L</strong></li>
                                        <li>âœ… <strong>Healthy scratch tracking for playoff games</strong></li>
                                        <li>âœ… 2-2-1-1-1 home game format (realistic playoff schedule)</li>
                                        <li>âœ… Championship Finals with champion crowning</li>
                                        <li>âœ… Rest days between rounds</li>
                                        <li>âœ… Series history preservation</li>
                                        <li>âœ… Playoff leaders board toggle</li>
                                        <li>âœ… Goalie leaderboards (Wins, SV%, GAA, Shutouts)</li>
                                    </ul>
                                </div>

                                <div className="card" style={{ border: '2px solid #fbbf24' }}>
                                    <h2 style={{ color: '#fbbf24' }}>ðŸ”„ Phase 2.5: Technical Infrastructure - IN PROGRESS</h2>
                                    <p style={{ color: '#22d3ee', marginBottom: '1rem' }}>Performance optimization and long-term stability for multi-season play</p>
                                    
                                    <h3 style={{ color: '#22c55e', marginTop: '1rem' }}>âœ… Completed:</h3>
                                    <ul style={{ color: '#e2e8f0', lineHeight: '1.8' }}>
                                        <li>âœ… Per-game stat tracking for all games (regular season + playoffs)</li>
                                        <li>âœ… Season totals = sum of all game stats (perfect accuracy)</li>
                                        <li>âœ… Game detail views with full player stats</li>
                                        <li>âœ… Period-by-period scoring summaries</li>
                                        <li>âœ… Running season totals in scoring summaries</li>
                                    </ul>
                                    
                                    <h3 style={{ color: '#fbbf24', marginTop: '1rem' }}>â³ Next Priority - Data Management:</h3>
                                    <ul style={{ color: '#e2e8f0', lineHeight: '1.8' }}>
                                        <li>ðŸ”§ <strong>Season data compression system (CRITICAL for multi-season play)</strong></li>
                                        <li style={{ marginLeft: '1.5rem', fontSize: '0.95em', color: '#93c5fd' }}>â€¢ Problem: 1 season = ~10.6 MB, 30 seasons = 318 MB (too large!)</li>
                                        <li style={{ marginLeft: '1.5rem', fontSize: '0.95em', color: '#93c5fd' }}>â€¢ Solution: Keep last 3 seasons detailed (~32 MB), compress older seasons to summaries</li>
                                        <li style={{ marginLeft: '1.5rem', fontSize: '0.95em', color: '#93c5fd' }}>â€¢ Result: 30 seasons = ~45 MB (safe for all browsers)</li>
                                        <li style={{ marginLeft: '1.5rem', fontSize: '0.95em', color: '#93c5fd' }}>â€¢ Compressed seasons keep: standings, player season totals, playoff results, awards</li>
                                        <li style={{ marginLeft: '1.5rem', fontSize: '0.95em', color: '#93c5fd' }}>â€¢ Compressed seasons remove: per-game details (saves 99% space per season)</li>
                                        <li>ðŸ”§ <strong>Export/import system for season backups</strong></li>
                                        <li style={{ marginLeft: '1.5rem', fontSize: '0.95em', color: '#93c5fd' }}>â€¢ Users can export any season as downloadable JSON file</li>
                                        <li style={{ marginLeft: '1.5rem', fontSize: '0.95em', color: '#93c5fd' }}>â€¢ Import old seasons to view historical details</li>
                                        <li style={{ marginLeft: '1.5rem', fontSize: '0.95em', color: '#93c5fd' }}>â€¢ Frees up browser storage space</li>
                                        <li>ðŸ”§ <strong>Storage monitoring & warnings</strong></li>
                                        <li style={{ marginLeft: '1.5rem', fontSize: '0.95em', color: '#93c5fd' }}>â€¢ Real-time storage usage display</li>
                                        <li style={{ marginLeft: '1.5rem', fontSize: '0.95em', color: '#93c5fd' }}>â€¢ Warning at 80% capacity</li>
                                        <li style={{ marginLeft: '1.5rem', fontSize: '0.95em', color: '#93c5fd' }}>â€¢ Recommendations for managing storage</li>
                                    </ul>
                                    
                                    <h3 style={{ color: '#8b5cf6', marginTop: '1rem' }}>ðŸ”® Future Technical Features:</h3>
                                    <ul style={{ color: '#e2e8f0', lineHeight: '1.8' }}>
                                        <li>PWA (Progressive Web App) support - installable on desktop & mobile</li>
                                        <li>Offline mode capability</li>
                                        <li>Cloud save sync (premium feature)</li>
                                        <li>IndexedDB migration (larger storage capacity)</li>
                                        <li>Performance profiling & optimization</li>
                                    </ul>
                                </div>

                                <div className="card">
                                    <h2 style={{ color: '#8b5cf6' }}>ðŸ“‹ Phase 3: Franchise Management - NEXT MAJOR PHASE</h2>
                                    <p style={{ color: '#22d3ee', marginBottom: '1rem' }}>Foundation for long-term gameplay and multiple seasons</p>
                                    
                                    <h3 style={{ color: '#22d3ee', marginTop: '1rem' }}>1. Multi-Season Framework (HIGHEST PRIORITY)</h3>
                                    <ul style={{ color: '#e2e8f0', lineHeight: '1.8' }}>
                                        <li>Season progression system (advance to next season button)</li>
                                        <li>Offseason phase (draft â†’ free agency â†’ training camp)</li>
                                        <li>Historical records tracking (past champions, award winners)</li>
                                        <li>Career stats accumulation across seasons</li>
                                        <li>Season summary screens (year-end wrap-up)</li>
                                        <li>Season history viewer (browse past seasons)</li>
                                    </ul>
                                    
                                    <h3 style={{ color: '#22d3ee', marginTop: '1rem' }}>2. Player Development & Aging</h3>
                                    <ul style={{ color: '#e2e8f0', lineHeight: '1.8' }}>
                                        <li>Age-based progression/regression curves</li>
                                        <li>Young players (18-24): +1-5 OVR per season (rapid development)</li>
                                        <li>Prime players (25-30): maintain or slight improvement (+0-1 OVR)</li>
                                        <li>Aging players (31+): -1-3 OVR per season (gradual decline)</li>
                                        <li>Potential rating system (determines growth ceiling)</li>
                                        <li>Playing time affects development (ice time matters)</li>
                                        <li>Retirement logic (age 38-42, or declining performance)</li>
                                    </ul>
                                    
                                    <h3 style={{ color: '#22d3ee', marginTop: '1rem' }}>3. Entry Draft System</h3>
                                    <ul style={{ color: '#e2e8f0', lineHeight: '1.8' }}>
                                        <li>7-round draft (224 picks total, 32 per round)</li>
                                        <li>Draft lottery for bottom 16 teams (weighted odds)</li>
                                        <li>Prospect generation (18-year-olds with potential ratings)</li>
                                        <li>Draft board with rankings and scouting reports</li>
                                        <li>Auto-pick option for later rounds</li>
                                        <li>Draft pick trading (future picks too)</li>
                                        <li>Draft history tracking</li>
                                    </ul>
                                    
                                    <h3 style={{ color: '#22d3ee', marginTop: '1rem' }}>4. Contracts & Salary Cap</h3>
                                    <ul style={{ color: '#e2e8f0', lineHeight: '1.8' }}>
                                        <li>Player contracts (1-8 years, $700K-$15M per year)</li>
                                        <li>Salary cap ($83.5M) and floor ($61.7M)</li>
                                        <li>Cap hit calculation (AAV - average annual value)</li>
                                        <li>Contract expiry tracking and RFA/UFA eligibility</li>
                                        <li>Team payroll view with cap space display</li>
                                        <li>Entry-level contracts (ELC) for rookies</li>
                                    </ul>
                                    
                                    <h3 style={{ color: '#22d3ee', marginTop: '1rem' }}>5. Free Agency</h3>
                                    <ul style={{ color: '#e2e8f0', lineHeight: '1.8' }}>
                                        <li>UFA (Unrestricted Free Agents) - open market</li>
                                        <li>RFA (Restricted Free Agents) - qualifying offers required</li>
                                        <li>Contract negotiation AI (players demand market value)</li>
                                        <li>July 1st free agency frenzy period</li>
                                        <li>Signing bonuses and term preferences</li>
                                        <li>Team needs vs. player asking price</li>
                                    </ul>
                                </div>

                                <div className="card">
                                    <h2 style={{ color: '#3b82f6' }}>ðŸ“Š Phase 4: Advanced Features</h2>
                                    <p style={{ color: '#22d3ee', marginBottom: '1rem' }}>Polish and depth for dedicated players</p>
                                    
                                    <h3 style={{ color: '#22d3ee', marginTop: '1rem' }}>Awards & Honors</h3>
                                    <ul style={{ color: '#e2e8f0', lineHeight: '1.8' }}>
                                        <li>Hart Trophy (MVP)</li>
                                        <li>Vezina Trophy (Best Goalie)</li>
                                        <li>Norris Trophy (Best Defenseman)</li>
                                        <li>Calder Trophy (Rookie of the Year)</li>
                                        <li>Conn Smythe Trophy (Playoff MVP)</li>
                                        <li>All-Star Teams (1st, 2nd, 3rd)</li>
                                    </ul>
                                    
                                    <h3 style={{ color: '#22d3ee', marginTop: '1rem' }}>Financial Management</h3>
                                    <ul style={{ color: '#e2e8f0', lineHeight: '1.8' }}>
                                        <li>Attendance tracking (15,000-21,000 capacity)</li>
                                        <li>Ticket revenue based on performance</li>
                                        <li>Playoff revenue bonuses</li>
                                        <li>Operating expenses and profit/loss</li>
                                        <li>Arena upgrades</li>
                                    </ul>
                                    
                                    <h3 style={{ color: '#22d3ee', marginTop: '1rem' }}>Advanced Stats</h3>
                                    <ul style={{ color: '#e2e8f0', lineHeight: '1.8' }}>
                                        <li>Corsi & Fenwick (shot attempt metrics)</li>
                                        <li>PDO (shooting % + save %)</li>
                                        <li>Zone starts (offensive/defensive)</li>
                                        <li>Quality of competition metrics</li>
                                        <li>Heat maps and advanced visualizations</li>
                                    </ul>
                                    
                                    <h3 style={{ color: '#22d3ee', marginTop: '1rem' }}>ðŸŽ® Live Game Viewer</h3>
                                    <ul style={{ color: '#e2e8f0', lineHeight: '1.8' }}>
                                        <li><strong>Watch games play out in real-time!</strong></li>
                                        <li>Text-based play-by-play commentary</li>
                                        <li>Period-by-period progression</li>
                                        <li>Live score updates and shot counters</li>
                                        <li>Highlight reel of key moments</li>
                                        <li>Option to sim fast or watch live</li>
                                    </ul>
                                    <p style={{ color: '#22d3ee', marginTop: '0.5rem', fontStyle: 'italic', fontSize: '0.9rem' }}>
                                        Example: "14:23 1st - McDavid carries into the zone... shoots... GOAL! McDavid (15) from Draisaitl (22). Oilers lead 2-1!"
                                    </p>
                                </div>

                                <div className="card">
                                    <h2 style={{ color: '#a78bfa' }}>ðŸŒ Phase 5: International Expansion (Future Vision)</h2>
                                    <p style={{ color: '#22d3ee', marginBottom: '1rem' }}>A global hockey universe - this is the long-term dream!</p>
                                    
                                    <h3 style={{ color: '#22d3ee' }}>Continental Leagues</h3>
                                    <ul style={{ color: '#e2e8f0', lineHeight: '1.8' }}>
                                        <li>ðŸ’ <strong>North America:</strong> 32 teams, 82-game season (existing)</li>
                                        <li>ðŸ‡ªðŸ‡º <strong>Europe:</strong> 30 teams (Russia, Sweden, Finland, Czech), 60-game season</li>
                                        <li>ðŸŒ <strong>Asia:</strong> 30 teams (Japan, Korea, China, Kazakhstan), 60-game season</li>
                                        <li>ðŸŒŽ <strong>South America:</strong> 30 teams (Argentina, Brazil, Chile), 60-game season</li>
                                        <li>ðŸŒ <strong>Africa:</strong> 30 teams (South Africa, Algeria, Morocco), 60-game season</li>
                                    </ul>
                                    
                                    <h3 style={{ color: '#22d3ee', marginTop: '1.5rem' }}>Inter-Continental Competition</h3>
                                    <ul style={{ color: '#e2e8f0', lineHeight: '1.8' }}>
                                        <li>ðŸ† <strong>Champions League:</strong> Top 4 from each league (20 teams) - Group stage â†’ Knockout â†’ Final</li>
                                        <li>ðŸŒ <strong>World Cup of Hockey:</strong> National teams, every 4 years, 32 nations</li>
                                        <li>ðŸ¥‡ <strong>Olympics:</strong> Winter Olympics integration</li>
                                    </ul>
                                    
                                    <p style={{ color: '#93c5fd', marginTop: '1.5rem', fontStyle: 'italic' }}>
                                        Note: This phase requires Phases 1-4 to be fully complete and stable. It's a massive undertaking that will come after the core game is polished.
                                    </p>
                                </div>

                                <div className="card" style={{ background: 'rgba(59, 130, 246, 0.1)', border: '2px solid #3b82f6' }}>
                                    <h2 style={{ color: '#3b82f6' }}>ðŸ’¡ Development Philosophy</h2>
                                    <ul style={{ color: '#e2e8f0', lineHeight: '2', fontSize: '1.05rem' }}>
                                        <li><strong>Quality over Speed:</strong> Each feature must work perfectly before moving on</li>
                                        <li><strong>User Feedback:</strong> Your input shapes priorities and features</li>
                                        <li><strong>Incremental Progress:</strong> Small, tested updates prevent breaking changes</li>
                                        <li><strong>Save Compatibility:</strong> Your saves will work with future updates</li>
                                        <li><strong>Open Development:</strong> Track progress in this roadmap</li>
                                    </ul>
                                    
                                    <p style={{ color: '#22d3ee', marginTop: '1.5rem', fontSize: '1.1rem' }}>
                                        ðŸŽ¯ <strong>Current Focus:</strong> Phase 2.5 - Data compression system to enable efficient multi-season play (30+ seasons without performance issues)
                                    </p>
                                    
                                    <p style={{ color: '#93c5fd', marginTop: '1rem' }}>
                                        Have feedback or feature requests? Use the feedback button below any response to share your thoughts!
                                    </p>
                                </div>
                            </div>
                        )}

                        {/* AWARDS VIEW */}
                        {currentView === 'awards' && seasonAwards && (
                            <div>
                                <div className="card" style={{ background: 'linear-gradient(135deg, rgba(245, 158, 11, 0.2), rgba(251, 191, 36, 0.1))', border: '2px solid #f59e0b' }}>
                                    <h1 style={{ color: '#fbbf24', marginBottom: '0.5rem', fontSize: '2.5rem' }}>ðŸ† End of Season Awards</h1>
                                    <p style={{ color: '#93c5fd', fontSize: '1.2rem' }}>
                                        {gameState.year}-{(gameState.year + 1).toString().slice(-2)} Season
                                    </p>
                                    <button 
                                        onClick={() => {
                                            setSeasonMode('playoffs');
                                            setCurrentView('playoffs');
                                        }}
                                        style={{
                                            marginTop: '1rem',
                                            padding: '0.75rem 1.5rem',
                                            background: '#22c55e',
                                            color: '#fff',
                                            border: 'none',
                                            borderRadius: '0.5rem',
                                            fontSize: '1.1rem',
                                            cursor: 'pointer',
                                            fontWeight: 'bold'
                                        }}
                                    >
                                        Continue to Playoffs â†’
                                    </button>
                                </div>

                                {/* LEAGUE AWARDS */}
                                <div className="card">
                                    <h2 style={{ color: '#f59e0b', marginBottom: '1.5rem' }}>â­ League Awards</h2>
                                    
                                    <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))', gap: '1.5rem' }}>
                                        {[
                                            { title: 'League MVP', player: seasonAwards.league.mvp, icon: 'ðŸ†' },
                                            { title: 'Best Goaltender', player: seasonAwards.league.bestGoalie, icon: 'ðŸ¥…' },
                                            { title: 'Best Defenseman', player: seasonAwards.league.bestDefenseman, icon: 'ðŸ›¡ï¸' },
                                            { title: 'Rookie of the Year', player: seasonAwards.league.rookieOfYear, icon: 'â­' },
                                            { title: 'Top Goal Scorer', player: seasonAwards.league.topGoalScorer, icon: 'ðŸŽ¯' },
                                            { title: 'Top Point Scorer', player: seasonAwards.league.topPointScorer, icon: 'ðŸ“Š' },
                                            { title: 'Best Defensive Forward', player: seasonAwards.league.bestDefensiveForward, icon: 'ðŸ…' },
                                            { title: 'Sportsmanship Award', player: seasonAwards.league.sportsmanship, icon: 'ðŸ¤' }
                                        ].map((award, idx) => {
                                            if (!award.player) return null;
                                            const team = TEAMS.find(t => t.id === award.player.teamId);
                                            return (
                                                <div key={idx} style={{
                                                    padding: '1.5rem',
                                                    background: 'rgba(245, 158, 11, 0.1)',
                                                    borderRadius: '0.75rem',
                                                    border: '2px solid rgba(245, 158, 11, 0.3)',
                                                    cursor: 'pointer'
                                                }}
                                                onClick={() => {
                                                    navigateTo('playerProfile', award.player);
                                                }}>
                                                    <div style={{ fontSize: '2rem', marginBottom: '0.5rem' }}>{award.icon}</div>
                                                    <h3 style={{ color: '#fbbf24', marginBottom: '0.75rem', fontSize: '1.1rem' }}>
                                                        {award.title}
                                                    </h3>
                                                    <div style={{ color: '#fff', fontWeight: 'bold', fontSize: '1.2rem', marginBottom: '0.5rem' }}>
                                                        {award.player.firstName} {award.player.lastName}
                                                    </div>
                                                    <div style={{ color: '#93c5fd', marginBottom: '0.75rem' }}>
                                                        {team?.city} {team?.name}
                                                    </div>
                                                    <div style={{ color: '#e2e8f0', fontSize: '0.9rem' }}>
                                                        {award.player.position === 'G' ? (
                                                            <>
                                                                {award.player.stats.wins}-{award.player.stats.losses} | 
                                                                {' '}{award.player.stats.savePercentage.toFixed(3)} SV% | 
                                                                {' '}{award.player.stats.gaa.toFixed(2)} GAA
                                                            </>
                                                        ) : (
                                                            <>
                                                                {award.player.stats.goals}G {award.player.stats.assists}A {award.player.stats.points}PTS | 
                                                                {' '}{award.player.stats.plusMinus > 0 ? '+' : ''}{award.player.stats.plusMinus}
                                                            </>
                                                        )}
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>

                                {/* ALL-STAR TEAMS */}
                                <div className="card">
                                    <h2 style={{ color: '#22d3ee', marginBottom: '1.5rem' }}>â­ League All-Star Teams</h2>
                                    
                                    {['firstTeam', 'secondTeam', 'thirdTeam'].map((teamType, teamIdx) => {
                                        const teamName = teamType === 'firstTeam' ? '1st Team' : teamType === 'secondTeam' ? '2nd Team' : '3rd Team';
                                        const team = seasonAwards.allStars[teamType];
                                        
                                        return (
                                            <div key={teamIdx} style={{ marginBottom: '2rem' }}>
                                                <h3 style={{ color: '#22d3ee', marginBottom: '1rem' }}>{teamName}</h3>
                                                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))', gap: '1rem' }}>
                                                    {[
                                                        { label: 'Goalie', player: team.goalie },
                                                        { label: 'Left Defense', player: team.leftDefense },
                                                        { label: 'Right Defense', player: team.rightDefense },
                                                        { label: 'Center', player: team.center },
                                                        { label: 'Left Wing', player: team.leftWing },
                                                        { label: 'Right Wing', player: team.rightWing }
                                                    ].map((pos, posIdx) => {
                                                        if (!pos.player) return null;
                                                        const playerTeam = TEAMS.find(t => t.id === pos.player.teamId);
                                                        return (
                                                            <div key={posIdx} style={{
                                                                padding: '1rem',
                                                                background: 'rgba(59, 130, 246, 0.1)',
                                                                borderRadius: '0.5rem',
                                                                border: '1px solid rgba(59, 130, 246, 0.3)',
                                                                cursor: 'pointer'
                                                            }}
                                                            onClick={() => {
                                                                setSelectedPlayerProfile(pos.player);
                                                                setCurrentView('playerProfile');
                                                            }}>
                                                                <div style={{ color: '#93c5fd', fontSize: '0.85rem', marginBottom: '0.25rem' }}>
                                                                    {pos.label}
                                                                </div>
                                                                <div style={{ color: '#fff', fontWeight: 'bold', marginBottom: '0.25rem' }}>
                                                                    {pos.player.firstName} {pos.player.lastName}
                                                                </div>
                                                                <div style={{ color: '#64748b', fontSize: '0.85rem', marginBottom: '0.5rem' }}>
                                                                    {playerTeam?.abbreviation || playerTeam?.city}
                                                                </div>
                                                                <div style={{ color: '#e2e8f0', fontSize: '0.85rem' }}>
                                                                    {pos.player.position === 'G' ? (
                                                                        <>{pos.player.stats.wins}W | {pos.player.stats.savePercentage.toFixed(3)} SV%</>
                                                                    ) : (
                                                                        <>{pos.player.stats.points}PTS ({pos.player.stats.goals}G-{pos.player.stats.assists}A)</>
                                                                    )}
                                                                </div>
                                                            </div>
                                                        );
                                                    })}
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>

                                {/* DIVISION AWARDS */}
                                {['Atlantic', 'Metropolitan', 'Central', 'Pacific'].map((division, divIdx) => {
                                    const divAwards = seasonAwards.divisions[division];
                                    const divAllStars = seasonAwards.allStars.divisions[division];
                                    
                                    return (
                                        <div key={divIdx} className="card">
                                            <h2 style={{ color: '#8b5cf6', marginBottom: '1.5rem' }}>
                                                ðŸ’ {division} Division Awards
                                            </h2>
                                            
                                            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(280px, 1fr))', gap: '1.5rem', marginBottom: '2rem' }}>
                                                {[
                                                    { title: 'Division MVP', player: divAwards.mvp, icon: 'ðŸ‘‘' },
                                                    { title: 'Best Goaltender', player: divAwards.bestGoalie, icon: 'ðŸ¥…' },
                                                    { title: 'Best Defenseman', player: divAwards.bestDefenseman, icon: 'ðŸ›¡ï¸' },
                                                    { title: 'Rookie of the Year', player: divAwards.rookieOfYear, icon: 'â­' },
                                                    { title: 'Top Scorer', player: divAwards.topScorer, icon: 'ðŸŽ¯' }
                                                ].map((award, awardIdx) => {
                                                    if (!award.player) return null;
                                                    const team = TEAMS.find(t => t.id === award.player.teamId);
                                                    return (
                                                        <div key={awardIdx} style={{
                                                            padding: '1rem',
                                                            background: 'rgba(139, 92, 246, 0.1)',
                                                            borderRadius: '0.5rem',
                                                            border: '1px solid rgba(139, 92, 246, 0.3)',
                                                            cursor: 'pointer'
                                                        }}
                                                        onClick={() => {
                                                            setSelectedPlayerProfile(award.player);
                                                            setCurrentView('playerProfile');
                                                        }}>
                                                            <div style={{ fontSize: '1.5rem', marginBottom: '0.5rem' }}>{award.icon}</div>
                                                            <h4 style={{ color: '#a78bfa', marginBottom: '0.5rem', fontSize: '0.95rem' }}>
                                                                {award.title}
                                                            </h4>
                                                            <div style={{ color: '#fff', fontWeight: 'bold', marginBottom: '0.25rem' }}>
                                                                {award.player.firstName} {award.player.lastName}
                                                            </div>
                                                            <div style={{ color: '#93c5fd', fontSize: '0.85rem', marginBottom: '0.5rem' }}>
                                                                {team?.city} {team?.name}
                                                            </div>
                                                            <div style={{ color: '#e2e8f0', fontSize: '0.85rem' }}>
                                                                {award.player.position === 'G' ? (
                                                                    <>{award.player.stats.savePercentage.toFixed(3)} SV% | {award.player.stats.gaa.toFixed(2)} GAA</>
                                                                ) : (
                                                                    <>{award.player.stats.points}PTS ({award.player.stats.goals}G-{award.player.stats.assists}A)</>
                                                                )}
                                                            </div>
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                            
                                            <h3 style={{ color: '#a78bfa', marginBottom: '1rem', marginTop: '1rem' }}>
                                                Division All-Stars
                                            </h3>
                                            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '1rem' }}>
                                                {[
                                                    { label: 'G', player: divAllStars.goalie },
                                                    { label: 'LD', player: divAllStars.leftDefense },
                                                    { label: 'RD', player: divAllStars.rightDefense },
                                                    { label: 'C', player: divAllStars.center },
                                                    { label: 'LW', player: divAllStars.leftWing },
                                                    { label: 'RW', player: divAllStars.rightWing }
                                                ].map((pos, posIdx) => {
                                                    if (!pos.player) return null;
                                                    const playerTeam = TEAMS.find(t => t.id === pos.player.teamId);
                                                    return (
                                                        <div key={posIdx} style={{
                                                            padding: '0.75rem',
                                                            background: 'rgba(139, 92, 246, 0.05)',
                                                            borderRadius: '0.375rem',
                                                            border: '1px solid rgba(139, 92, 246, 0.2)',
                                                            cursor: 'pointer'
                                                        }}
                                                        onClick={() => {
                                                            setSelectedPlayerProfile(pos.player);
                                                            setCurrentView('playerProfile');
                                                        }}>
                                                            <div style={{ color: '#a78bfa', fontSize: '0.75rem', marginBottom: '0.25rem', fontWeight: 'bold' }}>
                                                                {pos.label}
                                                            </div>
                                                            <div style={{ color: '#fff', fontSize: '0.9rem', fontWeight: 'bold', marginBottom: '0.25rem' }}>
                                                                {pos.player.firstName.charAt(0)}. {pos.player.lastName}
                                                            </div>
                                                            <div style={{ color: '#64748b', fontSize: '0.75rem' }}>
                                                                {playerTeam?.abbreviation}
                                                            </div>
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        )}

                        {/* HELP & USER MANUAL VIEW */}
                        {currentView === 'help' && (
                            <div className="card">
                                <h1 style={{ color: '#60a5fa', marginBottom: '1rem', fontSize: '2.5rem' }}>ðŸ“– Hockey GM - User Manual</h1>
                                <p style={{ color: '#93c5fd', fontSize: '1.1rem', marginBottom: '2rem' }}>
                                    Complete guide to managing your hockey franchise
                                </p>

                                {/* GETTING STARTED */}
                                <div className="card" style={{ background: 'rgba(34, 197, 94, 0.1)', border: '2px solid #22c55e' }}>
                                    <h2 style={{ color: '#22c55e' }}>ðŸš€ Getting Started</h2>
                                    
                                    <h3 style={{ color: '#93c5fd', marginTop: '1.5rem' }}>Creating Your Game</h3>
                                    <ol style={{ lineHeight: '2', color: '#e2e8f0' }}>
                                        <li><strong>Select Your Team:</strong> Choose from 32 professional hockey teams on the main menu</li>
                                        <li><strong>Your Roster:</strong> Each team starts with 23 NHL players (13F + 7D + 3G)</li>
                                        <li><strong>Farm Team:</strong> You also control 23 farm team players for development</li>
                                        <li><strong>Season Length:</strong> 82-game regular season + playoffs</li>
                                    </ol>

                                    <h3 style={{ color: '#93c5fd', marginTop: '1.5rem' }}>Navigation</h3>
                                    <ul style={{ lineHeight: '2', color: '#e2e8f0' }}>
                                        <li><strong>Stats:</strong> Player stats, team stats, league leaders</li>
                                        <li><strong>Roster Management:</strong> Control your lineup, lines, trades, injuries</li>
                                        <li><strong>Season:</strong> Standings, calendar, awards, playoffs</li>
                                        <li><strong>Settings:</strong> Save game, roadmap, help</li>
                                    </ul>
                                </div>

                                {/* SIMULATION */}
                                <div className="card" style={{ background: 'rgba(59, 130, 246, 0.1)', border: '2px solid #3b82f6', marginTop: '2rem' }}>
                                    <h2 style={{ color: '#60a5fa' }}>âš¡ Simulation Controls</h2>
                                    
                                    <h3 style={{ color: '#93c5fd', marginTop: '1.5rem' }}>Sim Day</h3>
                                    <p style={{ color: '#e2e8f0' }}>
                                        Simulates one day of the schedule. Multiple games happen per day, up to 16 games maximum.
                                        This gives you fine control to check results frequently.
                                    </p>

                                    <h3 style={{ color: '#93c5fd', marginTop: '1.5rem' }}>âš¡ Sim Season</h3>
                                    <p style={{ color: '#e2e8f0' }}>
                                        Simulates the entire 82-game regular season at once. Fast way to complete a season.
                                        All stats, injuries, and awards are calculated automatically.
                                    </p>

                                    <h3 style={{ color: '#93c5fd', marginTop: '1.5rem' }}>Auto-Save</h3>
                                    <p style={{ color: '#e2e8f0' }}>
                                        Your game auto-saves after each day. You can also manually save via Settings â†’ ðŸ’¾ Save Game.
                                        Saves are stored in your browser's local storage.
                                    </p>
                                </div>

                                {/* ROSTER MANAGEMENT */}
                                <div className="card" style={{ background: 'rgba(251, 191, 36, 0.1)', border: '2px solid #fbbf24', marginTop: '2rem' }}>
                                    <h2 style={{ color: '#fbbf24' }}>ðŸ‘¥ Roster Management</h2>
                                    
                                    <h3 style={{ color: '#93c5fd', marginTop: '1.5rem' }}>Roster (23 Players)</h3>
                                    <ul style={{ lineHeight: '2', color: '#e2e8f0' }}>
                                        <li><strong>13 Forwards:</strong> Make up 4 lines</li>
                                        <li><strong>7 Defensemen:</strong> Make up 3 pairs</li>
                                        <li><strong>3 Goalies:</strong> Starter, backup, emergency</li>
                                        <li><strong>Team Overall:</strong> Shows your team's strength and league rank</li>
                                        <li><strong>Color Coding:</strong> Green (Top 5), Blue (Top 10), Yellow (Middle), Red (Bottom)</li>
                                    </ul>

                                    <h3 style={{ color: '#93c5fd', marginTop: '1.5rem' }}>Lines & Scratches</h3>
                                    <ul style={{ lineHeight: '2', color: '#e2e8f0' }}>
                                        <li><strong>Forward Lines:</strong> Assign 12 forwards to Lines 1-4 (3 per line: C, LW, RW)</li>
                                        <li><strong>Defense Pairs:</strong> Assign 6 defensemen to Pairs 1-3 (2 per pair: LD, RD)</li>
                                        <li><strong>Goalies:</strong> Dress 2 goalies (starter & backup)</li>
                                        <li><strong>Scratches:</strong> 3 players (1F, 1D, 1G) are healthy scratches each game</li>
                                        <li><strong>Auto-Set:</strong> Click "Auto-Set All Lines" to optimize by OVR</li>
                                        <li><strong>Out of Position:</strong> Players lose 3 OVR when playing wrong position</li>
                                    </ul>

                                    <h3 style={{ color: '#93c5fd', marginTop: '1.5rem' }}>Special Teams</h3>
                                    <ul style={{ lineHeight: '2', color: '#e2e8f0' }}>
                                        <li><strong>Power Play:</strong> 2 units with 5 players each (4F+1D typical)</li>
                                        <li><strong>Penalty Kill:</strong> 2 units with 4 players each (2F+2D typical)</li>
                                        <li><strong>Impact:</strong> PP/PK specialists get bonus weight in Team Overall rating</li>
                                    </ul>

                                    <h3 style={{ color: '#93c5fd', marginTop: '1.5rem' }}>ðŸ”„ Call-Ups & Send-Downs</h3>
                                    <ul style={{ lineHeight: '2', color: '#e2e8f0' }}>
                                        <li><strong>Call Up:</strong> Bring prospects from farm team to NHL</li>
                                        <li><strong>Send Down:</strong> Demote NHL players to farm (can't send injured players)</li>
                                        <li><strong>Auto Call-Up:</strong> When NHL player is injured and no scratches available, best farm player is called up automatically</li>
                                        <li><strong>Auto Return:</strong> When injured player heals, farm call-up returns automatically</li>
                                    </ul>
                                </div>

                                {/* INJURIES */}
                                <div className="card" style={{ background: 'rgba(239, 68, 68, 0.1)', border: '2px solid #ef4444', marginTop: '2rem' }}>
                                    <h2 style={{ color: '#f87171' }}>ðŸ¥ Injury System</h2>
                                    
                                    <h3 style={{ color: '#93c5fd', marginTop: '1.5rem' }}>How Injuries Work</h3>
                                    <ul style={{ lineHeight: '2', color: '#e2e8f0' }}>
                                        <li><strong>Injury Rate:</strong> ~3% per game (realistic NHL rates)</li>
                                        <li><strong>Position Impact:</strong> Forwards get injured more, goalies less</li>
                                        <li><strong>Age Impact:</strong> Older players (32+) more injury-prone</li>
                                        <li><strong>Ice Time:</strong> More TOI = higher injury risk</li>
                                    </ul>

                                    <h3 style={{ color: '#93c5fd', marginTop: '1.5rem' }}>Injury Types</h3>
                                    <ul style={{ lineHeight: '2', color: '#e2e8f0' }}>
                                        <li><strong>Day-to-Day (DTD):</strong> 1-7 days - back quickly</li>
                                        <li><strong>Week-to-Week:</strong> 7-14 days - short absence</li>
                                        <li><strong>Month-to-Month (IR):</strong> 15-60 days - medium term</li>
                                        <li><strong>Season-Ending:</strong> Rest of season</li>
                                        <li><strong>Career-Ending:</strong> Player retires (very rare, 0.1%)</li>
                                    </ul>

                                    <h3 style={{ color: '#93c5fd', marginTop: '1.5rem' }}>Managing Injuries</h3>
                                    <ul style={{ lineHeight: '2', color: '#e2e8f0' }}>
                                        <li>Check Roster Management â†’ Injuries to see all injured players</li>
                                        <li>Injured players keep their lineup spot but don't play</li>
                                        <li>Replacements (scratches or farm call-ups) fill in temporarily</li>
                                        <li>When healed, injured player returns to their original spot</li>
                                    </ul>
                                </div>

                                {/* STATS & TRACKING */}
                                <div className="card" style={{ background: 'rgba(168, 85, 247, 0.1)', border: '2px solid #a855f7', marginTop: '2rem' }}>
                                    <h2 style={{ color: '#c084fc' }}>ðŸ“Š Stats & Tracking</h2>
                                    
                                    <h3 style={{ color: '#93c5fd', marginTop: '1.5rem' }}>Player Stats</h3>
                                    <ul style={{ lineHeight: '2', color: '#e2e8f0' }}>
                                        <li><strong>Regular Season:</strong> Full stats for 82-game season</li>
                                        <li><strong>Playoffs:</strong> Separate playoff stats tracked</li>
                                        <li><strong>Per-Game Details:</strong> View individual game performances</li>
                                        <li><strong>Career Stats:</strong> Coming soon in future updates</li>
                                    </ul>

                                    <h3 style={{ color: '#93c5fd', marginTop: '1.5rem' }}>Team Stats</h3>
                                    <ul style={{ lineHeight: '2', color: '#e2e8f0' }}>
                                        <li><strong>Goals For/Against:</strong> Per game averages</li>
                                        <li><strong>Shots:</strong> Shots for and shots against per game</li>
                                        <li><strong>Power Play %:</strong> Success rate (20%+ is excellent)</li>
                                        <li><strong>Penalty Kill %:</strong> Success rate (82%+ is excellent)</li>
                                        <li><strong>Shooting %:</strong> Goals per 100 shots</li>
                                    </ul>

                                    <h3 style={{ color: '#93c5fd', marginTop: '1.5rem' }}>League Leaders</h3>
                                    <ul style={{ lineHeight: '2', color: '#e2e8f0' }}>
                                        <li><strong>Skater Stats:</strong> Points, goals, assists, +/-, PIM, shots</li>
                                        <li><strong>Goalie Stats:</strong> Wins, save %, GAA, shutouts</li>
                                        <li><strong>Minimum Games:</strong> 27 GP for goalies (save % & GAA)</li>
                                        <li><strong>Click Names:</strong> Click any player to view their full profile</li>
                                    </ul>
                                </div>

                                {/* AWARDS & ACHIEVEMENTS */}
                                <div className="card" style={{ background: 'rgba(245, 158, 11, 0.1)', border: '2px solid #f59e0b', marginTop: '2rem' }}>
                                    <h2 style={{ color: '#fbbf24' }}>ðŸ† Awards & Achievements</h2>
                                    
                                    <h3 style={{ color: '#93c5fd', marginTop: '1.5rem' }}>Season Awards (71 Total)</h3>
                                    <ul style={{ lineHeight: '2', color: '#e2e8f0' }}>
                                        <li><strong>Hart Trophy:</strong> League MVP</li>
                                        <li><strong>Vezina Trophy:</strong> Best Goaltender</li>
                                        <li><strong>Norris Trophy:</strong> Best Defenseman</li>
                                        <li><strong>Calder Trophy:</strong> Rookie of the Year</li>
                                        <li><strong>Art Ross Trophy:</strong> Points Leader</li>
                                        <li><strong>Maurice Richard Trophy:</strong> Goals Leader</li>
                                        <li><strong>Division Awards:</strong> MVP, rookie, goalie for each division</li>
                                        <li><strong>All-Star Teams:</strong> First, Second, Third teams + divisional all-stars</li>
                                    </ul>

                                    <h3 style={{ color: '#93c5fd', marginTop: '1.5rem' }}>Playoff Awards</h3>
                                    <ul style={{ lineHeight: '2', color: '#e2e8f0' }}>
                                        <li><strong>Stanley Cup:</strong> Playoff champion</li>
                                        <li><strong>Conn Smythe (Playoff MVP):</strong> Best player in playoffs</li>
                                    </ul>

                                    <h3 style={{ color: '#93c5fd', marginTop: '1.5rem' }}>Player Achievements</h3>
                                    <ul style={{ lineHeight: '2', color: '#e2e8f0' }}>
                                        <li><strong>Awards:</strong> Trophy wins appear in player profile</li>
                                        <li><strong>All-Star Selections:</strong> 40 players per season (20 per conference)</li>
                                        <li><strong>League Leaders:</strong> Leading any stat category</li>
                                        <li><strong>Milestones:</strong> 500 goals, 1000 points, etc.</li>
                                        <li><strong>View in Profile:</strong> Click player name â†’ see achievements section</li>
                                    </ul>
                                </div>

                                {/* PLAYOFFS */}
                                <div className="card" style={{ background: 'rgba(234, 179, 8, 0.1)', border: '2px solid #eab308', marginTop: '2rem' }}>
                                    <h2 style={{ color: '#facc15' }}>ðŸ† Playoffs</h2>
                                    
                                    <h3 style={{ color: '#93c5fd', marginTop: '1.5rem' }}>Playoff Format</h3>
                                    <ul style={{ lineHeight: '2', color: '#e2e8f0' }}>
                                        <li><strong>16 Teams:</strong> Top 8 from each conference qualify</li>
                                        <li><strong>Best-of-7 Series:</strong> First to 4 wins advances</li>
                                        <li><strong>4 Rounds:</strong> First Round â†’ Second Round â†’ Conference Finals â†’ Stanley Cup Finals</li>
                                        <li><strong>Bracket View:</strong> See full tournament tree with all matchups</li>
                                    </ul>

                                    <h3 style={{ color: '#93c5fd', marginTop: '1.5rem' }}>Simulation</h3>
                                    <ul style={{ lineHeight: '2', color: '#e2e8f0' }}>
                                        <li><strong>Sim Day:</strong> Play one playoff day at a time</li>
                                        <li><strong>Conference Alternation:</strong> East and West games alternate days</li>
                                        <li><strong>Series Progress:</strong> Track wins needed in bracket</li>
                                        <li><strong>Separate Stats:</strong> Playoff stats tracked separately from regular season</li>
                                    </ul>
                                </div>

                                {/* TIPS & STRATEGIES */}
                                <div className="card" style={{ background: 'rgba(34, 211, 238, 0.1)', border: '2px solid #22d3ee', marginTop: '2rem' }}>
                                    <h2 style={{ color: '#22d3ee' }}>ðŸ’¡ Tips & Strategies</h2>
                                    
                                    <h3 style={{ color: '#93c5fd', marginTop: '1.5rem' }}>Building a Winner</h3>
                                    <ul style={{ lineHeight: '2', color: '#e2e8f0' }}>
                                        <li><strong>Balance Depth:</strong> Deep teams handle injuries better than top-heavy teams</li>
                                        <li><strong>Line Chemistry:</strong> Put your best players on Line 1, they get most ice time</li>
                                        <li><strong>Special Teams:</strong> Good PP/PK units can swing games</li>
                                        <li><strong>Goaltending:</strong> Elite goalie (88+ OVR) can carry a team</li>
                                        <li><strong>Youth & Development:</strong> Young players with high potential grow over time</li>
                                    </ul>

                                    <h3 style={{ color: '#93c5fd', marginTop: '1.5rem' }}>Smart Roster Moves</h3>
                                    <ul style={{ lineHeight: '2', color: '#e2e8f0' }}>
                                        <li><strong>Call Up Prospects:</strong> Give young players NHL experience to develop faster</li>
                                        <li><strong>Manage Ice Time:</strong> Rest veterans on Line 4 to reduce injury risk</li>
                                        <li><strong>Platoon Goalies:</strong> Use backup 20-25 games to keep starter fresh</li>
                                        <li><strong>In-Position Play:</strong> Avoid -3 OVR penalty by playing natural positions</li>
                                    </ul>

                                    <h3 style={{ color: '#93c5fd', marginTop: '1.5rem' }}>Reading the Stats</h3>
                                    <ul style={{ lineHeight: '2', color: '#e2e8f0' }}>
                                        <li><strong>+/- Matters:</strong> High +/- means player is on ice for goals for > against</li>
                                        <li><strong>TOI = Value:</strong> Players with high TOI are trusted by "coach"</li>
                                        <li><strong>Shots = Chances:</strong> High shots usually means offensive zone time</li>
                                        <li><strong>PIM:</strong> Some penalty minutes are fine, too many hurt team</li>
                                    </ul>
                                </div>

                                {/* TECHNICAL INFO */}
                                <div className="card" style={{ background: 'rgba(100, 116, 139, 0.2)', border: '2px solid #64748b', marginTop: '2rem' }}>
                                    <h2 style={{ color: '#cbd5e1' }}>âš™ï¸ Technical Information</h2>
                                    
                                    <h3 style={{ color: '#93c5fd', marginTop: '1.5rem' }}>Save System</h3>
                                    <ul style={{ lineHeight: '2', color: '#e2e8f0' }}>
                                        <li><strong>Auto-Save:</strong> Game saves after every day simulated</li>
                                        <li><strong>Local Storage:</strong> Saves stored in browser (not server)</li>
                                        <li><strong>One Save Slot:</strong> Only one game can be saved at a time</li>
                                        <li><strong>Delete Save:</strong> Settings â†’ ðŸ—‘ï¸ Delete Save to start fresh</li>
                                    </ul>

                                    <h3 style={{ color: '#93c5fd', marginTop: '1.5rem' }}>Performance</h3>
                                    <ul style={{ lineHeight: '2', color: '#e2e8f0' }}>
                                        <li><strong>Optimized Simulation:</strong> Fast season sim with memoization</li>
                                        <li><strong>O(1) Lookups:</strong> Team and player data uses hash maps</li>
                                        <li><strong>No Console Spam:</strong> Debug logging removed for production</li>
                                    </ul>

                                    <h3 style={{ color: '#93c5fd', marginTop: '1.5rem' }}>Browser Compatibility</h3>
                                    <ul style={{ lineHeight: '2', color: '#e2e8f0' }}>
                                        <li><strong>Modern Browsers:</strong> Chrome, Firefox, Safari, Edge (latest versions)</li>
                                        <li><strong>Local Storage Required:</strong> Must allow browser storage for saves</li>
                                        <li><strong>JavaScript Required:</strong> Game runs entirely client-side</li>
                                    </ul>
                                </div>

                                {/* FUTURE FEATURES */}
                                <div className="card" style={{ background: 'rgba(139, 92, 246, 0.1)', border: '2px solid #8b5cf6', marginTop: '2rem' }}>
                                    <h2 style={{ color: '#a78bfa' }}>ðŸ”® Coming Soon</h2>
                                    <p style={{ color: '#e2e8f0', marginBottom: '1rem' }}>
                                        Features in development (see Settings â†’ Roadmap for full list):
                                    </p>
                                    <ul style={{ lineHeight: '2', color: '#e2e8f0' }}>
                                        <li>Player career highs tracking</li>
                                        <li>Advanced search & filters</li>
                                        <li>Trade history</li>
                                        <li>Multi-season franchise mode</li>
                                        <li>Entry draft system</li>
                                        <li>Free agency</li>
                                        <li>Contract & salary cap</li>
                                        <li>Player development & aging</li>
                                    </ul>
                                </div>

                                {/* FEEDBACK */}
                                <div className="card" style={{ background: 'rgba(34, 197, 94, 0.1)', border: '2px solid #22c55e', marginTop: '2rem' }}>
                                    <h2 style={{ color: '#22c55e' }}>ðŸ’¬ Questions or Issues?</h2>
                                    <p style={{ color: '#e2e8f0', lineHeight: '1.8' }}>
                                        This user manual is continuously updated as new features are added. 
                                        If you encounter bugs or have suggestions, the development team is actively improving the game.
                                    </p>
                                    <p style={{ color: '#93c5fd', marginTop: '1rem', fontStyle: 'italic' }}>
                                        Last Updated: December 2025 | Version 1.0
                                    </p>
                                </div>
                            </div>
                        )}

                        {/* PLAYOFF MVP VIEW */}
                        {currentView === 'playoffMVP' && playoffMVP && playoffState && (
                            <div>
                                <div className="card" style={{ 
                                    background: 'linear-gradient(135deg, rgba(245, 158, 11, 0.3), rgba(251, 191, 36, 0.2))', 
                                    border: '3px solid #f59e0b',
                                    textAlign: 'center'
                                }}>
                                    <div style={{ fontSize: '4rem', marginBottom: '1rem' }}>ðŸ†</div>
                                    <h1 style={{ color: '#fbbf24', marginBottom: '1rem', fontSize: '2.5rem' }}>
                                        Stanley Cup Champions
                                    </h1>
                                    <h2 style={{ color: '#fff', fontSize: '2rem', marginBottom: '2rem' }}>
                                        {TEAMS.find(t => t.id === playoffState.champion)?.city} {TEAMS.find(t => t.id === playoffState.champion)?.name}
                                    </h2>
                                    
                                    <div style={{ 
                                        marginTop: '2rem', 
                                        padding: '2rem',
                                        background: 'rgba(0, 0, 0, 0.3)',
                                        borderRadius: '1rem'
                                    }}>
                                        <h2 style={{ color: '#fbbf24', marginBottom: '1rem', fontSize: '1.8rem' }}>
                                            ðŸ’Ž Playoff MVP
                                        </h2>
                                        <h3 style={{ color: '#fff', fontSize: '2rem', fontWeight: 'bold', marginBottom: '0.5rem' }}>
                                            {playoffMVP.firstName} {playoffMVP.lastName}
                                        </h3>
                                        <div style={{ color: '#93c5fd', fontSize: '1.2rem', marginBottom: '1.5rem' }}>
                                            {TEAMS.find(t => t.id === playoffMVP.teamId)?.city} {TEAMS.find(t => t.id === playoffMVP.teamId)?.name}
                                        </div>
                                        
                                        <div style={{ 
                                            display: 'flex', 
                                            justifyContent: 'center', 
                                            gap: '3rem',
                                            fontSize: '1.5rem',
                                            color: '#e2e8f0',
                                            marginTop: '1.5rem'
                                        }}>
                                            {playoffMVP.position === 'G' ? (
                                                <>
                                                    <div>
                                                        <div style={{ color: '#93c5fd', fontSize: '1rem' }}>Record</div>
                                                        <div style={{ fontWeight: 'bold' }}>{playoffMVP.playoffStats.wins}-{playoffMVP.playoffStats.losses}</div>
                                                    </div>
                                                    <div>
                                                        <div style={{ color: '#93c5fd', fontSize: '1rem' }}>Save %</div>
                                                        <div style={{ fontWeight: 'bold' }}>{playoffMVP.playoffStats.savePercentage.toFixed(3)}</div>
                                                    </div>
                                                    <div>
                                                        <div style={{ color: '#93c5fd', fontSize: '1rem' }}>GAA</div>
                                                        <div style={{ fontWeight: 'bold' }}>{playoffMVP.playoffStats.gaa.toFixed(2)}</div>
                                                    </div>
                                                    <div>
                                                        <div style={{ color: '#93c5fd', fontSize: '1rem' }}>SO</div>
                                                        <div style={{ fontWeight: 'bold' }}>{playoffMVP.playoffStats.shutouts}</div>
                                                    </div>
                                                </>
                                            ) : (
                                                <>
                                                    <div>
                                                        <div style={{ color: '#93c5fd', fontSize: '1rem' }}>Goals</div>
                                                        <div style={{ fontWeight: 'bold' }}>{playoffMVP.playoffStats.goals}</div>
                                                    </div>
                                                    <div>
                                                        <div style={{ color: '#93c5fd', fontSize: '1rem' }}>Assists</div>
                                                        <div style={{ fontWeight: 'bold' }}>{playoffMVP.playoffStats.assists}</div>
                                                    </div>
                                                    <div>
                                                        <div style={{ color: '#93c5fd', fontSize: '1rem' }}>Points</div>
                                                        <div style={{ fontWeight: 'bold' }}>{playoffMVP.playoffStats.points}</div>
                                                    </div>
                                                    <div>
                                                        <div style={{ color: '#93c5fd', fontSize: '1rem' }}>+/-</div>
                                                        <div style={{ fontWeight: 'bold' }}>
                                                            {playoffMVP.playoffStats.plusMinus > 0 ? '+' : ''}{playoffMVP.playoffStats.plusMinus}
                                                        </div>
                                                    </div>
                                                </>
                                            )}
                                        </div>
                                    </div>
                                    
                                    <button 
                                        onClick={() => {
                                            setCurrentView('playoffs');
                                        }}
                                        style={{
                                            marginTop: '2rem',
                                            padding: '0.75rem 1.5rem',
                                            background: '#3b82f6',
                                            color: '#fff',
                                            border: 'none',
                                            borderRadius: '0.5rem',
                                            fontSize: '1.1rem',
                                            cursor: 'pointer',
                                            fontWeight: 'bold'
                                        }}
                                    >
                                        View Playoff Bracket
                                    </button>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<HockeyGM />);
    </script>
</body>
</html>